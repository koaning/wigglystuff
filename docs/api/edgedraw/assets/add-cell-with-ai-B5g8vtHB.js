var Ni=Object.defineProperty;var Ri=(t,e,a)=>e in t?Ni(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var L=(t,e,a)=>Ri(t,typeof e!="symbol"?e+"":e,a);import{s as xt,t as Pi}from"./chunk-DZLz74EQ.js";import{c as Mi,i as ji,n as rs,s as Zi,u as ss}from"./jotai-C7U7c6dd.js";import{t as $i}from"./react-cj45iF1i.js";import{At as Li,Bt as Di,Cr as Fi,Dr as zi,Fr as ns,Ht as Ui,Ir as Vi,Ut as is,Yn as Bi,bt as Wi,cn as os,d as qi,fr as Ji,i as Ki,kr as Yi,lr as Gi,tt as Ka,ut as Hi,vn as Qi,vt as Xi,w as ls,y as ct}from"./cells-CAMtfgeb.js";import{A as h,D as Ya,E as N,F as y,G as Ga,H as j,I as z,L as pt,N as ie,O as pa,P as Me,R,S as us,T as ma,U as ds,V as U,Y as cs,b as kt,j as Ae,k as ps,w as me,x as mt,z as d}from"./zod-U2NFpcFA.js";import{t as Ha}from"./compiler-runtime-bbSa6V1W.js";import{o as eo,u as he}from"./hotkeys-jCLisiwR.js";import{a as to}from"./config-DOzlN8_n.js";import{t as ao}from"./jsx-runtime-DmpivWpf.js";import{t as ms}from"./cn-BaXqCYqP.js";import{t as We}from"./button-DCB7VoVL.js";import{Gt as ha,Jt as ro,Kt as fa,Rt as so,Vt as hs,bt as ga,ot as no,rt as fs,st as gs,tt as Qa,yt as io,zt as oo}from"./dist-C6GW8SWp.js";import{G as ys,R as lo,X as uo}from"./Output-bwodJiCi.js";import{t as co}from"./createReducer-CTvsuJZY.js";import{r as po,t as mo}from"./requests-CftYh9v2.js";import{h as ho,n as fo,o as go,r as yo}from"./dist-0FJpM7wG.js";import{a as vo}from"./dist-DrAMGx2E.js";import{t as vs}from"./use-toast-BBrPeu2N.js";import{i as bo}from"./useLifecycle-DiLWmtpP.js";import{n as _o}from"./useTheme-Dsb69ewj.js";import{t as bs}from"./createLucideIcon-DbfgBYhq.js";import{t as xo}from"./ai-model-dropdown-BuNmF2aO.js";import{h as ko}from"./select-E33nSIDn.js";import{a as wo}from"./download-C81Fxkfa.js";import{a as _s,c as Io,p as Eo,r as To,t as Co}from"./dropdown-menu-k3cvSs56.js";import{n as So}from"./spinner-CM1AwwT-.js";import{a as Nt,c as Ao,i as Rt,o as Vt,r as Oo,s as Bt}from"./MarimoErrorOutput-CkZl2oHu.js";import{r as No}from"./name-cell-input-kfZkR5qv.js";import{n as Ro}from"./ConsoleOutput-BwPQWTZk.js";import{a as Po}from"./state-dWjslxDZ.js";import{t as Mo}from"./tooltip-QlUG_0sW.js";import{t as jo}from"./shim-DuR5ZJNr.js";import{n as Zo}from"./useEvent-mw3fc-le.js";import{i as $o}from"./error-banner-B98iBZZ2.js";import{n as Lo}from"./useRunCells-DSf9mKXo.js";import{n as Wt}from"./renderShortcut-Cp1zXREV.js";import{i as Xa}from"./cell-link-CGc-QK-U.js";import{r as Do,t as Fo}from"./esm-DXZXojh_.js";import{t as zo}from"./blob-BgGJeXvG.js";import{t as Uo}from"./useDeleteCell-yV4YK-xy.js";import{n as Vo}from"./add-missing-import-CgnlhMvv.js";import{n as Bo}from"./icons-DVWpV4I_.js";var Wo=bs("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),qo=bs("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),xs="vercel.ai.error",Jo=Symbol.for(xs),ks,Ko=class wi extends Error{constructor({name:e,message:a,cause:r}){super(a),this[ks]=!0,this.name=e,this.cause=r}static isInstance(e){return wi.hasMarker(e,xs)}static hasMarker(e,a){let r=Symbol.for(a);return typeof e=="object"&&!!e&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};ks=Jo;var qe=Ko;function ws(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Is="AI_InvalidArgumentError",Es=`vercel.ai.error.${Is}`,Yo=Symbol.for(Es),Ts,Cs=class extends qe{constructor({message:t,cause:e,argument:a}){super({name:Is,message:t,cause:e}),this[Ts]=!0,this.argument=a}static isInstance(t){return qe.hasMarker(t,Es)}};Ts=Yo;var Ss="AI_JSONParseError",As=`vercel.ai.error.${Ss}`,Go=Symbol.for(As),Os,ya=class extends qe{constructor({text:t,cause:e}){super({name:Ss,message:`JSON parsing failed: Text: ${t}.
Error message: ${ws(e)}`,cause:e}),this[Os]=!0,this.text=t}static isInstance(t){return qe.hasMarker(t,As)}};Os=Go;var Ns="AI_TypeValidationError",Rs=`vercel.ai.error.${Ns}`,Ho=Symbol.for(Rs),Ps,Qo=class Hr extends qe{constructor({value:e,cause:a}){super({name:Ns,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${ws(a)}`,cause:a}),this[Ps]=!0,this.value=e}static isInstance(e){return qe.hasMarker(e,Rs)}static wrap({value:e,cause:a}){return Hr.isInstance(a)&&a.value===e?a:new Hr({value:e,cause:a})}};Ps=Ho;var wt=Qo,Ms=class extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function er(t){}function Xo(t){if(typeof t=="function")throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=er,onError:a=er,onRetry:r=er,onComment:s}=t,n="",i=!0,o,l="",u="";function c(v){let p=i?v.replace(/^\xEF\xBB\xBF/,""):v,[g,k]=el(`${n}${p}`);for(let I of g)m(I);n=k,i=!1}function m(v){if(v===""){x();return}if(v.startsWith(":")){s&&s(v.slice(v.startsWith(": ")?2:1));return}let p=v.indexOf(":");if(p!==-1){let g=v.slice(0,p),k=v[p+1]===" "?2:1;b(g,v.slice(p+k),v);return}b(v,"",v)}function b(v,p,g){switch(v){case"event":u=p;break;case"data":l=`${l}${p}
`;break;case"id":o=p.includes("\0")?void 0:p;break;case"retry":/^\d+$/.test(p)?r(parseInt(p,10)):a(new Ms(`Invalid \`retry\` value: "${p}"`,{type:"invalid-retry",value:p,line:g}));break;default:a(new Ms(`Unknown field "${v.length>20?`${v.slice(0,20)}\u2026`:v}"`,{type:"unknown-field",field:v,value:p,line:g}));break}}function x(){l.length>0&&e({id:o,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",u=""}function w(v={}){n&&v.consume&&m(n),i=!0,o=void 0,l="",u="",n=""}return{feed:c,reset:w}}function el(t){let e=[],a="",r=0;for(;r<t.length;){let s=t.indexOf("\r",r),n=t.indexOf(`
`,r),i=-1;if(s!==-1&&n!==-1?i=Math.min(s,n):s===-1?n!==-1&&(i=n):i=s===t.length-1?-1:s,i===-1){a=t.slice(r);break}else{let o=t.slice(r,i);e.push(o),r=i+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,a]}var js=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:a}={}){let r;super({start(s){r=Xo({onEvent:n=>{s.enqueue(n)},onError(n){t==="terminate"?s.error(n):typeof t=="function"&&t(n)},onRetry:e,onComment:a})},transform(s){r.feed(s)}})}},J;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function a(s){throw Error()}t.assertNever=a,t.arrayToEnum=s=>{let n={};for(let i of s)n[i]=i;return n},t.getValidEnumValues=s=>{let n=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(let o of n)i[o]=s[o];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(n){return s[n]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&n.push(i);return n},t.find=(s,n)=>{for(let i of s)if(n(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,n=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(n)}t.joinValues=r,t.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(J||(J={}));var tl;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(tl||(tl={}));const T=J.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ht=t=>{switch(typeof t){case"undefined":return T.undefined;case"string":return T.string;case"number":return Number.isNaN(t)?T.nan:T.number;case"boolean":return T.boolean;case"function":return T.function;case"bigint":return T.bigint;case"symbol":return T.symbol;case"object":return Array.isArray(t)?T.array:t===null?T.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?T.promise:typeof Map<"u"&&t instanceof Map?T.map:typeof Set<"u"&&t instanceof Set?T.set:typeof Date<"u"&&t instanceof Date?T.date:T.object;default:return T.unknown}},_=J.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var Je=class Ii extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(n){return n.message},r={_errors:[]},s=n=>{for(let i of n.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(a(i));else{let o=r,l=0;for(;l<i.path.length;){let u=i.path[l];l===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(a(i))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),r}static assert(e){if(!(e instanceof Ii))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,J.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a={},r=[];for(let s of this.issues)if(s.path.length>0){let n=s.path[0];a[n]=a[n]||[],a[n].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};Je.create=t=>new Je(t);var qt=(t,e)=>{let a;switch(t.code){case _.invalid_type:a=t.received===T.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case _.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,J.jsonStringifyReplacer)}`;break;case _.unrecognized_keys:a=`Unrecognized key(s) in object: ${J.joinValues(t.keys,", ")}`;break;case _.invalid_union:a="Invalid input";break;case _.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${J.joinValues(t.options)}`;break;case _.invalid_enum_value:a=`Invalid enum value. Expected ${J.joinValues(t.options)}, received '${t.received}'`;break;case _.invalid_arguments:a="Invalid function arguments";break;case _.invalid_return_type:a="Invalid function return type";break;case _.invalid_date:a="Invalid date";break;case _.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:J.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case _.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case _.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case _.custom:a="Invalid input";break;case _.invalid_intersection_types:a="Intersection results could not be merged";break;case _.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case _.not_finite:a="Number must be finite";break;default:a=e.defaultError,J.assertNever(t)}return{message:a}},al=qt;function tr(){return al}const ar=t=>{let{data:e,path:a,errorMaps:r,issueData:s}=t,n=[...a,...s.path||[]],i={...s,path:n};if(s.message!==void 0)return{...s,path:n,message:s.message};let o="",l=r.filter(u=>!!u).slice().reverse();for(let u of l)o=u(i,{data:e,defaultError:o}).message;return{...s,path:n,message:o}};function E(t,e){let a=tr(),r=ar({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===qt?void 0:qt].filter(s=>!!s)});t.common.issues.push(r)}var Ee=class Ei{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let r=[];for(let s of a){if(s.status==="aborted")return P;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,a){let r=[];for(let s of a){let n=await s.key,i=await s.value;r.push({key:n,value:i})}return Ei.mergeObjectSync(e,r)}static mergeObjectSync(e,a){let r={};for(let s of a){let{key:n,value:i}=s;if(n.status==="aborted"||i.status==="aborted")return P;n.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(i.value!==void 0||s.alwaysSet)&&(r[n.value]=i.value)}return{status:e.value,value:r}}};const P=Object.freeze({status:"aborted"}),rr=t=>({status:"dirty",value:t}),ke=t=>({status:"valid",value:t}),Zs=t=>t.status==="aborted",$s=t=>t.status==="dirty",Pt=t=>t.status==="valid",va=t=>typeof Promise<"u"&&t instanceof Promise;var C;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(C||(C={}));var Ke=class{constructor(t,e,a,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ls=(t,e)=>{if(Pt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new Je(t.common.issues)),this._error}}};function $(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:r,description:s}=t;if(e&&(a||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(n,i)=>{let{message:o}=t;return n.code==="invalid_enum_value"?{message:o??i.defaultError}:i.data===void 0?{message:o??r??i.defaultError}:n.code==="invalid_type"?{message:o??a??i.defaultError}:{message:i.defaultError}},description:s}}var D=class{get description(){return this._def.description}_getType(t){return ht(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:ht(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Ee,ctx:{common:t.parent.common,data:t.data,parsedType:ht(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(va(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ht(t)};return Ls(a,this._parseSync({data:t,path:a.path,parent:a}))}"~validate"(t){var a,r;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ht(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:e});return Pt(s)?{value:s.value}:{issues:e.common.issues}}catch(s){(r=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(s=>Pt(s)?{value:s.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ht(t)},r=this._parse({data:t,path:a.path,parent:a});return Ls(a,await(va(r)?r:Promise.resolve(r)))}refine(t,e){let a=r=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,s)=>{let n=t(r),i=()=>s.addIssue({code:_.custom,...a(r)});return typeof Promise<"u"&&n instanceof Promise?n.then(o=>o?!0:(i(),!1)):n?!0:(i(),!1)})}refinement(t,e){return this._refinement((a,r)=>t(a)?!0:(r.addIssue(typeof e=="function"?e(a,r):e),!1))}_refinement(t){return new at({schema:this,typeName:f.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return rt.create(this,this._def)}nullable(){return Et.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jt.create(this)}promise(){return Jt.create(this,this._def)}or(t){return ka.create([this,t],this._def)}and(t){return wa.create(this,t,this._def)}transform(t){return new at({...$(this._def),schema:this,typeName:f.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new Sa({...$(this._def),innerType:this,defaultValue:e,typeName:f.ZodDefault})}brand(){return new Vs({typeName:f.ZodBranded,type:this,...$(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new Aa({...$(this._def),innerType:this,catchValue:e,typeName:f.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return Bs.create(this,t)}readonly(){return Oa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},rl=/^c[^\s-]{8,}$/i,sl=/^[0-9a-z]+$/,nl=/^[0-9A-HJKMNP-TV-Z]{26}$/i,il=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ol=/^[a-z0-9_-]{21}$/i,ll=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ul=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,dl=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,cl="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ds,pl=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ml=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,hl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,fl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,gl=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,yl=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Fs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",vl=RegExp(`^${Fs}$`);function zs(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function bl(t){return RegExp(`^${zs(t)}$`)}function _l(t){let e=`${Fs}T${zs(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function xl(t,e){return!!((e==="v4"||!e)&&pl.test(t)||(e==="v6"||!e)&&hl.test(t))}function kl(t,e){if(!ll.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||!s||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function wl(t,e){return!!((e==="v4"||!e)&&ml.test(t)||(e==="v6"||!e)&&fl.test(t))}var ba=class la extends D{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==T.string){let s=this._getOrReturnCtx(e);return E(s,{code:_.invalid_type,expected:T.string,received:s.parsedType}),P}let a=new Ee,r;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let n=e.data.length>s.value,i=e.data.length<s.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?E(r,{code:_.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&E(r,{code:_.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")dl.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"email",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")Ds||(Ds=new RegExp(cl,"u")),Ds.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"emoji",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")il.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"uuid",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")ol.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"nanoid",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")rl.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"cuid",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")sl.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"cuid2",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")nl.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"ulid",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),E(r,{validation:"url",code:_.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"regex",code:_.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?_l(s).test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?vl.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?bl(s).test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?ul.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"duration",code:_.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?xl(e.data,s.version)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"ip",code:_.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?kl(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"jwt",code:_.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?wl(e.data,s.version)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"cidr",code:_.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?gl.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"base64",code:_.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?yl.test(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{validation:"base64url",code:_.invalid_string,message:s.message}),a.dirty()):J.assertNever(s);return{status:a.value,value:e.data}}_regex(e,a,r){return this.refinement(s=>e.test(s),{validation:a,code:_.invalid_string,...C.errToObj(r)})}_addCheck(e){return new la({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...C.errToObj(e)})}url(e){return this._addCheck({kind:"url",...C.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...C.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...C.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...C.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...C.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...C.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...C.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...C.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...C.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...C.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...C.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...C.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...C.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...C.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...C.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...C.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...C.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...C.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...C.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...C.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...C.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...C.errToObj(a)})}nonempty(e){return this.min(1,C.errToObj(e))}trim(){return new la({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new la({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new la({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};ba.create=t=>new ba({checks:[],typeName:f.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...$(t)});function Il(t,e){let a=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=a>r?a:r;return Number.parseInt(t.toFixed(s).replace(".",""))%Number.parseInt(e.toFixed(s).replace(".",""))/10**s}var sr=class Qr extends D{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==T.number){let s=this._getOrReturnCtx(e);return E(s,{code:_.invalid_type,expected:T.number,received:s.parsedType}),P}let a,r=new Ee;for(let s of this._def.checks)s.kind==="int"?J.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),E(a,{code:_.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),E(a,{code:_.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),E(a,{code:_.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?Il(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),E(a,{code:_.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),E(a,{code:_.not_finite,message:s.message}),r.dirty()):J.assertNever(s);return{status:r.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,C.toString(a))}gt(e,a){return this.setLimit("min",e,!1,C.toString(a))}lte(e,a){return this.setLimit("max",e,!0,C.toString(a))}lt(e,a){return this.setLimit("max",e,!1,C.toString(a))}setLimit(e,a,r,s){return new Qr({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:C.toString(s)}]})}_addCheck(e){return new Qr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:C.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:C.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:C.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:C.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:C.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&J.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(a)&&Number.isFinite(e)}};sr.create=t=>new sr({checks:[],typeName:f.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...$(t)});var nr=class Xr extends D{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==T.bigint)return this._getInvalidInput(e);let a,r=new Ee;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),E(a,{code:_.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),E(a,{code:_.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),E(a,{code:_.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):J.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return E(a,{code:_.invalid_type,expected:T.bigint,received:a.parsedType}),P}gte(e,a){return this.setLimit("min",e,!0,C.toString(a))}gt(e,a){return this.setLimit("min",e,!1,C.toString(a))}lte(e,a){return this.setLimit("max",e,!0,C.toString(a))}lt(e,a){return this.setLimit("max",e,!1,C.toString(a))}setLimit(e,a,r,s){return new Xr({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:C.toString(s)}]})}_addCheck(e){return new Xr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:C.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};nr.create=t=>new nr({checks:[],typeName:f.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...$(t)});var ir=class extends D{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==T.boolean){let e=this._getOrReturnCtx(t);return E(e,{code:_.invalid_type,expected:T.boolean,received:e.parsedType}),P}return ke(t.data)}};ir.create=t=>new ir({typeName:f.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...$(t)});var or=class Ti extends D{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==T.date){let s=this._getOrReturnCtx(e);return E(s,{code:_.invalid_type,expected:T.date,received:s.parsedType}),P}if(Number.isNaN(e.data.getTime()))return E(this._getOrReturnCtx(e),{code:_.invalid_date}),P;let a=new Ee,r;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):J.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ti({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:C.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:C.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};or.create=t=>new or({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:f.ZodDate,...$(t)});var lr=class extends D{_parse(t){if(this._getType(t)!==T.symbol){let e=this._getOrReturnCtx(t);return E(e,{code:_.invalid_type,expected:T.symbol,received:e.parsedType}),P}return ke(t.data)}};lr.create=t=>new lr({typeName:f.ZodSymbol,...$(t)});var _a=class extends D{_parse(t){if(this._getType(t)!==T.undefined){let e=this._getOrReturnCtx(t);return E(e,{code:_.invalid_type,expected:T.undefined,received:e.parsedType}),P}return ke(t.data)}};_a.create=t=>new _a({typeName:f.ZodUndefined,...$(t)});var xa=class extends D{_parse(t){if(this._getType(t)!==T.null){let e=this._getOrReturnCtx(t);return E(e,{code:_.invalid_type,expected:T.null,received:e.parsedType}),P}return ke(t.data)}};xa.create=t=>new xa({typeName:f.ZodNull,...$(t)});var ur=class extends D{constructor(){super(...arguments),this._any=!0}_parse(t){return ke(t.data)}};ur.create=t=>new ur({typeName:f.ZodAny,...$(t)});var Mt=class extends D{constructor(){super(...arguments),this._unknown=!0}_parse(t){return ke(t.data)}};Mt.create=t=>new Mt({typeName:f.ZodUnknown,...$(t)});var ft=class extends D{_parse(t){let e=this._getOrReturnCtx(t);return E(e,{code:_.invalid_type,expected:T.never,received:e.parsedType}),P}};ft.create=t=>new ft({typeName:f.ZodNever,...$(t)});var dr=class extends D{_parse(t){if(this._getType(t)!==T.undefined){let e=this._getOrReturnCtx(t);return E(e,{code:_.invalid_type,expected:T.void,received:e.parsedType}),P}return ke(t.data)}};dr.create=t=>new dr({typeName:f.ZodVoid,...$(t)});var jt=class qa extends D{_parse(e){let{ctx:a,status:r}=this._processInputParams(e),s=this._def;if(a.parsedType!==T.array)return E(a,{code:_.invalid_type,expected:T.array,received:a.parsedType}),P;if(s.exactLength!==null){let i=a.data.length>s.exactLength.value,o=a.data.length<s.exactLength.value;(i||o)&&(E(a,{code:i?_.too_big:_.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&a.data.length<s.minLength.value&&(E(a,{code:_.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&a.data.length>s.maxLength.value&&(E(a,{code:_.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((i,o)=>s.type._parseAsync(new Ke(a,i,a.path,o)))).then(i=>Ee.mergeArray(r,i));let n=[...a.data].map((i,o)=>s.type._parseSync(new Ke(a,i,a.path,o)));return Ee.mergeArray(r,n)}get element(){return this._def.type}min(e,a){return new qa({...this._def,minLength:{value:e,message:C.toString(a)}})}max(e,a){return new qa({...this._def,maxLength:{value:e,message:C.toString(a)}})}length(e,a){return new qa({...this._def,exactLength:{value:e,message:C.toString(a)}})}nonempty(e){return this.min(1,e)}};jt.create=(t,e)=>new jt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:f.ZodArray,...$(e)});function Zt(t){if(t instanceof je){let e={};for(let a in t.shape){let r=t.shape[a];e[a]=rt.create(Zt(r))}return new je({...t._def,shape:()=>e})}else return t instanceof jt?new jt({...t._def,type:Zt(t.element)}):t instanceof rt?rt.create(Zt(t.unwrap())):t instanceof Et?Et.create(Zt(t.unwrap())):t instanceof It?It.create(t.items.map(e=>Zt(e))):t}var je=class ze extends D{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:J.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==T.object){let l=this._getOrReturnCtx(e);return E(l,{code:_.invalid_type,expected:T.object,received:l.parsedType}),P}let{status:a,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),i=[];if(!(this._def.catchall instanceof ft&&this._def.unknownKeys==="strip"))for(let l in r.data)n.includes(l)||i.push(l);let o=[];for(let l of n){let u=s[l],c=r.data[l];o.push({key:{status:"valid",value:l},value:u._parse(new Ke(r,c,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof ft){let l=this._def.unknownKeys;if(l==="passthrough")for(let u of i)o.push({key:{status:"valid",value:u},value:{status:"valid",value:r.data[u]}});else if(l==="strict")i.length>0&&(E(r,{code:_.unrecognized_keys,keys:i}),a.dirty());else if(l!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let u of i){let c=r.data[u];o.push({key:{status:"valid",value:u},value:l._parse(new Ke(r,c,r.path,u)),alwaysSet:u in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let l=[];for(let u of o){let c=await u.key,m=await u.value;l.push({key:c,value:m,alwaysSet:u.alwaysSet})}return l}).then(l=>Ee.mergeObjectSync(a,l)):Ee.mergeObjectSync(a,o)}get shape(){return this._def.shape()}strict(e){return C.errToObj,new ze({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,r)=>{var n,i;let s=((i=(n=this._def).errorMap)==null?void 0:i.call(n,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:C.errToObj(e).message??s}:{message:s}}}})}strip(){return new ze({...this._def,unknownKeys:"strip"})}passthrough(){return new ze({...this._def,unknownKeys:"passthrough"})}extend(e){return new ze({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ze({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:f.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new ze({...this._def,catchall:e})}pick(e){let a={};for(let r of J.objectKeys(e))e[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new ze({...this._def,shape:()=>a})}omit(e){let a={};for(let r of J.objectKeys(this.shape))e[r]||(a[r]=this.shape[r]);return new ze({...this._def,shape:()=>a})}deepPartial(){return Zt(this)}partial(e){let a={};for(let r of J.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?a[r]=s:a[r]=s.optional()}return new ze({...this._def,shape:()=>a})}required(e){let a={};for(let r of J.objectKeys(this.shape))if(e&&!e[r])a[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof rt;)s=s._def.innerType;a[r]=s}return new ze({...this._def,shape:()=>a})}keyof(){return Us(J.objectKeys(this.shape))}};je.create=(t,e)=>new je({shape:()=>t,unknownKeys:"strip",catchall:ft.create(),typeName:f.ZodObject,...$(e)}),je.strictCreate=(t,e)=>new je({shape:()=>t,unknownKeys:"strict",catchall:ft.create(),typeName:f.ZodObject,...$(e)}),je.lazycreate=(t,e)=>new je({shape:t,unknownKeys:"strip",catchall:ft.create(),typeName:f.ZodObject,...$(e)});var ka=class extends D{_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function r(s){for(let i of s)if(i.result.status==="valid")return i.result;for(let i of s)if(i.result.status==="dirty")return e.common.issues.push(...i.ctx.common.issues),i.result;let n=s.map(i=>new Je(i.ctx.common.issues));return E(e,{code:_.invalid_union,unionErrors:n}),P}if(e.common.async)return Promise.all(a.map(async s=>{let n={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}})).then(r);{let s,n=[];for(let o of a){let l={...e,common:{...e.common,issues:[]},parent:null},u=o._parseSync({data:e.data,path:e.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!s&&(s={result:u,ctx:l}),l.common.issues.length&&n.push(l.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;let i=n.map(o=>new Je(o));return E(e,{code:_.invalid_union,unionErrors:i}),P}}get options(){return this._def.options}};ka.create=(t,e)=>new ka({options:t,typeName:f.ZodUnion,...$(e)});var gt=t=>t instanceof Ia?gt(t.schema):t instanceof at?gt(t.innerType()):t instanceof Ea?[t.value]:t instanceof Ta?t.options:t instanceof Ca?J.objectValues(t.enum):t instanceof Sa?gt(t._def.innerType):t instanceof _a?[void 0]:t instanceof xa?[null]:t instanceof rt?[void 0,...gt(t.unwrap())]:t instanceof Et?[null,...gt(t.unwrap())]:t instanceof Vs||t instanceof Oa?gt(t.unwrap()):t instanceof Aa?gt(t._def.innerType):[],El=class Ci extends D{_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==T.object)return E(a,{code:_.invalid_type,expected:T.object,received:a.parsedType}),P;let r=this.discriminator,s=a.data[r],n=this.optionsMap.get(s);return n?a.common.async?n._parseAsync({data:a.data,path:a.path,parent:a}):n._parseSync({data:a.data,path:a.path,parent:a}):(E(a,{code:_.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),P)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,r){let s=new Map;for(let n of a){let i=gt(n.shape[e]);if(!i.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(s.has(o))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,n)}}return new Ci({typeName:f.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:s,...$(r)})}};function cr(t,e){let a=ht(t),r=ht(e);if(t===e)return{valid:!0,data:t};if(a===T.object&&r===T.object){let s=J.objectKeys(e),n=J.objectKeys(t).filter(o=>s.indexOf(o)!==-1),i={...t,...e};for(let o of n){let l=cr(t[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(a===T.array&&r===T.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let i=t[n],o=e[n],l=cr(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return a===T.date&&r===T.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var wa=class extends D{_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=(s,n)=>{if(Zs(s)||Zs(n))return P;let i=cr(s.value,n.value);return i.valid?(($s(s)||$s(n))&&e.dirty(),{status:e.value,value:i.data}):(E(a,{code:_.invalid_intersection_types}),P)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,n])=>r(s,n)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};wa.create=(t,e,a)=>new wa({left:t,right:e,typeName:f.ZodIntersection,...$(a)});var It=class Si extends D{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.array)return E(r,{code:_.invalid_type,expected:T.array,received:r.parsedType}),P;if(r.data.length<this._def.items.length)return E(r,{code:_.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),P;!this._def.rest&&r.data.length>this._def.items.length&&(E(r,{code:_.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let s=[...r.data].map((n,i)=>{let o=this._def.items[i]||this._def.rest;return o?o._parse(new Ke(r,n,r.path,i)):null}).filter(n=>!!n);return r.common.async?Promise.all(s).then(n=>Ee.mergeArray(a,n)):Ee.mergeArray(a,s)}get items(){return this._def.items}rest(e){return new Si({...this._def,rest:e})}};It.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new It({items:t,typeName:f.ZodTuple,rest:null,...$(e)})};var Tl=class es extends D{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.object)return E(r,{code:_.invalid_type,expected:T.object,received:r.parsedType}),P;let s=[],n=this._def.keyType,i=this._def.valueType;for(let o in r.data)s.push({key:n._parse(new Ke(r,o,r.path,o)),value:i._parse(new Ke(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Ee.mergeObjectAsync(a,s):Ee.mergeObjectSync(a,s)}get element(){return this._def.valueType}static create(e,a,r){return a instanceof D?new es({keyType:e,valueType:a,typeName:f.ZodRecord,...$(r)}):new es({keyType:ba.create(),valueType:e,typeName:f.ZodRecord,...$(a)})}},pr=class extends D{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==T.map)return E(a,{code:_.invalid_type,expected:T.map,received:a.parsedType}),P;let r=this._def.keyType,s=this._def.valueType,n=[...a.data.entries()].map(([i,o],l)=>({key:r._parse(new Ke(a,i,a.path,[l,"key"])),value:s._parse(new Ke(a,o,a.path,[l,"value"]))}));if(a.common.async){let i=new Map;return Promise.resolve().then(async()=>{for(let o of n){let l=await o.key,u=await o.value;if(l.status==="aborted"||u.status==="aborted")return P;(l.status==="dirty"||u.status==="dirty")&&e.dirty(),i.set(l.value,u.value)}return{status:e.value,value:i}})}else{let i=new Map;for(let o of n){let l=o.key,u=o.value;if(l.status==="aborted"||u.status==="aborted")return P;(l.status==="dirty"||u.status==="dirty")&&e.dirty(),i.set(l.value,u.value)}return{status:e.value,value:i}}}};pr.create=(t,e,a)=>new pr({valueType:e,keyType:t,typeName:f.ZodMap,...$(a)});var mr=class ts extends D{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.set)return E(r,{code:_.invalid_type,expected:T.set,received:r.parsedType}),P;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(E(r,{code:_.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),a.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(E(r,{code:_.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),a.dirty());let n=this._def.valueType;function i(l){let u=new Set;for(let c of l){if(c.status==="aborted")return P;c.status==="dirty"&&a.dirty(),u.add(c.value)}return{status:a.value,value:u}}let o=[...r.data.values()].map((l,u)=>n._parse(new Ke(r,l,r.path,u)));return r.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,a){return new ts({...this._def,minSize:{value:e,message:C.toString(a)}})}max(e,a){return new ts({...this._def,maxSize:{value:e,message:C.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};mr.create=(t,e)=>new mr({valueType:t,minSize:null,maxSize:null,typeName:f.ZodSet,...$(e)});var Cl=class Ja extends D{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==T.function)return E(a,{code:_.invalid_type,expected:T.function,received:a.parsedType}),P;function r(o,l){return ar({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,tr(),qt].filter(u=>!!u),issueData:{code:_.invalid_arguments,argumentsError:l}})}function s(o,l){return ar({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,tr(),qt].filter(u=>!!u),issueData:{code:_.invalid_return_type,returnTypeError:l}})}let n={errorMap:a.common.contextualErrorMap},i=a.data;if(this._def.returns instanceof Jt){let o=this;return ke(async function(...l){let u=new Je([]),c=await o._def.args.parseAsync(l,n).catch(b=>{throw u.addIssue(r(l,b)),u}),m=await Reflect.apply(i,this,c);return await o._def.returns._def.type.parseAsync(m,n).catch(b=>{throw u.addIssue(s(m,b)),u})})}else{let o=this;return ke(function(...l){let u=o._def.args.safeParse(l,n);if(!u.success)throw new Je([r(l,u.error)]);let c=Reflect.apply(i,this,u.data),m=o._def.returns.safeParse(c,n);if(!m.success)throw new Je([s(c,m.error)]);return m.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Ja({...this._def,args:It.create(e).rest(Mt.create())})}returns(e){return new Ja({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,r){return new Ja({args:e||It.create([]).rest(Mt.create()),returns:a||Mt.create(),typeName:f.ZodFunction,...$(r)})}},Ia=class extends D{get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};Ia.create=(t,e)=>new Ia({getter:t,typeName:f.ZodLazy,...$(e)});var Ea=class extends D{_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return E(e,{received:e.data,code:_.invalid_literal,expected:this._def.value}),P}return{status:"valid",value:t.data}}get value(){return this._def.value}};Ea.create=(t,e)=>new Ea({value:t,typeName:f.ZodLiteral,...$(e)});function Us(t,e){return new Ta({values:t,typeName:f.ZodEnum,...$(e)})}var Ta=class as extends D{_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),r=this._def.values;return E(a,{expected:J.joinValues(r),received:a.parsedType,code:_.invalid_type}),P}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),r=this._def.values;return E(a,{received:a.data,code:_.invalid_enum_value,options:r}),P}return ke(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return as.create(e,{...this._def,...a})}exclude(e,a=this._def){return as.create(this.options.filter(r=>!e.includes(r)),{...this._def,...a})}};Ta.create=Us;var Ca=class extends D{_parse(t){let e=J.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==T.string&&a.parsedType!==T.number){let r=J.objectValues(e);return E(a,{expected:J.joinValues(r),received:a.parsedType,code:_.invalid_type}),P}if(this._cache||(this._cache=new Set(J.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let r=J.objectValues(e);return E(a,{received:a.data,code:_.invalid_enum_value,options:r}),P}return ke(t.data)}get enum(){return this._def.values}};Ca.create=(t,e)=>new Ca({values:t,typeName:f.ZodNativeEnum,...$(e)});var Jt=class extends D{unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);return e.parsedType!==T.promise&&e.common.async===!1?(E(e,{code:_.invalid_type,expected:T.promise,received:e.parsedType}),P):ke((e.parsedType===T.promise?e.data:Promise.resolve(e.data)).then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}};Jt.create=(t,e)=>new Jt({type:t,typeName:f.ZodPromise,...$(e)});var at=class extends D{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===f.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=this._def.effect||null,s={addIssue:n=>{E(a,n),n.fatal?e.abort():e.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){let n=r.transform(a.data,s);if(a.common.async)return Promise.resolve(n).then(async i=>{if(e.value==="aborted")return P;let o=await this._def.schema._parseAsync({data:i,path:a.path,parent:a});return o.status==="aborted"?P:o.status==="dirty"||e.value==="dirty"?rr(o.value):o});{if(e.value==="aborted")return P;let i=this._def.schema._parseSync({data:n,path:a.path,parent:a});return i.status==="aborted"?P:i.status==="dirty"||e.value==="dirty"?rr(i.value):i}}if(r.type==="refinement"){let n=i=>{let o=r.refinement(i,s);if(a.common.async)return Promise.resolve(o);if(o instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?P:(i.status==="dirty"&&e.dirty(),n(i.value),{status:e.value,value:i.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>i.status==="aborted"?P:(i.status==="dirty"&&e.dirty(),n(i.value).then(()=>({status:e.value,value:i.value}))))}if(r.type==="transform")if(a.common.async===!1){let n=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Pt(n))return P;let i=r.transform(n.value,s);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:i}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(n=>Pt(n)?Promise.resolve(r.transform(n.value,s)).then(i=>({status:e.value,value:i})):P);J.assertNever(r)}};at.create=(t,e,a)=>new at({schema:t,typeName:f.ZodEffects,effect:e,...$(a)}),at.createWithPreprocess=(t,e,a)=>new at({schema:e,effect:{type:"preprocess",transform:t},typeName:f.ZodEffects,...$(a)});var rt=class extends D{_parse(t){return this._getType(t)===T.undefined?ke(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};rt.create=(t,e)=>new rt({innerType:t,typeName:f.ZodOptional,...$(e)});var Et=class extends D{_parse(t){return this._getType(t)===T.null?ke(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Et.create=(t,e)=>new Et({innerType:t,typeName:f.ZodNullable,...$(e)});var Sa=class extends D{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===T.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};Sa.create=(t,e)=>new Sa({innerType:t,typeName:f.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...$(e)});var Aa=class extends D{_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return va(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Je(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Je(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};Aa.create=(t,e)=>new Aa({innerType:t,typeName:f.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...$(e)});var hr=class extends D{_parse(t){if(this._getType(t)!==T.nan){let e=this._getOrReturnCtx(t);return E(e,{code:_.invalid_type,expected:T.nan,received:e.parsedType}),P}return{status:"valid",value:t.data}}};hr.create=t=>new hr({typeName:f.ZodNaN,...$(t)});var Vs=class extends D{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},Bs=class Ai extends D{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?P:s.status==="dirty"?(a.dirty(),rr(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?P:s.status==="dirty"?(a.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,a){return new Ai({in:e,out:a,typeName:f.ZodPipeline})}},Oa=class extends D{_parse(t){let e=this._def.innerType._parse(t),a=r=>(Pt(r)&&(r.value=Object.freeze(r.value)),r);return va(e)?e.then(r=>a(r)):a(e)}unwrap(){return this._def.innerType}};Oa.create=(t,e)=>new Oa({innerType:t,typeName:f.ZodReadonly,...$(e)}),je.lazycreate;var f;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(f||(f={})),ba.create,sr.create,hr.create,nr.create,ir.create,or.create,lr.create,_a.create,xa.create,ur.create,Mt.create,ft.create,dr.create,jt.create,je.create,je.strictCreate,ka.create,El.create,wa.create,It.create,Tl.create,pr.create,mr.create,Cl.create,Ia.create,Ea.create,Ta.create,Ca.create,Jt.create,at.create,rt.create,Et.create,at.createWithPreprocess,Bs.create;var Kt=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,i=Array(e);for(let o=0;o<e;o++)i[o]=a[Math.random()*n|0];return i.join("")};if(t==null)return s;if(a.includes(r))throw new Cs({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`},Sl=Kt(),Al=/"__proto__"\s*:/,Ol=/"constructor"\s*:/;function Nl(t){let e=JSON.parse(t);return typeof e!="object"||!e||Al.test(t)===!1&&Ol.test(t)===!1?e:Rl(e)}function Rl(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function Pl(t){let{stackTraceLimit:e}=Error;Error.stackTraceLimit=0;try{return Nl(t)}finally{Error.stackTraceLimit=e}}var Na=Symbol.for("vercel.ai.validator");function Ml(t){return{[Na]:!0,validate:t}}function jl(t){return typeof t=="object"&&!!t&&Na in t&&t[Na]===!0&&"validate"in t}function Zl(t){return jl(t)?t:$l(t)}function $l(t){return Ml(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new wt({value:e,cause:a.issues})}})}async function Ws({value:t,schema:e}){let a=await fr({value:t,schema:e});if(!a.success)throw wt.wrap({value:t,cause:a.error});return a.value}async function fr({value:t,schema:e}){let a=Zl(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:wt.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:wt.wrap({value:t,cause:r}),rawValue:t}}}async function Ra({text:t,schema:e}){try{let a=Pl(t);return e==null?{success:!0,value:a,rawValue:a}:await fr({value:a,schema:e})}catch(a){return{success:!1,error:ya.isInstance(a)?a:new ya({text:t,cause:a}),rawValue:void 0}}}function qs({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new js).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await Ra({text:a,schema:e}))}}))}async function $t(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}var Ll=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},Dl=Symbol("Let zodToJsonSchema decide on which parser to use"),Js={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Fl=t=>typeof t=="string"?{...Js,name:t}:{...Js,...t};function Te(){return{}}function zl(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==f.ZodAny&&(a.items=Q(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function Ul(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function Vl(){return{type:"boolean"}}function Ks(t,e){return Q(t.type._def,e)}var Bl=(t,e)=>Q(t.innerType._def,e);function Ys(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>Ys(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Wl(t)}}var Wl=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function ql(t,e){return{...Q(t.innerType._def,e),default:t.defaultValue()}}function Jl(t,e){return e.effectStrategy==="input"?Q(t.schema._def,e):Te()}function Kl(t){return{type:"string",enum:Array.from(t.values)}}var Yl=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Gl(t,e){let a=[Q(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Q(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(Yl(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:i,...o}=s;n=o}r.push(n)}}),r.length?{allOf:r}:void 0}function Hl(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var gr=void 0,Ze={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(gr===void 0&&(gr=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),gr),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Gs(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":$e(a,"email",r.message,e);break;case"format:idn-email":$e(a,"idn-email",r.message,e);break;case"pattern:zod":ve(a,Ze.email,r.message,e);break}break;case"url":$e(a,"uri",r.message,e);break;case"uuid":$e(a,"uuid",r.message,e);break;case"regex":ve(a,r.regex,r.message,e);break;case"cuid":ve(a,Ze.cuid,r.message,e);break;case"cuid2":ve(a,Ze.cuid2,r.message,e);break;case"startsWith":ve(a,RegExp(`^${yr(r.value,e)}`),r.message,e);break;case"endsWith":ve(a,RegExp(`${yr(r.value,e)}$`),r.message,e);break;case"datetime":$e(a,"date-time",r.message,e);break;case"date":$e(a,"date",r.message,e);break;case"time":$e(a,"time",r.message,e);break;case"duration":$e(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":ve(a,RegExp(yr(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&$e(a,"ipv4",r.message,e),r.version!=="v4"&&$e(a,"ipv6",r.message,e);break;case"base64url":ve(a,Ze.base64url,r.message,e);break;case"jwt":ve(a,Ze.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&ve(a,Ze.ipv4Cidr,r.message,e),r.version!=="v4"&&ve(a,Ze.ipv6Cidr,r.message,e);break;case"emoji":ve(a,Ze.emoji(),r.message,e);break;case"ulid":ve(a,Ze.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":$e(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":ve(a,Ze.base64,r.message,e);break}break;case"nanoid":ve(a,Ze.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function yr(t,e){return e.patternStrategy==="escape"?Xl(t):t}var Ql=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Xl(t){let e="";for(let a=0;a<t.length;a++)Ql.has(t[a])||(e+="\\"),e+=t[a];return e}function $e(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function ve(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:Hs(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=Hs(e,r)}function Hs(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,i=!1,o=!1;for(let u=0;u<r.length;u++){if(n){s+=r[u],n=!1;continue}if(a.i){if(i){if(r[u].match(/[a-z]/)){o?(s+=r[u],s+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&((l=r[u+2])!=null&&l.match(/[a-z]/))?(s+=r[u],o=!0):s+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){s+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(a.m){if(r[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[u]==="."){s+=i?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}s+=r[u],r[u]==="\\"?n=!0:i&&r[u]==="]"?i=!1:!i&&r[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function Qs(t,e){var r,s,n,i,o;let a={type:"object",additionalProperties:Q(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===f.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:l,...u}=Gs(t.keyType._def,e);return{...a,propertyNames:u}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===f.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((i=t.keyType)==null?void 0:i._def.typeName)===f.ZodBranded&&t.keyType._def.type._def.typeName===f.ZodString&&((o=t.keyType._def.type._def.checks)!=null&&o.length)){let{type:l,...u}=Ks(t.keyType._def,e);return{...a,propertyNames:u}}}return a}function eu(t,e){return e.mapStrategy==="record"?Qs(t,e):{type:"array",maxItems:125,items:{type:"array",items:[Q(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||Te(),Q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||Te()],minItems:2,maxItems:2}}}function tu(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function au(){return{not:Te()}}function ru(){return{type:"null"}}var vr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function su(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in vr&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let i=vr[n._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let i=typeof n._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===a.length){let s=r.filter((n,i,o)=>o.indexOf(n)===i);return{type:s.length>1?s:s[0],enum:a.reduce((n,i)=>n.includes(i._def.value)?n:[...n,i._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return nu(t,e)}var nu=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>Q(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function iu(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[vr[t.innerType._def.typeName],"null"]};let a=Q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function ou(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function lu(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let i in s){let o=s[i];if(o===void 0||o._def===void 0)continue;let l=du(o),u=Q(o._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});u!==void 0&&(a.properties[i]=u,l||r.push(i))}r.length&&(a.required=r);let n=uu(t,e);return n!==void 0&&(a.additionalProperties=n),a}function uu(t,e){if(t.catchall._def.typeName!=="ZodNever")return Q(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function du(t){try{return t.isOptional()}catch{return!0}}var cu=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return Q(t.innerType._def,e);let a=Q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:Te()},a]}:Te()},pu=(t,e)=>{if(e.pipeStrategy==="input")return Q(t.in._def,e);if(e.pipeStrategy==="output")return Q(t.out._def,e);let a=Q(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]});return{allOf:[a,Q(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]})].filter(r=>r!==void 0)}};function mu(t,e){return Q(t.type._def,e)}function hu(t,e){let a={type:"array",uniqueItems:!0,items:Q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function fu(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>Q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:Q(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>Q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function gu(){return{not:Te()}}function yu(){return Te()}var vu=(t,e)=>Q(t.innerType._def,e),bu=(t,e,a)=>{switch(e){case f.ZodString:return Gs(t,a);case f.ZodNumber:return ou(t);case f.ZodObject:return lu(t,a);case f.ZodBigInt:return Ul(t);case f.ZodBoolean:return Vl();case f.ZodDate:return Ys(t,a);case f.ZodUndefined:return gu();case f.ZodNull:return ru();case f.ZodArray:return zl(t,a);case f.ZodUnion:case f.ZodDiscriminatedUnion:return su(t,a);case f.ZodIntersection:return Gl(t,a);case f.ZodTuple:return fu(t,a);case f.ZodRecord:return Qs(t,a);case f.ZodLiteral:return Hl(t);case f.ZodEnum:return Kl(t);case f.ZodNativeEnum:return tu(t);case f.ZodNullable:return iu(t,a);case f.ZodOptional:return cu(t,a);case f.ZodMap:return eu(t,a);case f.ZodSet:return hu(t,a);case f.ZodLazy:return()=>t.getter()._def;case f.ZodPromise:return mu(t,a);case f.ZodNaN:case f.ZodNever:return au();case f.ZodEffects:return Jl(t,a);case f.ZodAny:return Te();case f.ZodUnknown:return yu();case f.ZodDefault:return ql(t,a);case f.ZodBranded:return Ks(t,a);case f.ZodReadonly:return vu(t,a);case f.ZodCatch:return Bl(t,a);case f.ZodPipeline:return pu(t,a);case f.ZodFunction:case f.ZodVoid:case f.ZodSymbol:return;default:return(r=>{})(e)}};function Q(t,e,a=!1){var o;let r=e.seen.get(t);if(e.override){let l=(o=e.override)==null?void 0:o.call(e,t,e,r,a);if(l!==Dl)return l}if(r&&!a){let l=_u(r,e);if(l!==void 0)return l}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=bu(t,t.typeName,e),i=typeof n=="function"?Q(n(),e):n;if(i&&xu(t,e,i),e.postProcess){let l=e.postProcess(i,t,e);return s.jsonSchema=i,l}return s.jsonSchema=i,i}var _u=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:Ll(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Te()):e.$refStrategy==="seen"?Te():void 0}},xu=(t,e,a)=>(t.description&&(a.description=t.description),a),ku=t=>{let e=Fl(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},wu=(t,e)=>{let a=ku(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[u,c])=>({...l,[u]:Q(c._def,{...a,currentPath:[...a.basePath,a.definitionPath,u]},!0)??Te()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=Q(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??Te(),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(n.title=i);let o=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return o.$schema="http://json-schema.org/draft-07/schema#",o};function Iu(t,e){return _r(wu(t,{$refStrategy:(e==null?void 0:e.useReferences)??!1?"root":"none"}),{validate:async a=>{let r=await t.safeParseAsync(a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function Eu(t,e){return _r(Ga(t,{target:"draft-7",io:"output",reused:(e==null?void 0:e.useReferences)??!1?"ref":"inline"}),{validate:async a=>{let r=await ds(t,a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function Tu(t){return"_zod"in t}function Cu(t,e){return Tu(t)?Eu(t,e):Iu(t,e)}var br=Symbol.for("vercel.ai.schema");function _r(t,{validate:e}={}){return{[br]:!0,_type:void 0,[Na]:!0,jsonSchema:t,validate:e}}function Su(t){return typeof t=="object"&&!!t&&br in t&&t[br]===!0&&"jsonSchema"in t&&"validate"in t}function Au(t){return t==null?_r({properties:{},additionalProperties:!1}):Su(t)?t:Cu(t)}var{btoa:Rh,atob:Ph}=globalThis,Ou=Object.defineProperty,Nu=(t,e)=>{for(var a in e)Ou(t,a,{get:e[a],enumerable:!0})},Xs="AI_NoObjectGeneratedError",en=`vercel.ai.error.${Xs}`,Ru=Symbol.for(en),tn,an=class extends qe{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:Xs,message:t,cause:e}),this[tn]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return qe.hasMarker(t,en)}};tn=Ru;var rn=U([d(),mt(Uint8Array),mt(ArrayBuffer),Ya(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),Yt=ps(()=>U([us(),d(),Me(),N(),pt(d(),Yt),me(Yt)])),W=pt(d(),pt(d(),Yt)),sn=y({type:h("text"),text:d(),providerOptions:W.optional()}),Pu=y({type:h("image"),image:U([rn,mt(URL)]),mediaType:d().optional(),providerOptions:W.optional()}),nn=y({type:h("file"),data:U([rn,mt(URL)]),filename:d().optional(),mediaType:d(),providerOptions:W.optional()}),Mu=y({type:h("reasoning"),text:d(),providerOptions:W.optional()}),ju=y({type:h("tool-call"),toolCallId:d(),toolName:d(),input:j(),providerOptions:W.optional(),providerExecuted:N().optional()}),Zu=pa("type",[y({type:h("text"),value:d()}),y({type:h("json"),value:Yt}),y({type:h("error-text"),value:d()}),y({type:h("error-json"),value:Yt}),y({type:h("content"),value:me(U([y({type:h("text"),text:d()}),y({type:h("media"),data:d(),mediaType:d()})]))})]),on=y({type:h("tool-result"),toolCallId:d(),toolName:d(),output:Zu,providerOptions:W.optional()});U([y({role:h("system"),content:d(),providerOptions:W.optional()}),y({role:h("user"),content:U([d(),me(U([sn,Pu,nn]))]),providerOptions:W.optional()}),y({role:h("assistant"),content:U([d(),me(U([sn,nn,Mu,ju,on]))]),providerOptions:W.optional()}),y({role:h("tool"),content:me(on),providerOptions:W.optional()})]),Kt({prefix:"aitxt",size:24});var ln=U([R({type:h("text-start"),id:d(),providerMetadata:W.optional()}),R({type:h("text-delta"),id:d(),delta:d(),providerMetadata:W.optional()}),R({type:h("text-end"),id:d(),providerMetadata:W.optional()}),R({type:h("error"),errorText:d()}),R({type:h("tool-input-start"),toolCallId:d(),toolName:d(),providerExecuted:N().optional(),dynamic:N().optional()}),R({type:h("tool-input-delta"),toolCallId:d(),inputTextDelta:d()}),R({type:h("tool-input-available"),toolCallId:d(),toolName:d(),input:j(),providerExecuted:N().optional(),providerMetadata:W.optional(),dynamic:N().optional()}),R({type:h("tool-input-error"),toolCallId:d(),toolName:d(),input:j(),providerExecuted:N().optional(),providerMetadata:W.optional(),dynamic:N().optional(),errorText:d()}),R({type:h("tool-output-available"),toolCallId:d(),output:j(),providerExecuted:N().optional(),dynamic:N().optional(),preliminary:N().optional()}),R({type:h("tool-output-error"),toolCallId:d(),errorText:d(),providerExecuted:N().optional(),dynamic:N().optional()}),R({type:h("reasoning"),text:d(),providerMetadata:W.optional()}),R({type:h("reasoning-start"),id:d(),providerMetadata:W.optional()}),R({type:h("reasoning-delta"),id:d(),delta:d(),providerMetadata:W.optional()}),R({type:h("reasoning-end"),id:d(),providerMetadata:W.optional()}),R({type:h("reasoning-part-finish")}),R({type:h("source-url"),sourceId:d(),url:d(),title:d().optional(),providerMetadata:W.optional()}),R({type:h("source-document"),sourceId:d(),mediaType:d(),title:d(),filename:d().optional(),providerMetadata:W.optional()}),R({type:h("file"),url:d(),mediaType:d(),providerMetadata:W.optional()}),R({type:d().startsWith("data-"),id:d().optional(),data:j(),transient:N().optional()}),R({type:h("start-step")}),R({type:h("finish-step")}),R({type:h("start"),messageId:d().optional(),messageMetadata:j().optional()}),R({type:h("finish"),messageMetadata:j().optional()}),R({type:h("abort")}),R({type:h("message-metadata"),messageMetadata:j()})]);function $u(t){return t.type.startsWith("data-")}function un(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;let a={...t};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let s=e[r];if(s===void 0)continue;let n=r in t?t[r]:void 0,i=typeof s=="object"&&!!s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),o=typeof n=="object"&&!!n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);i&&o?a[r]=un(n,s):a[r]=s}return a}function Lu(t){let e=["ROOT"],a=-1,r=null;function s(l,u,c){switch(l){case'"':a=u,e.pop(),e.push(c),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=u,r=u,e.pop(),e.push(c),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(c),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=u,e.pop(),e.push(c),e.push("INSIDE_NUMBER");break;case"{":a=u,e.pop(),e.push(c),e.push("INSIDE_OBJECT_START");break;case"[":a=u,e.pop(),e.push(c),e.push("INSIDE_ARRAY_START");break}}function n(l,u){switch(l){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=u,e.pop();break}}function i(l,u){switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=u,e.pop();break}}for(let l=0;l<t.length;l++){let u=t[l];switch(e[e.length-1]){case"ROOT":s(u,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(u){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":switch(u){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break}break;case"INSIDE_OBJECT_KEY":switch(u){case'"':e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}break;case"INSIDE_OBJECT_AFTER_KEY":switch(u){case":":e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}break;case"INSIDE_OBJECT_BEFORE_VALUE":s(u,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(u,l);break;case"INSIDE_STRING":switch(u){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":switch(u){case"]":a=l,e.pop();break;default:a=l,s(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}break;case"INSIDE_ARRAY_AFTER_VALUE":switch(u){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(u,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(u){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(u,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(u,l);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(u,l);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(u,l);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let c=t.substring(r,l+1);!"false".startsWith(c)&&!"true".startsWith(c)&&!"null".startsWith(c)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(u,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(u,l)):a=l;break}}}let o=t.slice(0,a+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let u=t.substring(r,t.length);"true".startsWith(u)?o+="true".slice(u.length):"false".startsWith(u)?o+="false".slice(u.length):"null".startsWith(u)&&(o+="null".slice(u.length))}}return o}async function dn(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await Ra({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await Ra({text:Lu(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function Pa(t){return t.type.startsWith("tool-")}function Du(t){return t.type==="dynamic-tool"}function cn(t){return Pa(t)||Du(t)}function pn(t){return t.type.split("-").slice(1).join("-")}function Fu({lastMessage:t,messageId:e}){return{message:(t==null?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function zu({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:n,onData:i}){return t.pipeThrough(new TransformStream({async transform(o,l){await r(async({state:u,write:c})=>{function m(p){let g=u.message.parts.filter(Pa).find(k=>k.toolCallId===p);if(g==null)throw Error("tool-output-error must be preceded by a tool-input-available");return g}function b(p){let g=u.message.parts.filter(k=>k.type==="dynamic-tool").find(k=>k.toolCallId===p);if(g==null)throw Error("tool-output-error must be preceded by a tool-input-available");return g}function x(p){let g=u.message.parts.find(A=>Pa(A)&&A.toolCallId===p.toolCallId),k=p,I=g;g==null?u.message.parts.push({type:`tool-${p.toolName}`,toolCallId:p.toolCallId,state:p.state,input:k.input,output:k.output,rawInput:k.rawInput,errorText:k.errorText,providerExecuted:k.providerExecuted,preliminary:k.preliminary,...k.providerMetadata==null?{}:{callProviderMetadata:k.providerMetadata}}):(g.state=p.state,I.input=k.input,I.output=k.output,I.errorText=k.errorText,I.rawInput=k.rawInput,I.preliminary=k.preliminary,I.providerExecuted=k.providerExecuted??g.providerExecuted,k.providerMetadata!=null&&g.state==="input-available"&&(g.callProviderMetadata=k.providerMetadata))}function w(p){let g=u.message.parts.find(A=>A.type==="dynamic-tool"&&A.toolCallId===p.toolCallId),k=p,I=g;g==null?u.message.parts.push({type:"dynamic-tool",toolName:p.toolName,toolCallId:p.toolCallId,state:p.state,input:k.input,output:k.output,errorText:k.errorText,preliminary:k.preliminary,...k.providerMetadata==null?{}:{callProviderMetadata:k.providerMetadata}}):(g.state=p.state,I.toolName=p.toolName,I.input=k.input,I.output=k.output,I.errorText=k.errorText,I.rawInput=k.rawInput??I.rawInput,I.preliminary=k.preliminary,k.providerMetadata!=null&&g.state==="input-available"&&(g.callProviderMetadata=k.providerMetadata))}async function v(p){if(p!=null){let g=u.message.metadata==null?p:un(u.message.metadata,p);e!=null&&await Ws({value:g,schema:e}),u.message.metadata=g}}switch(o.type){case"text-start":{let p={type:"text",text:"",providerMetadata:o.providerMetadata,state:"streaming"};u.activeTextParts[o.id]=p,u.message.parts.push(p),c();break}case"text-delta":{let p=u.activeTextParts[o.id];p.text+=o.delta,p.providerMetadata=o.providerMetadata??p.providerMetadata,c();break}case"text-end":{let p=u.activeTextParts[o.id];p.state="done",p.providerMetadata=o.providerMetadata??p.providerMetadata,delete u.activeTextParts[o.id],c();break}case"reasoning-start":{let p={type:"reasoning",text:"",providerMetadata:o.providerMetadata,state:"streaming"};u.activeReasoningParts[o.id]=p,u.message.parts.push(p),c();break}case"reasoning-delta":{let p=u.activeReasoningParts[o.id];p.text+=o.delta,p.providerMetadata=o.providerMetadata??p.providerMetadata,c();break}case"reasoning-end":{let p=u.activeReasoningParts[o.id];p.providerMetadata=o.providerMetadata??p.providerMetadata,p.state="done",delete u.activeReasoningParts[o.id],c();break}case"file":u.message.parts.push({type:"file",mediaType:o.mediaType,url:o.url}),c();break;case"source-url":u.message.parts.push({type:"source-url",sourceId:o.sourceId,url:o.url,title:o.title,providerMetadata:o.providerMetadata}),c();break;case"source-document":u.message.parts.push({type:"source-document",sourceId:o.sourceId,mediaType:o.mediaType,title:o.title,filename:o.filename,providerMetadata:o.providerMetadata}),c();break;case"tool-input-start":{let p=u.message.parts.filter(Pa);u.partialToolCalls[o.toolCallId]={text:"",toolName:o.toolName,index:p.length,dynamic:o.dynamic},o.dynamic?w({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0}):x({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}),c();break}case"tool-input-delta":{let p=u.partialToolCalls[o.toolCallId];p.text+=o.inputTextDelta;let{value:g}=await dn(p.text);p.dynamic?w({toolCallId:o.toolCallId,toolName:p.toolName,state:"input-streaming",input:g}):x({toolCallId:o.toolCallId,toolName:p.toolName,state:"input-streaming",input:g}),c();break}case"tool-input-available":o.dynamic?w({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerMetadata:o.providerMetadata}):x({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),c(),n&&!o.providerExecuted&&await n({toolCall:o});break;case"tool-input-error":o.dynamic?w({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:o.input,errorText:o.errorText,providerMetadata:o.providerMetadata}):x({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:void 0,rawInput:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),c();break;case"tool-output-available":if(o.dynamic){let p=b(o.toolCallId);w({toolCallId:o.toolCallId,toolName:p.toolName,state:"output-available",input:p.input,output:o.output,preliminary:o.preliminary})}else{let p=m(o.toolCallId);x({toolCallId:o.toolCallId,toolName:pn(p),state:"output-available",input:p.input,output:o.output,providerExecuted:o.providerExecuted,preliminary:o.preliminary})}c();break;case"tool-output-error":if(o.dynamic){let p=b(o.toolCallId);w({toolCallId:o.toolCallId,toolName:p.toolName,state:"output-error",input:p.input,errorText:o.errorText})}else{let p=m(o.toolCallId);x({toolCallId:o.toolCallId,toolName:pn(p),state:"output-error",input:p.input,rawInput:p.rawInput,errorText:o.errorText})}c();break;case"start-step":u.message.parts.push({type:"step-start"});break;case"finish-step":u.activeTextParts={},u.activeReasoningParts={};break;case"start":o.messageId!=null&&(u.message.id=o.messageId),await v(o.messageMetadata),(o.messageId!=null||o.messageMetadata!=null)&&c();break;case"finish":await v(o.messageMetadata),o.messageMetadata!=null&&c();break;case"message-metadata":await v(o.messageMetadata),o.messageMetadata!=null&&c();break;case"error":s==null||s(Error(o.errorText));break;default:if($u(o)){(a==null?void 0:a[o.type])!=null&&await Ws({value:o.data,schema:a[o.type]});let p=o;if(p.transient){i==null||i(p);break}let g=p.id==null?void 0:u.message.parts.find(k=>p.type===k.type&&p.id===k.id);g==null?u.message.parts.push(p):g.data=p.data,i==null||i(p),c()}}l.enqueue(o)})}}))}async function mn({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:r}=await a.read();if(r)break}}catch(r){e==null||e(r)}finally{a.releaseLock()}}Kt({prefix:"aitxt",size:24}),Kt({prefix:"aiobj",size:24});var Uu=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(r){a(r)}}),this.processQueue()})}};Kt({prefix:"aiobj",size:24}),Nu({},{object:()=>Bu,text:()=>Vu});var Vu=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),Bu=({schema:t})=>{let e=Au(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await dn(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await Ra({text:a});if(!s.success)throw new an({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await fr({value:s.value,schema:e});if(!n.success)throw new an({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}},Wu=Ae({name:d(),version:d()}),xr=Ae({_meta:z(y({}).loose())}),Gt=xr,qu=y({method:d(),params:z(xr)}),Ju=Ae({experimental:z(y({}).loose()),logging:z(y({}).loose()),prompts:z(Ae({listChanged:z(N())})),resources:z(Ae({subscribe:z(N()),listChanged:z(N())})),tools:z(Ae({listChanged:z(N())}))});Gt.extend({protocolVersion:d(),capabilities:Ju,serverInfo:Wu,instructions:z(d())});var Ku=Gt.extend({nextCursor:z(d())}),Yu=y({name:d(),description:z(d()),inputSchema:y({type:h("object"),properties:z(y({}).loose())}).loose()}).loose();Ku.extend({tools:me(Yu)});var Gu=y({type:h("text"),text:d()}).loose(),Hu=y({type:h("image"),data:ma(),mimeType:d()}).loose(),hn=y({uri:d(),mimeType:z(d())}).loose(),Qu=hn.extend({text:d()}),Xu=hn.extend({blob:ma()}),ed=y({type:h("resource"),resource:U([Qu,Xu])}).loose();Gt.extend({content:me(U([Gu,Hu,ed])),isError:N().default(!1).optional()}).or(Gt.extend({toolResult:j()}));var Ma="2.0",td=y({jsonrpc:h(Ma),id:U([d(),Me().int()])}).merge(qu).strict(),ad=y({jsonrpc:h(Ma),id:U([d(),Me().int()]),result:Gt}).strict(),rd=y({jsonrpc:h(Ma),id:U([d(),Me().int()]),error:y({code:Me().int(),message:d(),data:z(j())})}).strict();U([td,y({jsonrpc:h(Ma)}).merge(y({method:d(),params:z(xr)})).strict(),ad,rd]);async function sd({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:r,value:s}=await a.read();if(r)break;await e(s)}}var nd=()=>fetch;async function id({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:n="data",setCompletion:i,setLoading:o,setError:l,setAbortController:u,onFinish:c,onError:m,fetch:b=nd()}){try{o(!0),l(void 0);let x=new AbortController;u(x),i("");let w=await b(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:{"Content-Type":"application/json",...r},signal:x.signal}).catch(p=>{throw p});if(!w.ok)throw Error(await w.text()??"Failed to fetch the chat response.");if(!w.body)throw Error("The response body is empty.");let v="";switch(n){case"text":await sd({stream:w.body,onTextPart:p=>{v+=p,i(v)}});break;case"data":await mn({stream:qs({stream:w.body,schema:ln}).pipeThrough(new TransformStream({async transform(p){if(!p.success)throw p.error;let g=p.value;if(g.type==="text-delta")v+=g.delta,i(v);else if(g.type==="error")throw Error(g.errorText)}})),onError:p=>{throw p}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return c&&c(e,v),u(null),v}catch(x){if(x.name==="AbortError")return u(null),null;x instanceof Error&&m&&m(x),l(x)}finally{o(!1)}}async function od(t){if(t==null)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async e=>{let{name:a,type:r}=e;return{type:"file",mediaType:r,filename:a,url:await new Promise((s,n)=>{let i=new FileReader;i.onload=o=>{var l;s((l=o.target)==null?void 0:l.result)},i.onerror=o=>n(o),i.readAsDataURL(e)})}}))}var ld=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:i}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:t,...e}){var m;let a=await $t(this.body),r=await $t(this.headers),s=await $t(this.credentials),n=await((m=this.prepareSendMessagesRequest)==null?void 0:m.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:{...r,...e.headers},credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),i=(n==null?void 0:n.api)??this.api,o=(n==null?void 0:n.headers)===void 0?{...r,...e.headers}:n.headers,l=(n==null?void 0:n.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:n.body,u=(n==null?void 0:n.credentials)??s,c=await(this.fetch??globalThis.fetch)(i,{method:"POST",headers:{"Content-Type":"application/json",...o},body:JSON.stringify(l),credentials:u,signal:t});if(!c.ok)throw Error(await c.text()??"Failed to fetch the chat response.");if(!c.body)throw Error("The response body is empty.");return this.processResponseStream(c.body)}async reconnectToStream(t){var u;let e=await $t(this.body),a=await $t(this.headers),r=await $t(this.credentials),s=await((u=this.prepareReconnectToStreamRequest)==null?void 0:u.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:{...a,...t.headers},credentials:r,requestMetadata:t.metadata})),n=(s==null?void 0:s.api)??`${this.api}/${t.chatId}/stream`,i=(s==null?void 0:s.headers)===void 0?{...a,...t.headers}:s.headers,o=(s==null?void 0:s.credentials)??r,l=await(this.fetch??globalThis.fetch)(n,{method:"GET",headers:i,credentials:o});if(l.status===204)return null;if(!l.ok)throw Error(await l.text()??"Failed to fetch the chat response.");if(!l.body)throw Error("The response body is empty.");return this.processResponseStream(l.body)}},ud=class extends ld{constructor(t={}){super(t)}processResponseStream(t){return qs({stream:t,schema:ln}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},dd=class{constructor({generateId:t=Sl,id:e=t(),transport:a=new ud,messageMetadataSchema:r,dataPartSchemas:s,state:n,onError:i,onToolCall:o,onFinish:l,onData:u,sendAutomaticallyWhen:c}){this.activeResponse=void 0,this.jobExecutor=new Uu,this.sendMessage=async(m,b)=>{var w;if(m==null){await this.makeRequest({trigger:"submit-message",messageId:(w=this.lastMessage)==null?void 0:w.id,...b});return}let x;if(x="text"in m||"files"in m?{parts:[...Array.isArray(m.files)?m.files:await od(m.files),..."text"in m&&m.text!=null?[{type:"text",text:m.text}]:[]]}:m,m.messageId!=null){let v=this.state.messages.findIndex(p=>p.id===m.messageId);if(v===-1)throw Error(`message with id ${m.messageId} not found`);if(this.state.messages[v].role!=="user")throw Error(`message with id ${m.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,v+1),this.state.replaceMessage(v,{...x,id:m.messageId,role:x.role??"user",metadata:m.metadata})}else this.state.pushMessage({...x,id:x.id??this.generateId(),role:x.role??"user",metadata:m.metadata});await this.makeRequest({trigger:"submit-message",messageId:m.messageId,...b})},this.regenerate=async({messageId:m,...b}={})=>{let x=m==null?this.state.messages.length-1:this.state.messages.findIndex(w=>w.id===m);if(x===-1)throw Error(`message ${m} not found`);this.state.messages=this.state.messages.slice(0,this.messages[x].role==="assistant"?x:x+1),await this.makeRequest({trigger:"regenerate-message",messageId:m,...b})},this.resumeStream=async(m={})=>{await this.makeRequest({trigger:"resume-stream",...m})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolResult=async({tool:m,toolCallId:b,output:x})=>this.jobExecutor.run(async()=>{var p,g;let w=this.state.messages,v=w[w.length-1];this.state.replaceMessage(w.length-1,{...v,parts:v.parts.map(k=>cn(k)&&k.toolCallId===b?{...k,state:"output-available",output:x}:k)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(k=>cn(k)&&k.toolCallId===b?{...k,state:"output-available",output:x,errorText:void 0}:k)),this.status!=="streaming"&&this.status!=="submitted"&&((p=this.sendAutomaticallyWhen)!=null&&p.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(g=this.lastMessage)==null?void 0:g.id})}),this.stop=async()=>{var m;this.status!=="streaming"&&this.status!=="submitted"||(m=this.activeResponse)!=null&&m.abortController&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=n,this.onError=i,this.onToolCall=o,this.onFinish=l,this.onData=u,this.sendAutomaticallyWhen=c}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var c,m;var n;this.setStatus({status:"submitted",error:void 0});let i=this.lastMessage,o=!1,l=!1,u=!1;try{let b={state:Fu({lastMessage:this.state.snapshot(i),messageId:this.generateId()}),abortController:new AbortController};b.abortController.signal.addEventListener("abort",()=>{o=!0}),this.activeResponse=b;let x;if(t==="resume-stream"){let w=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(w==null){this.setStatus({status:"ready"});return}x=w}else x=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:b.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});await mn({stream:zu({stream:x,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:w=>this.jobExecutor.run(()=>w({state:b.state,write:()=>{var v;this.setStatus({status:"streaming"}),b.state.message.id===((v=this.lastMessage)==null?void 0:v.id)?this.state.replaceMessage(this.state.messages.length-1,b.state.message):this.state.pushMessage(b.state.message)}})),onError:w=>{throw w}}),onError:w=>{throw w}}),this.setStatus({status:"ready"})}catch(b){if(o||b.name==="AbortError")return o=!0,this.setStatus({status:"ready"}),null;u=!0,b instanceof TypeError&&(b.message.toLowerCase().includes("fetch")||b.message.toLowerCase().includes("network"))&&(l=!0),this.onError&&b instanceof Error&&this.onError(b),this.setStatus({status:"error",error:b})}finally{try{(n=this.onFinish)==null||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:o,isDisconnect:l,isError:u})}catch(b){console.error(b)}this.activeResponse=void 0}(c=this.sendAutomaticallyWhen)!=null&&c.call(this,{messages:this.state.messages})&&await this.makeRequest({trigger:"submit-message",messageId:(m=this.lastMessage)==null?void 0:m.id,metadata:e,headers:a,body:r})}},cd=y({type:h("text"),text:d(),state:kt(["streaming","done"]).optional(),providerMetadata:W.optional()}),pd=y({type:h("reasoning"),text:d(),state:kt(["streaming","done"]).optional(),providerMetadata:W.optional()}),md=y({type:h("source-url"),sourceId:d(),url:d(),title:d().optional(),providerMetadata:W.optional()}),hd=y({type:h("source-document"),sourceId:d(),mediaType:d(),title:d(),filename:d().optional(),providerMetadata:W.optional()}),fd=y({type:h("file"),mediaType:d(),filename:d().optional(),url:d(),providerMetadata:W.optional()}),gd=y({type:h("step-start")}),yd=y({type:d().startsWith("data-"),id:d().optional(),data:j()}),vd=[y({type:h("dynamic-tool"),toolName:d(),toolCallId:d(),state:h("input-streaming"),input:j().optional(),output:ie().optional(),errorText:ie().optional()}),y({type:h("dynamic-tool"),toolName:d(),toolCallId:d(),state:h("input-available"),input:j(),output:ie().optional(),errorText:ie().optional(),callProviderMetadata:W.optional()}),y({type:h("dynamic-tool"),toolName:d(),toolCallId:d(),state:h("output-available"),input:j(),output:j(),errorText:ie().optional(),callProviderMetadata:W.optional(),preliminary:N().optional()}),y({type:h("dynamic-tool"),toolName:d(),toolCallId:d(),state:h("output-error"),input:j(),output:ie().optional(),errorText:d(),callProviderMetadata:W.optional()})],bd=[y({type:d().startsWith("tool-"),toolCallId:d(),state:h("input-streaming"),input:j().optional(),output:ie().optional(),errorText:ie().optional()}),y({type:d().startsWith("tool-"),toolCallId:d(),state:h("input-available"),input:j(),output:ie().optional(),errorText:ie().optional(),callProviderMetadata:W.optional()}),y({type:d().startsWith("tool-"),toolCallId:d(),state:h("output-available"),input:j(),output:j(),errorText:ie().optional(),callProviderMetadata:W.optional(),preliminary:N().optional()}),y({type:d().startsWith("tool-"),toolCallId:d(),state:h("output-error"),input:j(),output:ie().optional(),errorText:d(),callProviderMetadata:W.optional()})];y({id:d(),role:kt(["system","user","assistant"]),metadata:j().optional(),parts:me(U([cd,pd,md,hd,fd,gd,yd,...vd,...bd]))});var _d=Pi(((t,e)=>{function a(r,s){if(typeof r!="function")throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let n,i=0;return function(...o){clearTimeout(n);let l=Date.now(),u=s-(l-i);u<=0?(i=l,r.apply(this,o)):n=setTimeout(()=>{i=Date.now(),r.apply(this,o)},u)}}e.exports=a})),fn=Object.prototype.hasOwnProperty;function kr(t,e){var a,r;if(t===e)return!0;if(t&&e&&(a=t.constructor)===e.constructor){if(a===Date)return t.getTime()===e.getTime();if(a===RegExp)return t.toString()===e.toString();if(a===Array){if((r=t.length)===e.length)for(;r--&&kr(t[r],e[r]););return r===-1}if(!a||typeof t=="object"){for(a in r=0,t)if(fn.call(t,a)&&++r&&!fn.call(e,a)||!(a in e)||!kr(t[a],e[a]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}var M=xt($i(),1),st=new WeakMap,Tt=()=>{},ye=void 0,ja=Object,q=t=>t===ye,Le=t=>typeof t=="function",nt=(t,e)=>({...t,...e}),gn=t=>Le(t.then),wr={},Za={},Ir="undefined",Ht=typeof window!=Ir,Er=typeof document!=Ir,xd=Ht&&"Deno"in window,kd=()=>Ht&&typeof window.requestAnimationFrame!=Ir,yn=(t,e)=>{let a=st.get(t);return[()=>!q(e)&&t.get(e)||wr,r=>{if(!q(e)){let s=t.get(e);e in Za||(Za[e]=s),a[5](e,nt(s,r),s||wr)}},a[6],()=>!q(e)&&e in Za?Za[e]:!q(e)&&t.get(e)||wr]},Tr=!0,wd=()=>Tr,[Cr,Sr]=Ht&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Tt,Tt],Id=()=>{let t=Er&&document.visibilityState;return q(t)||t!=="hidden"},Ed=t=>(Er&&document.addEventListener("visibilitychange",t),Cr("focus",t),()=>{Er&&document.removeEventListener("visibilitychange",t),Sr("focus",t)}),Td=t=>{let e=()=>{Tr=!0,t()},a=()=>{Tr=!1};return Cr("online",e),Cr("offline",a),()=>{Sr("online",e),Sr("offline",a)}},Cd={isOnline:wd,isVisible:Id},Sd={initFocus:Ed,initReconnect:Td},vn=!M.useId,Qt=!Ht||xd,Ad=t=>kd()?window.requestAnimationFrame(t):setTimeout(t,1),$a=Qt?M.useEffect:M.useLayoutEffect,Ar=typeof navigator<"u"&&navigator.connection,bn=!Qt&&Ar&&(["slow-2g","2g"].includes(Ar.effectiveType)||Ar.saveData),La=new WeakMap,Od=t=>ja.prototype.toString.call(t),Or=(t,e)=>t===`[object ${e}]`,Nd=0,Nr=t=>{let e=typeof t,a=Od(t),r=Or(a,"Date"),s=Or(a,"RegExp"),n=Or(a,"Object"),i,o;if(ja(t)===t&&!r&&!s){if(i=La.get(t),i)return i;if(i=++Nd+"~",La.set(t,i),Array.isArray(t)){for(i="@",o=0;o<t.length;o++)i+=Nr(t[o])+",";La.set(t,i)}if(n){i="#";let l=ja.keys(t).sort();for(;!q(o=l.pop());)q(t[o])||(i+=o+":"+Nr(t[o])+",");La.set(t,i)}}else i=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return i},Rr=t=>{if(Le(t))try{t=t()}catch{t=""}let e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?Nr(t):"",[t,e]},Rd=0,Pr=()=>++Rd;async function _n(...t){let[e,a,r,s]=t,n=nt({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{}),i=n.populateCache,o=n.rollbackOnError,l=n.optimisticData,u=b=>typeof o=="function"?o(b):o!==!1,c=n.throwOnError;if(Le(a)){let b=a,x=[],w=e.keys();for(let v of w)!/^\$(inf|sub)\$/.test(v)&&b(e.get(v)._k)&&x.push(v);return Promise.all(x.map(m))}return m(a);async function m(b){let[x]=Rr(b);if(!x)return;let[w,v]=yn(e,x),[p,g,k,I]=st.get(e),A=()=>{let se=p[x];return(Le(n.revalidate)?n.revalidate(w().data,b):n.revalidate!==!1)&&(delete k[x],delete I[x],se&&se[0])?se[0](2).then(()=>w().data):w().data};if(t.length<3)return A();let O=r,V,B=!1,Z=Pr();g[x]=[Z,0];let ae=!q(l),F=w(),ee=F.data,oe=F._c,ue=q(oe)?ee:oe;if(ae&&(l=Le(l)?l(ue,ee):l,v({data:l,_c:ue})),Le(O))try{O=O(ue)}catch(se){V=se,B=!0}if(O&&gn(O))if(O=await O.catch(se=>{V=se,B=!0}),Z!==g[x][0]){if(B)throw V;return O}else B&&ae&&u(V)&&(i=!0,v({data:ue,_c:ye}));if(i&&(B||(Le(i)?v({data:i(O,ue),error:ye,_c:ye}):v({data:O,error:ye,_c:ye}))),g[x][1]=Pr(),Promise.resolve(A()).then(()=>{v({_c:ye})}),B){if(c)throw V;return}return O}}var xn=(t,e)=>{for(let a in t)t[a][0]&&t[a][0](e)},kn=(t,e)=>{if(!st.has(t)){let a=nt(Sd,e),r=Object.create(null),s=_n.bind(ye,t),n=Tt,i=Object.create(null),o=(c,m)=>{let b=i[c]||[];return i[c]=b,b.push(m),()=>b.splice(b.indexOf(m),1)},l=(c,m,b)=>{t.set(c,m);let x=i[c];if(x)for(let w of x)w(m,b)},u=()=>{if(!st.has(t)&&(st.set(t,[r,Object.create(null),Object.create(null),Object.create(null),s,l,o]),!Qt)){let c=a.initFocus(setTimeout.bind(ye,xn.bind(ye,r,0))),m=a.initReconnect(setTimeout.bind(ye,xn.bind(ye,r,1)));n=()=>{c&&c(),m&&m(),st.delete(t)}}};return u(),[t,s,u,n]}return[t,st.get(t)[4]]},Pd=(t,e,a,r,s)=>{let n=a.errorRetryCount,i=s.retryCount,o=~~((Math.random()+.5)*(1<<(i<8?i:8)))*a.errorRetryInterval;!q(n)&&i>n||setTimeout(r,o,s)},Md=kr,[Mr,jd]=kn(new Map),wn=nt({onLoadingSlow:Tt,onSuccess:Tt,onError:Tt,onErrorRetry:Pd,onDiscarded:Tt,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:bn?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:bn?5e3:3e3,compare:Md,isPaused:()=>!1,cache:Mr,mutate:jd,fallback:{}},Cd),In=(t,e)=>{let a=nt(t,e);if(e){let{use:r,fallback:s}=t,{use:n,fallback:i}=e;r&&n&&(a.use=r.concat(n)),s&&i&&(a.fallback=nt(s,i))}return a},jr=(0,M.createContext)({}),Zd=t=>{let{value:e}=t,a=(0,M.useContext)(jr),r=Le(e),s=(0,M.useMemo)(()=>r?e(a):e,[r,a,e]),n=(0,M.useMemo)(()=>r?s:In(a,s),[r,a,s]),i=s&&s.provider,o=(0,M.useRef)(ye);i&&!o.current&&(o.current=kn(i(n.cache||Mr),s));let l=o.current;return l&&(n.cache=l[0],n.mutate=l[1]),$a(()=>{if(l)return l[2]&&l[2](),l[3]},[]),(0,M.createElement)(jr.Provider,nt(t,{value:n}))},En=Ht&&window.__SWR_DEVTOOLS_USE__,$d=En?window.__SWR_DEVTOOLS_USE__:[],Ld=()=>{En&&(window.__SWR_DEVTOOLS_REACT__=M.default)},Dd=t=>Le(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],Fd=()=>nt(wn,(0,M.useContext)(jr)),zd=$d.concat(t=>(e,a,r)=>t(e,a&&((...s)=>{let[n]=Rr(e),[,,,i]=st.get(Mr);if(n.startsWith("$inf$"))return a(...s);let o=i[n];return q(o)?a(...s):(delete i[n],o)}),r)),Ud=t=>function(...e){let a=Fd(),[r,s,n]=Dd(e),i=In(a,n),o=t,{use:l}=i,u=(l||[]).concat(zd);for(let c=u.length;c--;)o=u[c](o);return o(r,s||i.fetcher||null,i)},Vd=(t,e,a)=>{let r=e[t]||(e[t]=[]);return r.push(a),()=>{let s=r.indexOf(a);s>=0&&(r[s]=r[r.length-1],r.pop())}};Ld();var Bd=xt(jo(),1),Zr=M.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),$r={dedupe:!0},Wd=(t,e,a)=>{let{cache:r,compare:s,suspense:n,fallbackData:i,revalidateOnMount:o,revalidateIfStale:l,refreshInterval:u,refreshWhenHidden:c,refreshWhenOffline:m,keepPreviousData:b}=a,[x,w,v,p]=st.get(r),[g,k]=Rr(t),I=(0,M.useRef)(!1),A=(0,M.useRef)(!1),O=(0,M.useRef)(g),V=(0,M.useRef)(e),B=(0,M.useRef)(a),Z=()=>B.current,ae=()=>Z().isVisible()&&Z().isOnline(),[F,ee,oe,ue]=yn(r,g),se=(0,M.useRef)({}).current,te=q(i)?q(a.fallback)?ye:a.fallback[g]:i,ne=(H,Y)=>{for(let de in se){let G=de;if(G==="data"){if(!s(H[G],Y[G])&&(!q(H[G])||!s(Re,Y[G])))return!1}else if(Y[G]!==H[G])return!1}return!0},fe=(0,M.useMemo)(()=>{let H=!g||!e?!1:q(o)?Z().isPaused()||n?!1:l!==!1:o,Y=ce=>{let we=nt(ce);return delete we._k,H?{isValidating:!0,isLoading:!0,...we}:we},de=F(),G=ue(),Se=Y(de),xe=de===G?Se:Y(G),pe=Se;return[()=>{let ce=Y(F());return ne(ce,pe)?(pe.data=ce.data,pe.isLoading=ce.isLoading,pe.isValidating=ce.isValidating,pe.error=ce.error,pe):(pe=ce,ce)},()=>xe]},[r,g]),le=(0,Bd.useSyncExternalStore)((0,M.useCallback)(H=>oe(g,(Y,de)=>{ne(de,Y)||H()}),[r,g]),fe[0],fe[1]),bt=!I.current,Ue=x[g]&&x[g].length>0,Ne=le.data,_e=q(Ne)?te&&gn(te)?Zr(te):te:Ne,Ge=le.error,ot=(0,M.useRef)(_e),Re=b?q(Ne)?q(ot.current)?_e:ot.current:Ne:_e,He=Ue&&!q(Ge)?!1:bt&&!q(o)?o:Z().isPaused()?!1:n?q(_e)?!1:l:q(_e)||l,Qe=!!(g&&e&&bt&&He),St=q(le.isValidating)?Qe:le.isValidating,Ut=q(le.isLoading)?Qe:le.isLoading,Ve=(0,M.useCallback)(async H=>{let Y=V.current;if(!g||!Y||A.current||Z().isPaused())return!1;let de,G,Se=!0,xe=H||{},pe=!v[g]||!xe.dedupe,ce=()=>vn?!A.current&&g===O.current&&I.current:g===O.current,we={isValidating:!1,isLoading:!1},et=()=>{ee(we)},_t=()=>{let ge=v[g];ge&&ge[1]===G&&delete v[g]},tt={isValidating:!0};q(F().data)&&(tt.isLoading=!0);try{if(pe&&(ee(tt),a.loadingTimeout&&q(F().data)&&setTimeout(()=>{Se&&ce()&&Z().onLoadingSlow(g,a)},a.loadingTimeout),v[g]=[Y(k),Pr()]),[de,G]=v[g],de=await de,pe&&setTimeout(_t,a.dedupingInterval),!v[g]||v[g][1]!==G)return pe&&ce()&&Z().onDiscarded(g),!1;we.error=ye;let ge=w[g];if(!q(ge)&&(G<=ge[0]||G<=ge[1]||ge[1]===0))return et(),pe&&ce()&&Z().onDiscarded(g),!1;let Ie=F().data;we.data=s(Ie,de)?Ie:de,pe&&ce()&&Z().onSuccess(de,g,a)}catch(ge){_t();let Ie=Z(),{shouldRetryOnError:lt}=Ie;Ie.isPaused()||(we.error=ge,pe&&ce()&&(Ie.onError(ge,g,Ie),(lt===!0||Le(lt)&&lt(ge))&&(!Z().revalidateOnFocus||!Z().revalidateOnReconnect||ae())&&Ie.onErrorRetry(ge,g,Ie,ut=>{let Be=x[g];Be&&Be[0]&&Be[0](3,ut)},{retryCount:(xe.retryCount||0)+1,dedupe:!0})))}return Se=!1,et(),!0},[g,r]),Xe=(0,M.useCallback)((...H)=>_n(r,O.current,...H),[]);if($a(()=>{V.current=e,B.current=a,q(Ne)||(ot.current=Ne)}),$a(()=>{if(!g)return;let H=Ve.bind(ye,$r),Y=0;Z().revalidateOnFocus&&(Y=Date.now()+Z().focusThrottleInterval);let de=Vd(g,x,(G,Se={})=>{if(G==0){let xe=Date.now();Z().revalidateOnFocus&&xe>Y&&ae()&&(Y=xe+Z().focusThrottleInterval,H())}else if(G==1)Z().revalidateOnReconnect&&ae()&&H();else{if(G==2)return Ve();if(G==3)return Ve(Se)}});return A.current=!1,O.current=g,I.current=!0,ee({_k:k}),He&&(v[g]||(q(_e)||Qt?H():Ad(H))),()=>{A.current=!0,de()}},[g]),$a(()=>{let H;function Y(){let G=Le(u)?u(F().data):u;G&&H!==-1&&(H=setTimeout(de,G))}function de(){!F().error&&(c||Z().isVisible())&&(m||Z().isOnline())?Ve($r).then(Y):Y()}return Y(),()=>{H&&(H=(clearTimeout(H),-1))}},[u,c,m,g]),(0,M.useDebugValue)(Re),n&&q(_e)&&g){if(!vn&&Qt)throw Error("Fallback data is required when using Suspense in SSR.");V.current=e,B.current=a,A.current=!1;let H=p[g];if(q(H)||Zr(Xe(H)),q(Ge)){let Y=Ve($r);q(Re)||(Y.status="fulfilled",Y.value=!0),Zr(Y)}else throw Ge}return{mutate:Xe,get data(){return se.data=!0,Re},get error(){return se.error=!0,Ge},get isValidating(){return se.isValidating=!0,St},get isLoading(){return se.isLoading=!0,Ut}}};ja.defineProperty(Zd,"defaultValue",{value:wn});var Tn=Ud(Wd),qd=xt(_d(),1),Cn=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},re=(t,e,a)=>(Cn(t,e,"read from private field"),a?a.call(t):e.get(t)),Ye=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},yt=(t,e,a,r)=>(Cn(t,e,"write to private field"),r?r.call(t,a):e.set(t,a),a);function Sn(t,e){return e==null?t:(0,qd.default)(t,e)}var Oe,Da,Fa,Xt,ea,ta,Lt,Lr,Dr,Jd=class{constructor(t=[]){Ye(this,Oe,void 0),Ye(this,Da,"ready"),Ye(this,Fa,void 0),Ye(this,Xt,new Set),Ye(this,ea,new Set),Ye(this,ta,new Set),this.pushMessage=e=>{yt(this,Oe,re(this,Oe).concat(e)),re(this,Lt).call(this)},this.popMessage=()=>{yt(this,Oe,re(this,Oe).slice(0,-1)),re(this,Lt).call(this)},this.replaceMessage=(e,a)=>{yt(this,Oe,[...re(this,Oe).slice(0,e),this.snapshot(a),...re(this,Oe).slice(e+1)]),re(this,Lt).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,a)=>{let r=a?Sn(e,a):e;return re(this,Xt).add(r),()=>{re(this,Xt).delete(r)}},this["~registerStatusCallback"]=e=>(re(this,ea).add(e),()=>{re(this,ea).delete(e)}),this["~registerErrorCallback"]=e=>(re(this,ta).add(e),()=>{re(this,ta).delete(e)}),Ye(this,Lt,()=>{re(this,Xt).forEach(e=>e())}),Ye(this,Lr,()=>{re(this,ea).forEach(e=>e())}),Ye(this,Dr,()=>{re(this,ta).forEach(e=>e())}),yt(this,Oe,t)}get status(){return re(this,Da)}set status(t){yt(this,Da,t),re(this,Lr).call(this)}get error(){return re(this,Fa)}set error(t){yt(this,Fa,t),re(this,Dr).call(this)}get messages(){return re(this,Oe)}set messages(t){yt(this,Oe,[...t]),re(this,Lt).call(this)}};Oe=new WeakMap,Da=new WeakMap,Fa=new WeakMap,Xt=new WeakMap,ea=new WeakMap,ta=new WeakMap,Lt=new WeakMap,Lr=new WeakMap,Dr=new WeakMap;var Dt,An=class extends dd{constructor({messages:t,...e}){let a=new Jd(t);super({...e,state:a}),Ye(this,Dt,void 0),this["~registerMessagesCallback"]=(r,s)=>re(this,Dt)["~registerMessagesCallback"](r,s),this["~registerStatusCallback"]=r=>re(this,Dt)["~registerStatusCallback"](r),this["~registerErrorCallback"]=r=>re(this,Dt)["~registerErrorCallback"](r),yt(this,Dt,a)}};Dt=new WeakMap;function On({experimental_throttle:t,resume:e=!1,...a}={}){let r=(0,M.useRef)("chat"in a?a.chat:new An(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new An(a));let s=(0,M.useSyncExternalStore)((0,M.useCallback)(l=>r.current["~registerMessagesCallback"](l,t),[t,"id"in a?a.id:null]),()=>r.current.messages,()=>r.current.messages),n=(0,M.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),i=(0,M.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),o=(0,M.useCallback)(l=>{typeof l=="function"&&(l=l(r.current.messages)),r.current.messages=l},[r]);return(0,M.useEffect)(()=>{e&&r.current.resumeStream()},[e,r]),{id:r.current.id,messages:s,setMessages:o,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:i,resumeStream:r.current.resumeStream,status:n,addToolResult:r.current.addToolResult}}function Kd({api:t="/api/completion",id:e,initialCompletion:a="",initialInput:r="",credentials:s,headers:n,body:i,streamProtocol:o="data",fetch:l,onFinish:u,onError:c,experimental_throttle:m}={}){let b=(0,M.useId)(),x=e||b,{data:w,mutate:v}=Tn([t,x],null,{fallbackData:a}),{data:p=!1,mutate:g}=Tn([x,"loading"],null),[k,I]=(0,M.useState)(void 0),A=w,[O,V]=(0,M.useState)(null),B=(0,M.useRef)({credentials:s,headers:n,body:i});(0,M.useEffect)(()=>{B.current={credentials:s,headers:n,body:i}},[s,n,i]);let Z=(0,M.useCallback)(async(te,ne)=>id({api:t,prompt:te,credentials:B.current.credentials,headers:{...B.current.headers,...ne==null?void 0:ne.headers},body:{...B.current.body,...ne==null?void 0:ne.body},streamProtocol:o,fetch:l,setCompletion:Sn(fe=>v(fe,!1),m),setLoading:g,setError:I,setAbortController:V,onFinish:u,onError:c}),[v,g,t,B,V,u,c,I,o,l,m]),ae=(0,M.useCallback)(()=>{O&&(O.abort(),V(null))},[O]),F=(0,M.useCallback)(te=>{v(te,!1)},[v]),ee=(0,M.useCallback)(async(te,ne)=>Z(te,ne),[Z]),[oe,ue]=(0,M.useState)(r),se=(0,M.useCallback)(te=>{var ne;return(ne=te==null?void 0:te.preventDefault)==null||ne.call(te),oe?ee(oe):void 0},[oe,ee]);return{completion:A,complete:ee,error:k,setCompletion:F,stop:ae,input:oe,setInput:ue,handleInputChange:(0,M.useCallback)(te=>{ue(te.target.value)},[ue]),handleSubmit:se,isLoading:p}}function Nn(t=globalThis){var e,a,r;return t.window?"runtime/browser":(e=t.navigator)!=null&&e.userAgent?`runtime/${t.navigator.userAgent.toLowerCase()}`:(r=(a=t.process)==null?void 0:a.versions)!=null&&r.node?`runtime/node.js/${t.process.version.substring(0)}`:t.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function Yd(t){return Object.fromEntries(Object.entries(t).filter(([e,a])=>a!=null))}function Rn(t,...e){let a=Yd(t??{}),r=new Headers(a),s=r.get("user-agent")||"";return r.set("user-agent",[s,...e].filter(Boolean).join(" ")),Object.fromEntries(r)}var aa=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,i=Array(e);for(let o=0;o<e;o++)i[o]=a[Math.random()*n|0];return i.join("")};if(t==null)return s;if(a.includes(r))throw new Cs({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`};aa();var Gd=/"__proto__"\s*:/,Hd=/"constructor"\s*:/;function Qd(t){let e=JSON.parse(t);return typeof e!="object"||!e||Gd.test(t)===!1&&Hd.test(t)===!1?e:Xd(e)}function Xd(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function ec(t){let{stackTraceLimit:e}=Error;Error.stackTraceLimit=0;try{return Qd(t)}finally{Error.stackTraceLimit=e}}var za=Symbol.for("vercel.ai.validator");function tc(t){return{[za]:!0,validate:t}}function ac(t){return typeof t=="object"&&!!t&&za in t&&t[za]===!0&&"validate"in t}function rc(t){return ac(t)?t:sc(t)}function sc(t){return tc(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new wt({value:e,cause:a.issues})}})}async function Pn({value:t,schema:e}){let a=rc(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:wt.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:wt.wrap({value:t,cause:r}),rawValue:t}}}async function Ua({text:t,schema:e}){try{let a=ec(t);return e==null?{success:!0,value:a,rawValue:a}:await Pn({value:a,schema:e})}catch(a){return{success:!1,error:ya.isInstance(a)?a:new ya({text:t,cause:a}),rawValue:void 0}}}function nc({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new js).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await Ua({text:a,schema:e}))}}))}async function Ft(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}var ic=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},oc=Symbol("Let zodToJsonSchema decide on which parser to use"),Mn={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},lc=t=>typeof t=="string"?{...Mn,name:t}:{...Mn,...t};function Ce(){return{}}function uc(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==f.ZodAny&&(a.items=X(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function dc(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function cc(){return{type:"boolean"}}function jn(t,e){return X(t.type._def,e)}var pc=(t,e)=>X(t.innerType._def,e);function Zn(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>Zn(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return mc(t)}}var mc=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function hc(t,e){return{...X(t.innerType._def,e),default:t.defaultValue()}}function fc(t,e){return e.effectStrategy==="input"?X(t.schema._def,e):Ce()}function gc(t){return{type:"string",enum:Array.from(t.values)}}var yc=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function vc(t,e){let a=[X(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),X(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(yc(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:i,...o}=s;n=o}r.push(n)}}),r.length?{allOf:r}:void 0}function bc(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var Fr=void 0,De={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Fr===void 0&&(Fr=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Fr),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function $n(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Fe(a,"email",r.message,e);break;case"format:idn-email":Fe(a,"idn-email",r.message,e);break;case"pattern:zod":be(a,De.email,r.message,e);break}break;case"url":Fe(a,"uri",r.message,e);break;case"uuid":Fe(a,"uuid",r.message,e);break;case"regex":be(a,r.regex,r.message,e);break;case"cuid":be(a,De.cuid,r.message,e);break;case"cuid2":be(a,De.cuid2,r.message,e);break;case"startsWith":be(a,RegExp(`^${zr(r.value,e)}`),r.message,e);break;case"endsWith":be(a,RegExp(`${zr(r.value,e)}$`),r.message,e);break;case"datetime":Fe(a,"date-time",r.message,e);break;case"date":Fe(a,"date",r.message,e);break;case"time":Fe(a,"time",r.message,e);break;case"duration":Fe(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":be(a,RegExp(zr(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&Fe(a,"ipv4",r.message,e),r.version!=="v4"&&Fe(a,"ipv6",r.message,e);break;case"base64url":be(a,De.base64url,r.message,e);break;case"jwt":be(a,De.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&be(a,De.ipv4Cidr,r.message,e),r.version!=="v4"&&be(a,De.ipv6Cidr,r.message,e);break;case"emoji":be(a,De.emoji(),r.message,e);break;case"ulid":be(a,De.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Fe(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":be(a,De.base64,r.message,e);break}break;case"nanoid":be(a,De.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function zr(t,e){return e.patternStrategy==="escape"?xc(t):t}var _c=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function xc(t){let e="";for(let a=0;a<t.length;a++)_c.has(t[a])||(e+="\\"),e+=t[a];return e}function Fe(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function be(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:Ln(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=Ln(e,r)}function Ln(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,i=!1,o=!1;for(let u=0;u<r.length;u++){if(n){s+=r[u],n=!1;continue}if(a.i){if(i){if(r[u].match(/[a-z]/)){o?(s+=r[u],s+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&((l=r[u+2])!=null&&l.match(/[a-z]/))?(s+=r[u],o=!0):s+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){s+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(a.m){if(r[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[u]==="."){s+=i?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}s+=r[u],r[u]==="\\"?n=!0:i&&r[u]==="]"?i=!1:!i&&r[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function Dn(t,e){var r,s,n,i,o;let a={type:"object",additionalProperties:X(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===f.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:l,...u}=$n(t.keyType._def,e);return{...a,propertyNames:u}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===f.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((i=t.keyType)==null?void 0:i._def.typeName)===f.ZodBranded&&t.keyType._def.type._def.typeName===f.ZodString&&((o=t.keyType._def.type._def.checks)!=null&&o.length)){let{type:l,...u}=jn(t.keyType._def,e);return{...a,propertyNames:u}}}return a}function kc(t,e){return e.mapStrategy==="record"?Dn(t,e):{type:"array",maxItems:125,items:{type:"array",items:[X(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||Ce(),X(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||Ce()],minItems:2,maxItems:2}}}function wc(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function Ic(){return{not:Ce()}}function Ec(){return{type:"null"}}var Ur={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Tc(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in Ur&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let i=Ur[n._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let i=typeof n._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===a.length){let s=r.filter((n,i,o)=>o.indexOf(n)===i);return{type:s.length>1?s:s[0],enum:a.reduce((n,i)=>n.includes(i._def.value)?n:[...n,i._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return Cc(t,e)}var Cc=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>X(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function Sc(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[Ur[t.innerType._def.typeName],"null"]};let a=X(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function Ac(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function Oc(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let i in s){let o=s[i];if(o===void 0||o._def===void 0)continue;let l=Rc(o),u=X(o._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});u!==void 0&&(a.properties[i]=u,l||r.push(i))}r.length&&(a.required=r);let n=Nc(t,e);return n!==void 0&&(a.additionalProperties=n),a}function Nc(t,e){if(t.catchall._def.typeName!=="ZodNever")return X(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Rc(t){try{return t.isOptional()}catch{return!0}}var Pc=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return X(t.innerType._def,e);let a=X(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:Ce()},a]}:Ce()},Mc=(t,e)=>{if(e.pipeStrategy==="input")return X(t.in._def,e);if(e.pipeStrategy==="output")return X(t.out._def,e);let a=X(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]});return{allOf:[a,X(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]})].filter(r=>r!==void 0)}};function jc(t,e){return X(t.type._def,e)}function Zc(t,e){let a={type:"array",uniqueItems:!0,items:X(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function $c(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>X(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:X(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>X(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function Lc(){return{not:Ce()}}function Dc(){return Ce()}var Fc=(t,e)=>X(t.innerType._def,e),zc=(t,e,a)=>{switch(e){case f.ZodString:return $n(t,a);case f.ZodNumber:return Ac(t);case f.ZodObject:return Oc(t,a);case f.ZodBigInt:return dc(t);case f.ZodBoolean:return cc();case f.ZodDate:return Zn(t,a);case f.ZodUndefined:return Lc();case f.ZodNull:return Ec();case f.ZodArray:return uc(t,a);case f.ZodUnion:case f.ZodDiscriminatedUnion:return Tc(t,a);case f.ZodIntersection:return vc(t,a);case f.ZodTuple:return $c(t,a);case f.ZodRecord:return Dn(t,a);case f.ZodLiteral:return bc(t);case f.ZodEnum:return gc(t);case f.ZodNativeEnum:return wc(t);case f.ZodNullable:return Sc(t,a);case f.ZodOptional:return Pc(t,a);case f.ZodMap:return kc(t,a);case f.ZodSet:return Zc(t,a);case f.ZodLazy:return()=>t.getter()._def;case f.ZodPromise:return jc(t,a);case f.ZodNaN:case f.ZodNever:return Ic();case f.ZodEffects:return fc(t,a);case f.ZodAny:return Ce();case f.ZodUnknown:return Dc();case f.ZodDefault:return hc(t,a);case f.ZodBranded:return jn(t,a);case f.ZodReadonly:return Fc(t,a);case f.ZodCatch:return pc(t,a);case f.ZodPipeline:return Mc(t,a);case f.ZodFunction:case f.ZodVoid:case f.ZodSymbol:return;default:return(r=>{})(e)}};function X(t,e,a=!1){var o;let r=e.seen.get(t);if(e.override){let l=(o=e.override)==null?void 0:o.call(e,t,e,r,a);if(l!==oc)return l}if(r&&!a){let l=Uc(r,e);if(l!==void 0)return l}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=zc(t,t.typeName,e),i=typeof n=="function"?X(n(),e):n;if(i&&Vc(t,e,i),e.postProcess){let l=e.postProcess(i,t,e);return s.jsonSchema=i,l}return s.jsonSchema=i,i}var Uc=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:ic(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Ce()):e.$refStrategy==="seen"?Ce():void 0}},Vc=(t,e,a)=>(t.description&&(a.description=t.description),a),Bc=t=>{let e=lc(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},Wc=(t,e)=>{let a=Bc(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[u,c])=>({...l,[u]:X(c._def,{...a,currentPath:[...a.basePath,a.definitionPath,u]},!0)??Ce()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=X(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??Ce(),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(n.title=i);let o=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return o.$schema="http://json-schema.org/draft-07/schema#",o};function qc(t,e){return Br(Wc(t,{$refStrategy:(e==null?void 0:e.useReferences)??!1?"root":"none"}),{validate:async a=>{let r=await t.safeParseAsync(a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function Jc(t,e){return Br(Ga(t,{target:"draft-7",io:"output",reused:(e==null?void 0:e.useReferences)??!1?"ref":"inline"}),{validate:async a=>{let r=await ds(t,a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function Kc(t){return"_zod"in t}function Yc(t,e){return Kc(t)?Jc(t,e):qc(t,e)}var Vr=Symbol.for("vercel.ai.schema");function Br(t,{validate:e}={}){return{[Vr]:!0,_type:void 0,[za]:!0,jsonSchema:t,validate:e}}function Gc(t){return typeof t=="object"&&!!t&&Vr in t&&t[Vr]===!0&&"jsonSchema"in t&&"validate"in t}function Hc(t){return t==null?Br({properties:{},additionalProperties:!1}):Gc(t)?t:Yc(t)}var{btoa:Mh,atob:jh}=globalThis,Qc=Object.defineProperty,Xc=(t,e)=>{for(var a in e)Qc(t,a,{get:e[a],enumerable:!0})},Fn="AI_NoObjectGeneratedError",zn=`vercel.ai.error.${Fn}`,ep=Symbol.for(zn),Un,Vn=class extends qe{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:Fn,message:t,cause:e}),this[Un]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return qe.hasMarker(t,zn)}};Un=ep;var Bn="5.0.52",Wn=U([d(),mt(Uint8Array),mt(ArrayBuffer),Ya(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),ra=ps(()=>U([us(),d(),Me(),N(),pt(d(),ra),me(ra)])),K=pt(d(),pt(d(),ra)),qn=y({type:h("text"),text:d(),providerOptions:K.optional()}),tp=y({type:h("image"),image:U([Wn,mt(URL)]),mediaType:d().optional(),providerOptions:K.optional()}),Jn=y({type:h("file"),data:U([Wn,mt(URL)]),filename:d().optional(),mediaType:d(),providerOptions:K.optional()}),ap=y({type:h("reasoning"),text:d(),providerOptions:K.optional()}),rp=y({type:h("tool-call"),toolCallId:d(),toolName:d(),input:j(),providerOptions:K.optional(),providerExecuted:N().optional()}),sp=pa("type",[y({type:h("text"),value:d()}),y({type:h("json"),value:ra}),y({type:h("error-text"),value:d()}),y({type:h("error-json"),value:ra}),y({type:h("content"),value:me(U([y({type:h("text"),text:d()}),y({type:h("media"),data:d(),mediaType:d()})]))})]),Kn=y({type:h("tool-result"),toolCallId:d(),toolName:d(),output:sp,providerOptions:K.optional()});U([y({role:h("system"),content:d(),providerOptions:K.optional()}),y({role:h("user"),content:U([d(),me(U([qn,tp,Jn]))]),providerOptions:K.optional()}),y({role:h("assistant"),content:U([d(),me(U([qn,Jn,ap,rp,Kn]))]),providerOptions:K.optional()}),y({role:h("tool"),content:me(Kn),providerOptions:K.optional()})]),aa({prefix:"aitxt",size:24});var np=U([R({type:h("text-start"),id:d(),providerMetadata:K.optional()}),R({type:h("text-delta"),id:d(),delta:d(),providerMetadata:K.optional()}),R({type:h("text-end"),id:d(),providerMetadata:K.optional()}),R({type:h("error"),errorText:d()}),R({type:h("tool-input-start"),toolCallId:d(),toolName:d(),providerExecuted:N().optional(),dynamic:N().optional()}),R({type:h("tool-input-delta"),toolCallId:d(),inputTextDelta:d()}),R({type:h("tool-input-available"),toolCallId:d(),toolName:d(),input:j(),providerExecuted:N().optional(),providerMetadata:K.optional(),dynamic:N().optional()}),R({type:h("tool-input-error"),toolCallId:d(),toolName:d(),input:j(),providerExecuted:N().optional(),providerMetadata:K.optional(),dynamic:N().optional(),errorText:d()}),R({type:h("tool-output-available"),toolCallId:d(),output:j(),providerExecuted:N().optional(),dynamic:N().optional(),preliminary:N().optional()}),R({type:h("tool-output-error"),toolCallId:d(),errorText:d(),providerExecuted:N().optional(),dynamic:N().optional()}),R({type:h("reasoning-start"),id:d(),providerMetadata:K.optional()}),R({type:h("reasoning-delta"),id:d(),delta:d(),providerMetadata:K.optional()}),R({type:h("reasoning-end"),id:d(),providerMetadata:K.optional()}),R({type:h("source-url"),sourceId:d(),url:d(),title:d().optional(),providerMetadata:K.optional()}),R({type:h("source-document"),sourceId:d(),mediaType:d(),title:d(),filename:d().optional(),providerMetadata:K.optional()}),R({type:h("file"),url:d(),mediaType:d(),providerMetadata:K.optional()}),R({type:Ya(t=>typeof t=="string"&&t.startsWith("data-"),{message:'Type must start with "data-"'}),id:d().optional(),data:j(),transient:N().optional()}),R({type:h("start-step")}),R({type:h("finish-step")}),R({type:h("start"),messageId:d().optional(),messageMetadata:j().optional()}),R({type:h("finish"),messageMetadata:j().optional()}),R({type:h("abort")}),R({type:h("message-metadata"),messageMetadata:j()})]);function ip(t){let e=["ROOT"],a=-1,r=null;function s(l,u,c){switch(l){case'"':a=u,e.pop(),e.push(c),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=u,r=u,e.pop(),e.push(c),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(c),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=u,e.pop(),e.push(c),e.push("INSIDE_NUMBER");break;case"{":a=u,e.pop(),e.push(c),e.push("INSIDE_OBJECT_START");break;case"[":a=u,e.pop(),e.push(c),e.push("INSIDE_ARRAY_START");break}}function n(l,u){switch(l){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=u,e.pop();break}}function i(l,u){switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=u,e.pop();break}}for(let l=0;l<t.length;l++){let u=t[l];switch(e[e.length-1]){case"ROOT":s(u,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(u){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":switch(u){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break}break;case"INSIDE_OBJECT_KEY":switch(u){case'"':e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}break;case"INSIDE_OBJECT_AFTER_KEY":switch(u){case":":e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}break;case"INSIDE_OBJECT_BEFORE_VALUE":s(u,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(u,l);break;case"INSIDE_STRING":switch(u){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":switch(u){case"]":a=l,e.pop();break;default:a=l,s(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}break;case"INSIDE_ARRAY_AFTER_VALUE":switch(u){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(u,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(u){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(u,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(u,l);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(u,l);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(u,l);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let c=t.substring(r,l+1);!"false".startsWith(c)&&!"true".startsWith(c)&&!"null".startsWith(c)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(u,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(u,l)):a=l;break}}}let o=t.slice(0,a+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let u=t.substring(r,t.length);"true".startsWith(u)?o+="true".slice(u.length):"false".startsWith(u)?o+="false".slice(u.length):"null".startsWith(u)&&(o+="null".slice(u.length))}}return o}async function op(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await Ua({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await Ua({text:ip(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}aa({prefix:"aitxt",size:24}),aa({prefix:"aiobj",size:24}),aa({prefix:"aiobj",size:24}),Xc({},{object:()=>up,text:()=>lp});var lp=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),up=({schema:t})=>{let e=Hc(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await op(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await Ua({text:a});if(!s.success)throw new Vn({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await Pn({value:s.value,schema:e});if(!n.success)throw new Vn({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}},dp=Ae({name:d(),version:d()}),Wr=Ae({_meta:z(y({}).loose())}),sa=Wr,cp=y({method:d(),params:z(Wr)}),pp=Ae({experimental:z(y({}).loose()),logging:z(y({}).loose()),prompts:z(Ae({listChanged:z(N())})),resources:z(Ae({subscribe:z(N()),listChanged:z(N())})),tools:z(Ae({listChanged:z(N())}))});sa.extend({protocolVersion:d(),capabilities:pp,serverInfo:dp,instructions:z(d())});var mp=sa.extend({nextCursor:z(d())}),hp=y({name:d(),description:z(d()),inputSchema:y({type:h("object"),properties:z(y({}).loose())}).loose()}).loose();mp.extend({tools:me(hp)});var fp=y({type:h("text"),text:d()}).loose(),gp=y({type:h("image"),data:ma(),mimeType:d()}).loose(),Yn=y({uri:d(),mimeType:z(d())}).loose(),yp=Yn.extend({text:d()}),vp=Yn.extend({blob:ma()}),bp=y({type:h("resource"),resource:U([yp,vp])}).loose();sa.extend({content:me(U([fp,gp,bp])),isError:N().default(!1).optional()}).or(sa.extend({toolResult:j()}));var Va="2.0",_p=y({jsonrpc:h(Va),id:U([d(),Me().int()])}).merge(cp).strict(),xp=y({jsonrpc:h(Va),id:U([d(),Me().int()]),result:sa}).strict(),kp=y({jsonrpc:h(Va),id:U([d(),Me().int()]),error:y({code:Me().int(),message:d(),data:z(j())})}).strict();U([_p,y({jsonrpc:h(Va)}).merge(y({method:d(),params:z(Wr)})).strict(),xp,kp]);var wp=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:i}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:t,...e}){var m;let a=await Ft(this.body),r=await Ft(this.headers),s=await Ft(this.credentials),n=await((m=this.prepareSendMessagesRequest)==null?void 0:m.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:{...r,...e.headers},credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),i=(n==null?void 0:n.api)??this.api,o=(n==null?void 0:n.headers)===void 0?{...r,...e.headers}:n.headers,l=(n==null?void 0:n.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:n.body,u=(n==null?void 0:n.credentials)??s,c=await(this.fetch??globalThis.fetch)(i,{method:"POST",headers:Rn({"Content-Type":"application/json",...o},`ai-sdk/${Bn}`,Nn()),body:JSON.stringify(l),credentials:u,signal:t});if(!c.ok)throw Error(await c.text()??"Failed to fetch the chat response.");if(!c.body)throw Error("The response body is empty.");return this.processResponseStream(c.body)}async reconnectToStream(t){var u;let e=await Ft(this.body),a=await Ft(this.headers),r=await Ft(this.credentials),s=await((u=this.prepareReconnectToStreamRequest)==null?void 0:u.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:{...a,...t.headers},credentials:r,requestMetadata:t.metadata})),n=(s==null?void 0:s.api)??`${this.api}/${t.chatId}/stream`,i=(s==null?void 0:s.headers)===void 0?{...a,...t.headers}:s.headers,o=(s==null?void 0:s.credentials)??r,l=await(this.fetch??globalThis.fetch)(n,{method:"GET",headers:Rn(i,`ai-sdk/${Bn}`,Nn()),credentials:o});if(l.status===204)return null;if(!l.ok)throw Error(await l.text()??"Failed to fetch the chat response.");if(!l.body)throw Error("The response body is empty.");return this.processResponseStream(l.body)}},Gn=class extends wp{constructor(t={}){super(t)}processResponseStream(t){return nc({stream:t,schema:np}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},Ip=y({type:h("text"),text:d(),state:kt(["streaming","done"]).optional(),providerMetadata:K.optional()}),Ep=y({type:h("reasoning"),text:d(),state:kt(["streaming","done"]).optional(),providerMetadata:K.optional()}),Tp=y({type:h("source-url"),sourceId:d(),url:d(),title:d().optional(),providerMetadata:K.optional()}),Cp=y({type:h("source-document"),sourceId:d(),mediaType:d(),title:d(),filename:d().optional(),providerMetadata:K.optional()}),Sp=y({type:h("file"),mediaType:d(),filename:d().optional(),url:d(),providerMetadata:K.optional()}),Ap=y({type:h("step-start")}),Op=y({type:d().startsWith("data-"),id:d().optional(),data:j()}),Np=[y({type:h("dynamic-tool"),toolName:d(),toolCallId:d(),state:h("input-streaming"),input:j().optional(),output:ie().optional(),errorText:ie().optional()}),y({type:h("dynamic-tool"),toolName:d(),toolCallId:d(),state:h("input-available"),input:j(),output:ie().optional(),errorText:ie().optional(),callProviderMetadata:K.optional()}),y({type:h("dynamic-tool"),toolName:d(),toolCallId:d(),state:h("output-available"),input:j(),output:j(),errorText:ie().optional(),callProviderMetadata:K.optional(),preliminary:N().optional()}),y({type:h("dynamic-tool"),toolName:d(),toolCallId:d(),state:h("output-error"),input:j(),output:ie().optional(),errorText:d(),callProviderMetadata:K.optional()})],Rp=[y({type:d().startsWith("tool-"),toolCallId:d(),state:h("input-streaming"),providerExecuted:N().optional(),input:j().optional(),output:ie().optional(),errorText:ie().optional()}),y({type:d().startsWith("tool-"),toolCallId:d(),state:h("input-available"),providerExecuted:N().optional(),input:j(),output:ie().optional(),errorText:ie().optional(),callProviderMetadata:K.optional()}),y({type:d().startsWith("tool-"),toolCallId:d(),state:h("output-available"),providerExecuted:N().optional(),input:j(),output:j(),errorText:ie().optional(),callProviderMetadata:K.optional(),preliminary:N().optional()}),y({type:d().startsWith("tool-"),toolCallId:d(),state:h("output-error"),providerExecuted:N().optional(),input:j(),output:ie().optional(),errorText:d(),callProviderMetadata:K.optional()})];y({id:d(),role:kt(["system","user","assistant"]),metadata:j().optional(),parts:me(U([Ip,Ep,Tp,Cp,Sp,Ap,Op,...Np,...Rp]))});var zt=class extends Error{constructor(t,e="TOOL_ERROR",a=!1,r,s){super(t),this.name="ToolExecutionError",this.code=e,this.isRetryable=a,this.suggestedFix=r,this.meta=s}toStructuredString(){let t=JSON.stringify({message:this.message,code:this.code,is_retryable:this.isRetryable,...this.suggestedFix&&{suggested_fix:this.suggestedFix},...this.meta&&{meta:this.meta}});return`Error invoking tool ${this.name}: ${t}`}};const Hn=y({status:kt(["success","error","warning"]).optional(),auth_required:N().optional(),next_steps:me(d()).optional(),action_url:d().optional(),message:d().optional(),meta:pt(d(),j()).optional()});function Pp(t,e){return t?!!(["image/","video/","audio/","application/pdf"].some(a=>t.startsWith(a))||["svg","vega"].some(a=>t.includes(a))||t==="text/html"&&["<img","<video","<audio","<iframe","<canvas","<svg","<marimo-ui-element"].some(a=>e.includes(a))):!1}var Mp=class extends Bt{constructor(e){super();L(this,"title","Cell Outputs");L(this,"mentionPrefix","@");L(this,"contextType","cell-output");this.store=e}getItems(){let e=this.store.get(ct),a=[];for(let r of e.cellIds.inOrderIds){let s=Xn(r,e),n=s.cellOutput;if(!n)continue;let i=n.output.mimetype||"unknown";a.push({uri:this.asURI(r),name:s.cellName,type:this.contextType,description:`Cell output (${i})`,data:{...s,cellOutput:n}})}return a}formatCompletion(e){let{cellOutput:a,cellName:r,cellCode:s}=e.data;return{label:`@${r}`,displayLabel:r,detail:`${a.outputType} output`,boost:a.outputType==="media"?Rt.HIGH:Rt.MEDIUM,type:this.contextType,section:Nt.CELL_OUTPUT,apply:`@${r}`,info:()=>{let n=document.createElement("div");n.classList.add("mo-cm-tooltip","docs-documentation","min-w-[300px]","max-w-[500px]","flex","flex-col","gap-2");let i=document.createElement("div");i.classList.add("flex","flex-col","gap-1");let o=document.createElement("div");o.classList.add("font-bold","text-base"),o.textContent=r,i.append(o);let l=document.createElement("div");if(l.classList.add("text-sm","text-muted-foreground"),i.append(l),n.append(i),s){let u=document.createElement("div");u.classList.add("text-xs","font-medium","text-muted-foreground"),u.textContent="Code:",n.append(u);let c=document.createElement("div");c.classList.add("text-xs","font-mono","bg-muted","p-2","rounded","max-h-20","overflow-y-auto"),c.textContent=s.slice(0,200)+(s.length>200?"...":""),n.append(c)}if(a.processedContent){let u=document.createElement("div");u.classList.add("text-xs","font-medium","text-muted-foreground","mt-2"),u.textContent="Output Preview:",n.append(u);let c=document.createElement("div");c.classList.add("text-xs","bg-muted","p-2","rounded","max-h-24","overflow-y-auto","mb-2"),c.textContent=a.processedContent.slice(0,300)+(a.processedContent.length>300?"...":""),n.append(c)}if(a.outputType==="media"){let u=document.createElement("div");u.classList.add("text-xs","text-muted-foreground","italic","mb-2"),u.textContent="A screenshot of the output will be attached",n.append(u)}return n}}}formatContext(e){let{cellOutput:a,cellName:r,cellId:s,cellCode:n}=e.data,i={name:r,cellId:s,outputType:a.outputType,mimetype:a.output.mimetype},o=`Cell Code:
${n}

`;return a.outputType==="text"&&a.processedContent?o+=`Output:
${a.processedContent}`:a.outputType==="media"&&(o+=`Media Output: Contains ${a.output.mimetype} content`,a.imageUrl&&(o+=`
Image URL: ${a.imageUrl}`)),Vt({type:this.contextType,data:i,details:o})}async getAttachments(e){let a=e[0].data.cellId,r=e[0].data.cellName;return jp(e.map(s=>s.data.cellOutput),a,r)}};async function jp(t,e,a){let r=t.filter(n=>n.shouldDownloadImage&&n.outputType==="media");if(r.length===0)return[];let s=r.flatMap(n=>{let i=document.getElementById(Vi.create(e));return i?{cellId:e,cellName:a,mimetype:n.output.mimetype,element:i}:(he.warn(`Output element not found for cell ${e}`),[])});try{return await Promise.all(s.map(async n=>({type:"file",filename:`${a}-output-screenshot`,mediaType:"image/png",url:await wo(n.element)})))}catch(n){return he.error("Error downloading cell output images:",n),[]}}function Qn(t){if(ys(t))return null;let e=t.mimetype,a=Pp(e,String(t.data))?"media":"text",r=Ro(t),s,n=!1;return a==="media"&&(typeof t.data=="string"&&t.data.startsWith("data:")||typeof t.data=="string"&&t.data.startsWith("http")?s=t.data:n=!0),{processedContent:r,imageUrl:s,shouldDownloadImage:n,outputType:a,output:t}}function Xn(t,e,a){let{includeConsoleOutput:r=!1}=a||{},s=e.cellRuntime[t],n=e.cellData[t],i=e.cellIds.inOrderIds.indexOf(t),o=Hi(n.name,i),l;r&&(l=s.consoleOutputs.map(m=>Qn(m)).filter(m=>m!==null));let u,c=s.output;return c&&!ys(c)&&(u=Qn(c)??void 0),{cellId:t,cellName:o,cellCode:n.code,cellOutput:u,consoleOutputs:l}}function Zp(t){return t.type==="setup-refs"?"The setup cell cannot have references":t.type==="cycle"?"This cell is in a cycle":t.type==="multiple-defs"?`The variable '${t.name}' was defined by another cell`:t.type==="import-star"||t.type==="ancestor-stopped"||t.type==="ancestor-prevented"||t.type==="exception"||t.type==="strict-exception"?t.msg:t.type==="interruption"?"This cell was interrupted and needs to be re-run":t.type==="syntax"||t.type==="unknown"||t.type==="sql-error"?t.msg:t.type==="internal"?t.msg||"An internal error occurred":(bo(t),"Unknown error")}var ei=new Wi("error","errors"),$p=class extends Bt{constructor(e){super();L(this,"title","Errors");L(this,"mentionPrefix","@");L(this,"contextType","error");this.store=e}getItems(){let e=this.store.get(Ki);return e.length===0?[]:[{uri:this.asURI("all"),name:"Errors",type:this.contextType,data:{type:"all-errors",errors:e.map(a=>({cellId:a.cellId,cellName:a.cellName,errorData:a.output.data}))},description:"All errors in the notebook"}]}formatCompletion(e){return e.data.type==="all-errors"?{label:"@Errors",displayLabel:"Errors",detail:`${e.data.errors.length} ${ei.pluralize(e.data.errors.length)}`,type:"error",apply:"@Errors",section:Nt.ERROR,info:()=>{let a=document.createElement("div");a.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let r=document.createElement("div");r.classList.add("flex","flex-col","gap-1");let s=document.createElement("div");s.classList.add("font-bold","text-base"),s.textContent="Errors",r.append(s);let n=document.createElement("div");return n.classList.add("text-sm","text-muted-foreground"),n.textContent=`${e.data.errors.length} ${ei.pluralize(e.data.errors.length)}`,r.append(n),a.append(r),a}}:{label:"Error",displayLabel:"Error",section:Nt.ERROR}}formatContext(e){let{data:a}=e;return a.errors.map(r=>Vt({type:this.contextType,data:{name:r.cellName||`Cell ${r.cellId}`,description:r.errorData.map(s=>Zp(s)).join(`
`)}})).join(`

`)}};const ti=Ji();var Lp={maxDepth:3,maxResults:20,defaultResultsLimit:5,includeDirectories:!1},Dp=class extends Bt{constructor(e,a=Lp){super();L(this,"title","Files");L(this,"mentionPrefix","#");L(this,"contextType","file");L(this,"searchFiles",async(e,a={})=>{let{maxDepth:r,maxResults:s,includeDirectories:n}={...this.config,...a};return(await this.apiRequests.sendSearchFiles({query:e,includeFiles:!0,includeDirectories:n,depth:r,limit:s})).files});this.apiRequests=e,this.config=a}createCompletionSource(){return async e=>{let a=e.matchBefore(/#[^\s#]*/);if(!a)return null;let r=a.text;if(!r.startsWith("#"))return null;let s=r.slice(1);if(s.length===0)return this.getDefaultCompletions(a);try{let n=(await this.searchFiles(s)||[]).map(i=>{let o={uri:this.asURI(i.path),name:i.name,type:this.contextType,description:i.isDirectory?"Directory":"File",data:{path:i.path,isDirectory:i.isDirectory}};return this.formatCompletion(o)});return{from:a.from,options:n}}catch(n){return he.error("Failed to search files:",n),null}}}async getDefaultCompletions(e){try{for(let a of["py","md","csv"])try{let r=await this.searchFiles(a,{maxDepth:1,maxResults:5});if(r&&r.length>0){let s=r.map(n=>{let i={uri:this.asURI(n.path),name:n.name,type:this.contextType,description:n.isDirectory?"Directory":"File",data:{path:n.path,isDirectory:n.isDirectory}};return this.formatCompletion(i)});return{from:e.from,options:s}}}catch(r){he.error("Failed to get default file completions:",r)}return{from:e.from,options:[]}}catch(a){return he.error("Failed to get default file completions:",a),null}}getItems(){return[]}formatCompletion(e){let{data:a,name:r}=e,s=a.isDirectory?"\u{1F4C1}":"\u{1F4C4}";return{...this.createBasicCompletion(e),type:"file",section:Nt.FILE,boost:a.isDirectory?Rt.MEDIUM:Rt.LOW,detail:a.path,displayLabel:`${s} ${r}`,apply:async(n,i,o,l)=>{var x;let u=(x=n.state.facet(ti))==null?void 0:x.addAttachment;if(!u){he.warn("No addAttachment callback provided");return}let c=await this.apiRequests.sendFileDetails({path:a.path}).catch(w=>(vs({title:"Failed to get file details",description:w.message}),null));if(!c)return;let m=c.mimeType||"text/plain",b;if(m.startsWith("text/")||m.includes("json")||m.includes("xml"))b=new Blob([c.contents||""],{type:m});else if(c.contents)try{b=await zo(lo(c.contents,m))}catch{b=new Blob([c.contents],{type:m})}else b=new Blob([""],{type:m});u(new File([b],r,{type:m})),n.dispatch({changes:{from:o,to:l,insert:""}}),go(n)},info:()=>{let n=document.createElement("div");n.classList.add("flex","flex-col","gap-1","p-2");let i=document.createElement("div");i.classList.add("font-bold"),i.textContent=r,n.append(i);let o=document.createElement("div");return o.classList.add("text-xs","text-muted-foreground"),o.textContent=a.path,n.append(o),n}}}formatContext(e){let{data:a,name:r}=e;return Vt({type:this.contextType,data:{name:r,path:a.path,isDirectory:a.isDirectory},details:a.isDirectory?"Directory containing files and subdirectories":"File"})}},Fp=class extends Bt{constructor(e){super();L(this,"title","Tables");L(this,"mentionPrefix","@");L(this,"contextType","data");this.tablesMap=e}getItems(){return[...this.tablesMap.entries()].map(([e,a])=>({uri:this.asURI(e),name:e,type:this.contextType,description:a.source==="memory"?"in-memory":a.source,data:a}))}formatContext(e){let{data:a}=e,{columns:r,source:s,num_rows:n,num_columns:i,name:o,variable_name:l}=a,u=[n==null?void 0:`${n} rows`,i==null?void 0:`${i} columns`].filter(Boolean).join(", "),c="";if(u&&(c+=`Shape: ${u}
`),l&&(c+=`Variable: ${l}
`),r&&r.length>0){c+=`Columns:
`;for(let m of r){let b=`  ${m.name} (${m.type})`;if(m.sample_values&&m.sample_values.length>0){let x=m.sample_values.slice(0,3).map(w=>w===null?"null":String(w)).join(", ");b+=` - samples: [${x}]`}c+=`${b}
`}}return Vt({type:this.contextType,data:{name:o,source:s??"unknown"},details:c.trim()})}formatCompletion(e){let a=e.data.name,r=e.data;return{label:`@${a}`,displayLabel:a,detail:r.source==="memory"?"in-memory":r.source,boost:r.source_type==="local"?Rt.LOCAL_TABLE:Rt.REMOTE_TABLE,type:is(r),apply:`@${a}`,section:{name:is(r)==="dataframe"?"Dataframe":"Table",rank:Nt.TABLE.rank},info:()=>this.createTableInfoElement(a,r)}}createTableInfoElement(e,a){let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");if(n.classList.add("font-bold","text-base"),n.textContent=e,s.append(n),a.source){let o=document.createElement("div");o.classList.add("text-xs","text-muted-foreground"),o.textContent=`Source: ${a.source}`,s.append(o)}r.append(s);let i=[a.num_rows==null?void 0:`${a.num_rows} rows`,a.num_columns==null?void 0:`${a.num_columns} columns`].filter(Boolean).join(", ");if(i){let o=document.createElement("div");o.classList.add("text-xs","bg-muted","px-2","py-1","rounded"),o.textContent=i,r.append(o)}if(a.columns&&a.columns.length>0){let o=document.createElement("div");o.classList.add("overflow-auto","max-h-60");let l=document.createElement("table");l.classList.add("w-full","text-xs","border-collapse");let u=l.insertRow();u.classList.add("bg-muted");let c=u.insertCell();c.classList.add("p-2","font-medium","text-left"),c.textContent="Column";let m=u.insertCell();m.classList.add("p-2","font-medium","text-left"),m.textContent="Type";let b=a.columns.some(w=>this.getItemMetadata(a,w)!==void 0),x;b&&(x=u.insertCell(),x.classList.add("p-2","font-medium","text-left"),x.textContent="Metadata"),a.columns.forEach((w,v)=>{let p=l.insertRow();p.classList.add(v%2==0?"bg-background":"bg-muted/30");let g=p.insertCell();g.classList.add("p-2","font-mono"),g.textContent=w.name;let k=p.insertCell();if(k.classList.add("p-2","text-muted-foreground"),k.textContent=w.type,b){let I=p.insertCell();I.classList.add("p-2");let A=this.getItemMetadata(a,w);A&&I.append(A)}}),o.append(l),r.append(o)}return r}getItemMetadata(e,a){var n,i;let r=(n=e.primary_keys)==null?void 0:n.includes(a.name),s=(i=e.indexes)==null?void 0:i.includes(a.name);if(r||s){let o=document.createElement("span");o.textContent=r?"PK":"IDX";let l=r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";return o.classList.add("text-xs","px-1.5","py-0.5","rounded-full","font-medium",...l.split(" ")),o}}},zp=class extends Bt{constructor(e,a){super();L(this,"title","Variables");L(this,"mentionPrefix","@");L(this,"contextType","variable");this.variables=e,this.tablesMap=a}getItems(){let e=new Set(this.tablesMap.keys());return Object.entries(this.variables).flatMap(([a,r])=>e.has(a)?[]:[{uri:this.asURI(a),name:a,type:this.contextType,description:r.dataType??"",dataType:r.dataType,data:{variable:r}}])}formatCompletion(e){let{data:a}=e,{variable:r}=a;return{label:`@${r.name}`,displayLabel:r.name,detail:r.dataType??"",type:this.contextType,section:Nt.VARIABLE,info:()=>Qi(r)}}formatContext(e){let{data:a}=e,{variable:r}=a;return Vt({type:this.contextType,data:{name:r.name,dataType:r.dataType},details:r.value==null?void 0:JSON.stringify(r.value)})}};function Ct(t){let e=t.get(Ui),a=t.get(Di),r=t.get(Bi);return new Ao().register(new Fp(a)).register(new zp(r,a)).register(new $p(t)).register(new Mp(t)).register(new Oo(e.connectionsMap,a))}function Up(){return new Dp(mo())}const Vp="@";function Bp({input:t}){let e="";return t.includes("@")&&(e=qp(t),he.debug("Included context",e)),{includeOtherCode:os(""),context:{plainText:e,schema:[],variables:[]}}}async function Wp({input:t}){let e="",a=[];if(t.includes("@")){let r=Ct(rs),s=r.parseAllContextIds(t);e=r.formatContextForAI(s);try{a=await r.getAttachmentsForContext(s),he.debug("Included attachments",a.length)}catch(n){he.error("Error getting attachments:",n)}}return{body:{includeOtherCode:os(""),context:{plainText:e,schema:[],variables:[]}},attachments:a}}function qp(t){let e=Ct(rs),a=e.parseAllContextIds(t);return e.formatContextForAI(a)}function Jp(t,e=[]){return a=>{let r=t.map(s=>a.matchBefore(s)).find(Boolean);return!r||r&&r.from===r.to&&!a.explicit?null:{from:r==null?void 0:r.from,options:[...e]}}}function Kp(t){var e;if((e=t.current)!=null&&e.view){let a=t.current.view.state.selection.main.from;t.current.view.dispatch({changes:{from:a,to:a,insert:"@"},selection:{anchor:a+1,head:a+1}}),t.current.view.focus(),ho(t.current.view)}}function Yp(t){if(t.trim().length===0)return[];if(!t.includes("```"))return[{language:"python",code:t}];let e=[],a=0,r=t.indexOf("```",a);for(;r!==-1;){let s=t.indexOf(`
`,r);if(s===-1){let u=t.slice(r+3),c=u.indexOf(" "),m=c===-1?u:u.slice(0,c),b=m==="markdown"?"markdown":m==="sql"?"sql":"python",x=c===-1?"":u.slice(c+1);x.trim()&&e.push({language:b,code:x.trim()});break}let n=t.slice(r+3,s).trim()||"";n=n==="markdown"?"markdown":n==="sql"?"sql":"python";let i=s+1,o=t.indexOf("```",i);if(o===-1){let u=t.slice(i).replace(/\n+$/,"");u.trim()&&e.push({language:n,code:u});break}let l=t.slice(i,o).replace(/\n+$/,"");l.trim()&&e.push({language:n,code:l}),a=o+3,r=t.indexOf("```",a)}return e.length===0&&e.push({language:"python",code:t}),e}var Gp=xt(Ha(),1),ai=()=>new Map,{valueAtom:na,useActions:ri,createActions:Zh,reducer:$h}=co(ai,{addStagedCell:(t,e)=>{let{cellId:a,edit:r}=e;return new Map([...t,[a,r]])},removeStagedCell:(t,e)=>{let a=new Map(t);return a.delete(e),a},clearStagedCells:()=>ai()});function si(t){let e=(0,Gp.c)(26),{addStagedCell:a,removeStagedCell:r,clearStagedCells:s}=ri(),{createNewCell:n}=ls(),i=Uo(),o=(0,M.useRef)(null),l;e[0]!==a||e[1]!==n?(l=I=>{let A=ns.create();return a({cellId:A,edit:{type:"add_cell"}}),n({cellId:"__end__",code:I,before:!1,newCellId:A}),A},e[0]=a,e[1]=n,e[2]=l):l=e[2];let u=l,c;e[3]===t?c=e[4]:(c=I=>{let{cellId:A,code:O}=I;if(!t.get(na).has(A)){he.error("Staged cell not found",{cellId:A});return}let V=qi(A);if(!V){he.error("Editor for this cell not found",{cellId:A});return}Ka(V,O)},e[3]=t,e[4]=c);let m=c,b;e[5]!==i||e[6]!==r?(b=I=>{r(I),i({cellId:I})},e[5]=i,e[6]=r,e[7]=b):b=e[7];let x=b,w;e[8]!==s||e[9]!==i||e[10]!==t?(w=()=>{let I=t.get(na);for(let A of I.keys())i({cellId:A});s()},e[8]=s,e[9]=i,e[10]=t,e[11]=w):w=e[11];let v=w,p;e[12]!==a||e[13]!==n||e[14]!==u||e[15]!==m?(p=I=>{e:switch(I.type){case"text-start":o.current=new Hp(u,m,a,n);break e;case"text-delta":if(!o.current){he.error("Cell creation stream not found");return}o.current.stream(I);break e;case"text-end":case"finish":if(!o.current){he.error("Cell creation stream not found");return}o.current.stop();break e;default:he.error("Unknown chunk type",{chunk:I})}},e[12]=a,e[13]=n,e[14]=u,e[15]=m,e[16]=p):p=e[16];let g=p,k;return e[17]!==a||e[18]!==s||e[19]!==u||e[20]!==v||e[21]!==x||e[22]!==g||e[23]!==r||e[24]!==m?(k={createStagedCell:u,updateStagedCell:m,addStagedCell:a,removeStagedCell:r,clearStagedCells:s,deleteStagedCell:x,deleteAllStagedCells:v,onStream:g},e[17]=a,e[18]=s,e[19]=u,e[20]=v,e[21]=x,e[22]=g,e[23]=r,e[24]=m,e[25]=k):k=e[25],k}var Hp=class{constructor(t,e,a,r){L(this,"createdCells",[]);L(this,"buffer","");L(this,"hasMarimoImport",!1);this.onCreateCell=t,this.onUpdateCell=e,this.addStagedCell=a,this.createNewCell=r}stream(t){let e=t.delta;this.buffer+=e;let a=Yp(this.buffer);for(let[r,s]of a.entries())if(r<this.createdCells.length){this.addMarimoImport(s.language);let n=this.createdCells[r];this.createdCells[r]={...n,cell:s},this.onUpdateCell({cellId:n.cellId,code:s.code,language:s.language})}else{let n=this.onCreateCell(s.code);this.createdCells.push({cellId:n,cell:s})}}addMarimoImport(t){var a;if(this.hasMarimoImport||t==="python")return;let e=Vo({autoInstantiate:!1,createNewCell:this.createNewCell,fromCellId:(a=this.createdCells[0])==null?void 0:a.cellId,before:!0});e&&this.addStagedCell({cellId:e,edit:{type:"add_cell"}}),this.hasMarimoImport=!0}stop(){this.buffer=""}},Qp={baseDescription:"Perform editing operations on the current notebook. You should prefer to create new cells unless you need to edit existing cells. Call this tool multiple times to perform multiple edits. Separate code into logical individual cells to take advantage of the notebook's reactive execution model.",prerequisites:["If you are updating existing cells, you need the cellIds. If they are not known, call the lightweight_cell_map_tool to find out."],additionalInfo:`
  Args:
    edit (object): The editing operation to perform. Must be one of:
    - update_cell: Update the code of an existing cell, pass cellId and the new code.
    - add_cell: Add a new cell to the notebook. The position is specified by the position object with a "type" field:
        { type: "notebook_end" } - Add at the end of the notebook
        { type: "relative", cellId: "...", before: true } - Add before the specified cell (before: false for after)
        { type: "column_end", columnIndex: 0 } - Add at the end of a specific column (0-based index)
    - delete_cell: Delete an existing cell, pass cellId. For deleting cells, the user needs to accept the deletion to actually delete the cell, so you may still see the cell in the notebook on subsequent edits which is fine.

    For adding code, use the following guidelines:
    - Markdown cells: use mo.md(f"""{content}""") function to insert content.
    - SQL cells: use mo.sql(f"""{content}""") function to insert content. If a database engine is specified, use mo.sql(f"""{content}""", engine=engine) instead.

    Returns:
    - A result object containing standard tool metadata.`},Xp=y({edit:pa("type",[y({type:h("update_cell"),cellId:d(),code:d()}),y({type:h("add_cell"),position:pa("type",[y({type:h("relative"),cellId:d(),before:N()}),y({type:h("column_end"),columnIndex:Me()}),y({type:h("notebook_end")})]),code:d()}),y({type:h("delete_cell"),cellId:d()})])}),em=class{constructor(){L(this,"name","edit_notebook_tool");L(this,"description",Qp);L(this,"schema",Xp);L(this,"outputSchema",Hn);L(this,"mode",["agent"]);L(this,"handler",async({edit:t},e)=>{let{addStagedCell:a,createNewCell:r,store:s}=e;switch(t.type){case"update_cell":{let{cellId:n,code:i}=t,o=s.get(ct);this.validateCellIdExists(n,o);let l=this.getCellEditorView(n,o);Xa(n);let u=s.get(na).get(n);if((u==null?void 0:u.type)==="add_cell"){Ka(l,i);break}let c=l.state.doc.toString();a({cellId:n,edit:{type:"update_cell",previousCode:(u==null?void 0:u.previousCode)??c}}),Ka(l,i);break}case"add_cell":{let{position:n,code:i}=t,o="__end__",l=!1,u=ns.create(),c=s.get(ct);switch(n.type){case"relative":this.validateCellIdExists(n.cellId,c),o=n.cellId,l=n.before;break;case"column_end":o={type:"__end__",columnId:this.getColumnId(n.columnIndex,c)};break;case"notebook_end":break}r({cellId:o,before:l,code:i,newCellId:u}),a({cellId:u,edit:{type:"add_cell"}}),Xa(u);break}case"delete_cell":{let{cellId:n}=t,i=s.get(ct);this.validateCellIdExists(n,i),a({cellId:n,edit:{type:"delete_cell",previousCode:this.getCellEditorView(n,i).state.doc.toString()}}),Xa(n);break}}return{status:"success",next_steps:["If you need to perform more edits, call this tool again.","You should use the lint notebook tool to check for errors and lint issues. Fix them by editing the notebook.","You should use the run stale cells tool to run the cells that have been edited or newly added. This allows you to see the output of the cells and fix any errors."]}})}validateCellIdExists(t,e){if(!e.cellIds.getColumns().some(a=>a.idSet.has(t)))throw new zt("Cell not found","CELL_NOT_FOUND",!1,"Check which cells exist in the notebook")}getColumnId(t,e){let a=e.cellIds.getColumns();if(t<0||t>=a.length)throw new zt("Column index is out of range","COLUMN_INDEX_OUT_OF_RANGE",!0,"Choose a column index between 0 and the number of columns in the notebook (0-based)");return a[t].id}getCellEditorView(t,e){let a=e.cellHandles[t].current;if(!(a!=null&&a.editorView))throw new zt("Cell editor not found","CELL_EDITOR_NOT_FOUND",!1,"Internal error, ask the user to report this error");return a.editorView}},tm=200,am=3e4,rm={baseDescription:"Run cells in the current notebook that are stale. Stale cells are cells that have been edited or newly added. You can run this tool after editing the notebook or when requested. The output of the ran cells will be returned alongside metadata."},ni=y({type:h("file"),url:d(),mediaType:d()}),sm=class{constructor(t){L(this,"name","run_stale_cells_tool");L(this,"description",rm);L(this,"schema",y({}));L(this,"outputSchema",Hn.extend({cellsToOutput:pt(d(),y({consoleOutput:d().optional(),cellOutput:d().optional(),consoleAttachments:me(ni).optional(),cellAttachments:me(ni).optional()}).nullable()).optional()}));L(this,"mode",["agent"]);L(this,"handler",async(t,e)=>{let{prepareForRun:a,sendRun:r,store:s}=e,n=s.get(ct),i=Gi(n);if(i.length===0)return{status:"success",message:"No stale cells found."};if(await Lo({cellIds:i,sendRun:r,prepareForRun:a,notebook:n}),!await this.waitForCellsToFinish(s,i,am,this.postExecutionDelay))return{status:"success",message:"No output was returned because some cells have not finished executing"};let o=s.get(ct),l=new Map,u="",c=!1;for(let b of i){let x=Xn(b,o,{includeConsoleOutput:!0}),w,v,p=x.cellOutput,g=x.consoleOutputs,k=g&&g.length>0;if(!p&&!k){l.set(b,null);continue}p&&(w=this.formatOutputString(p),this.outputHasErrors(p)&&(c=!0)),k&&(v=g.map(I=>this.formatOutputString(I)).join(`
`),u+="Console output represents the stdout or stderr of the cell (eg. print statements).",g.some(I=>this.outputHasErrors(I))&&(c=!0)),l.set(b,{cellOutput:w,consoleOutput:v})}if(l.size===0)return{status:"success",message:"Stale cells have been run. No output was returned."};let m=["Review the output of the cells. The CellId is the key of the result object.",c?"There are errors in the cells. Please fix them by using the edit notebook tool and the given CellIds.":"You may edit the notebook further with the given CellIds."];return{status:"success",cellsToOutput:Object.fromEntries(l),message:u===""?void 0:u,next_steps:m}});this.postExecutionDelay=(t==null?void 0:t.postExecutionDelay)??tm}outputHasErrors(t){let{output:e}=t;return e.mimetype==="application/vnd.marimo+error"||e.mimetype==="application/vnd.marimo+traceback"}formatOutputString(t){let e="",{outputType:a,processedContent:r,imageUrl:s,output:n}=t;return a==="text"?(e+=`Output:
`,r?e+=r:typeof n.data=="string"?e+=n.data:e+=JSON.stringify(n.data)):a==="media"&&(e+=`Media Output: Contains ${n.mimetype} content`,s&&(e+=`
Image URL: ${s}`)),e}async waitForCellsToFinish(t,e,a,r){let s=i=>e.every(o=>{let l=i.cellRuntime[o];return(l==null?void 0:l.status)!=="running"&&(l==null?void 0:l.status)!=="queued"}),n=async()=>(r>0&&await new Promise(i=>setTimeout(i,r)),!0);if(s(t.get(ct)))return await n();try{return await Promise.race([ji(ct,s),new Promise((i,o)=>setTimeout(()=>o(Error("timeout")),a))]),await n()}catch{return!1}}};function nm(t){let e=t.baseDescription;return t.whenToUse&&(e+=`

## When to use:
- ${t.whenToUse.join(`
- `)}`),t.avoidIf&&(e+=`

## Avoid if:
- ${t.avoidIf.join(`
- `)}`),t.prerequisites&&(e+=`

## Prerequisites:
- ${t.prerequisites.join(`
- `)}`),t.sideEffects&&(e+=`

## Side effects:
- ${t.sideEffects.join(`
- `)}`),t.additionalInfo&&(e+=`

## Additional info:
- ${t.additionalInfo}`),e}var ii,ia;function im(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(i){n[i]=r[i]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(i,o){return o(t,e,i)||i},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}const qr=new(ii=zi(),ia=class{constructor(t=[]){L(this,"tools",new Map);this.tools=new Map(t.map(e=>[e.name,e]))}has(t){return this.tools.has(t)}getToolOrThrow(t){let e=this.tools.get(t);if(!e)throw Error(`Tool ${t} not found`);return e}async invoke(t,e,a){var o;let r=this.getToolOrThrow(t),s=r.handler,n=r.schema,i=r.outputSchema;try{let l=await n.safeParseAsync(e);if(l.error)throw new zt(`Tool ${t} returned invalid input: ${cs(l.error)}`,"INVALID_ARGUMENTS",!0,"Please check the arguments and try again.");let u=l.data,c=await s(u,a),m=await i.safeParseAsync(c);if(m.error){let b=cs(m.error);throw Error(`Tool ${t} returned invalid output: ${b}`)}return{tool_name:t,result:m.data,error:null}}catch(l){return l instanceof zt?{tool_name:t,result:null,error:l.toStructuredString()}:{tool_name:t,result:null,error:new zt(l instanceof Error?l.message:String(l),"TOOL_ERROR",!1,"Check the error message and try again with valid arguments.",{args:e,errorType:((o=l==null?void 0:l.constructor)==null?void 0:o.name)??typeof l}).toStructuredString()}}}getToolSchemas(){return[...this.tools.values()].map(t=>({name:t.name,description:nm(t.description),parameters:Ga(t.schema),source:"frontend",mode:t.mode}))}},im(ia.prototype,"getToolSchemas",[ii],Object.getOwnPropertyDescriptor(ia.prototype,"getToolSchemas"),ia.prototype),ia)([new em,new sm]);function Jr(t,e){return new Promise(a=>{let r=new FileReader;r.readAsDataURL(t),r.onload=s=>{var n;if((n=s.target)!=null&&n.result){let i=s.target.result;a(e==="base64"?i.slice(i.indexOf(",")+1):i)}}})}function om(t){return Promise.all(t.map(e=>Jr(e,"base64").then(a=>[e.name,a])))}function lm(t){return t.length>50?`${t.slice(0,50)}...`:t}async function um(t){return await Promise.all(t.map(async e=>({type:"file",mediaType:e.type,filename:e.name,url:await Jr(e,"dataUrl")})))}function dm(t){if(t.length===0)return!1;let e=t.at(-1);if(!e||e.role!=="assistant"||!e.parts)return!1;let a=e.parts;return a.length===0?!1:a[a.length-1].type==="reasoning"}function oi(t){return t.map(e=>e.type==="text"?e.text:"").join(`
`)}async function li(t){let e=await Wp({input:oi(t.flatMap(r=>r.parts))});function a(r,s){let n=[...r.parts];return s&&n.push(...e.attachments),{role:r.role,content:oi(r.parts),parts:n}}return{...e.body,messages:t.map((r,s)=>a(r,s===t.length-1))}}async function ui({invokeAiTool:t,addToolResult:e,toolCall:a,toolContext:r}){try{if(qr.has(a.toolName)){let s=await qr.invoke(a.toolName,a.input,r);e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}else{let s=await t({toolName:a.toolName,arguments:a.input});e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}}catch(s){he.error("Tool call failed:",s),e({tool:a.toolName,toolCallId:a.toolCallId,output:`Error: ${s instanceof Error?s.message:String(s)}`})}}function cm(t){var o;if(t.length===0)return!1;let e=t[t.length-1],a=e.parts;if(a.length===0||e.role!=="assistant")return!1;let r=a.filter(l=>l.type.startsWith("tool-"));if(r.length===0)return!1;let s=r.every(l=>l.state==="output-available"),n=a[a.length-1],i=n.type==="text"&&((o=n.text)==null?void 0:o.trim().length)>0;return he.warn("All tool calls completed: %s",s),s&&!i}function pm(t){return oo.define({combine:e=>e[0]??t})}var di=pm({}),Kr=ha.define(),Ba=ha.define(),mm=50,Yr=fa.define({create(){return{prompts:[],navigationIndex:-1,originalText:""}},update(t,e){var r,s;let a={...t};e.docChanged&&t.navigationIndex!==-1&&(e.effects.some(n=>n.is(Ba)||n.is(Kr))||(a.navigationIndex=-1,a.originalText=""));for(let n of e.effects)if(n.is(Kr)){let i=n.value.trim();i&&(a.prompts=[i,...t.prompts.filter(o=>o!==i)].slice(0,mm),(s=(r=e.state.facet(di)).save)==null||s.call(r,a.prompts)),a.navigationIndex=-1,a.originalText=""}else n.is(Ba)&&(a.navigationIndex=n.value.index,a.originalText=n.value.originalText);return a}}),hm=t=>{let e=t.state.field(Yr),a=t.state.doc;if(e.prompts.length===0)return!1;let r,s=e.originalText;if(e.navigationIndex===-1){if(a.length>0)return!1;r=0,s=a.toString()}else if(r=Math.min(e.navigationIndex+1,e.prompts.length-1),r===e.navigationIndex)return!1;let n=e.prompts[r];return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},effects:Ba.of({index:r,originalText:s})}),!0},fm=t=>{let e=t.state.field(Yr);if(e.navigationIndex===-1)return!1;let a,r;return e.navigationIndex===0?(a=e.originalText,r=-1):(r=e.navigationIndex-1,a=e.prompts[r]??""),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:a},effects:Ba.of({index:r,originalText:e.originalText})}),!0};const ci=t=>{let e=t.state.doc.toString();return e.trim()?(t.dispatch({effects:Kr.of(e)}),!0):!1};function gm(t={}){let{storage:e,defaultKeymap:a=!0}=t,r=[Yr.init(()=>{var s;return{prompts:((s=e==null?void 0:e.load)==null?void 0:s.call(e))??[],navigationIndex:-1,originalText:""}}),di.of(e??{})];return a&&r.push(ga.of([{key:"ArrowUp",run:hm},{key:"ArrowDown",run:fm}])),r}const Gr=ha.define(),it=fa.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Gr)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}}),ym=fa.define({create(){return{onResourceClick:void 0,onResourceMouseOver:void 0,onResourceMouseOut:void 0,onPromptSubmit:void 0}},update(t){return t}}),vm=ha.define();fa.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(vm)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}});const bm=(t,e)=>async a=>{let r=a.matchBefore(/@(\w+)?/);if(!r||r.from===r.to&&!a.explicit)return null;let s=await t();if(s.length===0)return null;let n=Gr.of(new Map(s.map(o=>[o.uri,o])));a.view&&a.view.dispatch({effects:n});let i=s.map(o=>({label:`@${o.name}`,displayLabel:o.name,detail:o.uri,info:o.description||void 0,type:o.mimeType?"constant":"variable",boost:o.description?100:0,...e==null?void 0:e(o),apply:(l,u,c,m)=>{l.dispatch({changes:{from:c,to:m,insert:`@${o.uri} `}})}}));return{from:r.from,options:i}},_m=/@[\w-]+:\/\/(?!\/)[^\s]+/;function vt(t){return t.matchAll(new RegExp(_m.source,"g"))}var xm=class extends gs{constructor(e,a){super();L(this,"resource");L(this,"view");this.resource=e,this.view=a}eq(e){return e.resource.uri===this.resource.uri}toDOM(){let e=document.createElement("span");e.className="cm-resource-widget",e.textContent=`@${this.resource.name}`;let a=this.view.state.field(ym,!1),r=a==null?void 0:a.onResourceClick,s=a==null?void 0:a.onResourceMouseOver,n=a==null?void 0:a.onResourceMouseOut;return r&&(e.style.cursor="pointer",e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),r(this.resource)})),s&&e.addEventListener("mouseover",i=>{i.preventDefault(),i.stopPropagation(),s(this.resource)}),n&&e.addEventListener("mouseout",i=>{i.preventDefault(),i.stopPropagation(),n(this.resource)}),e}},km=class extends gs{constructor(e,a){super();L(this,"uri");L(this,"view");this.uri=e,this.view=a}eq(e){return e.uri===this.uri}toDOM(){let e=document.createElement("span");return e.className="cm-not-found-resource-widget",e.textContent=`@${this.uri.split("://")[1]??this.uri}`,e}};function pi(t){let e=t.state.field(it),a=[];for(let{from:r,to:s}of t.visibleRanges){let n=t.state.doc.sliceString(r,s);for(let i of vt(n)){let o=r+i.index,l=i[0].slice(1),u=e.get(l);u?a.push(Qa.replace({widget:new xm(u,t)}).range(o,o+i[0].length)):a.push(Qa.replace({widget:new km(l,t)}).range(o,o+i[0].length))}}return Qa.set(a)}const wm=no.fromClass(class{constructor(t){L(this,"decorations");this.decorations=pi(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(a=>a.is(Gr))))&&(this.decorations=pi(t.view))}},{decorations:t=>t.decorations});function Im(t){let e=document.createElement("div");e.className="cm-tooltip-cursor";let a=document.createElement("div");if(a.className="cm-tooltip-cursor-title",a.textContent=`${t.name} (${t.uri})`,e.appendChild(a),t.description){let r=document.createElement("div");r.className="cm-tooltip-cursor-description",r.textContent=t.description,e.appendChild(r)}if(t.mimeType){let r=document.createElement("div");r.className="cm-tooltip-cursor-mimetype",r.textContent=t.mimeType,e.appendChild(r)}return{dom:e}}function Em(t,e,a,r=0){for(let s of vt(t)){let n=r+s.index,i=n+s[0].length;if(e>=n&&e<=i){let o=s[0].slice(1),l=a.get(o);if(l)return{resource:l,start:n,end:i}}}return null}function Tm(t){return io((e,a)=>{let{from:r,text:s}=e.state.doc.lineAt(a),n=Em(s,a,e.state.field(it),r);return n?{pos:n.start,end:n.end,above:!0,create(){return(t.createTooltip??Im)(n.resource)}}:null})}function Cm(t,e){let a=t.field(it),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(vt(n));if(i.length===0)return null;for(let o of i){let l=s.from+o.index,u=l+o[0].length,c=o[0].slice(1);if(e===u&&a.has(c))return{from:l,to:u,uri:c}}return null}function Sm(t,e){let a=t.field(it),r=t.doc,s=r.lineAt(e).to,n=r.sliceString(e,s),i=Array.from(vt(n));if(i.length===0)return null;let o=i[0];if(!o||o.index!==0)return null;let l=e,u=e+o[0].length,c=o[0].slice(1);return a.has(c)?{from:l,to:u,uri:c}:null}function mi(t,e){let a=t.field(it),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(vt(n));for(let o of i){let l=s.from+o.index,u=l+o[0].length,c=o[0].slice(1);if(e>l&&e<u&&a.has(c))return{from:l,to:u,uri:c}}return null}function Am(t,e){let a=t.field(it),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,e),i=Array.from(vt(n)),o=null;for(let l of i){let u=s.from+l.index,c=u+l[0].length,m=l[0].slice(1);a.has(m)&&c<=e&&(e>c?o=c:e===c&&(o=u))}return o}function Om(t,e){let a=t.field(it),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(vt(n));for(let o of i){let l=s.from+o.index,u=l+o[0].length,c=o[0].slice(1);if(a.has(c)&&l>=e){if(e<l)return l;if(e===l)return u}}return null}const Nm=so.transactionFilter.of(t=>{var r;let e=t.annotation(ro.userEvent);if(!e)return t;let a=t.startState.selection.main;if(!a.empty)return t;if(e==="input.type"||e.startsWith("input")){if(t.changes.empty)return t;let s=t.startState.field(it),n=t.startState.doc,i=!1,o=0,l=[];if(t.changes.iterChanges((u,c,m,b,x)=>{let w=x.toString(),v=u;if(/^\s+$/.test(w)){l.push({from:u,to:c,insert:w});return}let p=n.lineAt(v),g=n.sliceString(p.from,p.to),k=Array.from(vt(g)),I=!1,A=!1;for(let V of k){let B=p.from+V.index,Z=B+V[0].length,ae=V[0].slice(1);if(s.has(ae)){if(v===B){let F=v>0?n.sliceString(v-1,v):"";F!==""&&F!==" "&&F!==`
`&&F!=="	"&&(I=!0)}if(v===Z){let F=v<n.length?n.sliceString(v,v+1):"";(F===""||F!==" "&&F!==`
`&&F!=="	")&&(A=!0)}}}let O=w;I&&(O=` ${O}`,o+=1),A&&(O=` ${O}`,o+=1),O!==w&&(i=!0),l.push({from:u,to:c,insert:O})}),i)return[{changes:l,selection:t.selection?{anchor:t.selection.main.anchor+o,head:t.selection.main.head+o}:void 0,scrollIntoView:t.scrollIntoView}]}if(e==="delete.backward"||e==="delete.forward"){let s=null;return e==="delete.backward"?s=Cm(t.startState,a.head):e==="delete.forward"&&(s=Sm(t.startState,a.head)),s?[{changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from},scrollIntoView:!0}]:t}if((r=t.selection)!=null&&r.main.empty&&a.empty&&!e.startsWith("input")&&e!=="input.type"){let s=a.head,n=t.selection.main.head,i=null;if(n<s){let o=mi(t.startState,s);i=o&&s>o.from?o.from:Am(t.startState,s)}else if(n>s){let o=mi(t.startState,s);i=o&&s<o.to?o.to:Om(t.startState,s)}if(i!==null&&i!==n)return[{selection:{anchor:i},scrollIntoView:!0}]}return t}),Rm=fs.baseTheme({".cm-resource-widget":{background:"light-dark(rgba(86,156,214,0.08),rgba(86,156,214,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#2367a2,#7ecbff)",fontWeight:"500"},".cm-resource-widget:hover":{background:"light-dark(rgba(86,156,214,0.18),rgba(86,156,214,0.28))"},".cm-not-found-resource-widget":{background:"light-dark(rgba(151,151,151,0.08),rgba(151,151,151,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#b00020,#ff8080)",fontWeight:"500"}});var hi="_none_",Pm=[{uri:"",name:"No resources",type:hi,data:{}}],Mm={info:"Variables, dataframes, and tables will appear here.",apply:()=>{}};function jm(t){let{language:e,store:a,onAddFiles:r}=t;return[e.data.of({autocomplete:bm(async()=>{let s=Ct(a).getAllItems();return s.length===0?Pm:s},s=>{var n;return s.type===hi?Mm:((n=Ct(a).getProvider(s.type))==null?void 0:n.formatCompletion(s))||{}})}),hs.high(ga.of([{key:"Tab",run:s=>fo(s)}])),ti.of({addAttachment:s=>r==null?void 0:r([s])}),...r?[e.data.of({autocomplete:Up().createCompletionSource()})]:[],wm,Nm,it.init(()=>{let s=Ct(a).getAllItems();return new Map(s.map(n=>[n.uri,n]))}),Rm,Tm({createTooltip:s=>{let n=Ct(a).getProvider(s.type);if(!n)return he.warn("No provider found for resource",s),oa(s.description||s.name);let i=n.formatCompletion(s),o=s.description||s.name;if(!(i!=null&&i.info))return oa(o);if(typeof i.info=="string")return oa(i.info);let l=i.info(i);return l?"dom"in l?{dom:l.dom}:"then"in l?(he.warn("info is a promise. This is not supported",l),oa(o)):{dom:l}:oa(o)}})]}function oa(t){let e=document.createElement("div");return e.innerHTML=t,{dom:e}}var Wa=xt(Ha(),1),S=xt(ao(),1);const fi=t=>{let{handleAcceptCompletion:e,handleDeclineCompletion:a,isLoading:r,hasCompletion:s}=t;return n=>{let i=eo()?n.metaKey:n.ctrlKey;i&&n.key==="Enter"&&!r&&s&&e(),(n.key==="Delete"||n.key==="Backspace")&&i&&n.shiftKey&&(a(),n.preventDefault(),n.stopPropagation())}},gi=t=>{let e=(0,Wa.c)(22),{isLoading:a,onAccept:r,onDecline:s,size:n,acceptShortcut:i,declineShortcut:o,multipleCompletions:l}=t,u=n===void 0?"sm":n,c=i===void 0?"Mod-\u21B5":i,m=o===void 0?"Shift-Mod-Delete":o,b=l===void 0?!1:l,x=b&&" all",w;e[0]===c?w=e[1]:(w=(0,S.jsx)(Wt,{className:"ml-1 inline",shortcut:c}),e[0]=c,e[1]=w);let v;e[2]!==x||e[3]!==w?(v=(0,S.jsxs)("span",{className:"text-(--grass-11) opacity-100",children:["Accept",x," ",w]}),e[2]=x,e[3]=w,e[4]=v):v=e[4];let p;e[5]!==a||e[6]!==r||e[7]!==u||e[8]!==v?(p=(0,S.jsx)(We,{"data-testid":"accept-completion-button",variant:"text",size:u,className:"mb-0",disabled:a,onClick:r,children:v}),e[5]=a,e[6]=r,e[7]=u,e[8]=v,e[9]=p):p=e[9];let g=b&&" all",k;e[10]===m?k=e[11]:(k=(0,S.jsx)(Wt,{className:"ml-1 inline",shortcut:m}),e[10]=m,e[11]=k);let I;e[12]!==k||e[13]!==g?(I=(0,S.jsxs)("span",{className:"text-(--red-10)",children:["Reject",g," ",k]}),e[12]=k,e[13]=g,e[14]=I):I=e[14];let A;e[15]!==s||e[16]!==u||e[17]!==I?(A=(0,S.jsx)(We,{"data-testid":"decline-completion-button",variant:"text",size:u,className:"mb-0 pl-1 pr-0",onClick:s,children:I}),e[15]=s,e[16]=u,e[17]=I,e[18]=A):A=e[18];let O;return e[19]!==A||e[20]!==p?(O=(0,S.jsxs)(S.Fragment,{children:[p,A]}),e[19]=A,e[20]=p,e[21]=O):O=e[21],O},Zm=t=>{let e=(0,Wa.c)(9),{isLoading:a,onAccept:r,onDecline:s,runCell:n}=t,i;e[0]!==a||e[1]!==r||e[2]!==n?(i=(0,S.jsx)(yi,{isLoading:a,onAccept:r,size:"xs",runCell:n}),e[0]=a,e[1]=r,e[2]=n,e[3]=i):i=e[3];let o;e[4]===s?o=e[5]:(o=(0,S.jsx)(vi,{onDecline:s,size:"xs"}),e[4]=s,e[5]=o);let l;return e[6]!==i||e[7]!==o?(l=(0,S.jsxs)(S.Fragment,{children:[i,o]}),e[6]=i,e[7]=o,e[8]=l):l=e[8],l},yi=t=>{let e=(0,Wa.c)(33),{isLoading:a,onAccept:r,multipleCompletions:s,size:n,buttonStyles:i,acceptShortcut:o,runCell:l,playButtonStyles:u}=t,c=s===void 0?!1:s,m=n===void 0?"sm":n,b;e[0]!==r||e[1]!==l?(b=()=>{r(),l&&l()},e[0]=r,e[1]=l,e[2]=b):b=e[2];let x=b,w=c?"Accept all":"Accept";if(l){let k=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-r-none ${i}`,I;e[3]===o?I=e[4]:(I=o&&(0,S.jsx)(Wt,{className:"ml-1 inline",shortcut:o}),e[3]=o,e[4]=I);let A;e[5]!==a||e[6]!==r||e[7]!==m||e[8]!==k||e[9]!==I||e[10]!==w?(A=(0,S.jsxs)(We,{variant:"text",size:m,disabled:a,onClick:r,className:k,children:[w,I]}),e[5]=a,e[6]=r,e[7]=m,e[8]=k,e[9]=I,e[10]=w,e[11]=A):A=e[11];let O=c?"Accept and run all cells":"Accept and run cell",V=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-l-none px-1.5 ${u}`,B;e[12]===Symbol.for("react.memo_cache_sentinel")?(B=(0,S.jsx)(No,{className:"h-2.5 w-2.5"}),e[12]=B):B=e[12];let Z;e[13]!==x||e[14]!==a||e[15]!==m||e[16]!==V?(Z=(0,S.jsx)(We,{variant:"text",size:m,disabled:a,onClick:x,className:V,children:B}),e[13]=x,e[14]=a,e[15]=m,e[16]=V,e[17]=Z):Z=e[17];let ae;e[18]!==Z||e[19]!==O?(ae=(0,S.jsx)(Mo,{content:O,children:Z}),e[18]=Z,e[19]=O,e[20]=ae):ae=e[20];let F;return e[21]!==ae||e[22]!==A?(F=(0,S.jsxs)("div",{className:"flex",children:[A,ae]}),e[21]=ae,e[22]=A,e[23]=F):F=e[23],F}let v=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded px-3 ${i}`,p;e[24]===o?p=e[25]:(p=o&&(0,S.jsx)(Wt,{className:"ml-1 inline",shortcut:o}),e[24]=o,e[25]=p);let g;return e[26]!==a||e[27]!==r||e[28]!==m||e[29]!==v||e[30]!==p||e[31]!==w?(g=(0,S.jsxs)(We,{variant:"text",size:m,disabled:a,onClick:r,className:v,children:[w,p]}),e[26]=a,e[27]=r,e[28]=m,e[29]=v,e[30]=p,e[31]=w,e[32]=g):g=e[32],g},vi=t=>{let e=(0,Wa.c)(8),{onDecline:a,multipleCompletions:r,size:s,className:n,declineShortcut:i}=t,o=r===void 0?!1:r,l=s===void 0?"sm":s,u=`h-6 text-(--red-10) bg-(--red-3)/60 hover:bg-(--red-3)
    dark:bg-(--red-4)/80 dark:hover:bg-(--red-3) rounded px-3 font-semibold
    active:bg-(--red-5) dark:active:bg-(--red-4)
    border-(--red-6) border hover:shadow-xs ${n}`,c=o&&" all",m;e[0]===i?m=e[1]:(m=i&&(0,S.jsx)(Wt,{className:"ml-1 inline",shortcut:i}),e[0]=i,e[1]=m);let b;return e[2]!==a||e[3]!==l||e[4]!==u||e[5]!==c||e[6]!==m?(b=(0,S.jsxs)(We,{variant:"text",size:l,onClick:a,className:u,children:["Reject",c,m]}),e[2]=a,e[3]=l,e[4]=u,e[5]=c,e[6]=m,e[7]=b):b=e[7],b};var $m=class extends Gn{constructor(t,e){super(t),this.onChunkReceived=e}processResponseStream(t){let e=this.onChunkReceived;return super.processResponseStream(t).pipeThrough(new TransformStream({async transform(a,r){e(a),r.enqueue(a)}}))}},bi=xt(Ha(),1),Lm=Yi("marimo:ai-language","python",Xi),_i="marimo:ai-prompt-history",xi=new Fi(me(d()),()=>[]);const Dm=t=>{let e=(0,bi.c)(89),{onClose:a}=t,r=ss(),[s,n]=(0,M.useState)(""),{deleteAllStagedCells:i,clearStagedCells:o,onStream:l,addStagedCell:u}=si(r),[c,m]=Zi(Lm),b=to(),{invokeAiTool:x,sendRun:w}=po(),v=Mi(na),p=(0,M.useRef)(null),{createNewCell:g,prepareForRun:k}=ls(),I;e[0]!==u||e[1]!==g||e[2]!==k||e[3]!==w||e[4]!==r?(I={store:r,addStagedCell:u,createNewCell:g,prepareForRun:k,sendRun:w},e[0]=u,e[1]=g,e[2]=k,e[3]=w,e[4]=r,e[5]=I):I=e[5];let A=I,O;if(e[6]!==c||e[7]!==l||e[8]!==b){let Pe;e[10]===c?Pe=e[11]:(Pe=async ca=>{let Oi=await li(ca.messages);return{body:{...ca,...Oi,code:"",prompt:"",language:c}}},e[10]=c,e[11]=Pe);let dt;e[12]===l?dt=e[13]:(dt=ca=>{l(ca)},e[12]=l,e[13]=dt),O=new $m({api:b.getAiURL("completion").toString(),headers:b.headers(),prepareSendMessagesRequest:Pe},dt),e[6]=c,e[7]=l,e[8]=b,e[9]=O}else O=e[9];let{sendMessage:V,stop:B,status:Z,addToolResult:ae}=On({experimental_throttle:100,transport:O,onToolCall:async Pe=>{let{toolCall:dt}=Pe;await ui({invokeAiTool:x,addToolResult:F,toolCall:{toolName:dt.toolName,toolCallId:dt.toolCallId,input:dt.input},toolContext:A})},onError:Fm}),F=ae,ee=Z==="streaming"||Z==="submitted",oe=v.size>0,ue=v.size>1,se;e[14]!==i||e[15]!==s||e[16]!==ee||e[17]!==V?(se=()=>{var Pe;ee||((Pe=p.current)!=null&&Pe.view&&ci(p.current.view),i(),V({text:s}))},e[14]=i,e[15]=s,e[16]=ee,e[17]=V,e[18]=se):se=e[18];let te=se,ne;e[19]===Symbol.for("react.memo_cache_sentinel")?(ne=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Bo,{className:"size-4 mr-2"}),"Python"]}),e[19]=ne):ne=e[19];let fe=ne,le;e[20]===Symbol.for("react.memo_cache_sentinel")?(le=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Li,{className:"size-4 mr-2"}),"SQL"]}),e[20]=le):le=e[20];let bt=le,Ue=c==="python"?fe:bt,Ne;e[21]===Symbol.for("react.memo_cache_sentinel")?(Ne=(0,S.jsx)(uo,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"}),e[21]=Ne):Ne=e[21];let _e;e[22]===Ue?_e=e[23]:(_e=(0,S.jsx)(Eo,{asChild:!0,children:(0,S.jsxs)(We,{variant:"text",className:"ml-2",size:"xs","data-testid":"language-button",children:[Ue,Ne]})}),e[22]=Ue,e[23]=_e);let Ge,ot;e[24]===Symbol.for("react.memo_cache_sentinel")?(Ge=(0,S.jsx)("div",{className:"px-2 py-1 font-semibold",children:"Select language"}),ot=(0,S.jsx)(Io,{}),e[24]=Ge,e[25]=ot):(Ge=e[24],ot=e[25]);let Re;e[26]===m?Re=e[27]:(Re=(0,S.jsx)(_s,{onClick:()=>m("python"),children:fe}),e[26]=m,e[27]=Re);let He;e[28]===m?He=e[29]:(He=(0,S.jsx)(_s,{onClick:()=>m("sql"),children:bt}),e[28]=m,e[29]=He);let Qe;e[30]!==Re||e[31]!==He?(Qe=(0,S.jsxs)(To,{align:"center",children:[Ge,ot,Re,He]}),e[30]=Re,e[31]=He,e[32]=Qe):Qe=e[32];let St;e[33]!==_e||e[34]!==Qe?(St=(0,S.jsxs)(Co,{modal:!1,children:[_e,Qe]}),e[33]=_e,e[34]=Qe,e[35]=St):St=e[35];let Ut=St,Ve;e[36]!==o||e[37]!==a?(Ve=()=>{o(),a()},e[36]=o,e[37]=a,e[38]=Ve):Ve=e[38];let Xe=Ve,H;e[39]===i?H=e[40]:(H=()=>{i()},e[39]=i,e[40]=H);let Y=H,de;e[41]===Symbol.for("react.memo_cache_sentinel")?(de=(0,S.jsx)(Po,{className:"size-4 text-(--blue-11) mr-2"}),e[41]=de):de=e[41];let G;e[42]!==i||e[43]!==a?(G=()=>{i(),a()},e[42]=i,e[43]=a,e[44]=G):G=e[44];let Se;e[45]===Symbol.for("react.memo_cache_sentinel")?(Se=Pe=>{n(Pe)},e[45]=Se):Se=e[45];let xe;e[46]!==Xe||e[47]!==Y||e[48]!==oe||e[49]!==ee?(xe=fi({handleAcceptCompletion:Xe,handleDeclineCompletion:Y,isLoading:ee,hasCompletion:oe}),e[46]=Xe,e[47]=Y,e[48]=oe,e[49]=ee,e[50]=xe):xe=e[50];let pe;e[51]!==s||e[52]!==te||e[53]!==G||e[54]!==xe?(pe=(0,S.jsx)(ki,{inputRef:p,onClose:G,value:s,onChange:Se,onSubmit:te,onKeyDown:xe}),e[51]=s,e[52]=te,e[53]=G,e[54]=xe,e[55]=pe):pe=e[55];let ce;e[56]!==ee||e[57]!==B?(ce=ee&&(0,S.jsxs)(We,{"data-testid":"stop-completion-button",variant:"text",size:"sm",className:"mb-0",onClick:B,children:[(0,S.jsx)(So,{className:"animate-spin mr-1",size:14}),"Stop"]}),e[56]=ee,e[57]=B,e[58]=ce):ce=e[58];let we;e[59]===Symbol.for("react.memo_cache_sentinel")?(we=(0,S.jsx)(qo,{className:"size-4"}),e[59]=we):we=e[59];let et;e[60]===te?et=e[61]:(et=(0,S.jsx)(We,{variant:"text",size:"sm",onClick:te,title:"Submit",children:we}),e[60]=te,e[61]=et);let _t;e[62]===Symbol.for("react.memo_cache_sentinel")?(_t=(0,S.jsx)(ko,{className:"size-4"}),e[62]=_t):_t=e[62];let tt;e[63]===a?tt=e[64]:(tt=(0,S.jsx)(We,{variant:"text",size:"sm",className:"mb-0 px-1",onClick:a,children:_t}),e[63]=a,e[64]=tt);let ge;e[65]!==pe||e[66]!==ce||e[67]!==et||e[68]!==tt?(ge=(0,S.jsxs)("div",{className:"flex items-center px-3",children:[de,pe,ce,et,tt]}),e[65]=pe,e[66]=ce,e[67]=et,e[68]=tt,e[69]=ge):ge=e[69];let Ie=ge,lt;e[70]===Symbol.for("react.memo_cache_sentinel")?(lt=ms("flex flex-col w-full gap-2 py-2"),e[70]=lt):lt=e[70];let ut;e[71]===oe?ut=e[72]:(ut=!oe&&(0,S.jsxs)("span",{className:"text-xs text-muted-foreground px-3 flex flex-col gap-1",children:[(0,S.jsxs)("span",{children:["You can mention"," ",(0,S.jsx)("span",{className:"text-(--cyan-11)",children:"@dataframe"})," or"," ",(0,S.jsx)("span",{className:"text-(--cyan-11)",children:"@sql_table"})," to pull additional context such as column names."]}),(0,S.jsx)("span",{children:"Code from other cells is automatically included."})]}),e[71]=oe,e[72]=ut);let Be;e[73]!==Xe||e[74]!==Y||e[75]!==oe||e[76]!==ee||e[77]!==ue?(Be=oe&&(0,S.jsx)(gi,{isLoading:ee,onAccept:Xe,onDecline:Y,size:"sm",multipleCompletions:ue}),e[73]=Xe,e[74]=Y,e[75]=oe,e[76]=ee,e[77]=ue,e[78]=Be):Be=e[78];let ua;e[79]===Symbol.for("react.memo_cache_sentinel")?(ua=(0,S.jsx)(xo,{triggerClassName:"h-7 text-xs max-w-64",iconSize:"small",forRole:"edit"}),e[79]=ua):ua=e[79];let At;e[80]===Ut?At=e[81]:(At=(0,S.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[Ut,ua]}),e[80]=Ut,e[81]=At);let Ot;e[82]!==ut||e[83]!==Be||e[84]!==At?(Ot=(0,S.jsxs)("div",{className:"flex flex-row justify-between -mt-1 ml-1 mr-3",children:[ut,Be,At]}),e[82]=ut,e[83]=Be,e[84]=At,e[85]=Ot):Ot=e[85];let da;return e[86]!==Ie||e[87]!==Ot?(da=(0,S.jsxs)("div",{className:lt,children:[Ie,Ot]}),e[86]=Ie,e[87]=Ot,e[88]=da):da=e[88],da},ki=t=>{let e=(0,bi.c)(35),{value:a,placeholder:r,inputRef:s,className:n,onChange:i,onSubmit:o,onKeyDown:l,onClose:u,onAddFiles:c,additionalCompletions:m,maxHeight:b}=t,x=o,w=u,v=ss(),{theme:p}=_o(),g;e[0]===m?g=e[1]:(g=fe=>m?Jp([m.triggerCompletionRegex],m.completions)(fe):null,e[0]=m,e[1]=g);let k=Zo(g),I,A,O,V;if(e[2]!==k||e[3]!==c||e[4]!==v){let fe=vo();e[9]===Symbol.for("react.memo_cache_sentinel")?(I=yo({}),e[9]=I):I=e[9],A=fe,O=jm({language:fe.language,store:v,onAddFiles:c}),V=fe.language.data.of({autocomplete:k}),e[2]=k,e[3]=c,e[4]=v,e[5]=I,e[6]=A,e[7]=O,e[8]=V}else I=e[5],A=e[6],O=e[7],V=e[8];let B;e[10]===Symbol.for("react.memo_cache_sentinel")?(B=gm({storage:{load:zm,save:Um}}),e[10]=B):B=e[10];let Z;e[11]===Symbol.for("react.memo_cache_sentinel")?(Z=Do(),e[11]=Z):Z=e[11];let ae;e[12]===x?ae=e[13]:(ae=hs.highest(ga.of([{preventDefault:!0,stopPropagation:!0,any:(fe,le)=>{let bt=le.metaKey||le.ctrlKey||le.shiftKey;if(le.key==="Enter"&&!bt)return x(le,fe.state.doc.toString()),le.preventDefault(),le.stopPropagation(),!0;if(le.key==="Enter"&&le.shiftKey){let Ue=fe.state.selection.main.from;return fe.dispatch({changes:{from:Ue,to:Ue,insert:`
`},selection:{anchor:Ue+1,head:Ue+1}}),le.preventDefault(),le.stopPropagation(),!0}return!1}}])),e[12]=x,e[13]=ae);let F;e[14]===w?F=e[15]:(F=ga.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(w(),!0)}]),e[14]=w,e[15]=F);let ee;e[16]!==I||e[17]!==A||e[18]!==O||e[19]!==V||e[20]!==ae||e[21]!==F?(ee=[I,A,O,V,B,fs.lineWrapping,Z,ae,F],e[16]=I,e[17]=A,e[18]=O,e[19]=V,e[20]=ae,e[21]=F,e[22]=ee):ee=e[22];let oe=ee,ue;e[23]===n?ue=e[24]:(ue=ms("flex-1 font-sans overflow-auto my-1",n),e[23]=n,e[24]=ue);let se=p==="dark"?"dark":"light",te=r||"Generate with AI, @ to include context",ne;return e[25]!==oe||e[26]!==s||e[27]!==b||e[28]!==i||e[29]!==l||e[30]!==ue||e[31]!==se||e[32]!==te||e[33]!==a?(ne=(0,S.jsx)(Fo,{ref:s,className:ue,width:"100%",maxHeight:b,value:a,basicSetup:!1,extensions:oe,onChange:i,onKeyDown:l,theme:se,placeholder:te}),e[25]=oe,e[26]=s,e[27]=b,e[28]=i,e[29]=l,e[30]=ue,e[31]=se,e[32]=te,e[33]=a,e[34]=ne):ne=e[34],ne};function Fm(t){vs({title:"Generate with AI failed",description:$o(t)})}function zm(){return xi.get(_i)}function Um(t){return xi.set(_i,t)}export{Bp as C,Kd as D,On as E,Wo as O,Kp as S,Gn as T,qr as _,Zm as a,si as b,ci as c,lm as d,ui as f,om as g,Jr as h,gi as i,li as l,dm as m,ki as n,vi as o,cm as p,yi as r,fi as s,Dm as t,um as u,na as v,Ct as w,Vp as x,ri as y};
