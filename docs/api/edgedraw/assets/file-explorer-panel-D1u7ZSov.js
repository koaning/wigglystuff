var Se=Object.defineProperty;var _e=(t,e,r)=>e in t?Se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var O=(t,e,r)=>_e(t,typeof e!="symbol"?e+"":e,r);import{s as U}from"./chunk-DZLz74EQ.js";import{c as ce,d as me,n as Me,s as pe}from"./jotai-C7U7c6dd.js";import{t as Oe}from"./react-cj45iF1i.js";import{Er as ze,Pt as Re,w as Ae,xn as ae}from"./cells-CAMtfgeb.js";import"./react-dom-BjyRIiB0.js";import"./zod-U2NFpcFA.js";import{t as ie}from"./compiler-runtime-bbSa6V1W.js";import"./_Uint8Array-D5Z9rM2X.js";import"./isSymbol-xTSywenE.js";import"./_arrayMap-DQI2GUNb.js";import"./toString-CBnct2wx.js";import"./toNumber-CTOPJrpu.js";import"./toInteger-Bor4StOs.js";import"./isArrayLikeObject-DKyJYtr8.js";import"./_getTag-CVRrQL_Q.js";import"./_baseIsEqual-CVFfFJm2.js";import"./merge-Dvc5opZF.js";import"./_baseSlice-BWZ0PeaJ.js";import"./upperFirst-CBQfDRod.js";import"./_hasUnicode-3DIK_jNi.js";import"./capitalize-CBqvgOfA.js";import"./_arrayReduce-DV4IVFuG.js";import"./startCase-RfubwhHM.js";import"./_baseProperty-c4IQJQis.js";import"./now-BXqTLlmI.js";import"./debounce-BUM2losY.js";import"./tooltip-CyyA9NKX.js";import"./range-ZclXTdAh.js";import{d as We,u as Ie}from"./hotkeys-jCLisiwR.js";import{t as Ee}from"./invariant-D5a0EE05.js";import{f as He}from"./utils-BPcfRUDE.js";import"./constants-CEISdYm1.js";import{g as X}from"./config-DOzlN8_n.js";import"./ErrorBoundary-Bu1xrDr8.js";import"./useEventListener-DVwjxFkt.js";import{t as qe}from"./jsx-runtime-DmpivWpf.js";import"./clsx-BlAkgCmw.js";import{t as re}from"./cn-BaXqCYqP.js";import{n as Be,t as L}from"./button-DCB7VoVL.js";import{bt as Te,rt as $e}from"./dist-C6GW8SWp.js";import"./dist-BFSjfL-I.js";import{R as Le,a as Ve,i as Ue,o as Ke,r as Ye,s as Ze}from"./Output-bwodJiCi.js";import"./once-C5bmD4W5.js";import"./capabilities-MLRWIHmO.js";import"./cjs-Ck8KMDI1.js";import"./createReducer-CTvsuJZY.js";import{n as Ge,r as oe}from"./requests-CftYh9v2.js";import"./preload-helper-BnutJmlU.js";import"./dist-0FJpM7wG.js";import"./dist-DrAMGx2E.js";import"./dist-CZkQ2hcE.js";import"./dist-BrS3KFEl.js";import"./dist-DvTgOH5F.js";import"./dist-YP2XXp1Z.js";import"./stex-xveX5l_T.js";import"./Deferred-NfAvvkGM.js";import"./uuid-D0hUC3Qw.js";import"./key-CaC9xuXQ.js";import{t as z}from"./use-toast-BBrPeu2N.js";import"./main-ChjX94eX.js";import"./marked.esm-BV7g2d65.js";import"./connection-DOETP_K0.js";import"./dist-CvIoRIOp.js";import"./useLifecycle-DiLWmtpP.js";import{n as Je}from"./useTheme-Dsb69ewj.js";import{t as V}from"./createLucideIcon-DbfgBYhq.js";import{t as Qe}from"./arrow-left-qLn5JMUD.js";import{t as Xe}from"./between-horizontal-start-DDhAeomy.js";import"./type-CnQq0uaD.js";import"./table-CTK995oK.js";import"./check-DqnGmZZE.js";import{_ as et}from"./select-E33nSIDn.js";import{n as tt,t as he}from"./download-C81Fxkfa.js";import{t as at}from"./chevron-right-Bu29x-gp.js";import{_ as se}from"./maps-B9m998ly.js";import"./toDate-CbcWqY6f.js";import{a as C,c as K,p as it,r as rt,t as ot}from"./dropdown-menu-k3cvSs56.js";import{t as fe}from"./copy-4VJP-N0g.js";import{t as xe}from"./download-BYnrx3yk.js";import{t as st}from"./ellipsis-vertical-GzpLMS30.js";import{n as ue,r as nt,t as lt}from"./types-CKcqkReK.js";import"./file-video-camera-Bt4f7oOT.js";import{t as ge}from"./file-plus-2-C6zNvKzj.js";import"./file-text-KeEJTZsk.js";import"./file-DU2hKpP7.js";import{t as dt}from"./spinner-CM1AwwT-.js";import"./MarimoErrorOutput-CkZl2oHu.js";import{t as ct}from"./refresh-ccw-Dmg0YI4-.js";import{t as mt}from"./refresh-cw-z53rVhjq.js";import{t as pt}from"./save-Dxp7SN8k.js";import"./input-lkQFhlrZ.js";import"./state-dWjslxDZ.js";import{t as ht}from"./trash-2-BsccpX3E.js";import{t as ft}from"./triangle-alert-DoSv9yQr.js";import{i as xt,n as ut,t as gt}from"./es-Bve1w9dd.js";import"./badge-DrRlgkPx.js";import"./Combination-CJczP3q7.js";import"./dist-Cn3C5h2V.js";import{t as _}from"./tooltip-QlUG_0sW.js";import"./menu-items-CKlDAcIy.js";import"./useNonce-CElEIK4R.js";import"./en-US-Cok_jNd9.js";import"./isValid-BhOWABEg.js";import"./mode-BAOMKXFj.js";import{o as jt}from"./alert-dialog-DkIHCxse.js";import"./dialog-DZWinI5N.js";import"./usePress-CqxmpITG.js";import"./SSRProvider-3gFeNiun.js";import"./useDateFormatter-DHQNk42q.js";import"./context-By5V2JVn.js";import"./useNumberFormatter-BFHkt56k.js";import"./shim-DuR5ZJNr.js";import"./numbers-BrVMv_xq.js";import{n as R}from"./useEvent-mw3fc-le.js";import"./useDebounce-Dc646H0x.js";import{n as je}from"./ImperativeModal-kroC_7ut.js";import"./strings-jhyl_xMu.js";import{i as yt,n as ye}from"./error-banner-B98iBZZ2.js";import"./vega-loader.browser-BJKnSXO3.js";import"./precisionRound-JPbfj2M2.js";import"./defaultLocale-D-ie3mwB.js";import"./defaultLocale-DzEPn_Ia.js";import{t as ee}from"./copy-zuiMeyCQ.js";import"./copy-icon-DFLZbTfh.js";import"./RenderHTML-DII6L-pL.js";import"./purify.es-BNe8OHFA.js";import"./useRunCells-DSf9mKXo.js";import"./multi-map-CMSc8wqP.js";import"./emotion-is-prop-valid.esm-DY_d0mBI.js";import"./extends-BADOB1Xm.js";import"./prop-types-DVt2dPhq.js";import"./objectWithoutPropertiesLoose-BhduYW5j.js";import{n as ne,t as bt}from"./tree-ThjH84Vh.js";import{n as vt,t as wt}from"./alert-DZiaW65G.js";import{n as be}from"./useAsyncData-BIQYiPhO.js";import"./kbd-BEZA_QXE.js";import{a as kt}from"./renderShortcut-Cp1zXREV.js";import{t as Ft}from"./LazyAnyLanguageCodeMirror-C5EeHVjE.js";import"./popover-ieUH9gue.js";import"./cell-link-CGc-QK-U.js";import"./links-Cd3tV5IK.js";import"./useIframeCapabilities-CRfeZulz.js";import"./lazy-NLnLn6Pi.js";import"./tabs-DvBunSCS.js";import"./command-CgWi9W7A.js";import"./table-Ny605LgF.js";import"./formats-Dmio8FVx.js";import{n as Ct}from"./blob-BgGJeXvG.js";import{t as Nt}from"./bundle.esm-CC-LjhS-.js";import{o as Dt}from"./focus-Bg0Cm8D6.js";import{t as Pt}from"./links-Lztpt8X-.js";import{t as St}from"./icon-32x32-BbDKn-R9.js";import{t as Y}from"./Inputs-BbLBkwsf.js";var _t=V("copy-minus",[["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),ve=V("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),we=V("list-tree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),Mt=V("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Ot=V("square-play",[["rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",key:"h1oib"}],["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}]]),zt=V("view",[["path",{d:"M21 17v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2",key:"mrq65r"}],["path",{d:"M21 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2",key:"be3xqs"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0",key:"11ak4c"}]]),Rt=U(ie(),1),S=U(Oe(),1),a=U(qe(),1),le=new Map;const At=({file:t,onOpenNotebook:e})=>{let{theme:r}=Je(),{sendFileDetails:s,sendUpdateFile:i}=oe(),l=ce(He),d=ce(ze),[m,c]=(0,S.useState)(""),{data:o,isPending:f,error:x,setData:j,refetch:h}=be(async()=>{let n=await s({path:t.path}),g=n.contents||"";return c(le.get(t.path)||g),n},[t.path]),y=async()=>{m!==(o==null?void 0:o.contents)&&await i({path:t.path,contents:m}).then(n=>{n.success&&(j(g=>({...g,contents:m})),c(m))})},v=(0,S.useRef)(m);if(v.current=m,(0,S.useEffect)(()=>()=>{if(!(o!=null&&o.contents))return;let n=v.current;n===o.contents?le.delete(t.path):le.set(t.path,n)},[t.path,o==null?void 0:o.contents]),x)return(0,a.jsx)(ye,{error:x});if(f||!o)return null;let u=o.mimeType||"text/plain",k=u in de,F=d&&o.file.isMarimoFile&&(t.path===d||t.path.endsWith(`/${d}`));if(!o.contents&&!k)return(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 p-6",children:[(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Name"}),(0,a.jsx)("div",{children:o.file.name}),(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Type"}),(0,a.jsx)("div",{children:u})]});let b=(0,a.jsxs)("div",{className:"text-xs text-muted-foreground p-1 flex justify-end gap-2 border-b",children:[(0,a.jsx)(_,{content:"Refresh",children:(0,a.jsx)(Y,{size:"small",onClick:h,children:(0,a.jsx)(mt,{})})}),t.isMarimoFile&&!X()&&(0,a.jsx)(_,{content:"Open notebook",children:(0,a.jsx)(Y,{size:"small",onClick:n=>e(n),children:(0,a.jsx)(se,{})})}),(0,a.jsx)(_,{content:"Download",children:(0,a.jsx)(Y,{size:"small",onClick:()=>{if(ke(u)){tt(Le(o.contents,u),o.file.name);return}he(new Blob([o.contents||m],{type:u}),o.file.name)},children:(0,a.jsx)(xe,{})})}),!ke(u)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_,{content:"Copy contents to clipboard",children:(0,a.jsx)(Y,{size:"small",onClick:async()=>{await ee(m)},children:(0,a.jsx)(fe,{})})}),(0,a.jsx)(_,{content:kt("global.save"),children:(0,a.jsx)(Y,{size:"small",color:m===o.contents?void 0:"green",onClick:y,disabled:m===o.contents,children:(0,a.jsx)(pt,{})})})]})]});return u.startsWith("image/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ve,{base64:o.contents,mime:u})})]}):u==="text/csv"&&o.contents?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ue,{contents:o.contents})})]}):u.startsWith("audio/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ye,{base64:o.contents,mime:u})})]}):u.startsWith("video/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ze,{base64:o.contents,mime:u})})]}):u.startsWith("application/pdf")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ke,{base64:o.contents,mime:u})})]}):(0,a.jsxs)(a.Fragment,{children:[b,F&&(0,a.jsxs)(wt,{variant:"warning",className:"rounded-none",children:[(0,a.jsx)(ft,{className:"h-4 w-4"}),(0,a.jsx)(vt,{children:"Editing the notebook file directly while running in marimo's editor may cause unintended changes. Please use with caution."})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(0,a.jsx)(S.Suspense,{children:(0,a.jsx)(Ft,{theme:r==="dark"?"dark":"light",language:de[u]||de.default,className:"border-b",extensions:[$e.lineWrapping,Te.of([{key:l.getHotkey("global.save").key,stopPropagation:!0,run:()=>m===o.contents?!1:(y(),!0)}])],value:m,onChange:c})})})]})};var ke=t=>t?t.startsWith("image/")||t.startsWith("audio/")||t.startsWith("video/")||t.startsWith("application/pdf"):!1,de={"application/javascript":"javascript","text/markdown":"markdown","text/html":"html","text/css":"css","text/x-python":"python","application/json":"json","application/xml":"xml","text/x-yaml":"yaml","text/csv":"markdown","text/plain":"markdown",default:"markdown"},Wt=class{constructor(t){O(this,"delegate",new ne([]));O(this,"rootPath","");O(this,"onChange",We.NOOP);O(this,"path",new ae("/"));O(this,"initialize",async t=>{if(this.onChange=t,this.delegate.data.length===0)try{let e=await this.callbacks.listFiles({path:this.rootPath});this.delegate=new ne(e.files),this.rootPath=e.root,this.path=ae.guessDeliminator(e.root)}catch(e){z({title:"Failed",description:yt(e)})}this.onChange(this.delegate.data)});O(this,"refreshAll",async t=>{let e=[this.rootPath,...t.map(s=>{var i;return(i=this.delegate.find(s))==null?void 0:i.data.path})].filter(Boolean),r=await Promise.all(e.map(s=>this.callbacks.listFiles({path:s}).catch(()=>({files:[]}))));for(let[s,i]of e.entries()){let l=r[s];i===this.rootPath?this.delegate=new ne(l.files):this.delegate.update({id:i,changes:{children:l.files}})}this.onChange(this.delegate.data)});O(this,"relativeFromRoot",t=>{let e=this.rootPath.endsWith(this.path.deliminator)?this.rootPath:`${this.rootPath}${this.path.deliminator}`;return t.startsWith(e)?t.slice(e.length):t});O(this,"handleResponse",t=>t.success?t:(z({title:"Failed",description:t.message}),null));this.callbacks=t}async expand(t){let e=this.delegate.find(t);if(!e||!e.data.isDirectory)return!1;if(e.children&&e.children.length>0)return!0;let r=await this.callbacks.listFiles({path:e.data.path});return this.delegate.update({id:t,changes:{children:r.files}}),this.onChange(this.delegate.data),!0}async rename(t,e){let r=this.delegate.find(t);if(!r)return;let s=r.data.path,i=this.path.join(this.path.dirname(s),e);await this.callbacks.renameFileOrFolder({path:s,newPath:i}).then(this.handleResponse),this.delegate.update({id:t,changes:{name:e,path:i}}),this.onChange(this.delegate.data),await this.refreshAll([i])}async move(t,e){var s;let r=e?((s=this.delegate.find(e))==null?void 0:s.data.path)??e:this.rootPath;await Promise.all(t.map(i=>{this.delegate.move({id:i,parentId:e,index:0});let l=this.delegate.find(i);if(!l)return Promise.resolve();let d=this.path.join(r,this.path.basename(l.data.path));return this.delegate.update({id:i,changes:{path:d}}),this.callbacks.renameFileOrFolder({path:l.data.path,newPath:d}).then(this.handleResponse)})),this.onChange(this.delegate.data),await this.refreshAll([r])}async createFile(t,e){var i;let r=e?((i=this.delegate.find(e))==null?void 0:i.data.path)??e:this.rootPath,s=await this.callbacks.createFileOrFolder({path:r,type:"file",name:t}).then(this.handleResponse);s!=null&&s.info&&(this.delegate.create({parentId:e,index:0,data:s.info}),this.onChange(this.delegate.data),await this.refreshAll([r]))}async createFolder(t,e){var i;let r=e?((i=this.delegate.find(e))==null?void 0:i.data.path)??e:this.rootPath,s=await this.callbacks.createFileOrFolder({path:r,type:"directory",name:t}).then(this.handleResponse);s!=null&&s.info&&(this.delegate.create({parentId:e,index:0,data:s.info}),this.onChange(this.delegate.data),await this.refreshAll([r]))}async delete(t){let e=this.delegate.find(t);e&&(await this.callbacks.deleteFileOrFolder({path:e.data.path}).then(this.handleResponse),this.delegate.drop({id:t}),this.onChange(this.delegate.data))}};const Fe=me(t=>{let e=t(Ge);return Ee(e,"no requestClientAtom set"),new Wt({listFiles:e.sendListFiles,createFileOrFolder:e.sendCreateFileOrFolder,deleteFileOrFolder:e.sendDeleteFileOrFolder,renameFileOrFolder:e.sendRenameFileOrFolder})}),It=me({});async function Et(){await Me.get(Fe).refreshAll([])}var Ht=1024*1024*100;function Ce(t){let e=(0,Rt.c)(7),r;e[0]===t?r=e[1]:(r=t===void 0?{}:t,e[0]=t,e[1]=r);let s=r,{sendCreateFileOrFolder:i}=oe(),l;e[2]===i?l=e[3]:(l=async m=>{for(let c of m){let o=Vt(Lt(c)),f="";o&&(f=ae.guessDeliminator(o).dirname(o));let x=(await Ct(c)).split(",")[1];await i({path:f,type:"file",name:c.name,contents:x})}await Et()},e[2]=i,e[3]=l);let d;return e[4]!==s||e[5]!==l?(d={multiple:!0,maxSize:Ht,onError:$t,onDropRejected:qt,onDrop:l,...s},e[4]=s,e[5]=l,e[6]=d):d=e[6],gt(d)}function qt(t){z({title:"File upload failed",description:(0,a.jsx)("div",{className:"flex flex-col gap-1",children:t.map(Bt)}),variant:"danger"})}function Bt(t){return(0,a.jsxs)("div",{children:[t.file.name," (",t.errors.map(Tt).join(", "),")"]},t.file.name)}function Tt(t){return t.message}function $t(t){Ie.error(t),z({title:"File upload failed",description:t.message,variant:"danger"})}function Lt(t){if(t.webkitRelativePath)return t.webkitRelativePath;if("path"in t&&typeof t.path=="string")return t.path;if("relativePath"in t&&typeof t.relativePath=="string")return t.relativePath}function Vt(t){if(t)return t.replace(/^\/+/,"")}var Z=U(ie(),1),Ne=S.createContext(null);const Ut=t=>{let e=(0,Z.c)(60),{height:r}=t,s=(0,S.useRef)(null),[i]=pe(Fe),l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[0]=l):l=e[0];let[d,m]=(0,S.useState)(l),[c,o]=(0,S.useState)(null),{openPrompt:f}=je(),[x,j]=pe(It),h;e[1]===i?h=e[2]:(h=()=>i.initialize(m),e[1]=i,e[2]=h);let y;e[3]===Symbol.for("react.memo_cache_sentinel")?(y=[],e[3]=y):y=e[3];let{isPending:v,error:u}=be(h,y),k;e[4]!==x||e[5]!==i?(k=()=>{i.refreshAll(Object.keys(x).filter(p=>x[p]))},e[4]=x,e[5]=i,e[6]=k):k=e[6];let F=R(k),b;e[7]!==f||e[8]!==i?(b=async()=>{f({title:"Folder name",onConfirm:async p=>{i.createFolder(p,null)}})},e[7]=f,e[8]=i,e[9]=b):b=e[9];let n=R(b),g;e[10]!==f||e[11]!==i?(g=async()=>{f({title:"File name",onConfirm:async p=>{i.createFile(p,null)}})},e[10]=f,e[11]=i,e[12]=g):g=e[12];let N=R(g),D;e[13]===j?D=e[14]:(D=()=>{var p;(p=s.current)==null||p.closeAll(),j({})},e[13]=j,e[14]=D);let A=R(D);if(v){let p;return e[15]===Symbol.for("react.memo_cache_sentinel")?(p=(0,a.jsx)(dt,{size:"medium",centered:!0}),e[15]=p):p=e[15],p}if(u){let p;return e[16]===u?p=e[17]:(p=(0,a.jsx)(ye,{error:u}),e[16]=u,e[17]=p),p}if(c){let p;e[18]===Symbol.for("react.memo_cache_sentinel")?(p=()=>o(null),e[18]=p):p=e[18];let w;e[19]===Symbol.for("react.memo_cache_sentinel")?(w=(0,a.jsx)(L,{onClick:p,"data-testid":"file-explorer-back-button",variant:"text",size:"xs",className:"mb-0",children:(0,a.jsx)(Qe,{size:16})}),e[19]=w):w=e[19];let P;e[20]===c.name?P=e[21]:(P=(0,a.jsxs)("div",{className:"flex items-center pl-1 pr-3 shrink-0 border-b justify-between",children:[w,(0,a.jsx)("span",{className:"font-bold",children:c.name})]}),e[20]=c.name,e[21]=P);let T;e[22]!==c.path||e[23]!==i?(T=Pe=>De(Pe,i.relativeFromRoot(c.path)),e[22]=c.path,e[23]=i,e[24]=T):T=e[24];let $;e[25]!==c||e[26]!==T?($=(0,a.jsx)(S.Suspense,{children:(0,a.jsx)(At,{onOpenNotebook:T,file:c})}),e[25]=c,e[26]=T,e[27]=$):$=e[27];let Q;return e[28]!==P||e[29]!==$?(Q=(0,a.jsxs)(a.Fragment,{children:[P,$]}),e[28]=P,e[29]=$,e[30]=Q):Q=e[30],Q}let M;e[31]!==A||e[32]!==N||e[33]!==n||e[34]!==F||e[35]!==i?(M=(0,a.jsx)(Yt,{onRefresh:F,onCreateFile:N,onCreateFolder:n,onCollapseAll:A,tree:i}),e[31]=A,e[32]=N,e[33]=n,e[34]=F,e[35]=i,e[36]=M):M=e[36];let te=r-33,W,I,E;e[37]===i?(W=e[38],I=e[39],E=e[40]):(W=async p=>{let{ids:w}=p;for(let P of w)await i.delete(P)},I=async p=>{let{id:w,name:P}=p;await i.rename(w,P)},E=async p=>{let{dragIds:w,parentId:P}=p;await i.move(w,P)},e[37]=i,e[38]=W,e[39]=I,e[40]=E);let G;e[41]===Symbol.for("react.memo_cache_sentinel")?(G=p=>{let w=p[0];w&&(w.data.isDirectory||o(w.data))},e[41]=G):G=e[41];let H;e[42]!==x||e[43]!==j||e[44]!==i?(H=async p=>{if(await i.expand(p)){let w=x[p]??!1;j({...x,[p]:!w})}},e[42]=x,e[43]=j,e[44]=i,e[45]=H):H=e[45];let q;e[46]!==d||e[47]!==x||e[48]!==W||e[49]!==I||e[50]!==E||e[51]!==H||e[52]!==te?(q=(0,a.jsx)(bt,{width:"100%",ref:s,height:te,className:"h-full",data:d,initialOpenState:x,openByDefault:!1,renderCursor:Xt,disableDrop:ea,onDelete:W,onRename:I,onMove:E,onSelect:G,onToggle:H,padding:15,rowHeight:30,indent:Kt,overscanCount:1e3,disableMultiSelection:!0,children:Jt}),e[46]=d,e[47]=x,e[48]=W,e[49]=I,e[50]=E,e[51]=H,e[52]=te,e[53]=q):q=e[53];let B;e[54]!==q||e[55]!==i?(B=(0,a.jsx)(Ne,{value:i,children:q}),e[54]=q,e[55]=i,e[56]=B):B=e[56];let J;return e[57]!==B||e[58]!==M?(J=(0,a.jsxs)(a.Fragment,{children:[M,B]}),e[57]=B,e[58]=M,e[59]=J):J=e[59],J};var Kt=15,Yt=t=>{let e=(0,Z.c)(30),{onRefresh:r,onCreateFile:s,onCreateFolder:i,onCollapseAll:l}=t,d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d={noDrag:!0,noDragEventsBubbling:!0},e[0]=d):d=e[0];let{getRootProps:m,getInputProps:c}=Ce(d),o;e[1]===Symbol.for("react.memo_cache_sentinel")?(o=(0,a.jsx)(ge,{size:16}),e[1]=o):o=e[1];let f;e[2]===s?f=e[3]:(f=(0,a.jsx)(_,{content:"Add file",children:(0,a.jsx)(L,{"data-testid":"file-explorer-add-file-button",onClick:s,variant:"text",size:"xs",children:o})}),e[2]=s,e[3]=f);let x;e[4]===Symbol.for("react.memo_cache_sentinel")?(x=(0,a.jsx)(ve,{size:16}),e[4]=x):x=e[4];let j;e[5]===i?j=e[6]:(j=(0,a.jsx)(_,{content:"Add folder",children:(0,a.jsx)(L,{"data-testid":"file-explorer-add-folder-button",onClick:i,variant:"text",size:"xs",children:x})}),e[5]=i,e[6]=j);let h;e[7]===m?h=e[8]:(h=m({}),e[7]=m,e[8]=h);let y,v;e[9]===Symbol.for("react.memo_cache_sentinel")?(y=Be({variant:"text",size:"xs"}),v=(0,a.jsx)(xt,{size:16}),e[9]=y,e[10]=v):(y=e[9],v=e[10]);let u;e[11]===h?u=e[12]:(u=(0,a.jsx)(_,{content:"Upload file",children:(0,a.jsx)("button",{"data-testid":"file-explorer-upload-button",...h,className:y,children:v})}),e[11]=h,e[12]=u);let k;e[13]===c?k=e[14]:(k=c({}),e[13]=c,e[14]=k);let F;e[15]===k?F=e[16]:(F=(0,a.jsx)("input",{...k,type:"file"}),e[15]=k,e[16]=F);let b;e[17]===Symbol.for("react.memo_cache_sentinel")?(b=(0,a.jsx)(ct,{size:16}),e[17]=b):b=e[17];let n;e[18]===r?n=e[19]:(n=(0,a.jsx)(_,{content:"Refresh",children:(0,a.jsx)(L,{"data-testid":"file-explorer-refresh-button",onClick:r,variant:"text",size:"xs",children:b})}),e[18]=r,e[19]=n);let g;e[20]===Symbol.for("react.memo_cache_sentinel")?(g=(0,a.jsx)(_t,{size:16}),e[20]=g):g=e[20];let N;e[21]===l?N=e[22]:(N=(0,a.jsx)(_,{content:"Collapse all folders",children:(0,a.jsx)(L,{"data-testid":"file-explorer-collapse-button",onClick:l,variant:"text",size:"xs",children:g})}),e[21]=l,e[22]=N);let D;return e[23]!==F||e[24]!==n||e[25]!==N||e[26]!==f||e[27]!==j||e[28]!==u?(D=(0,a.jsxs)("div",{className:"flex items-center justify-end px-2 shrink-0 border-b",children:[f,j,u,F,n,N]}),e[23]=F,e[24]=n,e[25]=N,e[26]=f,e[27]=j,e[28]=u,e[29]=D):D=e[29],D},Zt=t=>{let e=(0,Z.c)(9),{node:r,onOpenMarimoFile:s}=t,i;e[0]===r?i=e[1]:(i=m=>{r.data.isDirectory||(m.stopPropagation(),r.select())},e[0]=r,e[1]=i);let l;e[2]!==r.data.isMarimoFile||e[3]!==s?(l=r.data.isMarimoFile&&!X()&&(0,a.jsxs)("span",{className:"shrink-0 ml-2 text-sm hidden group-hover:inline hover:underline",onClick:s,children:["open ",(0,a.jsx)(se,{className:"inline ml-1",size:12})]}),e[2]=r.data.isMarimoFile,e[3]=s,e[4]=l):l=e[4];let d;return e[5]!==r.data.name||e[6]!==i||e[7]!==l?(d=(0,a.jsxs)("span",{className:"flex-1 overflow-hidden text-ellipsis",onClick:i,children:[r.data.name,l]}),e[5]=r.data.name,e[6]=i,e[7]=l,e[8]=d):d=e[8],d},Gt=t=>{let e=(0,Z.c)(10),{node:r}=t,s=(0,S.useRef)(null),i,l;e[0]===r.data.name?(i=e[1],l=e[2]):(i=()=>{var o,f;(o=s.current)==null||o.focus(),(f=s.current)==null||f.setSelectionRange(0,r.data.name.lastIndexOf("."))},l=[r.data.name],e[0]=r.data.name,e[1]=i,e[2]=l),(0,S.useEffect)(i,l);let d,m;e[3]===r?(d=e[4],m=e[5]):(d=()=>r.reset(),m=o=>{o.key==="Escape"&&r.reset(),o.key==="Enter"&&r.submit(o.currentTarget.value)},e[3]=r,e[4]=d,e[5]=m);let c;return e[6]!==r.data.name||e[7]!==d||e[8]!==m?(c=(0,a.jsx)("input",{ref:s,className:"flex-1 bg-transparent border border-border text-muted-foreground",defaultValue:r.data.name,onClick:ta,onBlur:d,onKeyDown:m}),e[6]=r.data.name,e[7]=d,e[8]=m,e[9]=c):c=e[9],c},Jt=({node:t,style:e,dragHandle:r})=>{let{openFile:s,sendCreateFileOrFolder:i,sendFileDetails:l}=oe(),d=t.data.isDirectory?"directory":nt(t.data.name),m=lt[d],{openConfirm:c,openPrompt:o}=je(),{createNewCell:f}=Ae(),x=Dt(),j=n=>{f({code:n,before:!1,cellId:x??"__end__"})},h=(0,S.use)(Ne),y=async n=>{De(n,h?h.relativeFromRoot(t.data.path):t.data.path)},v=async n=>{n.stopPropagation(),n.preventDefault(),c({title:"Delete file",description:`Are you sure you want to delete ${t.data.name}?`,confirmAction:(0,a.jsx)(jt,{onClick:async()=>{await t.tree.delete(t.id)},"aria-label":"Confirm",children:"Delete"})})},u=R(async()=>{t.open(),o({title:"Folder name",onConfirm:async n=>{h==null||h.createFolder(n,t.id)}})}),k=R(async()=>{t.open(),o({title:"File name",onConfirm:async n=>{h==null||h.createFile(n,t.id)}})}),F=R(async()=>{var D;if(!h||t.data.isDirectory)return;let[n,g]=ut(t.data.name),N=`${n}_copy${g}`;try{let A=await l({path:t.data.path}),M=((D=t.parent)==null?void 0:D.data.path)||"";await i({path:M,type:"file",name:N,contents:A.contents?btoa(A.contents):void 0}),await h.refreshAll([M])}catch{z({title:"Failed to duplicate file",description:"Unable to create a duplicate of the file",variant:"danger"})}}),b=()=>{let n={size:14,strokeWidth:1.5,className:"mr-2"};return(0,a.jsxs)(rt,{align:"end",className:"no-print w-[220px]",onClick:g=>g.stopPropagation(),onCloseAutoFocus:g=>g.preventDefault(),children:[!t.data.isDirectory&&(0,a.jsxs)(C,{onSelect:()=>t.select(),children:[(0,a.jsx)(zt,{...n}),"Open file"]}),!t.data.isDirectory&&!X()&&(0,a.jsxs)(C,{onSelect:()=>{s({path:t.data.path})},children:[(0,a.jsx)(se,{...n}),"Open file in external editor"]}),t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(C,{onSelect:()=>k(),children:[(0,a.jsx)(ge,{...n}),"Create file"]}),(0,a.jsxs)(C,{onSelect:()=>u(),children:[(0,a.jsx)(ve,{...n}),"Create folder"]}),(0,a.jsx)(K,{})]}),(0,a.jsxs)(C,{onSelect:()=>t.edit(),children:[(0,a.jsx)(Mt,{...n}),"Rename"]}),!t.data.isDirectory&&(0,a.jsxs)(C,{onSelect:F,children:[(0,a.jsx)(fe,{...n}),"Duplicate"]}),(0,a.jsxs)(C,{onSelect:async()=>{await ee(t.data.path),z({title:"Copied to clipboard"})},children:[(0,a.jsx)(we,{...n}),"Copy path"]}),h&&(0,a.jsxs)(C,{onSelect:async()=>{await ee(h.relativeFromRoot(t.data.path)),z({title:"Copied to clipboard"})},children:[(0,a.jsx)(we,{...n}),"Copy relative path"]}),(0,a.jsx)(K,{}),(0,a.jsxs)(C,{onSelect:()=>{let{path:g}=t.data;j(ue[d](g))},children:[(0,a.jsx)(Xe,{...n}),"Insert snippet for reading file"]}),(0,a.jsxs)(C,{onSelect:async()=>{z({title:"Copied to clipboard",description:"Code to open the file has been copied to your clipboard. You can also drag and drop this file into the editor"});let{path:g}=t.data;await ee(ue[d](g))},children:[(0,a.jsx)(Re,{...n}),"Copy snippet for reading file"]}),t.data.isMarimoFile&&!X()&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K,{}),(0,a.jsxs)(C,{onSelect:y,children:[(0,a.jsx)(Ot,{...n}),"Open notebook"]})]}),(0,a.jsx)(K,{}),!t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(C,{onSelect:async()=>{let g=(await l({path:t.data.path})).contents||"";he(new Blob([g]),t.data.name)},children:[(0,a.jsx)(xe,{...n}),"Download"]}),(0,a.jsx)(K,{})]}),(0,a.jsxs)(C,{onSelect:v,variant:"danger",children:[(0,a.jsx)(ht,{...n}),"Delete"]})]})};return(0,a.jsxs)("div",{style:e,ref:r,className:re("flex items-center cursor-pointer ml-1 text-muted-foreground whitespace-nowrap group"),draggable:!0,onClick:n=>{n.stopPropagation(),t.data.isDirectory&&t.toggle()},children:[(0,a.jsx)(Qt,{node:t}),(0,a.jsxs)("span",{className:re("flex items-center pl-1 py-1 cursor-pointer hover:bg-accent/50 hover:text-accent-foreground rounded-l flex-1 overflow-hidden group",t.willReceiveDrop&&t.data.isDirectory&&"bg-accent/80 hover:bg-accent/80 text-accent-foreground"),children:[t.data.isMarimoFile?(0,a.jsx)("img",{src:St,className:"w-5 h-5 shrink-0 mr-2 filter grayscale",alt:"Marimo"}):(0,a.jsx)(m,{className:"w-5 h-5 shrink-0 mr-2",strokeWidth:1.5}),t.isEditing?(0,a.jsx)(Gt,{node:t}):(0,a.jsx)(Zt,{node:t,onOpenMarimoFile:y}),(0,a.jsxs)(ot,{modal:!1,children:[(0,a.jsx)(it,{asChild:!0,tabIndex:-1,onClick:n=>n.stopPropagation(),children:(0,a.jsx)(L,{"data-testid":"file-explorer-more-button",variant:"text",tabIndex:-1,size:"xs",className:"mb-0","aria-label":"More options",children:(0,a.jsx)(st,{strokeWidth:2,className:"w-5 h-5 hidden group-hover:block"})})}),b()]})]})]})},Qt=t=>{let e=(0,Z.c)(3),{node:r}=t;if(!r.data.isDirectory){let i;return e[0]===Symbol.for("react.memo_cache_sentinel")?(i=(0,a.jsx)("span",{className:"w-5 h-5 shrink-0"}),e[0]=i):i=e[0],i}let s;return e[1]===r.isOpen?s=e[2]:(s=r.isOpen?(0,a.jsx)(et,{className:"w-5 h-5 shrink-0"}):(0,a.jsx)(at,{className:"w-5 h-5 shrink-0"}),e[1]=r.isOpen,e[2]=s),s};function De(t,e){t.stopPropagation(),t.preventDefault(),Pt(e)}function Xt(){return null}function ea(t){let{parentNode:e}=t;return!e.data.isDirectory}function ta(t){return t.stopPropagation()}var aa=U(ie(),1),ia=()=>{let t=(0,aa.c)(20),{ref:e,height:r}=Nt(),s=r===void 0?1:r,i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i={noClick:!0,noKeyboard:!0},t[0]=i):i=t[0];let{getRootProps:l,getInputProps:d,isDragActive:m}=Ce(i),c;t[1]===l?c=t[2]:(c=l(),t[1]=l,t[2]=c);let o;t[3]===Symbol.for("react.memo_cache_sentinel")?(o=re("flex flex-col flex-1 overflow-hidden relative"),t[3]=o):o=t[3];let f;t[4]===d?f=t[5]:(f=d(),t[4]=d,t[5]=f);let x;t[6]===f?x=t[7]:(x=(0,a.jsx)("input",{...f}),t[6]=f,t[7]=x);let j;t[8]===m?j=t[9]:(j=m&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center uppercase justify-center text-xl font-bold text-primary/90 bg-accent/85 z-10 border-2 border-dashed border-primary/90 rounded-lg pointer-events-none",children:"Drop files here"}),t[8]=m,t[9]=j);let h;t[10]===s?h=t[11]:(h=(0,a.jsx)(Ut,{height:s}),t[10]=s,t[11]=h);let y;t[12]!==e||t[13]!==h?(y=(0,a.jsx)("div",{ref:e,className:"flex flex-col flex-1 overflow-hidden",children:h}),t[12]=e,t[13]=h,t[14]=y):y=t[14];let v;return t[15]!==c||t[16]!==x||t[17]!==j||t[18]!==y?(v=(0,a.jsxs)("div",{...c,className:o,children:[x,j,y]}),t[15]=c,t[16]=x,t[17]=j,t[18]=y,t[19]=v):v=t[19],v};export{ia as default};
