var Zn=Object.defineProperty;var Fn=(t,e,a)=>e in t?Zn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var j=(t,e,a)=>Fn(t,typeof e!="symbol"?e+"":e,a);import{s as Ta,t as zn}from"./chunk-LvLJmgfZ.js";import{c as Un,i as Vn,n as Rr,s as qn,u as Nr}from"./jotai-D74Ef_p1.js";import{t as Bn}from"./react-XTZdWHwa.js";import{Br as Wn,Dr as Kn,Kn as Jn,Nr as Yn,Nt as Mr,On as Hn,Rn as Gn,St as Qn,Ut as Xn,Wn as ei,at as Ia,bn as ti,d as ai,gr as ri,i as si,jr as ni,mt as ii,pr as oi,qn as jr,w as Pr,y as tt,zr as Lr}from"./cells-B1ds6ZjK.js";import{B as Ee,D as li,E as Dr,H as di,I as St,J as $r,L as ee,N as Zr,O as ui,P as G,R as E,S as ci,T as de,V as qe,W as Fr,b as Jt,k as M,w as Be,x as Yt}from"./zod-BBqism5D.js";import{t as Sa}from"./compiler-runtime-QczY1yfQ.js";import{i as pi}from"./useLifecycle-bYJVBwo9.js";import{o as mi,u as ie}from"./hotkeys-sK-kaEBC.js";import{a as hi}from"./config-BwUC_LRl.js";import{t as fi}from"./jsx-runtime-B4_2-8Ho.js";import{t as je}from"./button-BtVgadIf.js";import{t as zr}from"./cn-f3ruLt4G.js";import{Bt as gi,Jt as Ht,St as Gt,Ut as Ur,Vt as yi,Xt as vi,at as Vr,ct as _i,lt as qr,qt as Qt,rt as Aa,xt as bi}from"./dist-hQAzR0Cy.js";import{U as xi,X as Br,tt as wi}from"./Output-C7Tw17j5.js";import{t as ki}from"./createReducer-uDMmKGBt.js";import{r as Ci,t as Ei}from"./requests-CMMs4cl8.js";import{h as Ti,n as Ii,o as Si,r as Ai}from"./dist-a5AhnPua.js";import{t as Wr}from"./createLucideIcon-C9QGcv--.js";import{t as Oi}from"./ai-model-dropdown-BiaBgfSy.js";import{h as Ri}from"./select-Dre1F6mo.js";import{a as Ni}from"./download-Yhx6Ym5-.js";import{a as Kr,c as Mi,p as ji,r as Pi,t as Li}from"./dropdown-menu-DL4QHRL7.js";import{n as Di}from"./spinner-cyqSIlb0.js";import{a as vt,c as $i,i as _t,o as At,r as Zi,s as Ot}from"./MarimoErrorOutput-B1Mc3WdL.js";import{r as Fi}from"./name-cell-input-Do6XiA3C.js";import{n as zi}from"./ConsoleOutput-D7wjWCxv.js";import{a as Ui}from"./state-GOQmrHWh.js";import{a as Vi}from"./dist-BFZNB01C.js";import{t as Jr}from"./use-toast-CTk3v2Fk.js";import{n as qi}from"./useTheme-DNzypnwR.js";import{t as Bi}from"./tooltip-DEUNsdbK.js";import{t as Wi}from"./shim-DZsTM49a.js";import{n as Ki}from"./useEvent-bc5jSpSz.js";import{i as Ji}from"./error-banner-BVpxvuDQ.js";import{n as Yi}from"./useRunCells-D8WfVv85.js";import{n as Rt}from"./renderShortcut-CF5R2n1d.js";import{i as Oa}from"./cell-link-ByqSnfe2.js";import{r as Hi,t as Gi}from"./esm-DDxkZACy.js";import{n as Qi}from"./add-missing-import-BkauGlV2.js";import{t as Xi}from"./blob-CIREuKO3.js";import{t as eo}from"./useDeleteCell-BCwFj4vN.js";import{n as to}from"./icons-CVbUY4lM.js";var ao=Wr("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),ro=Wr("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),Yr="vercel.ai.error",so=Symbol.for(Yr),Hr,no=class Rn extends Error{constructor({name:e,message:a,cause:r}){super(a),this[Hr]=!0,this.name=e,this.cause=r}static isInstance(e){return Rn.hasMarker(e,Yr)}static hasMarker(e,a){let r=Symbol.for(a);return typeof e=="object"&&!!e&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};Hr=so;var at=no;function Gr(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Qr="AI_InvalidArgumentError",Xr=`vercel.ai.error.${Qr}`,io=Symbol.for(Xr),es,oo=class extends at{constructor({message:t,cause:e,argument:a}){super({name:Qr,message:t,cause:e}),this[es]=!0,this.argument=a}static isInstance(t){return at.hasMarker(t,Xr)}};es=io;var ts="AI_JSONParseError",as=`vercel.ai.error.${ts}`,lo=Symbol.for(as),rs,ss=class extends at{constructor({text:t,cause:e}){super({name:ts,message:`JSON parsing failed: Text: ${t}.
Error message: ${Gr(e)}`,cause:e}),this[rs]=!0,this.text=t}static isInstance(t){return at.hasMarker(t,as)}};rs=lo;var ns="AI_TypeValidationError",is=`vercel.ai.error.${ns}`,uo=Symbol.for(is),os,co=class Er extends at{constructor({value:e,cause:a}){super({name:ns,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${Gr(a)}`,cause:a}),this[os]=!0,this.value=e}static isInstance(e){return at.hasMarker(e,is)}static wrap({value:e,cause:a}){return Er.isInstance(a)&&a.value===e?a:new Er({value:e,cause:a})}};os=uo;var Xt=co,ls=class extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function Ra(t){}function po(t){if(typeof t=="function")throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=Ra,onError:a=Ra,onRetry:r=Ra,onComment:s}=t,n="",i=!0,o,l="",d="";function u(h){let p=i?h.replace(/^\xEF\xBB\xBF/,""):h,[m,_]=mo(`${n}${p}`);for(let x of m)c(x);n=_,i=!1}function c(h){if(h===""){f();return}if(h.startsWith(":")){s&&s(h.slice(h.startsWith(": ")?2:1));return}let p=h.indexOf(":");if(p!==-1){let m=h.slice(0,p),_=h[p+1]===" "?2:1;y(m,h.slice(p+_),h);return}y(h,"",h)}function y(h,p,m){switch(h){case"event":d=p;break;case"data":l=`${l}${p}
`;break;case"id":o=p.includes("\0")?void 0:p;break;case"retry":/^\d+$/.test(p)?r(parseInt(p,10)):a(new ls(`Invalid \`retry\` value: "${p}"`,{type:"invalid-retry",value:p,line:m}));break;default:a(new ls(`Unknown field "${h.length>20?`${h.slice(0,20)}\u2026`:h}"`,{type:"unknown-field",field:h,value:p,line:m}));break}}function f(){l.length>0&&e({id:o,event:d||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",d=""}function b(h={}){n&&h.consume&&c(n),i=!0,o=void 0,l="",d="",n=""}return{feed:u,reset:b}}function mo(t){let e=[],a="",r=0;for(;r<t.length;){let s=t.indexOf("\r",r),n=t.indexOf(`
`,r),i=-1;if(s!==-1&&n!==-1?i=Math.min(s,n):s===-1?n!==-1&&(i=n):i=s===t.length-1?-1:s,i===-1){a=t.slice(r);break}else{let o=t.slice(r,i);e.push(o),r=i+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,a]}var ho=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:a}={}){let r;super({start(s){r=po({onEvent:n=>{s.enqueue(n)},onError(n){t==="terminate"?s.error(n):typeof t=="function"&&t(n)},onRetry:e,onComment:a})},transform(s){r.feed(s)}})}},F;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function a(s){throw Error()}t.assertNever=a,t.arrayToEnum=s=>{let n={};for(let i of s)n[i]=i;return n},t.getValidEnumValues=s=>{let n=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(let o of n)i[o]=s[o];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(n){return s[n]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&n.push(i);return n},t.find=(s,n)=>{for(let i of s)if(n(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,n=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(n)}t.joinValues=r,t.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(F||(F={}));var fo;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(fo||(fo={}));const k=F.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),rt=t=>{switch(typeof t){case"undefined":return k.undefined;case"string":return k.string;case"number":return Number.isNaN(t)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(t)?k.array:t===null?k.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?k.promise:typeof Map<"u"&&t instanceof Map?k.map:typeof Set<"u"&&t instanceof Set?k.set:typeof Date<"u"&&t instanceof Date?k.date:k.object;default:return k.unknown}},g=F.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var Pe=class Nn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(n){return n.message},r={_errors:[]},s=n=>{for(let i of n.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(a(i));else{let o=r,l=0;for(;l<i.path.length;){let d=i.path[l];l===i.path.length-1?(o[d]=o[d]||{_errors:[]},o[d]._errors.push(a(i))):o[d]=o[d]||{_errors:[]},o=o[d],l++}}};return s(this),r}static assert(e){if(!(e instanceof Nn))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,F.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a=Object.create(null),r=[];for(let s of this.issues)if(s.path.length>0){let n=s.path[0];a[n]=a[n]||[],a[n].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};Pe.create=t=>new Pe(t);var Nt=(t,e)=>{let a;switch(t.code){case g.invalid_type:a=t.received===k.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case g.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,F.jsonStringifyReplacer)}`;break;case g.unrecognized_keys:a=`Unrecognized key(s) in object: ${F.joinValues(t.keys,", ")}`;break;case g.invalid_union:a="Invalid input";break;case g.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${F.joinValues(t.options)}`;break;case g.invalid_enum_value:a=`Invalid enum value. Expected ${F.joinValues(t.options)}, received '${t.received}'`;break;case g.invalid_arguments:a="Invalid function arguments";break;case g.invalid_return_type:a="Invalid function return type";break;case g.invalid_date:a="Invalid date";break;case g.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:F.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case g.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case g.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case g.custom:a="Invalid input";break;case g.invalid_intersection_types:a="Intersection results could not be merged";break;case g.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case g.not_finite:a="Number must be finite";break;default:a=e.defaultError,F.assertNever(t)}return{message:a}},go=Nt;function Na(){return go}const Ma=t=>{let{data:e,path:a,errorMaps:r,issueData:s}=t,n=[...a,...s.path||[]],i={...s,path:n};if(s.message!==void 0)return{...s,path:n,message:s.message};let o="",l=r.filter(d=>!!d).slice().reverse();for(let d of l)o=d(i,{data:e,defaultError:o}).message;return{...s,path:n,message:o}};function w(t,e){let a=Na(),r=Ma({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===Nt?void 0:Nt].filter(s=>!!s)});t.common.issues.push(r)}var ye=class Mn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let r=[];for(let s of a){if(s.status==="aborted")return A;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,a){let r=[];for(let s of a){let n=await s.key,i=await s.value;r.push({key:n,value:i})}return Mn.mergeObjectSync(e,r)}static mergeObjectSync(e,a){let r={};for(let s of a){let{key:n,value:i}=s;if(n.status==="aborted"||i.status==="aborted")return A;n.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(i.value!==void 0||s.alwaysSet)&&(r[n.value]=i.value)}return{status:e.value,value:r}}};const A=Object.freeze({status:"aborted"}),ja=t=>({status:"dirty",value:t}),he=t=>({status:"valid",value:t}),ds=t=>t.status==="aborted",us=t=>t.status==="dirty",bt=t=>t.status==="valid",ea=t=>typeof Promise<"u"&&t instanceof Promise;var T;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(T||(T={}));var Le=class{constructor(t,e,a,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},cs=(t,e)=>{if(bt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new Pe(t.common.issues)),this._error}}};function N(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:r,description:s}=t;if(e&&(a||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(n,i)=>{let{message:o}=t;return n.code==="invalid_enum_value"?{message:o??i.defaultError}:i.data===void 0?{message:o??r??i.defaultError}:n.code==="invalid_type"?{message:o??a??i.defaultError}:{message:i.defaultError}},description:s}}var P=class{get description(){return this._def.description}_getType(t){return rt(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:rt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ye,ctx:{common:t.parent.common,data:t.data,parsedType:rt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(ea(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:rt(t)};return cs(a,this._parseSync({data:t,path:a.path,parent:a}))}"~validate"(t){var a,r;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:rt(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:e});return bt(s)?{value:s.value}:{issues:e.common.issues}}catch(s){(r=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(s=>bt(s)?{value:s.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:rt(t)},r=this._parse({data:t,path:a.path,parent:a});return cs(a,await(ea(r)?r:Promise.resolve(r)))}refine(t,e){let a=r=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,s)=>{let n=t(r),i=()=>s.addIssue({code:g.custom,...a(r)});return typeof Promise<"u"&&n instanceof Promise?n.then(o=>o?!0:(i(),!1)):n?!0:(i(),!1)})}refinement(t,e){return this._refinement((a,r)=>t(a)?!0:(r.addIssue(typeof e=="function"?e(a,r):e),!1))}_refinement(t){return new We({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Ke.create(this,this._def)}nullable(){return ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return wt.create(this)}promise(){return Mt.create(this,this._def)}or(t){return sa.create([this,t],this._def)}and(t){return na.create(this,t,this._def)}transform(t){return new We({...N(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new ua({...N(this._def),innerType:this,defaultValue:e,typeName:v.ZodDefault})}brand(){return new gs({typeName:v.ZodBranded,type:this,...N(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new ca({...N(this._def),innerType:this,catchValue:e,typeName:v.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return ys.create(this,t)}readonly(){return pa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},yo=/^c[^\s-]{8,}$/i,vo=/^[0-9a-z]+$/,_o=/^[0-9A-HJKMNP-TV-Z]{26}$/i,bo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,xo=/^[a-z0-9_-]{21}$/i,wo=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ko=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Co=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Eo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",ps,To=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Io=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,So=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ao=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Oo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ro=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ms="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",No=RegExp(`^${ms}$`);function hs(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function Mo(t){return RegExp(`^${hs(t)}$`)}function jo(t){let e=`${ms}T${hs(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function Po(t,e){return!!((e==="v4"||!e)&&To.test(t)||(e==="v6"||!e)&&So.test(t))}function Lo(t,e){if(!wo.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||!s||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Do(t,e){return!!((e==="v4"||!e)&&Io.test(t)||(e==="v6"||!e)&&Ao.test(t))}var ta=class qt extends P{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_type,expected:k.string,received:s.parsedType}),A}let a=new ye,r;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let n=e.data.length>s.value,i=e.data.length<s.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?w(r,{code:g.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&w(r,{code:g.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")Co.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"email",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")ps||(ps=new RegExp(Eo,"u")),ps.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"emoji",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")bo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"uuid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")xo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"nanoid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")yo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")vo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid2",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")_o.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ulid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),w(r,{validation:"url",code:g.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"regex",code:g.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?jo(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?No.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?Mo(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?ko.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"duration",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?Po(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ip",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?Lo(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"jwt",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?Do(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cidr",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?Oo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?Ro.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64url",code:g.invalid_string,message:s.message}),a.dirty()):F.assertNever(s);return{status:a.value,value:e.data}}_regex(e,a,r){return this.refinement(s=>e.test(s),{validation:a,code:g.invalid_string,...T.errToObj(r)})}_addCheck(e){return new qt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...T.errToObj(e)})}url(e){return this._addCheck({kind:"url",...T.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...T.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...T.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...T.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...T.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...T.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...T.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...T.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...T.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...T.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...T.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...T.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...T.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...T.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...T.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...T.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...T.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...T.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...T.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...T.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...T.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...T.errToObj(a)})}nonempty(e){return this.min(1,T.errToObj(e))}trim(){return new qt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new qt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new qt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};ta.create=t=>new ta({checks:[],typeName:v.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...N(t)});function $o(t,e){let a=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=a>r?a:r;return Number.parseInt(t.toFixed(s).replace(".",""))%Number.parseInt(e.toFixed(s).replace(".",""))/10**s}var Pa=class Tr extends P{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_type,expected:k.number,received:s.parsedType}),A}let a,r=new ye;for(let s of this._def.checks)s.kind==="int"?F.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:g.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?$o(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:g.not_finite,message:s.message}),r.dirty()):F.assertNever(s);return{status:r.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,T.toString(a))}gt(e,a){return this.setLimit("min",e,!1,T.toString(a))}lte(e,a){return this.setLimit("max",e,!0,T.toString(a))}lt(e,a){return this.setLimit("max",e,!1,T.toString(a))}setLimit(e,a,r,s){return new Tr({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:T.toString(s)}]})}_addCheck(e){return new Tr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:T.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:T.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:T.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:T.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:T.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&F.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(a)&&Number.isFinite(e)}};Pa.create=t=>new Pa({checks:[],typeName:v.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...N(t)});var La=class Ir extends P{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let a,r=new ye;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):F.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return w(a,{code:g.invalid_type,expected:k.bigint,received:a.parsedType}),A}gte(e,a){return this.setLimit("min",e,!0,T.toString(a))}gt(e,a){return this.setLimit("min",e,!1,T.toString(a))}lte(e,a){return this.setLimit("max",e,!0,T.toString(a))}lt(e,a){return this.setLimit("max",e,!1,T.toString(a))}setLimit(e,a,r,s){return new Ir({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:T.toString(s)}]})}_addCheck(e){return new Ir({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:T.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};La.create=t=>new La({checks:[],typeName:v.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...N(t)});var Da=class extends P{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==k.boolean){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.boolean,received:e.parsedType}),A}return he(t.data)}};Da.create=t=>new Da({typeName:v.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...N(t)});var $a=class jn extends P{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_type,expected:k.date,received:s.parsedType}),A}if(Number.isNaN(e.data.getTime()))return w(this._getOrReturnCtx(e),{code:g.invalid_date}),A;let a=new ye,r;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):F.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new jn({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:T.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:T.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};$a.create=t=>new $a({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:v.ZodDate,...N(t)});var Za=class extends P{_parse(t){if(this._getType(t)!==k.symbol){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.symbol,received:e.parsedType}),A}return he(t.data)}};Za.create=t=>new Za({typeName:v.ZodSymbol,...N(t)});var aa=class extends P{_parse(t){if(this._getType(t)!==k.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.undefined,received:e.parsedType}),A}return he(t.data)}};aa.create=t=>new aa({typeName:v.ZodUndefined,...N(t)});var ra=class extends P{_parse(t){if(this._getType(t)!==k.null){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.null,received:e.parsedType}),A}return he(t.data)}};ra.create=t=>new ra({typeName:v.ZodNull,...N(t)});var Fa=class extends P{constructor(){super(...arguments),this._any=!0}_parse(t){return he(t.data)}};Fa.create=t=>new Fa({typeName:v.ZodAny,...N(t)});var xt=class extends P{constructor(){super(...arguments),this._unknown=!0}_parse(t){return he(t.data)}};xt.create=t=>new xt({typeName:v.ZodUnknown,...N(t)});var st=class extends P{_parse(t){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.never,received:e.parsedType}),A}};st.create=t=>new st({typeName:v.ZodNever,...N(t)});var za=class extends P{_parse(t){if(this._getType(t)!==k.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.void,received:e.parsedType}),A}return he(t.data)}};za.create=t=>new za({typeName:v.ZodVoid,...N(t)});var wt=class Ca extends P{_parse(e){let{ctx:a,status:r}=this._processInputParams(e),s=this._def;if(a.parsedType!==k.array)return w(a,{code:g.invalid_type,expected:k.array,received:a.parsedType}),A;if(s.exactLength!==null){let i=a.data.length>s.exactLength.value,o=a.data.length<s.exactLength.value;(i||o)&&(w(a,{code:i?g.too_big:g.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&a.data.length<s.minLength.value&&(w(a,{code:g.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&a.data.length>s.maxLength.value&&(w(a,{code:g.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((i,o)=>s.type._parseAsync(new Le(a,i,a.path,o)))).then(i=>ye.mergeArray(r,i));let n=[...a.data].map((i,o)=>s.type._parseSync(new Le(a,i,a.path,o)));return ye.mergeArray(r,n)}get element(){return this._def.type}min(e,a){return new Ca({...this._def,minLength:{value:e,message:T.toString(a)}})}max(e,a){return new Ca({...this._def,maxLength:{value:e,message:T.toString(a)}})}length(e,a){return new Ca({...this._def,exactLength:{value:e,message:T.toString(a)}})}nonempty(e){return this.min(1,e)}};wt.create=(t,e)=>new wt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...N(e)});function kt(t){if(t instanceof Te){let e={};for(let a in t.shape){let r=t.shape[a];e[a]=Ke.create(kt(r))}return new Te({...t._def,shape:()=>e})}else return t instanceof wt?new wt({...t._def,type:kt(t.element)}):t instanceof Ke?Ke.create(kt(t.unwrap())):t instanceof ct?ct.create(kt(t.unwrap())):t instanceof ut?ut.create(t.items.map(e=>kt(e))):t}var Te=class Oe extends P{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:F.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==k.object){let l=this._getOrReturnCtx(e);return w(l,{code:g.invalid_type,expected:k.object,received:l.parsedType}),A}let{status:a,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),i=[];if(!(this._def.catchall instanceof st&&this._def.unknownKeys==="strip"))for(let l in r.data)n.includes(l)||i.push(l);let o=[];for(let l of n){let d=s[l],u=r.data[l];o.push({key:{status:"valid",value:l},value:d._parse(new Le(r,u,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof st){let l=this._def.unknownKeys;if(l==="passthrough")for(let d of i)o.push({key:{status:"valid",value:d},value:{status:"valid",value:r.data[d]}});else if(l==="strict")i.length>0&&(w(r,{code:g.unrecognized_keys,keys:i}),a.dirty());else if(l!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let d of i){let u=r.data[d];o.push({key:{status:"valid",value:d},value:l._parse(new Le(r,u,r.path,d)),alwaysSet:d in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let l=[];for(let d of o){let u=await d.key,c=await d.value;l.push({key:u,value:c,alwaysSet:d.alwaysSet})}return l}).then(l=>ye.mergeObjectSync(a,l)):ye.mergeObjectSync(a,o)}get shape(){return this._def.shape()}strict(e){return T.errToObj,new Oe({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,r)=>{var n,i;let s=((i=(n=this._def).errorMap)==null?void 0:i.call(n,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:T.errToObj(e).message??s}:{message:s}}}})}strip(){return new Oe({...this._def,unknownKeys:"strip"})}passthrough(){return new Oe({...this._def,unknownKeys:"passthrough"})}extend(e){return new Oe({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Oe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new Oe({...this._def,catchall:e})}pick(e){let a={};for(let r of F.objectKeys(e))e[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new Oe({...this._def,shape:()=>a})}omit(e){let a={};for(let r of F.objectKeys(this.shape))e[r]||(a[r]=this.shape[r]);return new Oe({...this._def,shape:()=>a})}deepPartial(){return kt(this)}partial(e){let a={};for(let r of F.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?a[r]=s:a[r]=s.optional()}return new Oe({...this._def,shape:()=>a})}required(e){let a={};for(let r of F.objectKeys(this.shape))if(e&&!e[r])a[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Ke;)s=s._def.innerType;a[r]=s}return new Oe({...this._def,shape:()=>a})}keyof(){return fs(F.objectKeys(this.shape))}};Te.create=(t,e)=>new Te({shape:()=>t,unknownKeys:"strip",catchall:st.create(),typeName:v.ZodObject,...N(e)}),Te.strictCreate=(t,e)=>new Te({shape:()=>t,unknownKeys:"strict",catchall:st.create(),typeName:v.ZodObject,...N(e)}),Te.lazycreate=(t,e)=>new Te({shape:t,unknownKeys:"strip",catchall:st.create(),typeName:v.ZodObject,...N(e)});var sa=class extends P{_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function r(s){for(let i of s)if(i.result.status==="valid")return i.result;for(let i of s)if(i.result.status==="dirty")return e.common.issues.push(...i.ctx.common.issues),i.result;let n=s.map(i=>new Pe(i.ctx.common.issues));return w(e,{code:g.invalid_union,unionErrors:n}),A}if(e.common.async)return Promise.all(a.map(async s=>{let n={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}})).then(r);{let s,n=[];for(let o of a){let l={...e,common:{...e.common,issues:[]},parent:null},d=o._parseSync({data:e.data,path:e.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:l}),l.common.issues.length&&n.push(l.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;let i=n.map(o=>new Pe(o));return w(e,{code:g.invalid_union,unionErrors:i}),A}}get options(){return this._def.options}};sa.create=(t,e)=>new sa({options:t,typeName:v.ZodUnion,...N(e)});var nt=t=>t instanceof ia?nt(t.schema):t instanceof We?nt(t.innerType()):t instanceof oa?[t.value]:t instanceof la?t.options:t instanceof da?F.objectValues(t.enum):t instanceof ua?nt(t._def.innerType):t instanceof aa?[void 0]:t instanceof ra?[null]:t instanceof Ke?[void 0,...nt(t.unwrap())]:t instanceof ct?[null,...nt(t.unwrap())]:t instanceof gs||t instanceof pa?nt(t.unwrap()):t instanceof ca?nt(t._def.innerType):[],Zo=class Pn extends P{_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==k.object)return w(a,{code:g.invalid_type,expected:k.object,received:a.parsedType}),A;let r=this.discriminator,s=a.data[r],n=this.optionsMap.get(s);return n?a.common.async?n._parseAsync({data:a.data,path:a.path,parent:a}):n._parseSync({data:a.data,path:a.path,parent:a}):(w(a,{code:g.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),A)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,r){let s=new Map;for(let n of a){let i=nt(n.shape[e]);if(!i.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(s.has(o))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,n)}}return new Pn({typeName:v.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:s,...N(r)})}};function Ua(t,e){let a=rt(t),r=rt(e);if(t===e)return{valid:!0,data:t};if(a===k.object&&r===k.object){let s=F.objectKeys(e),n=F.objectKeys(t).filter(o=>s.indexOf(o)!==-1),i={...t,...e};for(let o of n){let l=Ua(t[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(a===k.array&&r===k.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let i=t[n],o=e[n],l=Ua(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return a===k.date&&r===k.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var na=class extends P{_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=(s,n)=>{if(ds(s)||ds(n))return A;let i=Ua(s.value,n.value);return i.valid?((us(s)||us(n))&&e.dirty(),{status:e.value,value:i.data}):(w(a,{code:g.invalid_intersection_types}),A)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,n])=>r(s,n)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};na.create=(t,e,a)=>new na({left:t,right:e,typeName:v.ZodIntersection,...N(a)});var ut=class Ln extends P{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.array)return w(r,{code:g.invalid_type,expected:k.array,received:r.parsedType}),A;if(r.data.length<this._def.items.length)return w(r,{code:g.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),A;!this._def.rest&&r.data.length>this._def.items.length&&(w(r,{code:g.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let s=[...r.data].map((n,i)=>{let o=this._def.items[i]||this._def.rest;return o?o._parse(new Le(r,n,r.path,i)):null}).filter(n=>!!n);return r.common.async?Promise.all(s).then(n=>ye.mergeArray(a,n)):ye.mergeArray(a,s)}get items(){return this._def.items}rest(e){return new Ln({...this._def,rest:e})}};ut.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ut({items:t,typeName:v.ZodTuple,rest:null,...N(e)})};var Fo=class Sr extends P{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.object)return w(r,{code:g.invalid_type,expected:k.object,received:r.parsedType}),A;let s=[],n=this._def.keyType,i=this._def.valueType;for(let o in r.data)s.push({key:n._parse(new Le(r,o,r.path,o)),value:i._parse(new Le(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?ye.mergeObjectAsync(a,s):ye.mergeObjectSync(a,s)}get element(){return this._def.valueType}static create(e,a,r){return a instanceof P?new Sr({keyType:e,valueType:a,typeName:v.ZodRecord,...N(r)}):new Sr({keyType:ta.create(),valueType:e,typeName:v.ZodRecord,...N(a)})}},Va=class extends P{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==k.map)return w(a,{code:g.invalid_type,expected:k.map,received:a.parsedType}),A;let r=this._def.keyType,s=this._def.valueType,n=[...a.data.entries()].map(([i,o],l)=>({key:r._parse(new Le(a,i,a.path,[l,"key"])),value:s._parse(new Le(a,o,a.path,[l,"value"]))}));if(a.common.async){let i=new Map;return Promise.resolve().then(async()=>{for(let o of n){let l=await o.key,d=await o.value;if(l.status==="aborted"||d.status==="aborted")return A;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),i.set(l.value,d.value)}return{status:e.value,value:i}})}else{let i=new Map;for(let o of n){let l=o.key,d=o.value;if(l.status==="aborted"||d.status==="aborted")return A;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),i.set(l.value,d.value)}return{status:e.value,value:i}}}};Va.create=(t,e,a)=>new Va({valueType:e,keyType:t,typeName:v.ZodMap,...N(a)});var qa=class Ar extends P{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.set)return w(r,{code:g.invalid_type,expected:k.set,received:r.parsedType}),A;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(w(r,{code:g.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),a.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(w(r,{code:g.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),a.dirty());let n=this._def.valueType;function i(l){let d=new Set;for(let u of l){if(u.status==="aborted")return A;u.status==="dirty"&&a.dirty(),d.add(u.value)}return{status:a.value,value:d}}let o=[...r.data.values()].map((l,d)=>n._parse(new Le(r,l,r.path,d)));return r.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,a){return new Ar({...this._def,minSize:{value:e,message:T.toString(a)}})}max(e,a){return new Ar({...this._def,maxSize:{value:e,message:T.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};qa.create=(t,e)=>new qa({valueType:t,minSize:null,maxSize:null,typeName:v.ZodSet,...N(e)});var zo=class Ea extends P{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==k.function)return w(a,{code:g.invalid_type,expected:k.function,received:a.parsedType}),A;function r(o,l){return Ma({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Na(),Nt].filter(d=>!!d),issueData:{code:g.invalid_arguments,argumentsError:l}})}function s(o,l){return Ma({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Na(),Nt].filter(d=>!!d),issueData:{code:g.invalid_return_type,returnTypeError:l}})}let n={errorMap:a.common.contextualErrorMap},i=a.data;if(this._def.returns instanceof Mt){let o=this;return he(async function(...l){let d=new Pe([]),u=await o._def.args.parseAsync(l,n).catch(y=>{throw d.addIssue(r(l,y)),d}),c=await Reflect.apply(i,this,u);return await o._def.returns._def.type.parseAsync(c,n).catch(y=>{throw d.addIssue(s(c,y)),d})})}else{let o=this;return he(function(...l){let d=o._def.args.safeParse(l,n);if(!d.success)throw new Pe([r(l,d.error)]);let u=Reflect.apply(i,this,d.data),c=o._def.returns.safeParse(u,n);if(!c.success)throw new Pe([s(u,c.error)]);return c.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Ea({...this._def,args:ut.create(e).rest(xt.create())})}returns(e){return new Ea({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,r){return new Ea({args:e||ut.create([]).rest(xt.create()),returns:a||xt.create(),typeName:v.ZodFunction,...N(r)})}},ia=class extends P{get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};ia.create=(t,e)=>new ia({getter:t,typeName:v.ZodLazy,...N(e)});var oa=class extends P{_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return w(e,{received:e.data,code:g.invalid_literal,expected:this._def.value}),A}return{status:"valid",value:t.data}}get value(){return this._def.value}};oa.create=(t,e)=>new oa({value:t,typeName:v.ZodLiteral,...N(e)});function fs(t,e){return new la({values:t,typeName:v.ZodEnum,...N(e)})}var la=class Or extends P{_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{expected:F.joinValues(r),received:a.parsedType,code:g.invalid_type}),A}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{received:a.data,code:g.invalid_enum_value,options:r}),A}return he(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return Or.create(e,{...this._def,...a})}exclude(e,a=this._def){return Or.create(this.options.filter(r=>!e.includes(r)),{...this._def,...a})}};la.create=fs;var da=class extends P{_parse(t){let e=F.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==k.string&&a.parsedType!==k.number){let r=F.objectValues(e);return w(a,{expected:F.joinValues(r),received:a.parsedType,code:g.invalid_type}),A}if(this._cache||(this._cache=new Set(F.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let r=F.objectValues(e);return w(a,{received:a.data,code:g.invalid_enum_value,options:r}),A}return he(t.data)}get enum(){return this._def.values}};da.create=(t,e)=>new da({values:t,typeName:v.ZodNativeEnum,...N(e)});var Mt=class extends P{unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);return e.parsedType!==k.promise&&e.common.async===!1?(w(e,{code:g.invalid_type,expected:k.promise,received:e.parsedType}),A):he((e.parsedType===k.promise?e.data:Promise.resolve(e.data)).then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}};Mt.create=(t,e)=>new Mt({type:t,typeName:v.ZodPromise,...N(e)});var We=class extends P{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=this._def.effect||null,s={addIssue:n=>{w(a,n),n.fatal?e.abort():e.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){let n=r.transform(a.data,s);if(a.common.async)return Promise.resolve(n).then(async i=>{if(e.value==="aborted")return A;let o=await this._def.schema._parseAsync({data:i,path:a.path,parent:a});return o.status==="aborted"?A:o.status==="dirty"||e.value==="dirty"?ja(o.value):o});{if(e.value==="aborted")return A;let i=this._def.schema._parseSync({data:n,path:a.path,parent:a});return i.status==="aborted"?A:i.status==="dirty"||e.value==="dirty"?ja(i.value):i}}if(r.type==="refinement"){let n=i=>{let o=r.refinement(i,s);if(a.common.async)return Promise.resolve(o);if(o instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?A:(i.status==="dirty"&&e.dirty(),n(i.value),{status:e.value,value:i.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>i.status==="aborted"?A:(i.status==="dirty"&&e.dirty(),n(i.value).then(()=>({status:e.value,value:i.value}))))}if(r.type==="transform")if(a.common.async===!1){let n=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!bt(n))return A;let i=r.transform(n.value,s);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:i}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(n=>bt(n)?Promise.resolve(r.transform(n.value,s)).then(i=>({status:e.value,value:i})):A);F.assertNever(r)}};We.create=(t,e,a)=>new We({schema:t,typeName:v.ZodEffects,effect:e,...N(a)}),We.createWithPreprocess=(t,e,a)=>new We({schema:e,effect:{type:"preprocess",transform:t},typeName:v.ZodEffects,...N(a)});var Ke=class extends P{_parse(t){return this._getType(t)===k.undefined?he(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Ke.create=(t,e)=>new Ke({innerType:t,typeName:v.ZodOptional,...N(e)});var ct=class extends P{_parse(t){return this._getType(t)===k.null?he(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};ct.create=(t,e)=>new ct({innerType:t,typeName:v.ZodNullable,...N(e)});var ua=class extends P{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===k.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};ua.create=(t,e)=>new ua({innerType:t,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...N(e)});var ca=class extends P{_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return ea(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Pe(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Pe(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};ca.create=(t,e)=>new ca({innerType:t,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...N(e)});var Ba=class extends P{_parse(t){if(this._getType(t)!==k.nan){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.nan,received:e.parsedType}),A}return{status:"valid",value:t.data}}};Ba.create=t=>new Ba({typeName:v.ZodNaN,...N(t)});var gs=class extends P{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},ys=class Dn extends P{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?A:s.status==="dirty"?(a.dirty(),ja(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?A:s.status==="dirty"?(a.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,a){return new Dn({in:e,out:a,typeName:v.ZodPipeline})}},pa=class extends P{_parse(t){let e=this._def.innerType._parse(t),a=r=>(bt(r)&&(r.value=Object.freeze(r.value)),r);return ea(e)?e.then(r=>a(r)):a(e)}unwrap(){return this._def.innerType}};pa.create=(t,e)=>new pa({innerType:t,typeName:v.ZodReadonly,...N(e)}),Te.lazycreate;var v;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(v||(v={})),ta.create,Pa.create,Ba.create,La.create,Da.create,$a.create,Za.create,aa.create,ra.create,Fa.create,xt.create,st.create,za.create,wt.create,Te.create,Te.strictCreate,sa.create,Zo.create,na.create,ut.create,Fo.create,Va.create,qa.create,zo.create,ia.create,oa.create,la.create,da.create,Mt.create,We.create,Ke.create,ct.create,We.createWithPreprocess,ys.create;var jt=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,i=Array(e);for(let o=0;o<e;o++)i[o]=a[Math.random()*n|0];return i.join("")};if(t==null)return s;if(a.includes(r))throw new oo({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`},Uo=jt();function Wa(t=globalThis){var e,a,r;return t.window?"runtime/browser":(e=t.navigator)!=null&&e.userAgent?`runtime/${t.navigator.userAgent.toLowerCase()}`:(r=(a=t.process)==null?void 0:a.versions)!=null&&r.node?`runtime/node.js/${t.process.version.substring(0)}`:t.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function pt(t){if(t==null)return{};let e={};if(t instanceof Headers)t.forEach((a,r)=>{e[r.toLowerCase()]=a});else{Array.isArray(t)||(t=Object.entries(t));for(let[a,r]of t)r!=null&&(e[a.toLowerCase()]=r)}return e}function Ka(t,...e){let a=new Headers(pt(t)),r=a.get("user-agent")||"";return a.set("user-agent",[r,...e].filter(Boolean).join(" ")),Object.fromEntries(a.entries())}var Vo=/"__proto__"\s*:/,qo=/"constructor"\s*:/;function vs(t){let e=JSON.parse(t);return typeof e!="object"||!e||Vo.test(t)===!1&&qo.test(t)===!1?e:Bo(e)}function Bo(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function Wo(t){let{stackTraceLimit:e}=Error;try{Error.stackTraceLimit=0}catch{return vs(t)}try{return vs(t)}finally{Error.stackTraceLimit=e}}var ma=Symbol.for("vercel.ai.validator");function Ko(t){return{[ma]:!0,validate:t}}function Jo(t){return typeof t=="object"&&!!t&&ma in t&&t[ma]===!0&&"validate"in t}function Yo(t){let e;return()=>(e??(e=t()),e)}function Ho(t){return Jo(t)?t:typeof t=="function"?t():Go(t)}function Go(t){return Ko(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new Xt({value:e,cause:a.issues})}})}async function _s({value:t,schema:e}){let a=await Ja({value:t,schema:e});if(!a.success)throw Xt.wrap({value:t,cause:a.error});return a.value}async function Ja({value:t,schema:e}){let a=Ho(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:Xt.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:Xt.wrap({value:t,cause:r}),rawValue:t}}}async function ha({text:t,schema:e}){try{let a=Wo(t);return e==null?{success:!0,value:a,rawValue:a}:await Ja({value:a,schema:e})}catch(a){return{success:!1,error:ss.isInstance(a)?a:new ss({text:t,cause:a}),rawValue:void 0}}}function bs({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new ho).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await ha({text:a,schema:e}))}}))}async function Ct(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}var Qo=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},Xo=Symbol("Let zodToJsonSchema decide on which parser to use"),xs={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},el=t=>typeof t=="string"?{...xs,name:t}:{...xs,...t};function ve(){return{}}function tl(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==v.ZodAny&&(a.items=q(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function al(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function rl(){return{type:"boolean"}}function ws(t,e){return q(t.type._def,e)}var sl=(t,e)=>q(t.innerType._def,e);function ks(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>ks(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return nl(t)}}var nl=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function il(t,e){return{...q(t.innerType._def,e),default:t.defaultValue()}}function ol(t,e){return e.effectStrategy==="input"?q(t.schema._def,e):ve()}function ll(t){return{type:"string",enum:Array.from(t.values)}}var dl=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function ul(t,e){let a=[q(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),q(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(dl(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:i,...o}=s;n=o}r.push(n)}}),r.length?{allOf:r}:void 0}function cl(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var Ya=void 0,Ie={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ya===void 0&&(Ya=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ya),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Cs(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Se(a,"email",r.message,e);break;case"format:idn-email":Se(a,"idn-email",r.message,e);break;case"pattern:zod":ce(a,Ie.email,r.message,e);break}break;case"url":Se(a,"uri",r.message,e);break;case"uuid":Se(a,"uuid",r.message,e);break;case"regex":ce(a,r.regex,r.message,e);break;case"cuid":ce(a,Ie.cuid,r.message,e);break;case"cuid2":ce(a,Ie.cuid2,r.message,e);break;case"startsWith":ce(a,RegExp(`^${Ha(r.value,e)}`),r.message,e);break;case"endsWith":ce(a,RegExp(`${Ha(r.value,e)}$`),r.message,e);break;case"datetime":Se(a,"date-time",r.message,e);break;case"date":Se(a,"date",r.message,e);break;case"time":Se(a,"time",r.message,e);break;case"duration":Se(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":ce(a,RegExp(Ha(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&Se(a,"ipv4",r.message,e),r.version!=="v4"&&Se(a,"ipv6",r.message,e);break;case"base64url":ce(a,Ie.base64url,r.message,e);break;case"jwt":ce(a,Ie.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&ce(a,Ie.ipv4Cidr,r.message,e),r.version!=="v4"&&ce(a,Ie.ipv6Cidr,r.message,e);break;case"emoji":ce(a,Ie.emoji(),r.message,e);break;case"ulid":ce(a,Ie.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Se(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":ce(a,Ie.base64,r.message,e);break}break;case"nanoid":ce(a,Ie.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function Ha(t,e){return e.patternStrategy==="escape"?ml(t):t}var pl=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ml(t){let e="";for(let a=0;a<t.length;a++)pl.has(t[a])||(e+="\\"),e+=t[a];return e}function Se(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function ce(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:Es(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=Es(e,r)}function Es(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,i=!1,o=!1;for(let d=0;d<r.length;d++){if(n){s+=r[d],n=!1;continue}if(a.i){if(i){if(r[d].match(/[a-z]/)){o?(s+=r[d],s+=`${r[d-2]}-${r[d]}`.toUpperCase(),o=!1):r[d+1]==="-"&&((l=r[d+2])!=null&&l.match(/[a-z]/))?(s+=r[d],o=!0):s+=`${r[d]}${r[d].toUpperCase()}`;continue}}else if(r[d].match(/[a-z]/)){s+=`[${r[d]}${r[d].toUpperCase()}]`;continue}}if(a.m){if(r[d]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[d]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[d]==="."){s+=i?`${r[d]}\r
`:`[${r[d]}\r
]`;continue}s+=r[d],r[d]==="\\"?n=!0:i&&r[d]==="]"?i=!1:!i&&r[d]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function Ts(t,e){var r,s,n,i,o;let a={type:"object",additionalProperties:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===v.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:l,...d}=Cs(t.keyType._def,e);return{...a,propertyNames:d}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===v.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((i=t.keyType)==null?void 0:i._def.typeName)===v.ZodBranded&&t.keyType._def.type._def.typeName===v.ZodString&&((o=t.keyType._def.type._def.checks)!=null&&o.length)){let{type:l,...d}=ws(t.keyType._def,e);return{...a,propertyNames:d}}}return a}function hl(t,e){return e.mapStrategy==="record"?Ts(t,e):{type:"array",maxItems:125,items:{type:"array",items:[q(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ve(),q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ve()],minItems:2,maxItems:2}}}function fl(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function gl(){return{not:ve()}}function yl(){return{type:"null"}}var Ga={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function vl(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in Ga&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let i=Ga[n._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let i=typeof n._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===a.length){let s=r.filter((n,i,o)=>o.indexOf(n)===i);return{type:s.length>1?s:s[0],enum:a.reduce((n,i)=>n.includes(i._def.value)?n:[...n,i._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return _l(t,e)}var _l=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>q(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function bl(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[Ga[t.innerType._def.typeName],"null"]};let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function xl(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function wl(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let i in s){let o=s[i];if(o===void 0||o._def===void 0)continue;let l=Cl(o),d=q(o._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});d!==void 0&&(a.properties[i]=d,l||r.push(i))}r.length&&(a.required=r);let n=kl(t,e);return n!==void 0&&(a.additionalProperties=n),a}function kl(t,e){if(t.catchall._def.typeName!=="ZodNever")return q(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Cl(t){try{return t.isOptional()}catch{return!0}}var El=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return q(t.innerType._def,e);let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:ve()},a]}:ve()},Tl=(t,e)=>{if(e.pipeStrategy==="input")return q(t.in._def,e);if(e.pipeStrategy==="output")return q(t.out._def,e);let a=q(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]});return{allOf:[a,q(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]})].filter(r=>r!==void 0)}};function Il(t,e){return q(t.type._def,e)}function Sl(t,e){let a={type:"array",uniqueItems:!0,items:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function Al(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:q(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function Ol(){return{not:ve()}}function Rl(){return ve()}var Nl=(t,e)=>q(t.innerType._def,e),Ml=(t,e,a)=>{switch(e){case v.ZodString:return Cs(t,a);case v.ZodNumber:return xl(t);case v.ZodObject:return wl(t,a);case v.ZodBigInt:return al(t);case v.ZodBoolean:return rl();case v.ZodDate:return ks(t,a);case v.ZodUndefined:return Ol();case v.ZodNull:return yl();case v.ZodArray:return tl(t,a);case v.ZodUnion:case v.ZodDiscriminatedUnion:return vl(t,a);case v.ZodIntersection:return ul(t,a);case v.ZodTuple:return Al(t,a);case v.ZodRecord:return Ts(t,a);case v.ZodLiteral:return cl(t);case v.ZodEnum:return ll(t);case v.ZodNativeEnum:return fl(t);case v.ZodNullable:return bl(t,a);case v.ZodOptional:return El(t,a);case v.ZodMap:return hl(t,a);case v.ZodSet:return Sl(t,a);case v.ZodLazy:return()=>t.getter()._def;case v.ZodPromise:return Il(t,a);case v.ZodNaN:case v.ZodNever:return gl();case v.ZodEffects:return ol(t,a);case v.ZodAny:return ve();case v.ZodUnknown:return Rl();case v.ZodDefault:return il(t,a);case v.ZodBranded:return ws(t,a);case v.ZodReadonly:return Nl(t,a);case v.ZodCatch:return sl(t,a);case v.ZodPipeline:return Tl(t,a);case v.ZodFunction:case v.ZodVoid:case v.ZodSymbol:return;default:return(r=>{})(e)}};function q(t,e,a=!1){var o;let r=e.seen.get(t);if(e.override){let l=(o=e.override)==null?void 0:o.call(e,t,e,r,a);if(l!==Xo)return l}if(r&&!a){let l=jl(r,e);if(l!==void 0)return l}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=Ml(t,t.typeName,e),i=typeof n=="function"?q(n(),e):n;if(i&&Pl(t,e,i),e.postProcess){let l=e.postProcess(i,t,e);return s.jsonSchema=i,l}return s.jsonSchema=i,i}var jl=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:Qo(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ve()):e.$refStrategy==="seen"?ve():void 0}},Pl=(t,e,a)=>(t.description&&(a.description=t.description),a),Ll=t=>{let e=el(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},Dl=(t,e)=>{let a=Ll(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[d,u])=>({...l,[d]:q(u._def,{...a,currentPath:[...a.basePath,a.definitionPath,d]},!0)??ve()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=q(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??ve(),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(n.title=i);let o=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return o.$schema="http://json-schema.org/draft-07/schema#",o};function $l(t,e){let a=(e==null?void 0:e.useReferences)??!1;return Xa(()=>Dl(t,{$refStrategy:a?"root":"none"}),{validate:async r=>{let s=await t.safeParseAsync(r);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function Zl(t,e){let a=(e==null?void 0:e.useReferences)??!1;return Xa(()=>Fr(t,{target:"draft-7",io:"output",reused:a?"ref":"inline"}),{validate:async r=>{let s=await di(t,r);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function Fl(t){return"_zod"in t}function Is(t,e){return Fl(t)?Zl(t,e):$l(t,e)}var Qa=Symbol.for("vercel.ai.schema");function Xa(t,{validate:e}={}){return{[Qa]:!0,_type:void 0,[ma]:!0,get jsonSchema(){return typeof t=="function"&&(t=t()),t},validate:e}}function zl(t){return typeof t=="object"&&!!t&&Qa in t&&t[Qa]===!0&&"jsonSchema"in t&&"validate"in t}function Ul(t){return t==null?Xa({properties:{},additionalProperties:!1}):zl(t)?t:typeof t=="function"?t():Is(t)}var{btoa:Zc,atob:Fc}=globalThis,Vl=Object.defineProperty,ql=(t,e)=>{for(var a in e)Vl(t,a,{get:e[a],enumerable:!0})},Ss="AI_NoObjectGeneratedError",As=`vercel.ai.error.${Ss}`,Bl=Symbol.for(As),Os,Rs=class extends at{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:Ss,message:t,cause:e}),this[Os]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return at.hasMarker(t,As)}};Os=Bl;var er="5.0.105",Ns=Ee([E(),Yt(Uint8Array),Yt(ArrayBuffer),Dr(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),Pt=ui(()=>Ee([ci(),E(),Zr(),de(),St(E(),Pt),Be(Pt)])),ne=St(E(),St(E(),Pt)),Ms=G({type:M("text"),text:E(),providerOptions:ne.optional()}),Wl=G({type:M("image"),image:Ee([Ns,Yt(URL)]),mediaType:E().optional(),providerOptions:ne.optional()}),js=G({type:M("file"),data:Ee([Ns,Yt(URL)]),filename:E().optional(),mediaType:E(),providerOptions:ne.optional()}),Kl=G({type:M("reasoning"),text:E(),providerOptions:ne.optional()}),Jl=G({type:M("tool-call"),toolCallId:E(),toolName:E(),input:qe(),providerOptions:ne.optional(),providerExecuted:de().optional()}),Yl=li("type",[G({type:M("text"),value:E()}),G({type:M("json"),value:Pt}),G({type:M("error-text"),value:E()}),G({type:M("error-json"),value:Pt}),G({type:M("content"),value:Be(Ee([G({type:M("text"),text:E()}),G({type:M("media"),data:E(),mediaType:E()})]))})]),Ps=G({type:M("tool-result"),toolCallId:E(),toolName:E(),output:Yl,providerOptions:ne.optional()});Ee([G({role:M("system"),content:E(),providerOptions:ne.optional()}),G({role:M("user"),content:Ee([E(),Be(Ee([Ms,Wl,js]))]),providerOptions:ne.optional()}),G({role:M("assistant"),content:Ee([E(),Be(Ee([Ms,js,Kl,Jl,Ps]))]),providerOptions:ne.optional()}),G({role:M("tool"),content:Be(Ps),providerOptions:ne.optional()})]),jt({prefix:"aitxt",size:24});var Ls=Yo(()=>Is(Ee([ee({type:M("text-start"),id:E(),providerMetadata:ne.optional()}),ee({type:M("text-delta"),id:E(),delta:E(),providerMetadata:ne.optional()}),ee({type:M("text-end"),id:E(),providerMetadata:ne.optional()}),ee({type:M("error"),errorText:E()}),ee({type:M("tool-input-start"),toolCallId:E(),toolName:E(),providerExecuted:de().optional(),dynamic:de().optional()}),ee({type:M("tool-input-delta"),toolCallId:E(),inputTextDelta:E()}),ee({type:M("tool-input-available"),toolCallId:E(),toolName:E(),input:qe(),providerExecuted:de().optional(),providerMetadata:ne.optional(),dynamic:de().optional()}),ee({type:M("tool-input-error"),toolCallId:E(),toolName:E(),input:qe(),providerExecuted:de().optional(),providerMetadata:ne.optional(),dynamic:de().optional(),errorText:E()}),ee({type:M("tool-output-available"),toolCallId:E(),output:qe(),providerExecuted:de().optional(),dynamic:de().optional(),preliminary:de().optional()}),ee({type:M("tool-output-error"),toolCallId:E(),errorText:E(),providerExecuted:de().optional(),dynamic:de().optional()}),ee({type:M("reasoning-start"),id:E(),providerMetadata:ne.optional()}),ee({type:M("reasoning-delta"),id:E(),delta:E(),providerMetadata:ne.optional()}),ee({type:M("reasoning-end"),id:E(),providerMetadata:ne.optional()}),ee({type:M("source-url"),sourceId:E(),url:E(),title:E().optional(),providerMetadata:ne.optional()}),ee({type:M("source-document"),sourceId:E(),mediaType:E(),title:E(),filename:E().optional(),providerMetadata:ne.optional()}),ee({type:M("file"),url:E(),mediaType:E(),providerMetadata:ne.optional()}),ee({type:Dr(t=>typeof t=="string"&&t.startsWith("data-"),{message:'Type must start with "data-"'}),id:E().optional(),data:qe(),transient:de().optional()}),ee({type:M("start-step")}),ee({type:M("finish-step")}),ee({type:M("start"),messageId:E().optional(),messageMetadata:qe().optional()}),ee({type:M("finish"),finishReason:Jt(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:qe().optional()}),ee({type:M("abort")}),ee({type:M("message-metadata"),messageMetadata:qe()})])));function Hl(t){return t.type.startsWith("data-")}function Ds(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;let a={...t};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let s=e[r];if(s===void 0)continue;let n=r in t?t[r]:void 0,i=typeof s=="object"&&!!s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),o=typeof n=="object"&&!!n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);i&&o?a[r]=Ds(n,s):a[r]=s}return a}function Gl(t){let e=["ROOT"],a=-1,r=null;function s(l,d,u){switch(l){case'"':a=d,e.pop(),e.push(u),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=d,r=d,e.pop(),e.push(u),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=d,e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"{":a=d,e.pop(),e.push(u),e.push("INSIDE_OBJECT_START");break;case"[":a=d,e.pop(),e.push(u),e.push("INSIDE_ARRAY_START");break}}function n(l,d){switch(l){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=d,e.pop();break}}function i(l,d){switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=d,e.pop();break}}for(let l=0;l<t.length;l++){let d=t[l];switch(e[e.length-1]){case"ROOT":s(d,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break}break;case"INSIDE_OBJECT_KEY":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}break;case"INSIDE_OBJECT_AFTER_KEY":switch(d){case":":e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}break;case"INSIDE_OBJECT_BEFORE_VALUE":s(d,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(d,l);break;case"INSIDE_STRING":switch(d){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":switch(d){case"]":a=l,e.pop();break;default:a=l,s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break}break;case"INSIDE_ARRAY_AFTER_VALUE":switch(d){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(d){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(d,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(d,l);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let u=t.substring(r,l+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(d,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(d,l)):a=l;break}}}let o=t.slice(0,a+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let d=t.substring(r,t.length);"true".startsWith(d)?o+="true".slice(d.length):"false".startsWith(d)?o+="false".slice(d.length):"null".startsWith(d)&&(o+="null".slice(d.length))}}return o}async function $s(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await ha({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await ha({text:Gl(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function fa(t){return t.type.startsWith("tool-")}function Ql(t){return t.type==="dynamic-tool"}function Zs(t){return fa(t)||Ql(t)}function Fs(t){return t.type.split("-").slice(1).join("-")}function Xl({lastMessage:t,messageId:e}){return{message:(t==null?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function ed({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:n,onData:i}){return t.pipeThrough(new TransformStream({async transform(o,l){await r(async({state:d,write:u})=>{function c(p){let m=d.message.parts.filter(fa).find(_=>_.toolCallId===p);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function y(p){let m=d.message.parts.filter(_=>_.type==="dynamic-tool").find(_=>_.toolCallId===p);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function f(p){let m=d.message.parts.find(C=>fa(C)&&C.toolCallId===p.toolCallId),_=p,x=m;m==null?d.message.parts.push({type:`tool-${p.toolName}`,toolCallId:p.toolCallId,state:p.state,input:_.input,output:_.output,rawInput:_.rawInput,errorText:_.errorText,providerExecuted:_.providerExecuted,preliminary:_.preliminary,..._.providerMetadata==null?{}:{callProviderMetadata:_.providerMetadata}}):(m.state=p.state,x.input=_.input,x.output=_.output,x.errorText=_.errorText,x.rawInput=_.rawInput,x.preliminary=_.preliminary,x.providerExecuted=_.providerExecuted??m.providerExecuted,_.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=_.providerMetadata))}function b(p){let m=d.message.parts.find(C=>C.type==="dynamic-tool"&&C.toolCallId===p.toolCallId),_=p,x=m;m==null?d.message.parts.push({type:"dynamic-tool",toolName:p.toolName,toolCallId:p.toolCallId,state:p.state,input:_.input,output:_.output,errorText:_.errorText,preliminary:_.preliminary,providerExecuted:_.providerExecuted,..._.providerMetadata==null?{}:{callProviderMetadata:_.providerMetadata}}):(m.state=p.state,x.toolName=p.toolName,x.input=_.input,x.output=_.output,x.errorText=_.errorText,x.rawInput=_.rawInput??x.rawInput,x.preliminary=_.preliminary,x.providerExecuted=_.providerExecuted??m.providerExecuted,_.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=_.providerMetadata))}async function h(p){if(p!=null){let m=d.message.metadata==null?p:Ds(d.message.metadata,p);e!=null&&await _s({value:m,schema:e}),d.message.metadata=m}}switch(o.type){case"text-start":{let p={type:"text",text:"",providerMetadata:o.providerMetadata,state:"streaming"};d.activeTextParts[o.id]=p,d.message.parts.push(p),u();break}case"text-delta":{let p=d.activeTextParts[o.id];p.text+=o.delta,p.providerMetadata=o.providerMetadata??p.providerMetadata,u();break}case"text-end":{let p=d.activeTextParts[o.id];p.state="done",p.providerMetadata=o.providerMetadata??p.providerMetadata,delete d.activeTextParts[o.id],u();break}case"reasoning-start":{let p={type:"reasoning",text:"",providerMetadata:o.providerMetadata,state:"streaming"};d.activeReasoningParts[o.id]=p,d.message.parts.push(p),u();break}case"reasoning-delta":{let p=d.activeReasoningParts[o.id];p.text+=o.delta,p.providerMetadata=o.providerMetadata??p.providerMetadata,u();break}case"reasoning-end":{let p=d.activeReasoningParts[o.id];p.providerMetadata=o.providerMetadata??p.providerMetadata,p.state="done",delete d.activeReasoningParts[o.id],u();break}case"file":d.message.parts.push({type:"file",mediaType:o.mediaType,url:o.url}),u();break;case"source-url":d.message.parts.push({type:"source-url",sourceId:o.sourceId,url:o.url,title:o.title,providerMetadata:o.providerMetadata}),u();break;case"source-document":d.message.parts.push({type:"source-document",sourceId:o.sourceId,mediaType:o.mediaType,title:o.title,filename:o.filename,providerMetadata:o.providerMetadata}),u();break;case"tool-input-start":{let p=d.message.parts.filter(fa);d.partialToolCalls[o.toolCallId]={text:"",toolName:o.toolName,index:p.length,dynamic:o.dynamic},o.dynamic?b({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}):f({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}),u();break}case"tool-input-delta":{let p=d.partialToolCalls[o.toolCallId];p.text+=o.inputTextDelta;let{value:m}=await $s(p.text);p.dynamic?b({toolCallId:o.toolCallId,toolName:p.toolName,state:"input-streaming",input:m}):f({toolCallId:o.toolCallId,toolName:p.toolName,state:"input-streaming",input:m}),u();break}case"tool-input-available":o.dynamic?b({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}):f({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),u(),n&&!o.providerExecuted&&await n({toolCall:o});break;case"tool-input-error":o.dynamic?b({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}):f({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:void 0,rawInput:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),u();break;case"tool-output-available":if(o.dynamic){let p=y(o.toolCallId);b({toolCallId:o.toolCallId,toolName:p.toolName,state:"output-available",input:p.input,output:o.output,preliminary:o.preliminary})}else{let p=c(o.toolCallId);f({toolCallId:o.toolCallId,toolName:Fs(p),state:"output-available",input:p.input,output:o.output,providerExecuted:o.providerExecuted,preliminary:o.preliminary})}u();break;case"tool-output-error":if(o.dynamic){let p=y(o.toolCallId);b({toolCallId:o.toolCallId,toolName:p.toolName,state:"output-error",input:p.input,errorText:o.errorText,providerExecuted:o.providerExecuted})}else{let p=c(o.toolCallId);f({toolCallId:o.toolCallId,toolName:Fs(p),state:"output-error",input:p.input,rawInput:p.rawInput,errorText:o.errorText,providerExecuted:o.providerExecuted})}u();break;case"start-step":d.message.parts.push({type:"step-start"});break;case"finish-step":d.activeTextParts={},d.activeReasoningParts={};break;case"start":o.messageId!=null&&(d.message.id=o.messageId),await h(o.messageMetadata),(o.messageId!=null||o.messageMetadata!=null)&&u();break;case"finish":o.finishReason!=null&&(d.finishReason=o.finishReason),await h(o.messageMetadata),o.messageMetadata!=null&&u();break;case"message-metadata":await h(o.messageMetadata),o.messageMetadata!=null&&u();break;case"error":s==null||s(Error(o.errorText));break;default:if(Hl(o)){(a==null?void 0:a[o.type])!=null&&await _s({value:o.data,schema:a[o.type]});let p=o;if(p.transient){i==null||i(p);break}let m=p.id==null?void 0:d.message.parts.find(_=>p.type===_.type&&p.id===_.id);m==null?d.message.parts.push(p):m.data=p.data,i==null||i(p),u()}}l.enqueue(o)})}}))}async function zs({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:r}=await a.read();if(r)break}}catch(r){e==null||e(r)}finally{a.releaseLock()}}jt({prefix:"aitxt",size:24}),jt({prefix:"aiobj",size:24});var td=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(r){a(r)}}),this.processQueue()})}};jt({prefix:"aiobj",size:24}),ql({},{object:()=>rd,text:()=>ad});var ad=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),rd=({schema:t})=>{let e=Ul(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await $s(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await ha({text:a});if(!s.success)throw new Rs({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await Ja({value:s.value,schema:e});if(!n.success)throw new Rs({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}};async function sd({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:r,value:s}=await a.read();if(r)break;await e(s)}}var nd=()=>fetch;async function id({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:n="data",setCompletion:i,setLoading:o,setError:l,setAbortController:d,onFinish:u,onError:c,fetch:y=nd()}){try{o(!0),l(void 0);let f=new AbortController;d(f),i("");let b=await y(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:Ka({"Content-Type":"application/json",...r},`ai-sdk/${er}`,Wa()),signal:f.signal}).catch(p=>{throw p});if(!b.ok)throw Error(await b.text()??"Failed to fetch the chat response.");if(!b.body)throw Error("The response body is empty.");let h="";switch(n){case"text":await sd({stream:b.body,onTextPart:p=>{h+=p,i(h)}});break;case"data":await zs({stream:bs({stream:b.body,schema:Ls}).pipeThrough(new TransformStream({async transform(p){if(!p.success)throw p.error;let m=p.value;if(m.type==="text-delta")h+=m.delta,i(h);else if(m.type==="error")throw Error(m.errorText)}})),onError:p=>{throw p}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return u&&u(e,h),d(null),h}catch(f){if(f.name==="AbortError")return d(null),null;f instanceof Error&&c&&c(f),l(f)}finally{o(!1)}}async function od(t){if(t==null)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async e=>{let{name:a,type:r}=e;return{type:"file",mediaType:r,filename:a,url:await new Promise((s,n)=>{let i=new FileReader;i.onload=o=>{var l;s((l=o.target)==null?void 0:l.result)},i.onerror=o=>n(o),i.readAsDataURL(e)})}}))}var ld=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:i}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:t,...e}){var y;let a=await Ct(this.body),r=await Ct(this.headers),s=await Ct(this.credentials),n={...pt(r),...pt(e.headers)},i=await((y=this.prepareSendMessagesRequest)==null?void 0:y.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:n,credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),o=(i==null?void 0:i.api)??this.api,l=(i==null?void 0:i.headers)===void 0?n:pt(i.headers),d=(i==null?void 0:i.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:i.body,u=(i==null?void 0:i.credentials)??s,c=await(this.fetch??globalThis.fetch)(o,{method:"POST",headers:Ka({"Content-Type":"application/json",...l},`ai-sdk/${er}`,Wa()),body:JSON.stringify(d),credentials:u,signal:t});if(!c.ok)throw Error(await c.text()??"Failed to fetch the chat response.");if(!c.body)throw Error("The response body is empty.");return this.processResponseStream(c.body)}async reconnectToStream(t){var u;let e=await Ct(this.body),a=await Ct(this.headers),r=await Ct(this.credentials),s={...pt(a),...pt(t.headers)},n=await((u=this.prepareReconnectToStreamRequest)==null?void 0:u.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:s,credentials:r,requestMetadata:t.metadata})),i=(n==null?void 0:n.api)??`${this.api}/${t.chatId}/stream`,o=(n==null?void 0:n.headers)===void 0?s:pt(n.headers),l=(n==null?void 0:n.credentials)??r,d=await(this.fetch??globalThis.fetch)(i,{method:"GET",headers:Ka(o,`ai-sdk/${er}`,Wa()),credentials:l});if(d.status===204)return null;if(!d.ok)throw Error(await d.text()??"Failed to fetch the chat response.");if(!d.body)throw Error("The response body is empty.");return this.processResponseStream(d.body)}},tr=class extends ld{constructor(t={}){super(t)}processResponseStream(t){return bs({stream:t,schema:Ls}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},dd=class{constructor({generateId:t=Uo,id:e=t(),transport:a=new tr,messageMetadataSchema:r,dataPartSchemas:s,state:n,onError:i,onToolCall:o,onFinish:l,onData:d,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new td,this.sendMessage=async(c,y)=>{var b;if(c==null){await this.makeRequest({trigger:"submit-message",messageId:(b=this.lastMessage)==null?void 0:b.id,...y});return}let f;if(f="text"in c||"files"in c?{parts:[...Array.isArray(c.files)?c.files:await od(c.files),..."text"in c&&c.text!=null?[{type:"text",text:c.text}]:[]]}:c,c.messageId!=null){let h=this.state.messages.findIndex(p=>p.id===c.messageId);if(h===-1)throw Error(`message with id ${c.messageId} not found`);if(this.state.messages[h].role!=="user")throw Error(`message with id ${c.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,h+1),this.state.replaceMessage(h,{...f,id:c.messageId,role:f.role??"user",metadata:c.metadata})}else this.state.pushMessage({...f,id:f.id??this.generateId(),role:f.role??"user",metadata:c.metadata});await this.makeRequest({trigger:"submit-message",messageId:c.messageId,...y})},this.regenerate=async({messageId:c,...y}={})=>{let f=c==null?this.state.messages.length-1:this.state.messages.findIndex(b=>b.id===c);if(f===-1)throw Error(`message ${c} not found`);this.state.messages=this.state.messages.slice(0,this.messages[f].role==="assistant"?f:f+1),await this.makeRequest({trigger:"regenerate-message",messageId:c,...y})},this.resumeStream=async(c={})=>{await this.makeRequest({trigger:"resume-stream",...c})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolOutput=async({state:c="output-available",tool:y,toolCallId:f,output:b,errorText:h})=>this.jobExecutor.run(async()=>{var _,x;let p=this.state.messages,m=p[p.length-1];this.state.replaceMessage(p.length-1,{...m,parts:m.parts.map(C=>Zs(C)&&C.toolCallId===f?{...C,state:c,output:b,errorText:h}:C)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(C=>Zs(C)&&C.toolCallId===f?{...C,state:c,output:b,errorText:h}:C)),this.status!=="streaming"&&this.status!=="submitted"&&((_=this.sendAutomaticallyWhen)!=null&&_.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(x=this.lastMessage)==null?void 0:x.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var c;this.status!=="streaming"&&this.status!=="submitted"||(c=this.activeResponse)!=null&&c.abortController&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=n,this.onError=i,this.onToolCall=o,this.onFinish=l,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var u,c,y;var n;this.setStatus({status:"submitted",error:void 0});let i=this.lastMessage,o=!1,l=!1,d=!1;try{let f={state:Xl({lastMessage:this.state.snapshot(i),messageId:this.generateId()}),abortController:new AbortController};f.abortController.signal.addEventListener("abort",()=>{o=!0}),this.activeResponse=f;let b;if(t==="resume-stream"){let h=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(h==null){this.setStatus({status:"ready"});return}b=h}else b=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:f.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});await zs({stream:ed({stream:b,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:h=>this.jobExecutor.run(()=>h({state:f.state,write:()=>{var p;this.setStatus({status:"streaming"}),f.state.message.id===((p=this.lastMessage)==null?void 0:p.id)?this.state.replaceMessage(this.state.messages.length-1,f.state.message):this.state.pushMessage(f.state.message)}})),onError:h=>{throw h}}),onError:h=>{throw h}}),this.setStatus({status:"ready"})}catch(f){if(o||f.name==="AbortError")return o=!0,this.setStatus({status:"ready"}),null;d=!0,f instanceof TypeError&&(f.message.toLowerCase().includes("fetch")||f.message.toLowerCase().includes("network"))&&(l=!0),this.onError&&f instanceof Error&&this.onError(f),this.setStatus({status:"error",error:f})}finally{try{(n=this.onFinish)==null||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:o,isDisconnect:l,isError:d,finishReason:(u=this.activeResponse)==null?void 0:u.state.finishReason})}catch(f){console.error(f)}this.activeResponse=void 0}(c=this.sendAutomaticallyWhen)!=null&&c.call(this,{messages:this.state.messages})&&!d&&await this.makeRequest({trigger:"submit-message",messageId:(y=this.lastMessage)==null?void 0:y.id,metadata:e,headers:a,body:r})}},ud=zn(((t,e)=>{function a(r,s){if(typeof r!="function")throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let n,i=0;return function(...o){clearTimeout(n);let l=Date.now(),d=s-(l-i);d<=0?(i=l,r.apply(this,o)):n=setTimeout(()=>{i=Date.now(),r.apply(this,o)},d)}}e.exports=a})),Us=Object.prototype.hasOwnProperty;function ar(t,e){var a,r;if(t===e)return!0;if(t&&e&&(a=t.constructor)===e.constructor){if(a===Date)return t.getTime()===e.getTime();if(a===RegExp)return t.toString()===e.toString();if(a===Array){if((r=t.length)===e.length)for(;r--&&ar(t[r],e[r]););return r===-1}if(!a||typeof t=="object"){for(a in r=0,t)if(Us.call(t,a)&&++r&&!Us.call(e,a)||!(a in e)||!ar(t[a],e[a]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}var O=Ta(Bn(),1),Je=new WeakMap,mt=()=>{},ue=void 0,ga=Object,Z=t=>t===ue,Ae=t=>typeof t=="function",Ye=(t,e)=>({...t,...e}),Vs=t=>Ae(t.then),rr={},ya={},sr="undefined",Lt=typeof window!=sr,nr=typeof document!=sr,cd=Lt&&"Deno"in window,pd=()=>Lt&&typeof window.requestAnimationFrame!=sr,qs=(t,e)=>{let a=Je.get(t);return[()=>!Z(e)&&t.get(e)||rr,r=>{if(!Z(e)){let s=t.get(e);e in ya||(ya[e]=s),a[5](e,Ye(s,r),s||rr)}},a[6],()=>!Z(e)&&e in ya?ya[e]:!Z(e)&&t.get(e)||rr]},ir=!0,md=()=>ir,[or,lr]=Lt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[mt,mt],hd=()=>{let t=nr&&document.visibilityState;return Z(t)||t!=="hidden"},fd=t=>(nr&&document.addEventListener("visibilitychange",t),or("focus",t),()=>{nr&&document.removeEventListener("visibilitychange",t),lr("focus",t)}),gd=t=>{let e=()=>{ir=!0,t()},a=()=>{ir=!1};return or("online",e),or("offline",a),()=>{lr("online",e),lr("offline",a)}},yd={isOnline:md,isVisible:hd},vd={initFocus:fd,initReconnect:gd},Bs=!O.useId,Dt=!Lt||cd,_d=t=>pd()?window.requestAnimationFrame(t):setTimeout(t,1),va=Dt?O.useEffect:O.useLayoutEffect,dr=typeof navigator<"u"&&navigator.connection,Ws=!Dt&&dr&&(["slow-2g","2g"].includes(dr.effectiveType)||dr.saveData),_a=new WeakMap,bd=t=>ga.prototype.toString.call(t),ur=(t,e)=>t===`[object ${e}]`,xd=0,cr=t=>{let e=typeof t,a=bd(t),r=ur(a,"Date"),s=ur(a,"RegExp"),n=ur(a,"Object"),i,o;if(ga(t)===t&&!r&&!s){if(i=_a.get(t),i)return i;if(i=++xd+"~",_a.set(t,i),Array.isArray(t)){for(i="@",o=0;o<t.length;o++)i+=cr(t[o])+",";_a.set(t,i)}if(n){i="#";let l=ga.keys(t).sort();for(;!Z(o=l.pop());)Z(t[o])||(i+=o+":"+cr(t[o])+",");_a.set(t,i)}}else i=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return i},pr=t=>{if(Ae(t))try{t=t()}catch{t=""}let e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?cr(t):"",[t,e]},wd=0,mr=()=>++wd;async function Ks(...t){let[e,a,r,s]=t,n=Ye({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{}),i=n.populateCache,o=n.rollbackOnError,l=n.optimisticData,d=y=>typeof o=="function"?o(y):o!==!1,u=n.throwOnError;if(Ae(a)){let y=a,f=[],b=e.keys();for(let h of b)!/^\$(inf|sub)\$/.test(h)&&y(e.get(h)._k)&&f.push(h);return Promise.all(f.map(c))}return c(a);async function c(y){let[f]=pr(y);if(!f)return;let[b,h]=qs(e,f),[p,m,_,x]=Je.get(e),C=()=>{let Y=p[f];return(Ae(n.revalidate)?n.revalidate(b().data,y):n.revalidate!==!1)&&(delete _[f],delete x[f],Y&&Y[0])?Y[0](2).then(()=>b().data):b().data};if(t.length<3)return C();let S=r,D,$=!1,R=mr();m[f]=[R,0];let K=!Z(l),L=b(),B=L.data,Q=L._c,te=Z(Q)?B:Q;if(K&&(l=Ae(l)?l(te,B):l,h({data:l,_c:te})),Ae(S))try{S=S(te)}catch(Y){D=Y,$=!0}if(S&&Vs(S))if(S=await S.catch(Y=>{D=Y,$=!0}),R!==m[f][0]){if($)throw D;return S}else $&&K&&d(D)&&(i=!0,h({data:te,_c:ue}));if(i&&($||(Ae(i)?h({data:i(S,te),error:ue,_c:ue}):h({data:S,error:ue,_c:ue}))),m[f][1]=mr(),Promise.resolve(C()).then(()=>{h({_c:ue})}),$){if(u)throw D;return}return S}}var Js=(t,e)=>{for(let a in t)t[a][0]&&t[a][0](e)},Ys=(t,e)=>{if(!Je.has(t)){let a=Ye(vd,e),r=Object.create(null),s=Ks.bind(ue,t),n=mt,i=Object.create(null),o=(u,c)=>{let y=i[u]||[];return i[u]=y,y.push(c),()=>y.splice(y.indexOf(c),1)},l=(u,c,y)=>{t.set(u,c);let f=i[u];if(f)for(let b of f)b(c,y)},d=()=>{if(!Je.has(t)&&(Je.set(t,[r,Object.create(null),Object.create(null),Object.create(null),s,l,o]),!Dt)){let u=a.initFocus(setTimeout.bind(ue,Js.bind(ue,r,0))),c=a.initReconnect(setTimeout.bind(ue,Js.bind(ue,r,1)));n=()=>{u&&u(),c&&c(),Je.delete(t)}}};return d(),[t,s,d,n]}return[t,Je.get(t)[4]]},kd=(t,e,a,r,s)=>{let n=a.errorRetryCount,i=s.retryCount,o=~~((Math.random()+.5)*(1<<(i<8?i:8)))*a.errorRetryInterval;!Z(n)&&i>n||setTimeout(r,o,s)},Cd=ar,[hr,Ed]=Ys(new Map),Hs=Ye({onLoadingSlow:mt,onSuccess:mt,onError:mt,onErrorRetry:kd,onDiscarded:mt,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Ws?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Ws?5e3:3e3,compare:Cd,isPaused:()=>!1,cache:hr,mutate:Ed,fallback:{}},yd),Gs=(t,e)=>{let a=Ye(t,e);if(e){let{use:r,fallback:s}=t,{use:n,fallback:i}=e;r&&n&&(a.use=r.concat(n)),s&&i&&(a.fallback=Ye(s,i))}return a},fr=(0,O.createContext)({}),Td=t=>{let{value:e}=t,a=(0,O.useContext)(fr),r=Ae(e),s=(0,O.useMemo)(()=>r?e(a):e,[r,a,e]),n=(0,O.useMemo)(()=>r?s:Gs(a,s),[r,a,s]),i=s&&s.provider,o=(0,O.useRef)(ue);i&&!o.current&&(o.current=Ys(i(n.cache||hr),s));let l=o.current;return l&&(n.cache=l[0],n.mutate=l[1]),va(()=>{if(l)return l[2]&&l[2](),l[3]},[]),(0,O.createElement)(fr.Provider,Ye(t,{value:n}))},Qs=Lt&&window.__SWR_DEVTOOLS_USE__,Id=Qs?window.__SWR_DEVTOOLS_USE__:[],Sd=()=>{Qs&&(window.__SWR_DEVTOOLS_REACT__=O.default)},Ad=t=>Ae(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],Od=()=>Ye(Hs,(0,O.useContext)(fr)),Rd=Id.concat(t=>(e,a,r)=>t(e,a&&((...s)=>{let[n]=pr(e),[,,,i]=Je.get(hr);if(n.startsWith("$inf$"))return a(...s);let o=i[n];return Z(o)?a(...s):(delete i[n],o)}),r)),Nd=t=>function(...e){let a=Od(),[r,s,n]=Ad(e),i=Gs(a,n),o=t,{use:l}=i,d=(l||[]).concat(Rd);for(let u=d.length;u--;)o=d[u](o);return o(r,s||i.fetcher||null,i)},Md=(t,e,a)=>{let r=e[t]||(e[t]=[]);return r.push(a),()=>{let s=r.indexOf(a);s>=0&&(r[s]=r[r.length-1],r.pop())}};Sd();var jd=Wi(),gr=O.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),yr={dedupe:!0},Pd=(t,e,a)=>{let{cache:r,compare:s,suspense:n,fallbackData:i,revalidateOnMount:o,revalidateIfStale:l,refreshInterval:d,refreshWhenHidden:u,refreshWhenOffline:c,keepPreviousData:y}=a,[f,b,h,p]=Je.get(r),[m,_]=pr(t),x=(0,O.useRef)(!1),C=(0,O.useRef)(!1),S=(0,O.useRef)(m),D=(0,O.useRef)(e),$=(0,O.useRef)(a),R=()=>$.current,K=()=>R().isVisible()&&R().isOnline(),[L,B,Q,te]=qs(r,m),Y=(0,O.useRef)({}).current,W=Z(i)?Z(a.fallback)?ue:a.fallback[m]:i,H=(V,z)=>{for(let ae in Y){let U=ae;if(U==="data"){if(!s(V[U],z[U])&&(!Z(V[U])||!s(ke,z[U])))return!1}else if(z[U]!==V[U])return!1}return!0},oe=(0,O.useMemo)(()=>{let V=!m||!e?!1:Z(o)?R().isPaused()||n?!1:l!==!1:o,z=re=>{let fe=Ye(re);return delete fe._k,V?{isValidating:!0,isLoading:!0,...fe}:fe},ae=L(),U=te(),_e=z(ae),me=ae===U?_e:z(U),se=_e;return[()=>{let re=z(L());return H(re,se)?(se.data=re.data,se.isLoading=re.isLoading,se.isValidating=re.isValidating,se.error=re.error,se):(se=re,re)},()=>me]},[r,m]),X=(0,jd.useSyncExternalStore)((0,O.useCallback)(V=>Q(m,(z,ae)=>{H(ae,z)||V()}),[r,m]),oe[0],oe[1]),lt=!x.current,Re=f[m]&&f[m].length>0,we=X.data,pe=Z(we)?W&&Vs(W)?gr(W):W:we,$e=X.error,Ge=(0,O.useRef)(pe),ke=y?Z(we)?Z(Ge.current)?pe:Ge.current:we:pe,Ze=Re&&!Z($e)?!1:lt&&!Z(o)?o:R().isPaused()?!1:n?Z(pe)?!1:l:Z(pe)||l,Fe=!!(m&&e&&lt&&Ze),ft=Z(X.isValidating)?Fe:X.isValidating,It=Z(X.isLoading)?Fe:X.isLoading,Ne=(0,O.useCallback)(async V=>{let z=D.current;if(!m||!z||C.current||R().isPaused())return!1;let ae,U,_e=!0,me=V||{},se=!h[m]||!me.dedupe,re=()=>Bs?!C.current&&m===S.current&&x.current:m===S.current,fe={isValidating:!1,isLoading:!1},Ue=()=>{B(fe)},dt=()=>{let le=h[m];le&&le[1]===U&&delete h[m]},Ve={isValidating:!0};Z(L().data)&&(Ve.isLoading=!0);try{if(se&&(B(Ve),a.loadingTimeout&&Z(L().data)&&setTimeout(()=>{_e&&re()&&R().onLoadingSlow(m,a)},a.loadingTimeout),h[m]=[z(_),mr()]),[ae,U]=h[m],ae=await ae,se&&setTimeout(dt,a.dedupingInterval),!h[m]||h[m][1]!==U)return se&&re()&&R().onDiscarded(m),!1;fe.error=ue;let le=b[m];if(!Z(le)&&(U<=le[0]||U<=le[1]||le[1]===0))return Ue(),se&&re()&&R().onDiscarded(m),!1;let ge=L().data;fe.data=s(ge,ae)?ge:ae,se&&re()&&R().onSuccess(ae,m,a)}catch(le){dt();let ge=R(),{shouldRetryOnError:Qe}=ge;ge.isPaused()||(fe.error=le,se&&re()&&(ge.onError(le,m,ge),(Qe===!0||Ae(Qe)&&Qe(le))&&(!R().revalidateOnFocus||!R().revalidateOnReconnect||K())&&ge.onErrorRetry(le,m,ge,Xe=>{let Me=f[m];Me&&Me[0]&&Me[0](3,Xe)},{retryCount:(me.retryCount||0)+1,dedupe:!0})))}return _e=!1,Ue(),!0},[m,r]),ze=(0,O.useCallback)((...V)=>Ks(r,S.current,...V),[]);if(va(()=>{D.current=e,$.current=a,Z(we)||(Ge.current=we)}),va(()=>{if(!m)return;let V=Ne.bind(ue,yr),z=0;R().revalidateOnFocus&&(z=Date.now()+R().focusThrottleInterval);let ae=Md(m,f,(U,_e={})=>{if(U==0){let me=Date.now();R().revalidateOnFocus&&me>z&&K()&&(z=me+R().focusThrottleInterval,V())}else if(U==1)R().revalidateOnReconnect&&K()&&V();else{if(U==2)return Ne();if(U==3)return Ne(_e)}});return C.current=!1,S.current=m,x.current=!0,B({_k:_}),Ze&&(h[m]||(Z(pe)||Dt?V():_d(V))),()=>{C.current=!0,ae()}},[m]),va(()=>{let V;function z(){let U=Ae(d)?d(L().data):d;U&&V!==-1&&(V=setTimeout(ae,U))}function ae(){!L().error&&(u||R().isVisible())&&(c||R().isOnline())?Ne(yr).then(z):z()}return z(),()=>{V&&(V=(clearTimeout(V),-1))}},[d,u,c,m]),(0,O.useDebugValue)(ke),n&&Z(pe)&&m){if(!Bs&&Dt)throw Error("Fallback data is required when using Suspense in SSR.");D.current=e,$.current=a,C.current=!1;let V=p[m];if(Z(V)||gr(ze(V)),Z($e)){let z=Ne(yr);Z(ke)||(z.status="fulfilled",z.value=!0),gr(z)}else throw $e}return{mutate:ze,get data(){return Y.data=!0,ke},get error(){return Y.error=!0,$e},get isValidating(){return Y.isValidating=!0,ft},get isLoading(){return Y.isLoading=!0,It}}};ga.defineProperty(Td,"defaultValue",{value:Hs});var Xs=Nd(Pd),Ld=Ta(ud(),1),en=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},J=(t,e,a)=>(en(t,e,"read from private field"),a?a.call(t):e.get(t)),De=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},it=(t,e,a,r)=>(en(t,e,"write to private field"),r?r.call(t,a):e.set(t,a),a);function tn(t,e){return e==null?t:(0,Ld.default)(t,e)}var be,ba,xa,$t,Zt,Ft,Et,vr,_r,Dd=class{constructor(t=[]){De(this,be,void 0),De(this,ba,"ready"),De(this,xa,void 0),De(this,$t,new Set),De(this,Zt,new Set),De(this,Ft,new Set),this.pushMessage=e=>{it(this,be,J(this,be).concat(e)),J(this,Et).call(this)},this.popMessage=()=>{it(this,be,J(this,be).slice(0,-1)),J(this,Et).call(this)},this.replaceMessage=(e,a)=>{it(this,be,[...J(this,be).slice(0,e),this.snapshot(a),...J(this,be).slice(e+1)]),J(this,Et).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,a)=>{let r=a?tn(e,a):e;return J(this,$t).add(r),()=>{J(this,$t).delete(r)}},this["~registerStatusCallback"]=e=>(J(this,Zt).add(e),()=>{J(this,Zt).delete(e)}),this["~registerErrorCallback"]=e=>(J(this,Ft).add(e),()=>{J(this,Ft).delete(e)}),De(this,Et,()=>{J(this,$t).forEach(e=>e())}),De(this,vr,()=>{J(this,Zt).forEach(e=>e())}),De(this,_r,()=>{J(this,Ft).forEach(e=>e())}),it(this,be,t)}get status(){return J(this,ba)}set status(t){it(this,ba,t),J(this,vr).call(this)}get error(){return J(this,xa)}set error(t){it(this,xa,t),J(this,_r).call(this)}get messages(){return J(this,be)}set messages(t){it(this,be,[...t]),J(this,Et).call(this)}};be=new WeakMap,ba=new WeakMap,xa=new WeakMap,$t=new WeakMap,Zt=new WeakMap,Ft=new WeakMap,Et=new WeakMap,vr=new WeakMap,_r=new WeakMap;var Tt,an=class extends dd{constructor({messages:t,...e}){let a=new Dd(t);super({...e,state:a}),De(this,Tt,void 0),this["~registerMessagesCallback"]=(r,s)=>J(this,Tt)["~registerMessagesCallback"](r,s),this["~registerStatusCallback"]=r=>J(this,Tt)["~registerStatusCallback"](r),this["~registerErrorCallback"]=r=>J(this,Tt)["~registerErrorCallback"](r),it(this,Tt,a)}};Tt=new WeakMap;function rn({experimental_throttle:t,resume:e=!1,...a}={}){let r=(0,O.useRef)("chat"in a?a.chat:new an(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new an(a));let s=(0,O.useSyncExternalStore)((0,O.useCallback)(l=>r.current["~registerMessagesCallback"](l,t),[t,"id"in a?a.id:null]),()=>r.current.messages,()=>r.current.messages),n=(0,O.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),i=(0,O.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),o=(0,O.useCallback)(l=>{typeof l=="function"&&(l=l(r.current.messages)),r.current.messages=l},[r]);return(0,O.useEffect)(()=>{e&&r.current.resumeStream()},[e,r]),{id:r.current.id,messages:s,setMessages:o,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:i,resumeStream:r.current.resumeStream,status:n,addToolResult:r.current.addToolOutput,addToolOutput:r.current.addToolOutput}}function $d({api:t="/api/completion",id:e,initialCompletion:a="",initialInput:r="",credentials:s,headers:n,body:i,streamProtocol:o="data",fetch:l,onFinish:d,onError:u,experimental_throttle:c}={}){let y=(0,O.useId)(),f=e||y,{data:b,mutate:h}=Xs([t,f],null,{fallbackData:a}),{data:p=!1,mutate:m}=Xs([f,"loading"],null),[_,x]=(0,O.useState)(void 0),C=b,[S,D]=(0,O.useState)(null),$=(0,O.useRef)({credentials:s,headers:n,body:i});(0,O.useEffect)(()=>{$.current={credentials:s,headers:n,body:i}},[s,n,i]);let R=(0,O.useCallback)(async(W,H)=>id({api:t,prompt:W,credentials:$.current.credentials,headers:{...$.current.headers,...H==null?void 0:H.headers},body:{...$.current.body,...H==null?void 0:H.body},streamProtocol:o,fetch:l,setCompletion:tn(oe=>h(oe,!1),c),setLoading:m,setError:x,setAbortController:D,onFinish:d,onError:u}),[h,m,t,$,D,d,u,x,o,l,c]),K=(0,O.useCallback)(()=>{S&&(S.abort(),D(null))},[S]),L=(0,O.useCallback)(W=>{h(W,!1)},[h]),B=(0,O.useCallback)(async(W,H)=>R(W,H),[R]),[Q,te]=(0,O.useState)(r),Y=(0,O.useCallback)(W=>{var H;return(H=W==null?void 0:W.preventDefault)==null||H.call(W),Q?B(Q):void 0},[Q,B]);return{completion:C,complete:B,error:_,setCompletion:L,stop:K,input:Q,setInput:te,handleInputChange:(0,O.useCallback)(W=>{te(W.target.value)},[te]),handleSubmit:Y,isLoading:p}}var xe=class extends Error{constructor(t,e="TOOL_ERROR",a=!1,r,s){super(t),this.name="ToolExecutionError",this.code=e,this.isRetryable=a,this.suggestedFix=r,this.meta=s}toStructuredString(){let t=JSON.stringify({message:this.message,code:this.code,is_retryable:this.isRetryable,...this.suggestedFix&&{suggested_fix:this.suggestedFix},...this.meta&&{meta:this.meta}});return`Error invoking tool ${this.name}: ${t}`}};const sn=G({status:Jt(["success","error","warning"]).optional(),auth_required:de().optional(),next_steps:Be(E()).optional(),action_url:E().optional(),message:E().optional(),meta:St(E(),qe()).optional()});function Zd(t,e){return t?!!(["image/","video/","audio/","application/pdf"].some(a=>t.startsWith(a))||["svg","vega"].some(a=>t.includes(a))||t==="text/html"&&["<img","<video","<audio","<iframe","<canvas","<svg","<marimo-ui-element"].some(a=>e.includes(a))):!1}var Fd=class extends Ot{constructor(e){super();j(this,"title","Cell Outputs");j(this,"mentionPrefix","@");j(this,"contextType","cell-output");this.store=e}getItems(){let e=this.store.get(tt),a=[];for(let r of e.cellIds.inOrderIds){let s=on(r,e),n=s.cellOutput;if(!n)continue;let i=n.output.mimetype||"unknown";a.push({uri:this.asURI(r),name:s.cellName,type:this.contextType,description:`Cell output (${i})`,data:{...s,cellOutput:n}})}return a}formatCompletion(e){let{cellOutput:a,cellName:r,cellCode:s}=e.data;return{label:`@${r}`,displayLabel:r,detail:`${a.outputType} output`,boost:a.outputType==="media"?_t.HIGH:_t.MEDIUM,type:this.contextType,section:vt.CELL_OUTPUT,apply:`@${r}`,info:()=>{let n=document.createElement("div");n.classList.add("mo-cm-tooltip","docs-documentation","min-w-[300px]","max-w-[500px]","flex","flex-col","gap-2");let i=document.createElement("div");i.classList.add("flex","flex-col","gap-1");let o=document.createElement("div");o.classList.add("font-bold","text-base"),o.textContent=r,i.append(o);let l=document.createElement("div");if(l.classList.add("text-sm","text-muted-foreground"),i.append(l),n.append(i),s){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground"),d.textContent="Code:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","font-mono","bg-muted","p-2","rounded","max-h-20","overflow-y-auto"),u.textContent=s.slice(0,200)+(s.length>200?"...":""),n.append(u)}if(a.processedContent){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground","mt-2"),d.textContent="Output Preview:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","bg-muted","p-2","rounded","max-h-24","overflow-y-auto","mb-2"),u.textContent=a.processedContent.slice(0,300)+(a.processedContent.length>300?"...":""),n.append(u)}if(a.outputType==="media"){let d=document.createElement("div");d.classList.add("text-xs","text-muted-foreground","italic","mb-2"),d.textContent="A screenshot of the output will be attached",n.append(d)}return n}}}formatContext(e){let{cellOutput:a,cellName:r,cellId:s,cellCode:n}=e.data,i={name:r,cellId:s,outputType:a.outputType,mimetype:a.output.mimetype},o=`Cell Code:
${n}

`;return a.outputType==="text"&&a.processedContent?o+=`Output:
${a.processedContent}`:a.outputType==="media"&&(o+=`Media Output: Contains ${a.output.mimetype} content`,a.imageUrl&&(o+=`
Image URL: ${a.imageUrl}`)),At({type:this.contextType,data:i,details:o})}async getAttachments(e){let a=e[0].data.cellId,r=e[0].data.cellName;return zd(e.map(s=>s.data.cellOutput),a,r)}};async function zd(t,e,a){let r=t.filter(n=>n.shouldDownloadImage&&n.outputType==="media");if(r.length===0)return[];let s=r.flatMap(n=>{let i=document.getElementById(Wn.create(e));return i?{cellId:e,cellName:a,mimetype:n.output.mimetype,element:i}:(ie.warn(`Output element not found for cell ${e}`),[])});try{return await Promise.all(s.map(async n=>({type:"file",filename:`${a}-output-screenshot`,mediaType:"image/png",url:await Ni(n.element)})))}catch(n){return ie.error("Error downloading cell output images:",n),[]}}function nn(t){if(Br(t))return null;let e=t.mimetype,a=Zd(e,String(t.data))?"media":"text",r=zi(t),s,n=!1;return a==="media"&&(typeof t.data=="string"&&t.data.startsWith("data:")||typeof t.data=="string"&&t.data.startsWith("http")?s=t.data:n=!0),{processedContent:r,imageUrl:s,shouldDownloadImage:n,outputType:a,output:t}}function on(t,e,a){let{includeConsoleOutput:r=!1}=a||{},s=e.cellRuntime[t],n=e.cellData[t],i=e.cellIds.inOrderIds.indexOf(t),o=ii(n.name,i),l;r&&(l=s.consoleOutputs.map(c=>nn(c)).filter(c=>c!==null));let d,u=s.output;return u&&!Br(u)&&(d=nn(u)??void 0),{cellId:t,cellName:o,cellCode:n.code,cellOutput:d,consoleOutputs:l}}function Ud(t){return t.type==="setup-refs"?"The setup cell cannot have references":t.type==="cycle"?"This cell is in a cycle":t.type==="multiple-defs"?`The variable '${t.name}' was defined by another cell`:t.type==="import-star"||t.type==="ancestor-stopped"||t.type==="ancestor-prevented"||t.type==="exception"||t.type==="strict-exception"?t.msg:t.type==="interruption"?"This cell was interrupted and needs to be re-run":t.type==="syntax"||t.type==="unknown"||t.type==="sql-error"?t.msg:t.type==="internal"?t.msg||"An internal error occurred":(pi(t),"Unknown error")}var ln=new Hn("error","errors"),Vd=class extends Ot{constructor(e){super();j(this,"title","Errors");j(this,"mentionPrefix","@");j(this,"contextType","error");this.store=e}getItems(){let e=this.store.get(si);return e.length===0?[]:[{uri:this.asURI("all"),name:"Errors",type:this.contextType,data:{type:"all-errors",errors:e.map(a=>({cellId:a.cellId,cellName:a.cellName,errorData:a.output.data}))},description:"All errors in the notebook"}]}formatCompletion(e){return e.data.type==="all-errors"?{label:"@Errors",displayLabel:"Errors",detail:`${e.data.errors.length} ${ln.pluralize(e.data.errors.length)}`,type:"error",apply:"@Errors",section:vt.ERROR,info:()=>{let a=document.createElement("div");a.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let r=document.createElement("div");r.classList.add("flex","flex-col","gap-1");let s=document.createElement("div");s.classList.add("font-bold","text-base"),s.textContent="Errors",r.append(s);let n=document.createElement("div");return n.classList.add("text-sm","text-muted-foreground"),n.textContent=`${e.data.errors.length} ${ln.pluralize(e.data.errors.length)}`,r.append(n),a.append(r),a}}:{label:"Error",displayLabel:"Error",section:vt.ERROR}}formatContext(e){let{data:a}=e;return a.errors.map(r=>At({type:this.contextType,data:{name:r.cellName||`Cell ${r.cellId}`,description:r.errorData.map(s=>Ud(s)).join(`
`)}})).join(`

`)}};const dn=ri();var qd={maxDepth:3,maxResults:20,defaultResultsLimit:5,includeDirectories:!1},Bd=class extends Ot{constructor(e,a=qd){super();j(this,"title","Files");j(this,"mentionPrefix","#");j(this,"contextType","file");j(this,"searchFiles",async(e,a={})=>{let{maxDepth:r,maxResults:s,includeDirectories:n}={...this.config,...a};return(await this.apiRequests.sendSearchFiles({query:e,includeFiles:!0,includeDirectories:n,depth:r,limit:s})).files});this.apiRequests=e,this.config=a}createCompletionSource(){return async e=>{let a=e.matchBefore(/#[^\s#]*/);if(!a)return null;let r=a.text;if(!r.startsWith("#"))return null;let s=r.slice(1);if(s.length===0)return this.getDefaultCompletions(a);try{let n=(await this.searchFiles(s)||[]).map(i=>{let o={uri:this.asURI(i.path),name:i.name,type:this.contextType,description:i.isDirectory?"Directory":"File",data:{path:i.path,isDirectory:i.isDirectory}};return this.formatCompletion(o)});return{from:a.from,options:n}}catch(n){return ie.error("Failed to search files:",n),null}}}async getDefaultCompletions(e){try{for(let a of["py","md","csv"])try{let r=await this.searchFiles(a,{maxDepth:1,maxResults:5});if(r&&r.length>0){let s=r.map(n=>{let i={uri:this.asURI(n.path),name:n.name,type:this.contextType,description:n.isDirectory?"Directory":"File",data:{path:n.path,isDirectory:n.isDirectory}};return this.formatCompletion(i)});return{from:e.from,options:s}}}catch(r){ie.error("Failed to get default file completions:",r)}return{from:e.from,options:[]}}catch(a){return ie.error("Failed to get default file completions:",a),null}}getItems(){return[]}formatCompletion(e){let{data:a,name:r}=e,s=a.isDirectory?"\u{1F4C1}":"\u{1F4C4}";return{...this.createBasicCompletion(e),type:"file",section:vt.FILE,boost:a.isDirectory?_t.MEDIUM:_t.LOW,detail:a.path,displayLabel:`${s} ${r}`,apply:async(n,i,o,l)=>{var f;let d=(f=n.state.facet(dn))==null?void 0:f.addAttachment;if(!d){ie.warn("No addAttachment callback provided");return}let u=await this.apiRequests.sendFileDetails({path:a.path}).catch(b=>(Jr({title:"Failed to get file details",description:b.message}),null));if(!u)return;let c=u.mimeType||"text/plain",y;if(c.startsWith("text/")||c.includes("json")||c.includes("xml"))y=new Blob([u.contents||""],{type:c});else if(u.contents)try{y=await Xi(xi(u.contents,c))}catch{y=new Blob([u.contents],{type:c})}else y=new Blob([""],{type:c});d(new File([y],r,{type:c})),n.dispatch({changes:{from:o,to:l,insert:""}}),Si(n)},info:()=>{let n=document.createElement("div");n.classList.add("flex","flex-col","gap-1","p-2");let i=document.createElement("div");i.classList.add("font-bold"),i.textContent=r,n.append(i);let o=document.createElement("div");return o.classList.add("text-xs","text-muted-foreground"),o.textContent=a.path,n.append(o),n}}}formatContext(e){let{data:a,name:r}=e;return At({type:this.contextType,data:{name:r,path:a.path,isDirectory:a.isDirectory},details:a.isDirectory?"Directory containing files and subdirectories":"File"})}},Wd=class extends Ot{constructor(e){super();j(this,"title","Tables");j(this,"mentionPrefix","@");j(this,"contextType","data");this.tablesMap=e}getItems(){return[...this.tablesMap.entries()].map(([e,a])=>({uri:this.asURI(e),name:e,type:this.contextType,description:a.source==="memory"?"in-memory":a.source,data:a}))}formatContext(e){let{data:a}=e,{columns:r,source:s,num_rows:n,num_columns:i,name:o,variable_name:l}=a,d=[n==null?void 0:`${n} rows`,i==null?void 0:`${i} columns`].filter(Boolean).join(", "),u="";if(d&&(u+=`Shape: ${d}
`),l&&(u+=`Variable: ${l}
`),r&&r.length>0){u+=`Columns:
`;for(let c of r){let y=`  ${c.name} (${c.type})`;if(c.sample_values&&c.sample_values.length>0){let f=c.sample_values.slice(0,3).map(b=>b===null?"null":String(b)).join(", ");y+=` - samples: [${f}]`}u+=`${y}
`}}return At({type:this.contextType,data:{name:o,source:s??"unknown"},details:u.trim()})}formatCompletion(e){let a=e.data.name,r=e.data;return{label:`@${a}`,displayLabel:a,detail:r.source==="memory"?"in-memory":r.source,boost:r.source_type==="local"?_t.LOCAL_TABLE:_t.REMOTE_TABLE,type:jr(r),apply:`@${a}`,section:{name:jr(r)==="dataframe"?"Dataframe":"Table",rank:vt.TABLE.rank},info:()=>this.createTableInfoElement(a,r)}}createTableInfoElement(e,a){let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");if(n.classList.add("font-bold","text-base"),n.textContent=e,s.append(n),a.source){let o=document.createElement("div");o.classList.add("text-xs","text-muted-foreground"),o.textContent=`Source: ${a.source}`,s.append(o)}r.append(s);let i=[a.num_rows==null?void 0:`${a.num_rows} rows`,a.num_columns==null?void 0:`${a.num_columns} columns`].filter(Boolean).join(", ");if(i){let o=document.createElement("div");o.classList.add("text-xs","bg-muted","px-2","py-1","rounded"),o.textContent=i,r.append(o)}if(a.columns&&a.columns.length>0){let o=document.createElement("div");o.classList.add("overflow-auto","max-h-60");let l=document.createElement("table");l.classList.add("w-full","text-xs","border-collapse");let d=l.insertRow();d.classList.add("bg-muted");let u=d.insertCell();u.classList.add("p-2","font-medium","text-left"),u.textContent="Column";let c=d.insertCell();c.classList.add("p-2","font-medium","text-left"),c.textContent="Type";let y=a.columns.some(b=>this.getItemMetadata(a,b)!==void 0),f;y&&(f=d.insertCell(),f.classList.add("p-2","font-medium","text-left"),f.textContent="Metadata"),a.columns.forEach((b,h)=>{let p=l.insertRow();p.classList.add(h%2==0?"bg-background":"bg-muted/30");let m=p.insertCell();m.classList.add("p-2","font-mono"),m.textContent=b.name;let _=p.insertCell();if(_.classList.add("p-2","text-muted-foreground"),_.textContent=b.type,y){let x=p.insertCell();x.classList.add("p-2");let C=this.getItemMetadata(a,b);C&&x.append(C)}}),o.append(l),r.append(o)}return r}getItemMetadata(e,a){var n,i;let r=(n=e.primary_keys)==null?void 0:n.includes(a.name),s=(i=e.indexes)==null?void 0:i.includes(a.name);if(r||s){let o=document.createElement("span");o.textContent=r?"PK":"IDX";let l=r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";return o.classList.add("text-xs","px-1.5","py-0.5","rounded-full","font-medium",...l.split(" ")),o}}},Kd=class extends Ot{constructor(e,a){super();j(this,"title","Variables");j(this,"mentionPrefix","@");j(this,"contextType","variable");this.variables=e,this.tablesMap=a}getItems(){let e=new Set(this.tablesMap.keys());return Object.entries(this.variables).flatMap(([a,r])=>e.has(a)?[]:[{uri:this.asURI(a),name:a,type:this.contextType,description:r.dataType??"",dataType:r.dataType,data:{variable:r}}])}formatCompletion(e){let{data:a}=e,{variable:r}=a;return{label:`@${r.name}`,displayLabel:r.name,detail:r.dataType??"",type:this.contextType,section:vt.VARIABLE,info:()=>Xn(r)}}formatContext(e){let{data:a}=e,{variable:r}=a;return At({type:this.contextType,data:{name:r.name,dataType:r.dataType},details:r.value==null?void 0:JSON.stringify(r.value)})}};function ht(t){let e=t.get(Jn),a=t.get(ei),r=t.get(ti);return new $i().register(new Wd(a)).register(new Kd(r,a)).register(new Vd(t)).register(new Fd(t)).register(new Zi(e.connectionsMap,a))}function Jd(){return new Bd(Ei())}const Yd="@";function Hd({input:t}){let e="";return t.includes("@")&&(e=Qd(t),ie.debug("Included context",e)),{includeOtherCode:Mr(""),context:{plainText:e,schema:[],variables:[]}}}async function Gd({input:t}){let e="",a=[];if(t.includes("@")){let r=ht(Rr),s=r.parseAllContextIds(t);e=r.formatContextForAI(s);try{a=await r.getAttachmentsForContext(s),ie.debug("Included attachments",a.length)}catch(n){ie.error("Error getting attachments:",n)}}return{body:{includeOtherCode:Mr(""),context:{plainText:e,schema:[],variables:[]}},attachments:a}}function Qd(t){let e=ht(Rr),a=e.parseAllContextIds(t);return e.formatContextForAI(a)}function Xd(t,e=[]){return a=>{let r=t.map(s=>a.matchBefore(s)).find(Boolean);return!r||r&&r.from===r.to&&!a.explicit?null:{from:r==null?void 0:r.from,options:[...e]}}}function eu(t){var e;if((e=t.current)!=null&&e.view){let a=t.current.view.state.selection.main.from;t.current.view.dispatch({changes:{from:a,to:a,insert:"@"},selection:{anchor:a+1,head:a+1}}),t.current.view.focus(),Ti(t.current.view)}}function tu(t){if(t.trim().length===0)return[];if(!t.includes("```"))return[{language:"python",code:t}];let e=[],a=0,r=t.indexOf("```",a);for(;r!==-1;){let s=t.indexOf(`
`,r);if(s===-1){let d=t.slice(r+3),u=d.indexOf(" "),c=u===-1?d:d.slice(0,u),y=c==="markdown"?"markdown":c==="sql"?"sql":"python",f=u===-1?"":d.slice(u+1);f.trim()&&e.push({language:y,code:f.trim()});break}let n=t.slice(r+3,s).trim()||"";n=n==="markdown"?"markdown":n==="sql"?"sql":"python";let i=s+1,o=t.indexOf("```",i);if(o===-1){let d=t.slice(i).replace(/\n+$/,"");d.trim()&&e.push({language:n,code:d});break}let l=t.slice(i,o).replace(/\n+$/,"");l.trim()&&e.push({language:n,code:l}),a=o+3,r=t.indexOf("```",a)}return e.length===0&&e.push({language:"python",code:t}),e}var au=Sa(),un=()=>new Map,{valueAtom:zt,useActions:cn,createActions:zc,reducer:Uc}=ki(un,{addStagedCell:(t,e)=>{let{cellId:a,edit:r}=e;return new Map([...t,[a,r]])},removeStagedCell:(t,e)=>{let a=new Map(t);return a.delete(e),a},clearStagedCells:()=>un()});function pn(t){let e=(0,au.c)(26),{addStagedCell:a,removeStagedCell:r,clearStagedCells:s}=cn(),{createNewCell:n}=Pr(),i=eo(),o=(0,O.useRef)(null),l;e[0]!==a||e[1]!==n?(l=x=>{let C=Lr.create();return a({cellId:C,edit:{type:"add_cell"}}),n({cellId:"__end__",code:x,before:!1,newCellId:C}),C},e[0]=a,e[1]=n,e[2]=l):l=e[2];let d=l,u;e[3]===t?u=e[4]:(u=x=>{let{cellId:C,code:S}=x;if(!t.get(zt).has(C)){ie.error("Staged cell not found",{cellId:C});return}let D=ai(C);if(!D){ie.error("Editor for this cell not found",{cellId:C});return}Ia(D,S)},e[3]=t,e[4]=u);let c=u,y;e[5]!==i||e[6]!==r?(y=x=>{r(x),i({cellId:x})},e[5]=i,e[6]=r,e[7]=y):y=e[7];let f=y,b;e[8]!==s||e[9]!==i||e[10]!==t?(b=()=>{let x=t.get(zt);for(let C of x.keys())i({cellId:C});s()},e[8]=s,e[9]=i,e[10]=t,e[11]=b):b=e[11];let h=b,p;e[12]!==a||e[13]!==n||e[14]!==d||e[15]!==c?(p=x=>{e:switch(x.type){case"text-start":o.current=new ru(d,c,a,n);break e;case"text-delta":if(!o.current){ie.error("Cell creation stream not found");return}o.current.stream(x);break e;case"text-end":case"finish":if(!o.current){ie.error("Cell creation stream not found");return}o.current.stop();break e;default:ie.error("Unknown chunk type",{chunk:x})}},e[12]=a,e[13]=n,e[14]=d,e[15]=c,e[16]=p):p=e[16];let m=p,_;return e[17]!==a||e[18]!==s||e[19]!==d||e[20]!==h||e[21]!==f||e[22]!==m||e[23]!==r||e[24]!==c?(_={createStagedCell:d,updateStagedCell:c,addStagedCell:a,removeStagedCell:r,clearStagedCells:s,deleteStagedCell:f,deleteAllStagedCells:h,onStream:m},e[17]=a,e[18]=s,e[19]=d,e[20]=h,e[21]=f,e[22]=m,e[23]=r,e[24]=c,e[25]=_):_=e[25],_}var ru=class{constructor(t,e,a,r){j(this,"createdCells",[]);j(this,"buffer","");j(this,"hasMarimoImport",!1);this.onCreateCell=t,this.onUpdateCell=e,this.addStagedCell=a,this.createNewCell=r}stream(t){let e=t.delta;this.buffer+=e;let a=tu(this.buffer);for(let[r,s]of a.entries())if(r<this.createdCells.length){this.addMarimoImport(s.language);let n=this.createdCells[r];this.createdCells[r]={...n,cell:s},this.onUpdateCell({cellId:n.cellId,code:s.code,language:s.language})}else{let n=this.onCreateCell(s.code);this.createdCells.push({cellId:n,cell:s})}}addMarimoImport(t){var a;if(this.hasMarimoImport||t==="python")return;let e=Qi({autoInstantiate:!1,createNewCell:this.createNewCell,fromCellId:(a=this.createdCells[0])==null?void 0:a.cellId,before:!0});e&&this.addStagedCell({cellId:e,edit:{type:"add_cell"}}),this.hasMarimoImport=!0}stop(){this.buffer=""}},su={baseDescription:"Perform editing operations on the current notebook. You should prefer to create new cells unless you need to edit existing cells. Call this tool multiple times to perform multiple edits. Separate code into logical individual cells to take advantage of the notebook's reactive execution model.",prerequisites:["If you are updating existing cells, you need the cellIds. If they are not known, call the lightweight_cell_map_tool to find out."],additionalInfo:`
  Args:
    edit (object): The editing operation to perform with the following structure:
      - type: One of "update_cell", "add_cell", or "delete_cell"
      - code (string, optional): Required for "update_cell" and "add_cell" operations. The code content for the cell.
      - position (object): Always present, with the following structure:
        - type: One of "relative", "column_end", or "notebook_end". Not needed for "delete_cell" or "update_cell" operations.
        - cellId (string, optional): Required for "update_cell", "delete_cell", and "add_cell" with "relative" position type
        - columnIndex (number, optional): Required for "add_cell" with "column_end" position type (0-based index)
        - before (boolean, optional): Required for "add_cell" with "relative" position type (true to add before, false to add after)

    Operation types:
    - update_cell: Update the code of an existing cell. Requires: code, position.cellId
    - add_cell: Add a new cell to the notebook. Requires: code, and position based on position.type:
        - position.type "notebook_end": Add at the end of the notebook (no additional position fields needed)
        - position.type "relative": Add relative to an existing cell. Requires: position.cellId, position.before
        - position.type "column_end": Add at the end of a specific column. Requires: position.columnIndex
    - delete_cell: Delete an existing cell. Requires: position.cellId. For deleting cells, the user needs to accept the deletion to actually delete the cell, so you may still see the cell in the notebook on subsequent edits which is fine.

    For adding code, use the following guidelines:
    - Markdown cells: use mo.md(f"""{content}""") function to insert content.
    - SQL cells: use mo.sql(f"""{content}""") function to insert content. If a database engine is specified, use mo.sql(f"""{content}""", engine=engine) instead.

    Returns:
    - A result object containing standard tool metadata.`},nu=G({edit:G({type:Jt(["update_cell","add_cell","delete_cell"]),code:E().optional(),position:G({type:Jt(["relative","column_end","notebook_end"]).optional(),cellId:E().optional(),columnIndex:Zr().optional(),before:de().optional()})})}),iu=class{constructor(){j(this,"name","edit_notebook_tool");j(this,"description",su);j(this,"schema",nu);j(this,"outputSchema",sn);j(this,"mode",["agent"]);j(this,"handler",async({edit:t},e)=>{let{addStagedCell:a,createNewCell:r,store:s}=e;switch(t.type){case"update_cell":{let{position:n,code:i}=t,o=n.cellId;if(o){if(!i)throw new xe("Code is required for update_cell","CODE_REQUIRED_FOR_UPDATE_CELL",!0,"Provide the new code to update the cell")}else throw new xe("Cell ID is required for update_cell","CELL_ID_REQUIRED_FOR_UPDATE_CELL",!0,"Provide a cell ID to update");let l=s.get(tt);this.validateCellIdExists(o,l);let d=this.getCellEditorView(o,l);Oa(o);let u=s.get(zt).get(o);if((u==null?void 0:u.type)==="add_cell"){Ia(d,i);break}let c=d.state.doc.toString();a({cellId:o,edit:{type:"update_cell",previousCode:(u==null?void 0:u.previousCode)??c}}),Ia(d,i);break}case"add_cell":{let{position:n,code:i}=t,o="__end__",l=!1,d=Lr.create(),u=s.get(tt);switch(n.type){case"relative":{let c=n.cellId;if(!c)throw new xe("Cell ID is required for add_cell with relative position","TOOL_ERROR",!0,"Provide a cell ID to add the cell before");if(n.before===void 0)throw new xe("Before is required for add_cell with relative position","TOOL_ERROR",!0,`Provide a boolean value for before, true to add before cell ${c}, false to add after the cell`);this.validateCellIdExists(c,u),o=c,l=n.before;break}case"column_end":if(!n.columnIndex)throw new xe("Column index is required for add_cell with column_end position","TOOL_ERROR",!0,"Provide a column index to add the cell at the end of");o={type:"__end__",columnId:this.getColumnId(n.columnIndex,u)};break;case"notebook_end":break}r({cellId:o,before:l,code:i,newCellId:d}),a({cellId:d,edit:{type:"add_cell"}}),Oa(d);break}case"delete_cell":{let{position:n}=t,i=n.cellId;if(!i)throw new xe("Cell ID is required for delete_cell","CELL_ID_REQUIRED_FOR_DELETE_CELL",!0,"Provide a cell ID to delete");let o=s.get(tt);this.validateCellIdExists(i,o),a({cellId:i,edit:{type:"delete_cell",previousCode:this.getCellEditorView(i,o).state.doc.toString()}}),Oa(i);break}}return{status:"success",next_steps:["If you need to perform more edits, call this tool again.","You should use the lint notebook tool to check for errors and lint issues. Fix them by editing the notebook.","You should use the run stale cells tool to run the cells that have been edited or newly added. This allows you to see the output of the cells and fix any errors."]}})}validateCellIdExists(t,e){if(!e.cellIds.getColumns().some(a=>a.idSet.has(t)))throw new xe("Cell not found","CELL_NOT_FOUND",!1,"Check which cells exist in the notebook")}getColumnId(t,e){let a=e.cellIds.getColumns();if(t<0||t>=a.length)throw new xe("Column index is out of range","COLUMN_INDEX_OUT_OF_RANGE",!0,"Choose a column index between 0 and the number of columns in the notebook (0-based)");return a[t].id}getCellEditorView(t,e){let a=e.cellHandles[t].current;if(!(a!=null&&a.editorView))throw new xe("Cell editor not found","CELL_EDITOR_NOT_FOUND",!1,"Internal error, ask the user to report this error");return a.editorView}},ou=200,lu=3e4,du={baseDescription:"Run cells in the current notebook that are stale. Stale cells are cells that have been edited or newly added. You can run this tool after editing the notebook or when requested. The output of the ran cells will be returned alongside metadata."},mn=G({type:M("file"),url:E(),mediaType:E()}),uu=class{constructor(t){j(this,"name","run_stale_cells_tool");j(this,"description",du);j(this,"schema",G({}));j(this,"outputSchema",sn.extend({cellsToOutput:St(E(),G({consoleOutput:E().optional(),cellOutput:E().optional(),consoleAttachments:Be(mn).optional(),cellAttachments:Be(mn).optional()}).nullable()).optional()}));j(this,"mode",["agent"]);j(this,"handler",async(t,e)=>{let{prepareForRun:a,sendRun:r,store:s}=e,n=s.get(tt),i=oi(n);if(i.length===0)return{status:"success",message:"No stale cells found."};if(await Yi({cellIds:i,sendRun:r,prepareForRun:a,notebook:n}),!await this.waitForCellsToFinish(s,i,lu,this.postExecutionDelay))return{status:"success",message:"No output was returned because some cells have not finished executing"};let o=s.get(tt),l=new Map,d="",u=!1;for(let y of i){let f=on(y,o,{includeConsoleOutput:!0}),b,h,p=f.cellOutput,m=f.consoleOutputs,_=m&&m.length>0;if(!p&&!_){l.set(y,null);continue}p&&(b=this.formatOutputString(p),this.outputHasErrors(p)&&(u=!0)),_&&(h=m.map(x=>this.formatOutputString(x)).join(`
`),d+="Console output represents the stdout or stderr of the cell (eg. print statements).",m.some(x=>this.outputHasErrors(x))&&(u=!0)),l.set(y,{cellOutput:b,consoleOutput:h})}if(l.size===0)return{status:"success",message:"Stale cells have been run. No output was returned."};let c=["Review the output of the cells. The CellId is the key of the result object.",u?"There are errors in the cells. Please fix them by using the edit notebook tool and the given CellIds.":"You may edit the notebook further with the given CellIds."];return{status:"success",cellsToOutput:Object.fromEntries(l),message:d===""?void 0:d,next_steps:c}});this.postExecutionDelay=(t==null?void 0:t.postExecutionDelay)??ou}outputHasErrors(t){let{output:e}=t;return e.mimetype==="application/vnd.marimo+error"||e.mimetype==="application/vnd.marimo+traceback"}formatOutputString(t){let e="",{outputType:a,processedContent:r,imageUrl:s,output:n}=t;return a==="text"?(e+=`Output:
`,r?e+=r:typeof n.data=="string"?e+=n.data:e+=JSON.stringify(n.data)):a==="media"&&(e+=`Media Output: Contains ${n.mimetype} content`,s&&(e+=`
Image URL: ${s}`)),e}async waitForCellsToFinish(t,e,a,r){let s=i=>e.every(o=>{let l=i.cellRuntime[o];return(l==null?void 0:l.status)!=="running"&&(l==null?void 0:l.status)!=="queued"}),n=async()=>(r>0&&await new Promise(i=>setTimeout(i,r)),!0);if(s(t.get(tt)))return await n();try{return await Promise.race([Vn(tt,s),new Promise((i,o)=>setTimeout(()=>o(Error("timeout")),a))]),await n()}catch{return!1}}};function cu(t){let e=t.baseDescription;return t.whenToUse&&(e+=`

## When to use:
- ${t.whenToUse.join(`
- `)}`),t.avoidIf&&(e+=`

## Avoid if:
- ${t.avoidIf.join(`
- `)}`),t.prerequisites&&(e+=`

## Prerequisites:
- ${t.prerequisites.join(`
- `)}`),t.sideEffects&&(e+=`

## Side effects:
- ${t.sideEffects.join(`
- `)}`),t.additionalInfo&&(e+=`

## Additional info:
- ${t.additionalInfo}`),e}var hn,Ut;function pu(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(i){n[i]=r[i]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(i,o){return o(t,e,i)||i},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}const br=new(hn=ni(),Ut=class{constructor(t=[]){j(this,"tools",new Map);this.tools=new Map(t.map(e=>[e.name,e]))}has(t){return this.tools.has(t)}getToolOrThrow(t){let e=this.tools.get(t);if(!e)throw Error(`Tool ${t} not found`);return e}async invoke(t,e,a){var o;let r=this.getToolOrThrow(t),s=r.handler,n=r.schema,i=r.outputSchema;try{let l=await n.safeParseAsync(e);if(l.error)throw new xe(`Tool ${t} returned invalid input: ${$r(l.error)}`,"INVALID_ARGUMENTS",!0,"Please check the arguments and try again.");let d=l.data,u=await s(d,a),c=await i.safeParseAsync(u);if(c.error){let y=$r(c.error);throw Error(`Tool ${t} returned invalid output: ${y}`)}return{tool_name:t,result:c.data,error:null}}catch(l){return l instanceof xe?{tool_name:t,result:null,error:l.toStructuredString()}:{tool_name:t,result:null,error:new xe(l instanceof Error?l.message:String(l),"TOOL_ERROR",!1,"Check the error message and try again with valid arguments.",{args:e,errorType:((o=l==null?void 0:l.constructor)==null?void 0:o.name)??typeof l}).toStructuredString()}}}getToolSchemas(t){return[...this.tools.values()].filter(e=>e.mode.includes(t)).map(e=>({name:e.name,description:cu(e.description),parameters:Fr(e.schema),source:"frontend",mode:e.mode}))}},pu(Ut.prototype,"getToolSchemas",[hn],Object.getOwnPropertyDescriptor(Ut.prototype,"getToolSchemas"),Ut.prototype),Ut)([new iu,new uu]);function xr(t,e){return new Promise(a=>{let r=new FileReader;r.readAsDataURL(t),r.onload=s=>{var n;if((n=s.target)!=null&&n.result){let i=s.target.result;a(e==="base64"?i.slice(i.indexOf(",")+1):i)}}})}function mu(t){return Promise.all(t.map(e=>xr(e,"base64").then(a=>[e.name,a])))}function hu(t){return t.length>50?`${t.slice(0,50)}...`:t}async function fu(t){return await Promise.all(t.map(async e=>({type:"file",mediaType:e.type,filename:e.name,url:await xr(e,"dataUrl")})))}function gu(t){if(t.length===0)return!1;let e=t.at(-1);if(!e||e.role!=="assistant"||!e.parts)return!1;let a=e.parts;return a.length===0?!1:a[a.length-1].type==="reasoning"}function fn(t){return t.map(e=>e.type==="text"?e.text:"").join(`
`)}async function gn(t){let e=await Gd({input:fn(t.flatMap(r=>r.parts))});function a(r,s){let n=[...r.parts];return s&&n.push(...e.attachments),{role:r.role,content:fn(r.parts),parts:n}}return{...e.body,messages:t.map((r,s)=>a(r,s===t.length-1))}}async function yn({invokeAiTool:t,addToolResult:e,toolCall:a,toolContext:r}){try{if(br.has(a.toolName)){let s=await br.invoke(a.toolName,a.input,r);e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}else{let s=await t({toolName:a.toolName,arguments:a.input});e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}}catch(s){ie.error("Tool call failed:",s),e({tool:a.toolName,toolCallId:a.toolCallId,output:`Error: ${s instanceof Error?s.message:String(s)}`})}}function yu(t){var o;if(t.length===0)return!1;let e=t[t.length-1],a=e.parts;if(a.length===0||e.role!=="assistant")return!1;let r=a.filter(l=>l.type.startsWith("tool-"));if(r.length===0)return!1;let s=r.every(l=>l.state==="output-available"),n=a[a.length-1],i=n.type==="text"&&((o=n.text)==null?void 0:o.trim().length)>0;return ie.warn("All tool calls completed: %s",s),s&&!i}function vu(t){return yi.define({combine:e=>e[0]??t})}var vn=vu({}),wr=Qt.define(),wa=Qt.define(),_u=50,kr=Ht.define({create(){return{prompts:[],navigationIndex:-1,originalText:""}},update(t,e){var r,s;let a={...t};e.docChanged&&t.navigationIndex!==-1&&(e.effects.some(n=>n.is(wa)||n.is(wr))||(a.navigationIndex=-1,a.originalText=""));for(let n of e.effects)if(n.is(wr)){let i=n.value.trim();i&&(a.prompts=[i,...t.prompts.filter(o=>o!==i)].slice(0,_u),(s=(r=e.state.facet(vn)).save)==null||s.call(r,a.prompts)),a.navigationIndex=-1,a.originalText=""}else n.is(wa)&&(a.navigationIndex=n.value.index,a.originalText=n.value.originalText);return a}}),bu=t=>{let e=t.state.field(kr),a=t.state.doc;if(e.prompts.length===0)return!1;let r,s=e.originalText;if(e.navigationIndex===-1){if(a.length>0)return!1;r=0,s=a.toString()}else if(r=Math.min(e.navigationIndex+1,e.prompts.length-1),r===e.navigationIndex)return!1;let n=e.prompts[r];return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},effects:wa.of({index:r,originalText:s})}),!0},xu=t=>{let e=t.state.field(kr);if(e.navigationIndex===-1)return!1;let a,r;return e.navigationIndex===0?(a=e.originalText,r=-1):(r=e.navigationIndex-1,a=e.prompts[r]??""),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:a},effects:wa.of({index:r,originalText:e.originalText})}),!0};const _n=t=>{let e=t.state.doc.toString();return e.trim()?(t.dispatch({effects:wr.of(e)}),!0):!1};function wu(t={}){let{storage:e,defaultKeymap:a=!0}=t,r=[kr.init(()=>{var s;return{prompts:((s=e==null?void 0:e.load)==null?void 0:s.call(e))??[],navigationIndex:-1,originalText:""}}),vn.of(e??{})];return a&&r.push(Gt.of([{key:"ArrowUp",run:bu},{key:"ArrowDown",run:xu}])),r}const Cr=Qt.define(),He=Ht.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Cr)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}}),ku=Ht.define({create(){return{onResourceClick:void 0,onResourceMouseOver:void 0,onResourceMouseOut:void 0,onPromptSubmit:void 0}},update(t){return t}}),Cu=Qt.define();Ht.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Cu)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}});const Eu=(t,e)=>async a=>{let r=a.matchBefore(/@(\w+)?/);if(!r||r.from===r.to&&!a.explicit)return null;let s=await t();if(s.length===0)return null;let n=Cr.of(new Map(s.map(o=>[o.uri,o])));a.view&&a.view.dispatch({effects:n});let i=s.map(o=>({label:`@${o.name}`,displayLabel:o.name,detail:o.uri,info:o.description||void 0,type:o.mimeType?"constant":"variable",boost:o.description?100:0,...e==null?void 0:e(o),apply:(l,d,u,c)=>{l.dispatch({changes:{from:u,to:c,insert:`@${o.uri} `}})}}));return{from:r.from,options:i}},Tu=/@[\w-]+:\/\/(?!\/)[^\s]+/;function ot(t){return t.matchAll(new RegExp(Tu.source,"g"))}var Iu=class extends qr{constructor(e,a){super();j(this,"resource");j(this,"view");this.resource=e,this.view=a}eq(e){return e.resource.uri===this.resource.uri}toDOM(){let e=document.createElement("span");e.className="cm-resource-widget",e.textContent=`@${this.resource.name}`;let a=this.view.state.field(ku,!1),r=a==null?void 0:a.onResourceClick,s=a==null?void 0:a.onResourceMouseOver,n=a==null?void 0:a.onResourceMouseOut;return r&&(e.style.cursor="pointer",e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),r(this.resource)})),s&&e.addEventListener("mouseover",i=>{i.preventDefault(),i.stopPropagation(),s(this.resource)}),n&&e.addEventListener("mouseout",i=>{i.preventDefault(),i.stopPropagation(),n(this.resource)}),e}},Su=class extends qr{constructor(e,a){super();j(this,"uri");j(this,"view");this.uri=e,this.view=a}eq(e){return e.uri===this.uri}toDOM(){let e=document.createElement("span");return e.className="cm-not-found-resource-widget",e.textContent=`@${this.uri.split("://")[1]??this.uri}`,e}};function bn(t){let e=t.state.field(He),a=[];for(let{from:r,to:s}of t.visibleRanges){let n=t.state.doc.sliceString(r,s);for(let i of ot(n)){let o=r+i.index,l=i[0].slice(1),d=e.get(l);d?a.push(Aa.replace({widget:new Iu(d,t)}).range(o,o+i[0].length)):a.push(Aa.replace({widget:new Su(l,t)}).range(o,o+i[0].length))}}return Aa.set(a)}const Au=_i.fromClass(class{constructor(t){j(this,"decorations");this.decorations=bn(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(a=>a.is(Cr))))&&(this.decorations=bn(t.view))}},{decorations:t=>t.decorations});function Ou(t){let e=document.createElement("div");e.className="cm-tooltip-cursor";let a=document.createElement("div");if(a.className="cm-tooltip-cursor-title",a.textContent=`${t.name} (${t.uri})`,e.appendChild(a),t.description){let r=document.createElement("div");r.className="cm-tooltip-cursor-description",r.textContent=t.description,e.appendChild(r)}if(t.mimeType){let r=document.createElement("div");r.className="cm-tooltip-cursor-mimetype",r.textContent=t.mimeType,e.appendChild(r)}return{dom:e}}function Ru(t,e,a,r=0){for(let s of ot(t)){let n=r+s.index,i=n+s[0].length;if(e>=n&&e<=i){let o=s[0].slice(1),l=a.get(o);if(l)return{resource:l,start:n,end:i}}}return null}function Nu(t){return bi((e,a)=>{let{from:r,text:s}=e.state.doc.lineAt(a),n=Ru(s,a,e.state.field(He),r);return n?{pos:n.start,end:n.end,above:!0,create(){return(t.createTooltip??Ou)(n.resource)}}:null})}function Mu(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(ot(n));if(i.length===0)return null;for(let o of i){let l=s.from+o.index,d=l+o[0].length,u=o[0].slice(1);if(e===d&&a.has(u))return{from:l,to:d,uri:u}}return null}function ju(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e).to,n=r.sliceString(e,s),i=Array.from(ot(n));if(i.length===0)return null;let o=i[0];if(!o||o.index!==0)return null;let l=e,d=e+o[0].length,u=o[0].slice(1);return a.has(u)?{from:l,to:d,uri:u}:null}function xn(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(ot(n));for(let o of i){let l=s.from+o.index,d=l+o[0].length,u=o[0].slice(1);if(e>l&&e<d&&a.has(u))return{from:l,to:d,uri:u}}return null}function Pu(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,e),i=Array.from(ot(n)),o=null;for(let l of i){let d=s.from+l.index,u=d+l[0].length,c=l[0].slice(1);a.has(c)&&u<=e&&(e>u?o=u:e===u&&(o=d))}return o}function Lu(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(ot(n));for(let o of i){let l=s.from+o.index,d=l+o[0].length,u=o[0].slice(1);if(a.has(u)&&l>=e){if(e<l)return l;if(e===l)return d}}return null}const Du=gi.transactionFilter.of(t=>{var r;let e=t.annotation(vi.userEvent);if(!e)return t;let a=t.startState.selection.main;if(!a.empty)return t;if(e==="input.type"||e.startsWith("input")){if(t.changes.empty)return t;let s=t.startState.field(He),n=t.startState.doc,i=!1,o=0,l=[];if(t.changes.iterChanges((d,u,c,y,f)=>{let b=f.toString(),h=d;if(/^\s+$/.test(b)){l.push({from:d,to:u,insert:b});return}let p=n.lineAt(h),m=n.sliceString(p.from,p.to),_=Array.from(ot(m)),x=!1,C=!1;for(let D of _){let $=p.from+D.index,R=$+D[0].length,K=D[0].slice(1);if(s.has(K)){if(h===$){let L=h>0?n.sliceString(h-1,h):"";L!==""&&L!==" "&&L!==`
`&&L!=="	"&&(x=!0)}if(h===R){let L=h<n.length?n.sliceString(h,h+1):"";(L===""||L!==" "&&L!==`
`&&L!=="	")&&(C=!0)}}}let S=b;x&&(S=` ${S}`,o+=1),C&&(S=` ${S}`,o+=1),S!==b&&(i=!0),l.push({from:d,to:u,insert:S})}),i)return[{changes:l,selection:t.selection?{anchor:t.selection.main.anchor+o,head:t.selection.main.head+o}:void 0,scrollIntoView:t.scrollIntoView}]}if(e==="delete.backward"||e==="delete.forward"){let s=null;return e==="delete.backward"?s=Mu(t.startState,a.head):e==="delete.forward"&&(s=ju(t.startState,a.head)),s?[{changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from},scrollIntoView:!0}]:t}if((r=t.selection)!=null&&r.main.empty&&a.empty&&!e.startsWith("input")&&e!=="input.type"){let s=a.head,n=t.selection.main.head,i=null;if(n<s){let o=xn(t.startState,s);i=o&&s>o.from?o.from:Pu(t.startState,s)}else if(n>s){let o=xn(t.startState,s);i=o&&s<o.to?o.to:Lu(t.startState,s)}if(i!==null&&i!==n)return[{selection:{anchor:i},scrollIntoView:!0}]}return t}),$u=Vr.baseTheme({".cm-resource-widget":{background:"light-dark(rgba(86,156,214,0.08),rgba(86,156,214,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#2367a2,#7ecbff)",fontWeight:"500"},".cm-resource-widget:hover":{background:"light-dark(rgba(86,156,214,0.18),rgba(86,156,214,0.28))"},".cm-not-found-resource-widget":{background:"light-dark(rgba(151,151,151,0.08),rgba(151,151,151,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#b00020,#ff8080)",fontWeight:"500"}});var wn="_none_",Zu=[{uri:"",name:"No resources",type:wn,data:{}}],Fu={info:"Variables, dataframes, and tables will appear here.",apply:()=>{}};function zu(t){let{language:e,store:a,onAddFiles:r}=t;return[e.data.of({autocomplete:Eu(async()=>{let s=ht(a).getAllItems();return s.length===0?Zu:s},s=>{var n;return s.type===wn?Fu:((n=ht(a).getProvider(s.type))==null?void 0:n.formatCompletion(s))||{}})}),Ur.high(Gt.of([{key:"Tab",run:s=>Ii(s)}])),dn.of({addAttachment:s=>r==null?void 0:r([s])}),...r?[e.data.of({autocomplete:Jd().createCompletionSource()})]:[],Au,Du,He.init(()=>{let s=ht(a).getAllItems();return new Map(s.map(n=>[n.uri,n]))}),$u,Nu({createTooltip:s=>{let n=ht(a).getProvider(s.type);if(!n)return ie.warn("No provider found for resource",s),Vt(s.description||s.name);let i=n.formatCompletion(s),o=s.description||s.name;if(!(i!=null&&i.info))return Vt(o);if(typeof i.info=="string")return Vt(i.info);let l=i.info(i);return l?"dom"in l?{dom:l.dom}:"then"in l?(ie.warn("info is a promise. This is not supported",l),Vt(o)):{dom:l}:Vt(o)}})]}function Vt(t){let e=document.createElement("div");return e.innerHTML=t,{dom:e}}var ka=Sa(),I=Ta(fi(),1);const kn=t=>{let{handleAcceptCompletion:e,handleDeclineCompletion:a,isLoading:r,hasCompletion:s}=t;return n=>{let i=mi()?n.metaKey:n.ctrlKey;i&&n.key==="Enter"&&!r&&s&&e(),(n.key==="Delete"||n.key==="Backspace")&&i&&n.shiftKey&&(a(),n.preventDefault(),n.stopPropagation())}},Cn=t=>{let e=(0,ka.c)(22),{isLoading:a,onAccept:r,onDecline:s,size:n,acceptShortcut:i,declineShortcut:o,multipleCompletions:l}=t,d=n===void 0?"sm":n,u=i===void 0?"Mod-\u21B5":i,c=o===void 0?"Shift-Mod-Delete":o,y=l===void 0?!1:l,f=y&&" all",b;e[0]===u?b=e[1]:(b=(0,I.jsx)(Rt,{className:"ml-1 inline",shortcut:u}),e[0]=u,e[1]=b);let h;e[2]!==f||e[3]!==b?(h=(0,I.jsxs)("span",{className:"text-(--grass-11) opacity-100",children:["Accept",f," ",b]}),e[2]=f,e[3]=b,e[4]=h):h=e[4];let p;e[5]!==a||e[6]!==r||e[7]!==d||e[8]!==h?(p=(0,I.jsx)(je,{"data-testid":"accept-completion-button",variant:"text",size:d,className:"mb-0",disabled:a,onClick:r,children:h}),e[5]=a,e[6]=r,e[7]=d,e[8]=h,e[9]=p):p=e[9];let m=y&&" all",_;e[10]===c?_=e[11]:(_=(0,I.jsx)(Rt,{className:"ml-1 inline",shortcut:c}),e[10]=c,e[11]=_);let x;e[12]!==_||e[13]!==m?(x=(0,I.jsxs)("span",{className:"text-(--red-10)",children:["Reject",m," ",_]}),e[12]=_,e[13]=m,e[14]=x):x=e[14];let C;e[15]!==s||e[16]!==d||e[17]!==x?(C=(0,I.jsx)(je,{"data-testid":"decline-completion-button",variant:"text",size:d,className:"mb-0 pl-1 pr-0",onClick:s,children:x}),e[15]=s,e[16]=d,e[17]=x,e[18]=C):C=e[18];let S;return e[19]!==C||e[20]!==p?(S=(0,I.jsxs)(I.Fragment,{children:[p,C]}),e[19]=C,e[20]=p,e[21]=S):S=e[21],S},Uu=t=>{let e=(0,ka.c)(9),{isLoading:a,onAccept:r,onDecline:s,runCell:n}=t,i;e[0]!==a||e[1]!==r||e[2]!==n?(i=(0,I.jsx)(En,{isLoading:a,onAccept:r,size:"xs",runCell:n}),e[0]=a,e[1]=r,e[2]=n,e[3]=i):i=e[3];let o;e[4]===s?o=e[5]:(o=(0,I.jsx)(Tn,{onDecline:s,size:"xs"}),e[4]=s,e[5]=o);let l;return e[6]!==i||e[7]!==o?(l=(0,I.jsxs)(I.Fragment,{children:[i,o]}),e[6]=i,e[7]=o,e[8]=l):l=e[8],l},En=t=>{let e=(0,ka.c)(33),{isLoading:a,onAccept:r,multipleCompletions:s,size:n,buttonStyles:i,acceptShortcut:o,runCell:l,playButtonStyles:d}=t,u=s===void 0?!1:s,c=n===void 0?"sm":n,y;e[0]!==r||e[1]!==l?(y=()=>{r(),l&&l()},e[0]=r,e[1]=l,e[2]=y):y=e[2];let f=y,b=u?"Accept all":"Accept";if(l){let _=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-r-none ${i}`,x;e[3]===o?x=e[4]:(x=o&&(0,I.jsx)(Rt,{className:"ml-1 inline",shortcut:o}),e[3]=o,e[4]=x);let C;e[5]!==a||e[6]!==r||e[7]!==c||e[8]!==_||e[9]!==x||e[10]!==b?(C=(0,I.jsxs)(je,{variant:"text",size:c,disabled:a,onClick:r,className:_,children:[b,x]}),e[5]=a,e[6]=r,e[7]=c,e[8]=_,e[9]=x,e[10]=b,e[11]=C):C=e[11];let S=u?"Accept and run all cells":"Accept and run cell",D=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-l-none px-1.5 ${d}`,$;e[12]===Symbol.for("react.memo_cache_sentinel")?($=(0,I.jsx)(Fi,{className:"h-2.5 w-2.5"}),e[12]=$):$=e[12];let R;e[13]!==f||e[14]!==a||e[15]!==c||e[16]!==D?(R=(0,I.jsx)(je,{variant:"text",size:c,disabled:a,onClick:f,className:D,children:$}),e[13]=f,e[14]=a,e[15]=c,e[16]=D,e[17]=R):R=e[17];let K;e[18]!==R||e[19]!==S?(K=(0,I.jsx)(Bi,{content:S,children:R}),e[18]=R,e[19]=S,e[20]=K):K=e[20];let L;return e[21]!==K||e[22]!==C?(L=(0,I.jsxs)("div",{className:"flex",children:[C,K]}),e[21]=K,e[22]=C,e[23]=L):L=e[23],L}let h=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded px-3 ${i}`,p;e[24]===o?p=e[25]:(p=o&&(0,I.jsx)(Rt,{className:"ml-1 inline",shortcut:o}),e[24]=o,e[25]=p);let m;return e[26]!==a||e[27]!==r||e[28]!==c||e[29]!==h||e[30]!==p||e[31]!==b?(m=(0,I.jsxs)(je,{variant:"text",size:c,disabled:a,onClick:r,className:h,children:[b,p]}),e[26]=a,e[27]=r,e[28]=c,e[29]=h,e[30]=p,e[31]=b,e[32]=m):m=e[32],m},Tn=t=>{let e=(0,ka.c)(8),{onDecline:a,multipleCompletions:r,size:s,className:n,declineShortcut:i}=t,o=r===void 0?!1:r,l=s===void 0?"sm":s,d=`h-6 text-(--red-10) bg-(--red-3)/60 hover:bg-(--red-3)
    dark:bg-(--red-4)/80 dark:hover:bg-(--red-3) rounded px-3 font-semibold
    active:bg-(--red-5) dark:active:bg-(--red-4)
    border-(--red-6) border hover:shadow-xs ${n}`,u=o&&" all",c;e[0]===i?c=e[1]:(c=i&&(0,I.jsx)(Rt,{className:"ml-1 inline",shortcut:i}),e[0]=i,e[1]=c);let y;return e[2]!==a||e[3]!==l||e[4]!==d||e[5]!==u||e[6]!==c?(y=(0,I.jsxs)(je,{variant:"text",size:l,onClick:a,className:d,children:["Reject",u,c]}),e[2]=a,e[3]=l,e[4]=d,e[5]=u,e[6]=c,e[7]=y):y=e[7],y};var Vu=class extends tr{constructor(t,e){super(t),this.onChunkReceived=e}processResponseStream(t){let e=this.onChunkReceived;return super.processResponseStream(t).pipeThrough(new TransformStream({async transform(a,r){e(a),r.enqueue(a)}}))}},In=Sa(),qu=Yn("marimo:ai-language","python",Qn),Sn="marimo:ai-prompt-history",An=new Kn(Be(E()),()=>[]);const Bu=t=>{let e=(0,In.c)(89),{onClose:a}=t,r=Nr(),[s,n]=(0,O.useState)(""),{deleteAllStagedCells:i,clearStagedCells:o,onStream:l,addStagedCell:d}=pn(r),[u,c]=qn(qu),y=hi(),{invokeAiTool:f,sendRun:b}=Ci(),h=Un(zt),p=(0,O.useRef)(null),{createNewCell:m,prepareForRun:_}=Pr(),x;e[0]!==d||e[1]!==m||e[2]!==_||e[3]!==b||e[4]!==r?(x={store:r,addStagedCell:d,createNewCell:m,prepareForRun:_,sendRun:b},e[0]=d,e[1]=m,e[2]=_,e[3]=b,e[4]=r,e[5]=x):x=e[5];let C=x,S;if(e[6]!==u||e[7]!==l||e[8]!==y){let Ce;e[10]===u?Ce=e[11]:(Ce=async Kt=>{let $n=await gn(Kt.messages);return{body:{...Kt,...$n,code:"",prompt:"",language:u}}},e[10]=u,e[11]=Ce);let et;e[12]===l?et=e[13]:(et=Kt=>{l(Kt)},e[12]=l,e[13]=et),S=new Vu({api:y.getAiURL("completion").toString(),headers:y.headers(),prepareSendMessagesRequest:Ce},et),e[6]=u,e[7]=l,e[8]=y,e[9]=S}else S=e[9];let{sendMessage:D,stop:$,status:R,addToolResult:K}=rn({experimental_throttle:100,transport:S,onToolCall:async Ce=>{let{toolCall:et}=Ce;await yn({invokeAiTool:f,addToolResult:L,toolCall:{toolName:et.toolName,toolCallId:et.toolCallId,input:et.input},toolContext:C})},onError:Wu}),L=K,B=R==="streaming"||R==="submitted",Q=h.size>0,te=h.size>1,Y;e[14]!==i||e[15]!==s||e[16]!==B||e[17]!==D?(Y=()=>{var Ce;B||((Ce=p.current)!=null&&Ce.view&&_n(p.current.view),i(),D({text:s}))},e[14]=i,e[15]=s,e[16]=B,e[17]=D,e[18]=Y):Y=e[18];let W=Y,H;e[19]===Symbol.for("react.memo_cache_sentinel")?(H=(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(to,{className:"size-4 mr-2"}),"Python"]}),e[19]=H):H=e[19];let oe=H,X;e[20]===Symbol.for("react.memo_cache_sentinel")?(X=(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Gn,{className:"size-4 mr-2"}),"SQL"]}),e[20]=X):X=e[20];let lt=X,Re=u==="python"?oe:lt,we;e[21]===Symbol.for("react.memo_cache_sentinel")?(we=(0,I.jsx)(wi,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"}),e[21]=we):we=e[21];let pe;e[22]===Re?pe=e[23]:(pe=(0,I.jsx)(ji,{asChild:!0,children:(0,I.jsxs)(je,{variant:"text",className:"ml-2",size:"xs","data-testid":"language-button",children:[Re,we]})}),e[22]=Re,e[23]=pe);let $e,Ge;e[24]===Symbol.for("react.memo_cache_sentinel")?($e=(0,I.jsx)("div",{className:"px-2 py-1 font-semibold",children:"Select language"}),Ge=(0,I.jsx)(Mi,{}),e[24]=$e,e[25]=Ge):($e=e[24],Ge=e[25]);let ke;e[26]===c?ke=e[27]:(ke=(0,I.jsx)(Kr,{onClick:()=>c("python"),children:oe}),e[26]=c,e[27]=ke);let Ze;e[28]===c?Ze=e[29]:(Ze=(0,I.jsx)(Kr,{onClick:()=>c("sql"),children:lt}),e[28]=c,e[29]=Ze);let Fe;e[30]!==ke||e[31]!==Ze?(Fe=(0,I.jsxs)(Pi,{align:"center",children:[$e,Ge,ke,Ze]}),e[30]=ke,e[31]=Ze,e[32]=Fe):Fe=e[32];let ft;e[33]!==pe||e[34]!==Fe?(ft=(0,I.jsxs)(Li,{modal:!1,children:[pe,Fe]}),e[33]=pe,e[34]=Fe,e[35]=ft):ft=e[35];let It=ft,Ne;e[36]!==o||e[37]!==a?(Ne=()=>{o(),a()},e[36]=o,e[37]=a,e[38]=Ne):Ne=e[38];let ze=Ne,V;e[39]===i?V=e[40]:(V=()=>{i()},e[39]=i,e[40]=V);let z=V,ae;e[41]===Symbol.for("react.memo_cache_sentinel")?(ae=(0,I.jsx)(Ui,{className:"size-4 text-(--blue-11) mr-2"}),e[41]=ae):ae=e[41];let U;e[42]!==i||e[43]!==a?(U=()=>{i(),a()},e[42]=i,e[43]=a,e[44]=U):U=e[44];let _e;e[45]===Symbol.for("react.memo_cache_sentinel")?(_e=Ce=>{n(Ce)},e[45]=_e):_e=e[45];let me;e[46]!==ze||e[47]!==z||e[48]!==Q||e[49]!==B?(me=kn({handleAcceptCompletion:ze,handleDeclineCompletion:z,isLoading:B,hasCompletion:Q}),e[46]=ze,e[47]=z,e[48]=Q,e[49]=B,e[50]=me):me=e[50];let se;e[51]!==s||e[52]!==W||e[53]!==U||e[54]!==me?(se=(0,I.jsx)(On,{inputRef:p,onClose:U,value:s,onChange:_e,onSubmit:W,onKeyDown:me}),e[51]=s,e[52]=W,e[53]=U,e[54]=me,e[55]=se):se=e[55];let re;e[56]!==B||e[57]!==$?(re=B&&(0,I.jsxs)(je,{"data-testid":"stop-completion-button",variant:"text",size:"sm",className:"mb-0",onClick:$,children:[(0,I.jsx)(Di,{className:"animate-spin mr-1",size:14}),"Stop"]}),e[56]=B,e[57]=$,e[58]=re):re=e[58];let fe;e[59]===Symbol.for("react.memo_cache_sentinel")?(fe=(0,I.jsx)(ro,{className:"size-4"}),e[59]=fe):fe=e[59];let Ue;e[60]===W?Ue=e[61]:(Ue=(0,I.jsx)(je,{variant:"text",size:"sm",onClick:W,title:"Submit",children:fe}),e[60]=W,e[61]=Ue);let dt;e[62]===Symbol.for("react.memo_cache_sentinel")?(dt=(0,I.jsx)(Ri,{className:"size-4"}),e[62]=dt):dt=e[62];let Ve;e[63]===a?Ve=e[64]:(Ve=(0,I.jsx)(je,{variant:"text",size:"sm",className:"mb-0 px-1",onClick:a,children:dt}),e[63]=a,e[64]=Ve);let le;e[65]!==se||e[66]!==re||e[67]!==Ue||e[68]!==Ve?(le=(0,I.jsxs)("div",{className:"flex items-center px-3",children:[ae,se,re,Ue,Ve]}),e[65]=se,e[66]=re,e[67]=Ue,e[68]=Ve,e[69]=le):le=e[69];let ge=le,Qe;e[70]===Symbol.for("react.memo_cache_sentinel")?(Qe=zr("flex flex-col w-full gap-2 py-2"),e[70]=Qe):Qe=e[70];let Xe;e[71]===Q?Xe=e[72]:(Xe=!Q&&(0,I.jsxs)("span",{className:"text-xs text-muted-foreground px-3 flex flex-col gap-1",children:[(0,I.jsxs)("span",{children:["You can mention"," ",(0,I.jsx)("span",{className:"text-(--cyan-11)",children:"@dataframe"})," or"," ",(0,I.jsx)("span",{className:"text-(--cyan-11)",children:"@sql_table"})," to pull additional context such as column names."]}),(0,I.jsx)("span",{children:"Code from other cells is automatically included."})]}),e[71]=Q,e[72]=Xe);let Me;e[73]!==ze||e[74]!==z||e[75]!==Q||e[76]!==B||e[77]!==te?(Me=Q&&(0,I.jsx)(Cn,{isLoading:B,onAccept:ze,onDecline:z,size:"sm",multipleCompletions:te}),e[73]=ze,e[74]=z,e[75]=Q,e[76]=B,e[77]=te,e[78]=Me):Me=e[78];let Bt;e[79]===Symbol.for("react.memo_cache_sentinel")?(Bt=(0,I.jsx)(Oi,{triggerClassName:"h-7 text-xs max-w-64",iconSize:"small",forRole:"edit"}),e[79]=Bt):Bt=e[79];let gt;e[80]===It?gt=e[81]:(gt=(0,I.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[It,Bt]}),e[80]=It,e[81]=gt);let yt;e[82]!==Xe||e[83]!==Me||e[84]!==gt?(yt=(0,I.jsxs)("div",{className:"flex flex-row justify-between -mt-1 ml-1 mr-3",children:[Xe,Me,gt]}),e[82]=Xe,e[83]=Me,e[84]=gt,e[85]=yt):yt=e[85];let Wt;return e[86]!==ge||e[87]!==yt?(Wt=(0,I.jsxs)("div",{className:Qe,children:[ge,yt]}),e[86]=ge,e[87]=yt,e[88]=Wt):Wt=e[88],Wt},On=t=>{let e=(0,In.c)(35),{value:a,placeholder:r,inputRef:s,className:n,onChange:i,onSubmit:o,onKeyDown:l,onClose:d,onAddFiles:u,additionalCompletions:c,maxHeight:y}=t,f=o,b=d,h=Nr(),{theme:p}=qi(),m;e[0]===c?m=e[1]:(m=oe=>c?Xd([c.triggerCompletionRegex],c.completions)(oe):null,e[0]=c,e[1]=m);let _=Ki(m),x,C,S,D;if(e[2]!==_||e[3]!==u||e[4]!==h){let oe=Vi();e[9]===Symbol.for("react.memo_cache_sentinel")?(x=Ai({}),e[9]=x):x=e[9],C=oe,S=zu({language:oe.language,store:h,onAddFiles:u}),D=oe.language.data.of({autocomplete:_}),e[2]=_,e[3]=u,e[4]=h,e[5]=x,e[6]=C,e[7]=S,e[8]=D}else x=e[5],C=e[6],S=e[7],D=e[8];let $;e[10]===Symbol.for("react.memo_cache_sentinel")?($=wu({storage:{load:Ku,save:Ju}}),e[10]=$):$=e[10];let R;e[11]===Symbol.for("react.memo_cache_sentinel")?(R=Hi(),e[11]=R):R=e[11];let K;e[12]===f?K=e[13]:(K=Ur.highest(Gt.of([{preventDefault:!0,stopPropagation:!0,any:(oe,X)=>{let lt=X.metaKey||X.ctrlKey||X.shiftKey;if(X.key==="Enter"&&!lt)return f(X,oe.state.doc.toString()),X.preventDefault(),X.stopPropagation(),!0;if(X.key==="Enter"&&X.shiftKey){let Re=oe.state.selection.main.from;return oe.dispatch({changes:{from:Re,to:Re,insert:`
`},selection:{anchor:Re+1,head:Re+1}}),X.preventDefault(),X.stopPropagation(),!0}return!1}}])),e[12]=f,e[13]=K);let L;e[14]===b?L=e[15]:(L=Gt.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(b(),!0)}]),e[14]=b,e[15]=L);let B;e[16]!==x||e[17]!==C||e[18]!==S||e[19]!==D||e[20]!==K||e[21]!==L?(B=[x,C,S,D,$,Vr.lineWrapping,R,K,L],e[16]=x,e[17]=C,e[18]=S,e[19]=D,e[20]=K,e[21]=L,e[22]=B):B=e[22];let Q=B,te;e[23]===n?te=e[24]:(te=zr("flex-1 font-sans overflow-auto my-1",n),e[23]=n,e[24]=te);let Y=p==="dark"?"dark":"light",W=r||"Generate with AI, @ to include context",H;return e[25]!==Q||e[26]!==s||e[27]!==y||e[28]!==i||e[29]!==l||e[30]!==te||e[31]!==Y||e[32]!==W||e[33]!==a?(H=(0,I.jsx)(Gi,{ref:s,className:te,width:"100%",maxHeight:y,value:a,basicSetup:!1,extensions:Q,onChange:i,onKeyDown:l,theme:Y,placeholder:W}),e[25]=Q,e[26]=s,e[27]=y,e[28]=i,e[29]=l,e[30]=te,e[31]=Y,e[32]=W,e[33]=a,e[34]=H):H=e[34],H};function Wu(t){Jr({title:"Generate with AI failed",description:Ji(t)})}function Ku(){return An.get(Sn)}function Ju(t){return An.set(Sn,t)}export{Hd as C,tr as D,$d as E,ao as O,eu as S,rn as T,br as _,Uu as a,pn as b,_n as c,hu as d,yn as f,mu as g,xr as h,Cn as i,gn as l,gu as m,On as n,Tn as o,yu as p,En as r,kn as s,Bu as t,fu as u,zt as v,ht as w,Yd as x,cn as y};
