import{s as V}from"./chunk-LvLJmgfZ.js";import{s as Y}from"./jotai-D74Ef_p1.js";import{t as $}from"./react-XTZdWHwa.js";import{Fn as ee,G as te,K as se,Nr as re,St as ae,U as q,W as oe,gt as le}from"./cells-B1ds6ZjK.js";import{t as L}from"./compiler-runtime-QczY1yfQ.js";import{t as ne}from"./invariant-EWlZS5z8.js";import{t as ie}from"./ErrorBoundary-CtDyEdnn.js";import{t as de}from"./jsx-runtime-B4_2-8Ho.js";import{t as I}from"./button-BtVgadIf.js";import{t as E}from"./cn-f3ruLt4G.js";import{at as ce}from"./dist-hQAzR0Cy.js";import{Z as ue,n as me}from"./Output-C7Tw17j5.js";import{t as pe}from"./createLucideIcon-C9QGcv--.js";import{t as fe}from"./chevron-right-Cn1LhTdd.js";import{u as he}from"./toDate-J43JkZRd.js";import{r as xe,t as be}from"./name-cell-input-Do6XiA3C.js";import{J as ge,M as ve,j as Se,ot as je,q as ye,r as we,tt as Ne,x as Ce}from"./input-fjIzfaON.js";import{t as ke}from"./trash-DI_RMnlv.js";import{t as z}from"./tooltip-DEUNsdbK.js";import{M as Pe,T as B}from"./usePress-CuSksPzr.js";import{i as _e}from"./useHotkey-fEzjOJm_.js";import{t as De}from"./copy-icon-DyWZDAiU.js";import{t as Te}from"./esm-hcUBDEjZ.js";import{t as ze}from"./esm-DDxkZACy.js";var Ke=pe("skip-forward",[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]]);function G(t,e,s){let{isSelected:r}=e,{isPressed:o,buttonProps:l}=Ce({...t,onPress:Pe(e.toggle,t.onPress)},s);return{isPressed:o,isSelected:r,isDisabled:t.isDisabled||!1,buttonProps:B(l,{"aria-pressed":r})}}function Ie(t,e,s){let r={isSelected:e.selectedKeys.has(t.id),defaultSelected:!1,setSelected(c){e.setSelected(t.id,c)},toggle(){e.toggleKey(t.id)}},{isPressed:o,isSelected:l,isDisabled:i,buttonProps:n}=G({...t,id:void 0,isDisabled:t.isDisabled||e.isDisabled},r,s);return e.selectionMode==="single"&&(n.role="radio",n["aria-checked"]=r.isSelected,delete n["aria-pressed"]),{isPressed:o,isSelected:l,isDisabled:i,buttonProps:n}}var g=V($(),1);function Re(t={}){let{isReadOnly:e}=t,[s,r]=Ne(t.isSelected,t.defaultSelected||!1,t.onChange),[o]=(0,g.useState)(s);function l(n){e||r(n)}function i(){e||r(!s)}return{isSelected:s,defaultSelected:t.defaultSelected??o,setSelected:l,toggle:i}}var He=(0,g.createContext)(null),Me=(0,g.createContext)({}),Ee=(0,g.forwardRef)(function(t,e){[t,e]=ye(t,e,Me);let s=(0,g.useContext)(He),r=Re(s&&t.id!=null?{isSelected:s.selectedKeys.has(t.id),onChange(p){s.setSelected(t.id,p)}}:t),{buttonProps:o,isPressed:l,isSelected:i,isDisabled:n}=s&&t.id!=null?Ie({...t,id:t.id},s,e):G({...t,id:t.id==null?void 0:String(t.id)},r,e),{focusProps:c,isFocused:m,isFocusVisible:v}=Se(t),{hoverProps:y,isHovered:u}=ve(t),d=ge({...t,id:void 0,values:{isHovered:u,isPressed:l,isFocused:m,isSelected:r.isSelected,isFocusVisible:v,isDisabled:n,state:r},defaultClassName:"react-aria-ToggleButton"}),b=je(t,{global:!0});return delete b.id,delete b.onClick,g.createElement("button",{...B(b,d,o,c,y),ref:e,slot:t.slot||void 0,"data-focused":m||void 0,"data-disabled":n||void 0,"data-pressed":l||void 0,"data-selected":i||void 0,"data-hovered":u||void 0,"data-focus-visible":v||void 0},g.createElement(_e.Provider,{value:{isSelected:i}},d.children))}),Fe=L(),a=V(de(),1),We=(0,g.memo)(t=>{let e=g.useRef({});return(0,a.jsx)(ze,{minHeight:"200px",maxHeight:"200px",ref:e,theme:"dark",value:t.code,className:"*:outline-hidden [&>.cm-editor]:pr-0 overflow-hidden dark",readOnly:!0,editable:!1,basicSetup:{lineNumbers:!1},extensions:[Te.shell(),ce.updateListener.of(s=>{var r;s.docChanged&&((r=e.current.view)==null||r.dispatch({selection:{anchor:s.state.doc.length,head:s.state.doc.length},scrollIntoView:!0}))})]})});We.displayName="DebuggerOutput";const Ae=t=>{let e=(0,Fe.c)(30),{onSubmit:s,onClear:r}=t,o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=E("m-0 w-9 h-8 bg-(--slate-2) text-(--slate-11) hover:text-(--blue-11) rounded-none hover:bg-(--sky-3) hover:border-(--blue-8)","first:rounded-l-lg first:border-l border-t border-b hover:border","last:rounded-r-lg last:border-r"),e[0]=o):o=e[0];let l=o,i;e[1]===s?i=e[2]:(i=()=>s("n"),e[1]=s,e[2]=i);let n;e[3]===Symbol.for("react.memo_cache_sentinel")?(n=(0,a.jsx)(Ke,{fontSize:36,className:"w-5 h-5"}),e[3]=n):n=e[3];let c;e[4]===i?c=e[5]:(c=(0,a.jsx)(z,{content:"Next line",children:(0,a.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-next-button",className:l,onClick:i,children:n})}),e[4]=i,e[5]=c);let m;e[6]===s?m=e[7]:(m=()=>s("c"),e[6]=s,e[7]=m);let v,y;e[8]===Symbol.for("react.memo_cache_sentinel")?(v=E(l,"text-(--grass-11) hover:text-(--grass-11) hover:bg-(--grass-3) hover:border-(--grass-8)"),y=(0,a.jsx)(xe,{fontSize:36,className:"w-5 h-5"}),e[8]=v,e[9]=y):(v=e[8],y=e[9]);let u;e[10]===m?u=e[11]:(u=(0,a.jsx)(z,{content:"Continue execution",children:(0,a.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-continue-button",onClick:m,className:v,children:y})}),e[10]=m,e[11]=u);let d;e[12]===s?d=e[13]:(d=()=>s("bt"),e[12]=s,e[13]=d);let b;e[14]===Symbol.for("react.memo_cache_sentinel")?(b=(0,a.jsx)(ee,{fontSize:36,className:"w-5 h-5"}),e[14]=b):b=e[14];let p;e[15]===d?p=e[16]:(p=(0,a.jsx)(z,{content:"Print stack trace",children:(0,a.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-stack-button",className:l,onClick:d,children:b})}),e[15]=d,e[16]=p);let f;e[17]===s?f=e[18]:(f=()=>s("help"),e[17]=s,e[18]=f);let S;e[19]===Symbol.for("react.memo_cache_sentinel")?(S=(0,a.jsx)(he,{fontSize:36,className:"w-5 h-5"}),e[19]=S):S=e[19];let h;e[20]===f?h=e[21]:(h=(0,a.jsx)(z,{content:"Help",children:(0,a.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-help-button",className:l,onClick:f,children:S})}),e[20]=f,e[21]=h);let x;e[22]===r?x=e[23]:(x=r&&(0,a.jsx)(z,{content:"Clear",children:(0,a.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-clear-button",className:E(l,"text-(--red-11) hover:text-(--red-11) hover:bg-(--red-2) hover:border-(--red-8)"),onClick:r,children:(0,a.jsx)(ke,{fontSize:36,className:"w-5 h-5"})})}),e[22]=r,e[23]=x);let j;return e[24]!==p||e[25]!==h||e[26]!==x||e[27]!==c||e[28]!==u?(j=(0,a.jsxs)("div",{className:"flex",children:[c,u,p,h,x]}),e[24]=p,e[25]=h,e[26]=x,e[27]=c,e[28]=u,e[29]=j):j=e[29],j};function Oe(t=!0){return{onKeyDown:e=>{if(!t)return;let s=e.currentTarget;if(!(e.key.toLowerCase()==="a"&&(e.ctrlKey||e.metaKey)))return;e.preventDefault(),e.stopPropagation();let r=window.getSelection();if(!r)return;let o=document.createRange();o.selectNodeContents(s),r.removeAllRanges(),r.addRange(o)}}}var Le=L(),Ve=re("marimo:console:wrapText",!1,ae);function qe(){let t=(0,Le.c)(3),[e,s]=Y(Ve),r;return t[0]!==s||t[1]!==e?(r={wrapText:e,setWrapText:s},t[0]=s,t[1]=e,t[2]=r):r=t[2],r}var F=L(),Be=new se;const Ge=t=>{let e=(0,F.c)(2),s;return e[0]===t?s=e[1]:(s=(0,a.jsx)(ie,{children:(0,a.jsx)(Je,{...t})}),e[0]=t,e[1]=s),s};var Je=t=>{let e=(0,F.c)(48),s=g.useRef(null),{wrapText:r,setWrapText:o}=qe(),{consoleOutputs:l,stale:i,cellName:n,cellId:c,onSubmitDebugger:m,onClear:v,onRefactorWithAI:y,className:u}=t,d=l.length>0,b=Oe(d),p;if(e[0]===Symbol.for("react.memo_cache_sentinel")?(p=()=>{let w=s.current;if(!w)return;let H=w.scrollHeight-w.clientHeight;H-w.scrollTop<120&&(w.scrollTop=H)},e[0]=p):p=e[0],(0,g.useLayoutEffect)(p),!d&&le(n))return null;let f,S,h,x,j,N,P,_,C;if(e[1]!==c||e[2]!==u||e[3]!==l||e[4]!==d||e[5]!==v||e[6]!==y||e[7]!==m||e[8]!==b||e[9]!==o||e[10]!==i||e[11]!==r){let w=[...l].reverse(),H=w.some(Qe),Z=w.findIndex(Xe),M;e[21]===l?M=e[22]:(M=()=>l.filter(Ye).map($e).join(`
`),e[21]=l,e[22]=M);let W=M;_="relative group",e[23]!==W||e[24]!==d||e[25]!==o||e[26]!==r?(C=d&&(0,a.jsxs)("div",{className:"absolute top-1 right-5 z-10 opacity-0 group-hover:opacity-100 flex gap-1",children:[(0,a.jsx)(De,{tooltip:"Copy console output",value:W,className:"h-4 w-4"}),(0,a.jsx)(z,{content:r?"Disable wrap text":"Wrap text",children:(0,a.jsx)("span",{children:(0,a.jsx)(Ee,{"aria-label":"Toggle text wrapping",className:"p-1 rounded bg-transparent text-muted-foreground data-hovered:text-foreground data-selected:text-foreground",isSelected:r,onChange:o,children:(0,a.jsx)(ue,{className:"h-4 w-4"})})})})]}),e[23]=W,e[24]=d,e[25]=o,e[26]=r,e[27]=C):C=e[27],f=i?"This console output is stale":void 0,S="console-output-area",h=s,x=b,j=0;let A=i&&"marimo-output-stale",O=d?"p-5":"p-3";e[28]!==u||e[29]!==A||e[30]!==O?(N=E("console-output-area overflow-hidden rounded-b-lg flex flex-col-reverse w-full gap-1 focus:outline-hidden",A,O,u),e[28]=u,e[29]=A,e[30]=O,e[31]=N):N=e[31],P=w.map((k,K)=>{if(k.channel==="pdb")return null;if(k.channel==="stdin"){ne(typeof k.data=="string","Expected data to be a string");let Q=l.length-K-1;return k.response==null&&Z===K?(0,a.jsx)(Ue,{output:k.data,isPdb:H,onSubmit:X=>m(X,Q),onClear:v},K):(0,a.jsx)(Ze,{output:k.data,response:k.response},K)}return(0,a.jsx)(g.Fragment,{children:(0,a.jsx)(me,{cellId:c,onRefactorWithAI:y,message:k,wrapText:r})},K)}),e[1]=c,e[2]=u,e[3]=l,e[4]=d,e[5]=v,e[6]=y,e[7]=m,e[8]=b,e[9]=o,e[10]=i,e[11]=r,e[12]=f,e[13]=S,e[14]=h,e[15]=x,e[16]=j,e[17]=N,e[18]=P,e[19]=_,e[20]=C}else f=e[12],S=e[13],h=e[14],x=e[15],j=e[16],N=e[17],P=e[18],_=e[19],C=e[20];let D;e[32]!==c||e[33]!==n?(D=(0,a.jsx)(be,{value:n,cellId:c,className:"bg-(--slate-4) border-(--slate-4) hover:bg-(--slate-5) dark:border-(--sky-5) dark:bg-(--sky-6) dark:text-(--sky-12) text-(--slate-12) rounded-l rounded-br-lg absolute right-0 bottom-0 text-xs px-1.5 py-0.5 font-mono max-w-[75%] whitespace-nowrap overflow-hidden"}),e[32]=c,e[33]=n,e[34]=D):D=e[34];let T;e[35]!==f||e[36]!==D||e[37]!==S||e[38]!==h||e[39]!==x||e[40]!==j||e[41]!==N||e[42]!==P?(T=(0,a.jsxs)("div",{title:f,"data-testid":S,ref:h,...x,tabIndex:j,className:N,children:[P,D]}),e[35]=f,e[36]=D,e[37]=S,e[38]=h,e[39]=x,e[40]=j,e[41]=N,e[42]=P,e[43]=T):T=e[43];let R;return e[44]!==T||e[45]!==_||e[46]!==C?(R=(0,a.jsxs)("div",{className:_,children:[C,T]}),e[44]=T,e[45]=_,e[46]=C,e[47]=R):R=e[47],R},Ue=t=>{let e=(0,F.c)(13),s;e[0]===t.output?s=e[1]:(s=J(t.output),e[0]=t.output,e[1]=s);let r;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=(0,a.jsx)(fe,{className:"w-5 h-5"}),e[2]=r):r=e[2];let o;e[3]===t?o=e[4]:(o=(0,a.jsx)(we,{"data-testid":"console-input","data-stdin-blocking":!0,type:"text",autoComplete:"off",autoFocus:!0,icon:r,className:"m-0 h-8 focus-visible:shadow-xs-solid",placeholder:"stdin",onKeyDownCapture:n=>{n.key==="Enter"&&!n.shiftKey&&(t.onSubmit(n.currentTarget.value),n.preventDefault(),n.stopPropagation()),n.key==="Enter"&&n.metaKey&&(n.preventDefault(),n.stopPropagation())}}),e[3]=t,e[4]=o);let l;e[5]!==t.isPdb||e[6]!==t.onClear||e[7]!==t.onSubmit?(l=t.isPdb&&(0,a.jsx)(Ae,{onSubmit:t.onSubmit,onClear:t.onClear}),e[5]=t.isPdb,e[6]=t.onClear,e[7]=t.onSubmit,e[8]=l):l=e[8];let i;return e[9]!==s||e[10]!==o||e[11]!==l?(i=(0,a.jsxs)("div",{className:"flex gap-2 items-center pt-2",children:[s,o,l]}),e[9]=s,e[10]=o,e[11]=l,e[12]=i):i=e[12],i},Ze=t=>{let e=(0,F.c)(7),s;e[0]===t.output?s=e[1]:(s=J(t.output),e[0]=t.output,e[1]=s);let r;e[2]===t.response?r=e[3]:(r=(0,a.jsx)("span",{className:"text-(--sky-11)",children:t.response}),e[2]=t.response,e[3]=r);let o;return e[4]!==s||e[5]!==r?(o=(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[s,r]}),e[4]=s,e[5]=r,e[6]=o):o=e[6],o},J=t=>t?(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:Be.ansi_to_html(t)}}):null;const U=t=>t.mimetype.startsWith("application/vnd.marimo")||t.mimetype==="text/html"?te(q.asString(t.data)):oe(q.asString(t.data));function Qe(t){return typeof t.data=="string"&&t.data.includes("(Pdb)")}function Xe(t){return t.channel==="stdin"}function Ye(t){return t.channel!=="pdb"}function $e(t){return U(t)}export{U as n,Ge as t};
