var We=Object.defineProperty;var Ie=(t,e,r)=>e in t?We(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var M=(t,e,r)=>Ie(t,typeof e!="symbol"?e+"":e,r);import{s as ue}from"./chunk-LvLJmgfZ.js";import{c as ge,d as je,n as He,s as se}from"./jotai-D74Ef_p1.js";import{t as Ee}from"./react-XTZdWHwa.js";import{Ar as Be,Hn as Te,Kt as le,Nr as $e,St as qe,w as Ve}from"./cells-B1ds6ZjK.js";import"./react-dom-BZDtXk6t.js";import"./zod-BBqism5D.js";import{t as de}from"./compiler-runtime-QczY1yfQ.js";import"./_Uint8Array-BGESiCQL.js";import"./isSymbol-BGkTcW3U.js";import"./toString-DlRqgfqz.js";import"./toNumber-GB_lFVaq.js";import"./toInteger-Cl1doThW.js";import"./isArrayLikeObject-BkJc8lDE.js";import"./_getTag-BWqNuuwU.js";import"./_baseIsEqual-C8v2yRqO.js";import"./merge-DVX6Ez37.js";import"./_baseSlice-CskhCEVH.js";import"./useLifecycle-bYJVBwo9.js";import"./_hasUnicode-BC4vb_bF.js";import"./capitalize-HqFs_OK0.js";import"./_arrayReduce-BPS6ICyD.js";import"./type-Bx7IFbhF.js";import"./_baseProperty-Bl8lQyHQ.js";import"./now-DBnXnRPe.js";import"./debounce-BzCP2SOK.js";import"./tooltip-tPIJZni7.js";import"./range-CWPLRnRw.js";import{d as Le,u as Ue}from"./hotkeys-sK-kaEBC.js";import{t as Ke}from"./invariant-EWlZS5z8.js";import{f as Ye}from"./utils-Clm_pCuX.js";import"./constants-Bt6NlroV.js";import{_ as ae}from"./config-BwUC_LRl.js";import"./ErrorBoundary-CtDyEdnn.js";import"./useEventListener-BMXqdHZ5.js";import{t as Ze}from"./jsx-runtime-B4_2-8Ho.js";import{n as Ge,t as I}from"./button-BtVgadIf.js";import"./clsx-CGw3WJH5.js";import{t as ce}from"./cn-f3ruLt4G.js";import{St as Je,at as Qe}from"./dist-hQAzR0Cy.js";import"./dist-BWV-5FQQ.js";import{U as Xe,a as et,i as tt,o as at,r as it,s as rt}from"./Output-C7Tw17j5.js";import"./once-DF3Ybce_.js";import"./capabilities-DPEuN0Kv.js";import"./cjs-VdEqhsWH.js";import"./createReducer-uDMmKGBt.js";import{n as nt,r as me}from"./requests-CMMs4cl8.js";import"./dist-a5AhnPua.js";import"./dist-AYL4p4Dn.js";import{t as K}from"./createLucideIcon-C9QGcv--.js";import{t as ot}from"./arrow-left-ta7tm3i0.js";import{n as st,t as lt}from"./LazyAnyLanguageCodeMirror-49uxEXHt.js";import"./table-BqDahwx2.js";import"./check-Pczj-rmu.js";import{_ as dt}from"./select-Dre1F6mo.js";import{t as ct}from"./chevron-right-Cn1LhTdd.js";import{n as mt,t as ye}from"./download-Yhx6Ym5-.js";import{_ as pe}from"./maps-CcaFd04c.js";import"./toDate-J43JkZRd.js";import{a as N,c as Y,p as pt,r as ht,t as ft}from"./dropdown-menu-DL4QHRL7.js";import{t as ve}from"./copy-CGmj_xHa.js";import{t as be}from"./download-CRVp7nwp.js";import{t as xt}from"./ellipsis-vertical-BLHGoVMA.js";import{t as ut}from"./eye-off-CkynlJbW.js";import"./file-video-camera-DxwR0TAX.js";import{n as we,r as gt,t as jt}from"./types-mgJcVmSJ.js";import{t as ke}from"./file-plus-corner-DSMGuUMR.js";import"./file-text-DYJz3QFG.js";import"./file-DdZ6Vgf6.js";import"./DeferredRequestRegistry-DUZWfqOX.js";import{t as yt}from"./spinner-cyqSIlb0.js";import"./MarimoErrorOutput-B1Mc3WdL.js";import{t as vt}from"./refresh-ccw-BHxANXt5.js";import{t as bt}from"./refresh-cw-DHav_aX8.js";import{t as wt}from"./save-C2w9jD2I.js";import"./input-fjIzfaON.js";import"./state-GOQmrHWh.js";import{t as kt}from"./trash-2-DkyoQBeV.js";import{t as Ft}from"./triangle-alert-CITCjWDo.js";import{i as Ct,n as Nt,t as St}from"./es-BMRi-PYh.js";import"./badge-DjEl44tW.js";import"./preload-helper-WDmkW-6F.js";import"./dist-BFZNB01C.js";import"./dist-DjRxw7g7.js";import"./dist-BRKC9vDH.js";import"./dist-C2lGLtUJ.js";import"./dist-CiIxDFsH.js";import"./stex-BQjjdb1n.js";import"./Deferred-cELqHKYi.js";import"./uuid-DFgsIVBI.js";import{t as A}from"./use-toast-CTk3v2Fk.js";import"./main-B1nOh376.js";import"./useNonce-BPtPhVM4.js";import"./connection-DZfQ0nfK.js";import{n as Dt}from"./useTheme-DNzypnwR.js";import"./Combination-DIF6wDxT.js";import"./dist-DTKIwXcy.js";import{t as z}from"./tooltip-DEUNsdbK.js";import"./menu-items-QU91GQzu.js";import"./en-US-DZkKelDe.js";import"./isValid-CB2nX3F0.js";import"./mode-DQrmKtLw.js";import{o as _t}from"./alert-dialog-CYJZg0vV.js";import"./dialog-C-S4uQH4.js";import"./usePress-CuSksPzr.js";import"./SSRProvider-DrIPqn2D.js";import"./useDateFormatter-BQepJAoC.js";import"./context-C5uPODSj.js";import"./useNumberFormatter-C1aNc7b4.js";import"./shim-DZsTM49a.js";import"./numbers-BWXaNlZC.js";import{n as W}from"./useEvent-bc5jSpSz.js";import"./useDebounce-Dz48GAub.js";import{n as Fe}from"./ImperativeModal-DD50EU1G.js";import{i as Pt,n as Ce}from"./error-banner-BVpxvuDQ.js";import"./vega-loader.browser-DUgPL0IU.js";import"./precisionRound-BdwMj645.js";import"./defaultLocale-9ao8Dcla.js";import"./defaultLocale-Bu1vZnwX.js";import{t as ie}from"./copy-CL0ql7QN.js";import"./copy-icon-DyWZDAiU.js";import"./RenderHTML-JtHAHXUk.js";import"./purify.es-B1k9qoU6.js";import"./useRunCells-D8WfVv85.js";import"./multi-map-Z_hg0zTh.js";import"./emotion-is-prop-valid.esm-CvS1dbIX.js";import"./extends-r-9mmG40.js";import"./prop-types-8ppFGRBY.js";import"./objectWithoutPropertiesLoose-dfl_7i8r.js";import{n as he,t as zt}from"./tree-DBxu60uL.js";import{n as Ot,t as Mt}from"./alert-BP5lLEUu.js";import{n as Ne}from"./useAsyncData-CWTnKpYp.js";import"./kbd-BGS9frER.js";import{a as Rt}from"./renderShortcut-CF5R2n1d.js";import"./dist-CSuUnJvL.js";import"./popover-CmnWYkoH.js";import"./cell-link-ByqSnfe2.js";import"./links-9tVC0887.js";import"./useIframeCapabilities-DeznJSW5.js";import"./lazy-KZ8U4iLp.js";import"./tabs-CWZFOtfb.js";import{o as At}from"./focus-BwsN5YFR.js";import"./formats-C_m3CfBz.js";import"./chunk-T7OEMACY-DbVUP18p.js";import"./katex-BWHK7JiN.js";import"./marked.esm-D2gFq9fv.js";import"./dist-x0pnLWWY.js";import"./add-missing-import-BkauGlV2.js";import"./table-NPSY8_Zm.js";import{n as Wt}from"./blob-CIREuKO3.js";import{t as It}from"./bundle.esm-CBRGmh5t.js";import{t as Ht}from"./links-BlVLDD3s.js";import{t as Et}from"./icon-32x32-CTeqBIMC.js";import{t as Z}from"./Inputs-DoHz4Ac3.js";var Bt=K("copy-minus",[["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Se=K("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),De=K("list-tree",[["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"M3 10a2 2 0 0 0 2 2h3",key:"1npucw"}],["path",{d:"M3 5v12a2 2 0 0 0 2 2h3",key:"x1gjn2"}]]),Tt=K("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),$t=K("square-play",[["rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",key:"h1oib"}],["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}]]),qt=K("view",[["path",{d:"M21 17v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2",key:"mrq65r"}],["path",{d:"M21 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2",key:"be3xqs"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0",key:"11ak4c"}]]),Vt=de(),_=ue(Ee(),1),a=ue(Ze(),1),fe=new Map;const Lt=({file:t,onOpenNotebook:e})=>{let{theme:r}=Dt(),{sendFileDetails:n,sendUpdateFile:i}=me(),l=ge(Ye),c=ge(Be),[m,p]=(0,_.useState)(""),{data:o,isPending:f,error:j,setData:y,refetch:d}=Ne(async()=>{let s=await n({path:t.path}),u=s.contents||"";return p(fe.get(t.path)||u),s},[t.path]),g=async()=>{m!==(o==null?void 0:o.contents)&&await i({path:t.path,contents:m}).then(s=>{s.success&&(y(u=>({...u,contents:m})),p(m))})},b=(0,_.useRef)(m);if(b.current=m,(0,_.useEffect)(()=>()=>{if(!(o!=null&&o.contents))return;let s=b.current;s===o.contents?fe.delete(t.path):fe.set(t.path,s)},[t.path,o==null?void 0:o.contents]),j)return(0,a.jsx)(Ce,{error:j});if(f||!o)return null;let x=o.mimeType||"text/plain",S=x in xe,k=c&&o.file.isMarimoFile&&(t.path===c||t.path.endsWith(`/${c}`));if(!o.contents&&!S)return(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 p-6",children:[(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Name"}),(0,a.jsx)("div",{children:o.file.name}),(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Type"}),(0,a.jsx)("div",{children:x})]});let v=(0,a.jsxs)("div",{className:"text-xs text-muted-foreground p-1 flex justify-end gap-2 border-b",children:[(0,a.jsx)(z,{content:"Refresh",children:(0,a.jsx)(Z,{size:"small",onClick:d,children:(0,a.jsx)(bt,{})})}),t.isMarimoFile&&!ae()&&(0,a.jsx)(z,{content:"Open notebook",children:(0,a.jsx)(Z,{size:"small",onClick:s=>e(s),children:(0,a.jsx)(pe,{})})}),(0,a.jsx)(z,{content:"Download",children:(0,a.jsx)(Z,{size:"small",onClick:()=>{if(_e(x)){mt(Xe(o.contents,x),o.file.name);return}ye(new Blob([o.contents||m],{type:x}),o.file.name)},children:(0,a.jsx)(be,{})})}),!_e(x)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z,{content:"Copy contents to clipboard",children:(0,a.jsx)(Z,{size:"small",onClick:async()=>{await ie(m)},children:(0,a.jsx)(ve,{})})}),(0,a.jsx)(z,{content:Rt("global.save"),children:(0,a.jsx)(Z,{size:"small",color:m===o.contents?void 0:"green",onClick:g,disabled:m===o.contents,children:(0,a.jsx)(wt,{})})})]})]});return x.startsWith("image/")?(0,a.jsxs)(a.Fragment,{children:[v,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(et,{base64:o.contents,mime:x})})]}):x==="text/csv"&&o.contents?(0,a.jsxs)(a.Fragment,{children:[v,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(tt,{contents:o.contents})})]}):x.startsWith("audio/")?(0,a.jsxs)(a.Fragment,{children:[v,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(it,{base64:o.contents,mime:x})})]}):x.startsWith("video/")?(0,a.jsxs)(a.Fragment,{children:[v,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(rt,{base64:o.contents,mime:x})})]}):x.startsWith("application/pdf")?(0,a.jsxs)(a.Fragment,{children:[v,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(at,{base64:o.contents,mime:x})})]}):(0,a.jsxs)(a.Fragment,{children:[v,k&&(0,a.jsxs)(Mt,{variant:"warning",className:"rounded-none",children:[(0,a.jsx)(Ft,{className:"h-4 w-4"}),(0,a.jsx)(Ot,{children:"Editing the notebook file directly while running in marimo's editor may cause unintended changes. Please use with caution."})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(0,a.jsx)(_.Suspense,{children:(0,a.jsx)(lt,{theme:r==="dark"?"dark":"light",language:xe[x]||xe.default,className:"border-b",extensions:[Qe.lineWrapping,Je.of([{key:l.getHotkey("global.save").key,stopPropagation:!0,run:()=>m===o.contents?!1:(g(),!0)}])],value:m,onChange:p})})})]})};var _e=t=>t?t.startsWith("image/")||t.startsWith("audio/")||t.startsWith("video/")||t.startsWith("application/pdf"):!1,xe={"application/javascript":"javascript","text/markdown":"markdown","text/html":"html","text/css":"css","text/x-python":"python","application/json":"json","application/xml":"xml","text/x-yaml":"yaml","text/csv":"markdown","text/plain":"markdown",default:"markdown"},Ut=class{constructor(t){M(this,"delegate",new he([]));M(this,"rootPath","");M(this,"onChange",Le.NOOP);M(this,"path",new le("/"));M(this,"initialize",async t=>{if(this.onChange=t,this.delegate.data.length===0)try{let e=await this.callbacks.listFiles({path:this.rootPath});this.delegate=new he(e.files),this.rootPath=e.root,this.path=le.guessDeliminator(e.root)}catch(e){A({title:"Failed",description:Pt(e)})}this.onChange(this.delegate.data)});M(this,"refreshAll",async t=>{let e=[this.rootPath,...t.map(n=>{var i;return(i=this.delegate.find(n))==null?void 0:i.data.path})].filter(Boolean),r=await Promise.all(e.map(n=>this.callbacks.listFiles({path:n}).catch(()=>({files:[]}))));for(let[n,i]of e.entries()){let l=r[n];i===this.rootPath?this.delegate=new he(l.files):this.delegate.update({id:i,changes:{children:l.files}})}this.onChange(this.delegate.data)});M(this,"relativeFromRoot",t=>{let e=this.rootPath.endsWith(this.path.deliminator)?this.rootPath:`${this.rootPath}${this.path.deliminator}`;return t.startsWith(e)?t.slice(e.length):t});M(this,"handleResponse",t=>t.success?t:(A({title:"Failed",description:t.message}),null));this.callbacks=t}async expand(t){let e=this.delegate.find(t);if(!e||!e.data.isDirectory)return!1;if(e.children&&e.children.length>0)return!0;let r=await this.callbacks.listFiles({path:e.data.path});return this.delegate.update({id:t,changes:{children:r.files}}),this.onChange(this.delegate.data),!0}async rename(t,e){let r=this.delegate.find(t);if(!r)return;let n=r.data.path,i=this.path.join(this.path.dirname(n),e);await this.callbacks.renameFileOrFolder({path:n,newPath:i}).then(this.handleResponse),this.delegate.update({id:t,changes:{name:e,path:i}}),this.onChange(this.delegate.data),await this.refreshAll([i])}async move(t,e){var n;let r=e?((n=this.delegate.find(e))==null?void 0:n.data.path)??e:this.rootPath;await Promise.all(t.map(i=>{this.delegate.move({id:i,parentId:e,index:0});let l=this.delegate.find(i);if(!l)return Promise.resolve();let c=this.path.join(r,this.path.basename(l.data.path));return this.delegate.update({id:i,changes:{path:c}}),this.callbacks.renameFileOrFolder({path:l.data.path,newPath:c}).then(this.handleResponse)})),this.onChange(this.delegate.data),await this.refreshAll([r])}async createFile(t,e){var i;let r=e?((i=this.delegate.find(e))==null?void 0:i.data.path)??e:this.rootPath,n=await this.callbacks.createFileOrFolder({path:r,type:"file",name:t}).then(this.handleResponse);n!=null&&n.info&&(this.delegate.create({parentId:e,index:0,data:n.info}),this.onChange(this.delegate.data),await this.refreshAll([r]))}async createFolder(t,e){var i;let r=e?((i=this.delegate.find(e))==null?void 0:i.data.path)??e:this.rootPath,n=await this.callbacks.createFileOrFolder({path:r,type:"directory",name:t}).then(this.handleResponse);n!=null&&n.info&&(this.delegate.create({parentId:e,index:0,data:n.info}),this.onChange(this.delegate.data),await this.refreshAll([r]))}async delete(t){let e=this.delegate.find(t);e&&(await this.callbacks.deleteFileOrFolder({path:e.data.path}).then(this.handleResponse),this.delegate.drop({id:t}),this.onChange(this.delegate.data))}};const Pe=je(t=>{let e=t(nt);return Ke(e,"no requestClientAtom set"),new Ut({listFiles:e.sendListFiles,createFileOrFolder:e.sendCreateFileOrFolder,deleteFileOrFolder:e.sendDeleteFileOrFolder,renameFileOrFolder:e.sendRenameFileOrFolder})}),Kt=je({});async function Yt(){await He.get(Pe).refreshAll([])}var Zt=1024*1024*100;function ze(t){let e=(0,Vt.c)(7),r;e[0]===t?r=e[1]:(r=t===void 0?{}:t,e[0]=t,e[1]=r);let n=r,{sendCreateFileOrFolder:i}=me(),l;e[2]===i?l=e[3]:(l=async m=>{for(let p of m){let o=ta(ea(p)),f="";o&&(f=le.guessDeliminator(o).dirname(o));let j=(await Wt(p)).split(",")[1];await i({path:f,type:"file",name:p.name,contents:j})}await Yt()},e[2]=i,e[3]=l);let c;return e[4]!==n||e[5]!==l?(c={multiple:!0,maxSize:Zt,onError:Xt,onDropRejected:Gt,onDrop:l,...n},e[4]=n,e[5]=l,e[6]=c):c=e[6],St(c)}function Gt(t){A({title:"File upload failed",description:(0,a.jsx)("div",{className:"flex flex-col gap-1",children:t.map(Jt)}),variant:"danger"})}function Jt(t){return(0,a.jsxs)("div",{children:[t.file.name," (",t.errors.map(Qt).join(", "),")"]},t.file.name)}function Qt(t){return t.message}function Xt(t){Ue.error(t),A({title:"File upload failed",description:t.message,variant:"danger"})}function ea(t){if(t.webkitRelativePath)return t.webkitRelativePath;if("path"in t&&typeof t.path=="string")return t.path;if("relativePath"in t&&typeof t.relativePath=="string")return t.relativePath}function ta(t){if(t)return t.replace(/^\/+/,"")}var G=de(),aa=$e("marimo:showHiddenFiles",!0,qe,{getOnInit:!0}),Oe=_.createContext(null);const ia=t=>{let e=(0,G.c)(67),{height:r}=t,n=(0,_.useRef)(null),[i]=se(Pe),l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[0]=l):l=e[0];let[c,m]=(0,_.useState)(l),[p,o]=(0,_.useState)(null),[f,j]=se(aa),{openPrompt:y}=Fe(),[d,g]=se(Kt),b;e[1]===i?b=e[2]:(b=()=>i.initialize(m),e[1]=i,e[2]=b);let x;e[3]===Symbol.for("react.memo_cache_sentinel")?(x=[],e[3]=x):x=e[3];let{isPending:S,error:k}=Ne(b,x),v;e[4]!==d||e[5]!==i?(v=()=>{i.refreshAll(Object.keys(d).filter(h=>d[h]))},e[4]=d,e[5]=i,e[6]=v):v=e[6];let s=W(v),u;e[7]!==j||e[8]!==f?(u=()=>{j(!f)},e[7]=j,e[8]=f,e[9]=u):u=e[9];let O=W(u),F;e[10]!==y||e[11]!==i?(F=async()=>{y({title:"Folder name",onConfirm:async h=>{i.createFolder(h,null)}})},e[10]=y,e[11]=i,e[12]=F):F=e[12];let P=W(F),C;e[13]!==y||e[14]!==i?(C=async()=>{y({title:"File name",onConfirm:async h=>{i.createFile(h,null)}})},e[13]=y,e[14]=i,e[15]=C):C=e[15];let R=W(C),J;e[16]===g?J=e[17]:(J=()=>{var h;(h=n.current)==null||h.closeAll(),g({})},e[16]=g,e[17]=J);let re=W(J),Q;e[18]!==c||e[19]!==f?(Q=Re(c,f),e[18]=c,e[19]=f,e[20]=Q):Q=e[20];let ne=Q;if(S){let h;return e[21]===Symbol.for("react.memo_cache_sentinel")?(h=(0,a.jsx)(yt,{size:"medium",centered:!0}),e[21]=h):h=e[21],h}if(k){let h;return e[22]===k?h=e[23]:(h=(0,a.jsx)(Ce,{error:k}),e[22]=k,e[23]=h),h}if(p){let h;e[24]===Symbol.for("react.memo_cache_sentinel")?(h=()=>o(null),e[24]=h):h=e[24];let w;e[25]===Symbol.for("react.memo_cache_sentinel")?(w=(0,a.jsx)(I,{onClick:h,"data-testid":"file-explorer-back-button",variant:"text",size:"xs",className:"mb-0",children:(0,a.jsx)(ot,{size:16})}),e[25]=w):w=e[25];let D;e[26]===p.name?D=e[27]:(D=(0,a.jsxs)("div",{className:"flex items-center pl-1 pr-3 shrink-0 border-b justify-between",children:[w,(0,a.jsx)("span",{className:"font-bold",children:p.name})]}),e[26]=p.name,e[27]=D);let L;e[28]!==p.path||e[29]!==i?(L=Ae=>Me(Ae,i.relativeFromRoot(p.path)),e[28]=p.path,e[29]=i,e[30]=L):L=e[30];let U;e[31]!==p||e[32]!==L?(U=(0,a.jsx)(_.Suspense,{children:(0,a.jsx)(Lt,{onOpenNotebook:L,file:p})}),e[31]=p,e[32]=L,e[33]=U):U=e[33];let te;return e[34]!==D||e[35]!==U?(te=(0,a.jsxs)(a.Fragment,{children:[D,U]}),e[34]=D,e[35]=U,e[36]=te):te=e[36],te}let H;e[37]!==re||e[38]!==R||e[39]!==P||e[40]!==O||e[41]!==s||e[42]!==i?(H=(0,a.jsx)(na,{onRefresh:s,onHidden:O,onCreateFile:R,onCreateFolder:P,onCollapseAll:re,tree:i}),e[37]=re,e[38]=R,e[39]=P,e[40]=O,e[41]=s,e[42]=i,e[43]=H):H=e[43];let oe=r-33,E,B,T;e[44]===i?(E=e[45],B=e[46],T=e[47]):(E=async h=>{let{ids:w}=h;for(let D of w)await i.delete(D)},B=async h=>{let{id:w,name:D}=h;await i.rename(w,D)},T=async h=>{let{dragIds:w,parentId:D}=h;await i.move(w,D)},e[44]=i,e[45]=E,e[46]=B,e[47]=T);let X;e[48]===Symbol.for("react.memo_cache_sentinel")?(X=h=>{let w=h[0];w&&(w.data.isDirectory||o(w.data))},e[48]=X):X=e[48];let $;e[49]!==d||e[50]!==g||e[51]!==i?($=async h=>{if(await i.expand(h)){let w=d[h]??!1;g({...d,[h]:!w})}},e[49]=d,e[50]=g,e[51]=i,e[52]=$):$=e[52];let q;e[53]!==d||e[54]!==oe||e[55]!==E||e[56]!==B||e[57]!==T||e[58]!==$||e[59]!==ne?(q=(0,a.jsx)(zt,{width:"100%",ref:n,height:oe,className:"h-full",data:ne,initialOpenState:d,openByDefault:!1,renderCursor:ma,disableDrop:pa,onDelete:E,onRename:B,onMove:T,onSelect:X,onToggle:$,padding:15,rowHeight:30,indent:ra,overscanCount:1e3,disableMultiSelection:!0,children:la}),e[53]=d,e[54]=oe,e[55]=E,e[56]=B,e[57]=T,e[58]=$,e[59]=ne,e[60]=q):q=e[60];let V;e[61]!==q||e[62]!==i?(V=(0,a.jsx)(Oe,{value:i,children:q}),e[61]=q,e[62]=i,e[63]=V):V=e[63];let ee;return e[64]!==H||e[65]!==V?(ee=(0,a.jsxs)(a.Fragment,{children:[H,V]}),e[64]=H,e[65]=V,e[66]=ee):ee=e[66],ee};var ra=15,na=t=>{let e=(0,G.c)(34),{onRefresh:r,onHidden:n,onCreateFile:i,onCreateFolder:l,onCollapseAll:c}=t,m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m={noDrag:!0,noDragEventsBubbling:!0},e[0]=m):m=e[0];let{getRootProps:p,getInputProps:o}=ze(m),f;e[1]===Symbol.for("react.memo_cache_sentinel")?(f=(0,a.jsx)(ke,{size:16}),e[1]=f):f=e[1];let j;e[2]===i?j=e[3]:(j=(0,a.jsx)(z,{content:"Add file",children:(0,a.jsx)(I,{"data-testid":"file-explorer-add-file-button",onClick:i,variant:"text",size:"xs",children:f})}),e[2]=i,e[3]=j);let y;e[4]===Symbol.for("react.memo_cache_sentinel")?(y=(0,a.jsx)(Se,{size:16}),e[4]=y):y=e[4];let d;e[5]===l?d=e[6]:(d=(0,a.jsx)(z,{content:"Add folder",children:(0,a.jsx)(I,{"data-testid":"file-explorer-add-folder-button",onClick:l,variant:"text",size:"xs",children:y})}),e[5]=l,e[6]=d);let g;e[7]===p?g=e[8]:(g=p({}),e[7]=p,e[8]=g);let b,x;e[9]===Symbol.for("react.memo_cache_sentinel")?(b=Ge({variant:"text",size:"xs"}),x=(0,a.jsx)(Ct,{size:16}),e[9]=b,e[10]=x):(b=e[9],x=e[10]);let S;e[11]===g?S=e[12]:(S=(0,a.jsx)(z,{content:"Upload file",children:(0,a.jsx)("button",{"data-testid":"file-explorer-upload-button",...g,className:b,children:x})}),e[11]=g,e[12]=S);let k;e[13]===o?k=e[14]:(k=o({}),e[13]=o,e[14]=k);let v;e[15]===k?v=e[16]:(v=(0,a.jsx)("input",{...k,type:"file"}),e[15]=k,e[16]=v);let s;e[17]===Symbol.for("react.memo_cache_sentinel")?(s=(0,a.jsx)(vt,{size:16}),e[17]=s):s=e[17];let u;e[18]===r?u=e[19]:(u=(0,a.jsx)(z,{content:"Refresh",children:(0,a.jsx)(I,{"data-testid":"file-explorer-refresh-button",onClick:r,variant:"text",size:"xs",children:s})}),e[18]=r,e[19]=u);let O;e[20]===Symbol.for("react.memo_cache_sentinel")?(O=(0,a.jsx)(ut,{size:16}),e[20]=O):O=e[20];let F;e[21]===n?F=e[22]:(F=(0,a.jsx)(z,{content:"Toggle hidden files",children:(0,a.jsx)(I,{"data-testid":"file-explorer-hidden-files-button",onClick:n,variant:"text",size:"xs",children:O})}),e[21]=n,e[22]=F);let P;e[23]===Symbol.for("react.memo_cache_sentinel")?(P=(0,a.jsx)(Bt,{size:16}),e[23]=P):P=e[23];let C;e[24]===c?C=e[25]:(C=(0,a.jsx)(z,{content:"Collapse all folders",children:(0,a.jsx)(I,{"data-testid":"file-explorer-collapse-button",onClick:c,variant:"text",size:"xs",children:P})}),e[24]=c,e[25]=C);let R;return e[26]!==v||e[27]!==u||e[28]!==F||e[29]!==C||e[30]!==j||e[31]!==d||e[32]!==S?(R=(0,a.jsxs)("div",{className:"flex items-center justify-end px-2 shrink-0 border-b",children:[j,d,S,v,u,F,C]}),e[26]=v,e[27]=u,e[28]=F,e[29]=C,e[30]=j,e[31]=d,e[32]=S,e[33]=R):R=e[33],R},oa=t=>{let e=(0,G.c)(9),{node:r,onOpenMarimoFile:n}=t,i;e[0]===r?i=e[1]:(i=m=>{r.data.isDirectory||(m.stopPropagation(),r.select())},e[0]=r,e[1]=i);let l;e[2]!==r.data.isMarimoFile||e[3]!==n?(l=r.data.isMarimoFile&&!ae()&&(0,a.jsxs)("span",{className:"shrink-0 ml-2 text-sm hidden group-hover:inline hover:underline",onClick:n,children:["open ",(0,a.jsx)(pe,{className:"inline ml-1",size:12})]}),e[2]=r.data.isMarimoFile,e[3]=n,e[4]=l):l=e[4];let c;return e[5]!==r.data.name||e[6]!==i||e[7]!==l?(c=(0,a.jsxs)("span",{className:"flex-1 overflow-hidden text-ellipsis",onClick:i,children:[r.data.name,l]}),e[5]=r.data.name,e[6]=i,e[7]=l,e[8]=c):c=e[8],c},sa=t=>{let e=(0,G.c)(10),{node:r}=t,n=(0,_.useRef)(null),i,l;e[0]===r.data.name?(i=e[1],l=e[2]):(i=()=>{var o,f;(o=n.current)==null||o.focus(),(f=n.current)==null||f.setSelectionRange(0,r.data.name.lastIndexOf("."))},l=[r.data.name],e[0]=r.data.name,e[1]=i,e[2]=l),(0,_.useEffect)(i,l);let c,m;e[3]===r?(c=e[4],m=e[5]):(c=()=>r.reset(),m=o=>{o.key==="Escape"&&r.reset(),o.key==="Enter"&&r.submit(o.currentTarget.value)},e[3]=r,e[4]=c,e[5]=m);let p;return e[6]!==r.data.name||e[7]!==c||e[8]!==m?(p=(0,a.jsx)("input",{ref:n,className:"flex-1 bg-transparent border border-border text-muted-foreground",defaultValue:r.data.name,onClick:ha,onBlur:c,onKeyDown:m}),e[6]=r.data.name,e[7]=c,e[8]=m,e[9]=p):p=e[9],p},la=({node:t,style:e,dragHandle:r})=>{let{openFile:n,sendCreateFileOrFolder:i,sendFileDetails:l}=me(),c=t.data.isDirectory?"directory":gt(t.data.name),m=jt[c],{openConfirm:p,openPrompt:o}=Fe(),{createNewCell:f}=Ve(),j=At(),y=s=>{f({code:s,before:!1,cellId:j??"__end__"})},d=(0,_.use)(Oe),g=async s=>{Me(s,d?d.relativeFromRoot(t.data.path):t.data.path)},b=async s=>{s.stopPropagation(),s.preventDefault(),p({title:"Delete file",description:`Are you sure you want to delete ${t.data.name}?`,confirmAction:(0,a.jsx)(_t,{onClick:async()=>{await t.tree.delete(t.id)},"aria-label":"Confirm",children:"Delete"})})},x=W(async()=>{t.open(),o({title:"Folder name",onConfirm:async s=>{d==null||d.createFolder(s,t.id)}})}),S=W(async()=>{t.open(),o({title:"File name",onConfirm:async s=>{d==null||d.createFile(s,t.id)}})}),k=W(async()=>{var F;if(!d||t.data.isDirectory)return;let[s,u]=Nt(t.data.name),O=`${s}_copy${u}`;try{let P=await l({path:t.data.path}),C=((F=t.parent)==null?void 0:F.data.path)||"";await i({path:C,type:"file",name:O,contents:P.contents?btoa(P.contents):void 0}),await d.refreshAll([C])}catch{A({title:"Failed to duplicate file",description:"Unable to create a duplicate of the file",variant:"danger"})}}),v=()=>{let s={size:14,strokeWidth:1.5,className:"mr-2"};return(0,a.jsxs)(ht,{align:"end",className:"no-print w-[220px]",onClick:u=>u.stopPropagation(),onCloseAutoFocus:u=>u.preventDefault(),children:[!t.data.isDirectory&&(0,a.jsxs)(N,{onSelect:()=>t.select(),children:[(0,a.jsx)(qt,{...s}),"Open file"]}),!t.data.isDirectory&&!ae()&&(0,a.jsxs)(N,{onSelect:()=>{n({path:t.data.path})},children:[(0,a.jsx)(pe,{...s}),"Open file in external editor"]}),t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(N,{onSelect:()=>S(),children:[(0,a.jsx)(ke,{...s}),"Create file"]}),(0,a.jsxs)(N,{onSelect:()=>x(),children:[(0,a.jsx)(Se,{...s}),"Create folder"]}),(0,a.jsx)(Y,{})]}),(0,a.jsxs)(N,{onSelect:()=>t.edit(),children:[(0,a.jsx)(Tt,{...s}),"Rename"]}),!t.data.isDirectory&&(0,a.jsxs)(N,{onSelect:k,children:[(0,a.jsx)(ve,{...s}),"Duplicate"]}),(0,a.jsxs)(N,{onSelect:async()=>{await ie(t.data.path),A({title:"Copied to clipboard"})},children:[(0,a.jsx)(De,{...s}),"Copy path"]}),d&&(0,a.jsxs)(N,{onSelect:async()=>{await ie(d.relativeFromRoot(t.data.path)),A({title:"Copied to clipboard"})},children:[(0,a.jsx)(De,{...s}),"Copy relative path"]}),(0,a.jsx)(Y,{}),(0,a.jsxs)(N,{onSelect:()=>{let{path:u}=t.data;y(we[c](u))},children:[(0,a.jsx)(st,{...s}),"Insert snippet for reading file"]}),(0,a.jsxs)(N,{onSelect:async()=>{A({title:"Copied to clipboard",description:"Code to open the file has been copied to your clipboard. You can also drag and drop this file into the editor"});let{path:u}=t.data;await ie(we[c](u))},children:[(0,a.jsx)(Te,{...s}),"Copy snippet for reading file"]}),t.data.isMarimoFile&&!ae()&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y,{}),(0,a.jsxs)(N,{onSelect:g,children:[(0,a.jsx)($t,{...s}),"Open notebook"]})]}),(0,a.jsx)(Y,{}),!t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(N,{onSelect:async()=>{let u=(await l({path:t.data.path})).contents||"";ye(new Blob([u]),t.data.name)},children:[(0,a.jsx)(be,{...s}),"Download"]}),(0,a.jsx)(Y,{})]}),(0,a.jsxs)(N,{onSelect:b,variant:"danger",children:[(0,a.jsx)(kt,{...s}),"Delete"]})]})};return(0,a.jsxs)("div",{style:e,ref:r,className:ce("flex items-center cursor-pointer ml-1 text-muted-foreground whitespace-nowrap group"),draggable:!0,onClick:s=>{s.stopPropagation(),t.data.isDirectory&&t.toggle()},children:[(0,a.jsx)(da,{node:t}),(0,a.jsxs)("span",{className:ce("flex items-center pl-1 py-1 cursor-pointer hover:bg-accent/50 hover:text-accent-foreground rounded-l flex-1 overflow-hidden group",t.willReceiveDrop&&t.data.isDirectory&&"bg-accent/80 hover:bg-accent/80 text-accent-foreground"),children:[t.data.isMarimoFile?(0,a.jsx)("img",{src:Et,className:"w-5 h-5 shrink-0 mr-2 filter grayscale",alt:"Marimo"}):(0,a.jsx)(m,{className:"w-5 h-5 shrink-0 mr-2",strokeWidth:1.5}),t.isEditing?(0,a.jsx)(sa,{node:t}):(0,a.jsx)(oa,{node:t,onOpenMarimoFile:g}),(0,a.jsxs)(ft,{modal:!1,children:[(0,a.jsx)(pt,{asChild:!0,tabIndex:-1,onClick:s=>s.stopPropagation(),children:(0,a.jsx)(I,{"data-testid":"file-explorer-more-button",variant:"text",tabIndex:-1,size:"xs",className:"mb-0","aria-label":"More options",children:(0,a.jsx)(xt,{strokeWidth:2,className:"w-5 h-5 hidden group-hover:block"})})}),v()]})]})]})},da=t=>{let e=(0,G.c)(3),{node:r}=t;if(!r.data.isDirectory){let i;return e[0]===Symbol.for("react.memo_cache_sentinel")?(i=(0,a.jsx)("span",{className:"w-5 h-5 shrink-0"}),e[0]=i):i=e[0],i}let n;return e[1]===r.isOpen?n=e[2]:(n=r.isOpen?(0,a.jsx)(dt,{className:"w-5 h-5 shrink-0"}):(0,a.jsx)(ct,{className:"w-5 h-5 shrink-0"}),e[1]=r.isOpen,e[2]=n),n};function Me(t,e){t.stopPropagation(),t.preventDefault(),Ht(e)}function Re(t,e){if(e)return t;let r=[];for(let n of t){if(ca(n.name))continue;let i=n;if(n.children){let l=Re(n.children,e);l!==n.children&&(i={...n,children:l})}r.push(i)}return r}function ca(t){return!!t.startsWith(".")}function ma(){return null}function pa(t){let{parentNode:e}=t;return!e.data.isDirectory}function ha(t){return t.stopPropagation()}var fa=de(),xa=()=>{let t=(0,fa.c)(20),{ref:e,height:r}=It(),n=r===void 0?1:r,i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i={noClick:!0,noKeyboard:!0},t[0]=i):i=t[0];let{getRootProps:l,getInputProps:c,isDragActive:m}=ze(i),p;t[1]===l?p=t[2]:(p=l(),t[1]=l,t[2]=p);let o;t[3]===Symbol.for("react.memo_cache_sentinel")?(o=ce("flex flex-col flex-1 overflow-hidden relative"),t[3]=o):o=t[3];let f;t[4]===c?f=t[5]:(f=c(),t[4]=c,t[5]=f);let j;t[6]===f?j=t[7]:(j=(0,a.jsx)("input",{...f}),t[6]=f,t[7]=j);let y;t[8]===m?y=t[9]:(y=m&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center uppercase justify-center text-xl font-bold text-primary/90 bg-accent/85 z-10 border-2 border-dashed border-primary/90 rounded-lg pointer-events-none",children:"Drop files here"}),t[8]=m,t[9]=y);let d;t[10]===n?d=t[11]:(d=(0,a.jsx)(ia,{height:n}),t[10]=n,t[11]=d);let g;t[12]!==e||t[13]!==d?(g=(0,a.jsx)("div",{ref:e,className:"flex flex-col flex-1 overflow-hidden",children:d}),t[12]=e,t[13]=d,t[14]=g):g=t[14];let b;return t[15]!==p||t[16]!==j||t[17]!==y||t[18]!==g?(b=(0,a.jsxs)("div",{...p,className:o,children:[j,y,g]}),t[15]=p,t[16]=j,t[17]=y,t[18]=g,t[19]=b):b=t[19],b};export{xa as default};
