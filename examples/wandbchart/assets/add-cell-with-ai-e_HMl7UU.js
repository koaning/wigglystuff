var vi=Object.defineProperty;var _i=(t,e,a)=>e in t?vi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var L=(t,e,a)=>_i(t,typeof e!="symbol"?e+"":e,a);import{s as Za,t as bi}from"./chunk-LvLJmgfZ.js";import{f as Kr,i as Yr,l as xi,n as Hr,o as wi,u as Gr}from"./useEvent-BhXAndur.js";import{t as ki}from"./react-Bj1aDYRI.js";import{At as Qr,Cr as Ci,Dn as Ei,Er as Ti,Hn as Ii,It as Si,Jr as Ai,Wn as Oi,Wr as Ri,Xr as Ni,at as Fa,er as ji,f as Mi,gn as Pi,i as Li,ni as Xr,nr as $i,ri as Di,rr as es,vt as Zi,w as ts,y as Ge,yn as Fi}from"./cells-DPp5cDaO.js";import{B as Ce,D as zi,E as as,H as Ui,I as Nt,J as rs,L as Q,N as ss,O as Vi,P as H,R as E,S as Bi,T as ce,V as Fe,W as ns,b as aa,k as M,w as ze,x as ra}from"./zod-H_cgTO0M.js";import{t as jt}from"./compiler-runtime-B3qBwwSJ.js";import{n as is}from"./assertNever-CBU83Y6o.js";import{t as qi,w as Wi}from"./ai-model-dropdown-Dk2SdB3C.js";import{d as ie,s as Ji}from"./hotkeys-BHHWjLlp.js";import{n as Ki}from"./utils-YqBXNpsM.js";import{o as Yi}from"./config-Q0O7_stz.js";import{t as Hi}from"./jsx-runtime-ZmTK25f3.js";import{t as Qe}from"./button-CZ3Cs4qb.js";import{t as za}from"./cn-BKtXLv3a.js";import{Bt as Gi,Jt as sa,St as na,Ut as os,Vt as Qi,Xt as Xi,at as ls,ct as eo,lt as ds,qt as ia,rt as Ua,xt as to}from"./dist-DBwNzi3C.js";import{t as ao}from"./createReducer-B3rBsy4P.js";import{h as ro,n as so,o as no,r as io}from"./dist-ChS0Dc_R.js";import{r as oo,t as lo}from"./requests-B4FYHTZl.js";import{t as oa}from"./createLucideIcon-BCdY6lG5.js";import{t as us}from"./x-ZP5cObgf.js";import{f as uo,l as cs,n as co}from"./markdown-renderer-DJy8ww5d.js";import{a as ps,c as po,p as mo,r as ho,t as fo}from"./dropdown-menu-ldcmQvIV.js";import{t as ms}from"./file-Ch78NKWp.js";import{n as go,t as yo}from"./play-GLWQQs7F.js";import{t as vo}from"./spinner-DA8-7wQv.js";import{r as _o}from"./input-DUrq2DiR.js";import{a as bo}from"./state-D4T75eZb.js";import{a as Mt,i as wt,o as Pt,r as kt,s as xo,t as wo}from"./datasource-CtyqtITR.js";import{a as ko}from"./dist-bBwmhqty.js";import{t as Va}from"./use-toast-BDYuj3zG.js";import{r as Co}from"./useTheme-DQozhcp1.js";import{t as la}from"./tooltip-CMQz28hC.js";import{d as Eo}from"./popover-CH1FzjxU.js";import{r as To}from"./errors-TZBmrJmc.js";import{t as Io}from"./blob-D-eV0cU3.js";import{n as So}from"./useRunCells-D2HBb4DB.js";import{i as Ba}from"./cell-link-B9b7J8QK.js";import{r as Ao,t as Oo}from"./html-to-image-CIQqSu-S.js";import{n as qa}from"./renderShortcut-BckyRbYt.js";import{t as Ro}from"./process-output-ByfLnk6j.js";import{t as No}from"./useDeleteCell-DdRX94yC.js";import{r as jo,t as Mo}from"./esm-Bmu2DhPy.js";import{n as Po}from"./icons-CCHmxi8d.js";var hs=oa("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),fs=oa("circle-stop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]),gs=oa("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]),ys=oa("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),vs="vercel.ai.error",Lo=Symbol.for(vs),_s,bs,Xe=class ui extends(bs=Error,_s=Lo,bs){constructor({name:e,message:a,cause:r}){super(a),this[_s]=!0,this.name=e,this.cause=r}static isInstance(e){return ui.hasMarker(e,vs)}static hasMarker(e,a){let r=Symbol.for(a);return typeof e=="object"&&!!e&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};function xs(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var ws="AI_InvalidArgumentError",ks=`vercel.ai.error.${ws}`,$o=Symbol.for(ks),Cs,Es,Do=class extends(Es=Xe,Cs=$o,Es){constructor({message:t,cause:e,argument:a}){super({name:ws,message:t,cause:e}),this[Cs]=!0,this.argument=a}static isInstance(t){return Xe.hasMarker(t,ks)}},Ts="AI_JSONParseError",Is=`vercel.ai.error.${Ts}`,Zo=Symbol.for(Is),Ss,As,Os=class extends(As=Xe,Ss=Zo,As){constructor({text:t,cause:e}){super({name:Ts,message:`JSON parsing failed: Text: ${t}.
Error message: ${xs(e)}`,cause:e}),this[Ss]=!0,this.text=t}static isInstance(t){return Xe.hasMarker(t,Is)}},Rs="AI_TypeValidationError",Ns=`vercel.ai.error.${Rs}`,Fo=Symbol.for(Ns),js,Ms,da=class zr extends(Ms=Xe,js=Fo,Ms){constructor({value:e,cause:a}){super({name:Rs,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${xs(a)}`,cause:a}),this[js]=!0,this.value=e}static isInstance(e){return Xe.hasMarker(e,Ns)}static wrap({value:e,cause:a}){return zr.isInstance(a)&&a.value===e?a:new zr({value:e,cause:a})}},Ps=class extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function Wa(t){}function zo(t){if(typeof t=="function")throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=Wa,onError:a=Wa,onRetry:r=Wa,onComment:s}=t,n="",o=!0,i,l="",d="";function u(g){let p=o?g.replace(/^\xEF\xBB\xBF/,""):g,[h,v]=Uo(`${n}${p}`);for(let T of h)c(T);n=v,o=!1}function c(g){if(g===""){m();return}if(g.startsWith(":")){s&&s(g.slice(g.startsWith(": ")?2:1));return}let p=g.indexOf(":");if(p!==-1){let h=g.slice(0,p),v=g[p+1]===" "?2:1;f(h,g.slice(p+v),g);return}f(g,"",g)}function f(g,p,h){switch(g){case"event":d=p;break;case"data":l=`${l}${p}
`;break;case"id":i=p.includes("\0")?void 0:p;break;case"retry":/^\d+$/.test(p)?r(parseInt(p,10)):a(new Ps(`Invalid \`retry\` value: "${p}"`,{type:"invalid-retry",value:p,line:h}));break;default:a(new Ps(`Unknown field "${g.length>20?`${g.slice(0,20)}\u2026`:g}"`,{type:"unknown-field",field:g,value:p,line:h}));break}}function m(){l.length>0&&e({id:i,event:d||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",d=""}function b(g={}){n&&g.consume&&c(n),o=!0,i=void 0,l="",d="",n=""}return{feed:u,reset:b}}function Uo(t){let e=[],a="",r=0;for(;r<t.length;){let s=t.indexOf("\r",r),n=t.indexOf(`
`,r),o=-1;if(s!==-1&&n!==-1?o=Math.min(s,n):s===-1?n!==-1&&(o=n):o=s===t.length-1?-1:s,o===-1){a=t.slice(r);break}else{let i=t.slice(r,o);e.push(i),r=o+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,a]}var Vo=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:a}={}){let r;super({start(s){r=zo({onEvent:n=>{s.enqueue(n)},onError(n){t==="terminate"?s.error(n):typeof t=="function"&&t(n)},onRetry:e,onComment:a})},transform(s){r.feed(s)}})}},z;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function a(s){throw Error()}t.assertNever=a,t.arrayToEnum=s=>{let n={};for(let o of s)n[o]=o;return n},t.getValidEnumValues=s=>{let n=t.objectKeys(s).filter(i=>typeof s[s[i]]!="number"),o={};for(let i of n)o[i]=s[i];return t.objectValues(o)},t.objectValues=s=>t.objectKeys(s).map(function(n){return s[n]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let o in s)Object.prototype.hasOwnProperty.call(s,o)&&n.push(o);return n},t.find=(s,n)=>{for(let o of s)if(n(o))return o},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,n=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(n)}t.joinValues=r,t.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(z||(z={}));var Bo;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(Bo||(Bo={}));const w=z.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),et=t=>{switch(typeof t){case"undefined":return w.undefined;case"string":return w.string;case"number":return Number.isNaN(t)?w.nan:w.number;case"boolean":return w.boolean;case"function":return w.function;case"bigint":return w.bigint;case"symbol":return w.symbol;case"object":return Array.isArray(t)?w.array:t===null?w.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?w.promise:typeof Map<"u"&&t instanceof Map?w.map:typeof Set<"u"&&t instanceof Set?w.set:typeof Date<"u"&&t instanceof Date?w.date:w.object;default:return w.unknown}},y=z.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var je=class ci extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(n){return n.message},r={_errors:[]},s=n=>{for(let o of n.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)r._errors.push(a(o));else{let i=r,l=0;for(;l<o.path.length;){let d=o.path[l];l===o.path.length-1?(i[d]=i[d]||{_errors:[]},i[d]._errors.push(a(o))):i[d]=i[d]||{_errors:[]},i=i[d],l++}}};return s(this),r}static assert(e){if(!(e instanceof ci))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,z.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a=Object.create(null),r=[];for(let s of this.issues)if(s.path.length>0){let n=s.path[0];a[n]=a[n]||[],a[n].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};je.create=t=>new je(t);var Lt=(t,e)=>{let a;switch(t.code){case y.invalid_type:a=t.received===w.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case y.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,z.jsonStringifyReplacer)}`;break;case y.unrecognized_keys:a=`Unrecognized key(s) in object: ${z.joinValues(t.keys,", ")}`;break;case y.invalid_union:a="Invalid input";break;case y.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${z.joinValues(t.options)}`;break;case y.invalid_enum_value:a=`Invalid enum value. Expected ${z.joinValues(t.options)}, received '${t.received}'`;break;case y.invalid_arguments:a="Invalid function arguments";break;case y.invalid_return_type:a="Invalid function return type";break;case y.invalid_date:a="Invalid date";break;case y.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:z.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case y.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case y.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case y.custom:a="Invalid input";break;case y.invalid_intersection_types:a="Intersection results could not be merged";break;case y.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case y.not_finite:a="Number must be finite";break;default:a=e.defaultError,z.assertNever(t)}return{message:a}},qo=Lt;function Ja(){return qo}const Ka=t=>{let{data:e,path:a,errorMaps:r,issueData:s}=t,n=[...a,...s.path||[]],o={...s,path:n};if(s.message!==void 0)return{...s,path:n,message:s.message};let i="",l=r.filter(d=>!!d).slice().reverse();for(let d of l)i=d(o,{data:e,defaultError:i}).message;return{...s,path:n,message:i}};function x(t,e){let a=Ja(),r=Ka({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===Lt?void 0:Lt].filter(s=>!!s)});t.common.issues.push(r)}var ge=class pi{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let r=[];for(let s of a){if(s.status==="aborted")return O;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,a){let r=[];for(let s of a){let n=await s.key,o=await s.value;r.push({key:n,value:o})}return pi.mergeObjectSync(e,r)}static mergeObjectSync(e,a){let r={};for(let s of a){let{key:n,value:o}=s;if(n.status==="aborted"||o.status==="aborted")return O;n.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(o.value!==void 0||s.alwaysSet)&&(r[n.value]=o.value)}return{status:e.value,value:r}}};const O=Object.freeze({status:"aborted"}),Ya=t=>({status:"dirty",value:t}),fe=t=>({status:"valid",value:t}),Ls=t=>t.status==="aborted",$s=t=>t.status==="dirty",Ct=t=>t.status==="valid",ua=t=>typeof Promise<"u"&&t instanceof Promise;var I;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(I||(I={}));var Me=class{constructor(t,e,a,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ds=(t,e)=>{if(Ct(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new je(t.common.issues)),this._error}}};function R(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:r,description:s}=t;if(e&&(a||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(n,o)=>{let{message:i}=t;return n.code==="invalid_enum_value"?{message:i??o.defaultError}:o.data===void 0?{message:i??r??o.defaultError}:n.code==="invalid_type"?{message:i??a??o.defaultError}:{message:o.defaultError}},description:s}}var $=class{get description(){return this._def.description}_getType(t){return et(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:et(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ge,ctx:{common:t.parent.common,data:t.data,parsedType:et(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(ua(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:et(t)};return Ds(a,this._parseSync({data:t,path:a.path,parent:a}))}"~validate"(t){var a,r;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:et(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:e});return Ct(s)?{value:s.value}:{issues:e.common.issues}}catch(s){(r=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(s=>Ct(s)?{value:s.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:et(t)},r=this._parse({data:t,path:a.path,parent:a});return Ds(a,await(ua(r)?r:Promise.resolve(r)))}refine(t,e){let a=r=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,s)=>{let n=t(r),o=()=>s.addIssue({code:y.custom,...a(r)});return typeof Promise<"u"&&n instanceof Promise?n.then(i=>i?!0:(o(),!1)):n?!0:(o(),!1)})}refinement(t,e){return this._refinement((a,r)=>t(a)?!0:(r.addIssue(typeof e=="function"?e(a,r):e),!1))}_refinement(t){return new Ue({schema:this,typeName:_.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Ve.create(this,this._def)}nullable(){return dt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Tt.create(this)}promise(){return $t.create(this,this._def)}or(t){return ha.create([this,t],this._def)}and(t){return fa.create(this,t,this._def)}transform(t){return new Ue({...R(this._def),schema:this,typeName:_.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new ba({...R(this._def),innerType:this,defaultValue:e,typeName:_.ZodDefault})}brand(){return new Vs({typeName:_.ZodBranded,type:this,...R(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new xa({...R(this._def),innerType:this,catchValue:e,typeName:_.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return Bs.create(this,t)}readonly(){return wa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Wo=/^c[^\s-]{8,}$/i,Jo=/^[0-9a-z]+$/,Ko=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Yo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ho=/^[a-z0-9_-]{21}$/i,Go=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Qo=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Xo=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,el="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Zs,tl=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,al=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,rl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,nl=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,il=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Fs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ol=RegExp(`^${Fs}$`);function zs(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function ll(t){return RegExp(`^${zs(t)}$`)}function dl(t){let e=`${Fs}T${zs(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function ul(t,e){return!!((e==="v4"||!e)&&tl.test(t)||(e==="v6"||!e)&&rl.test(t))}function cl(t,e){if(!Go.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||!s||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function pl(t,e){return!!((e==="v4"||!e)&&al.test(t)||(e==="v6"||!e)&&sl.test(t))}var ca=class Yt extends ${_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==w.string){let s=this._getOrReturnCtx(e);return x(s,{code:y.invalid_type,expected:w.string,received:s.parsedType}),O}let a=new ge,r;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),x(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),x(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let n=e.data.length>s.value,o=e.data.length<s.value;(n||o)&&(r=this._getOrReturnCtx(e,r),n?x(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&x(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")Xo.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"email",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")Zs||(Zs=new RegExp(el,"u")),Zs.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"emoji",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")Yo.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"uuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")Ho.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"nanoid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")Wo.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"cuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")Jo.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"cuid2",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")Ko.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"ulid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),x(r,{validation:"url",code:y.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"regex",code:y.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?dl(s).test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?ol.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?ll(s).test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?Qo.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"duration",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?ul(e.data,s.version)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"ip",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?cl(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"jwt",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?pl(e.data,s.version)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"cidr",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?nl.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"base64",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?il.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"base64url",code:y.invalid_string,message:s.message}),a.dirty()):z.assertNever(s);return{status:a.value,value:e.data}}_regex(e,a,r){return this.refinement(s=>e.test(s),{validation:a,code:y.invalid_string,...I.errToObj(r)})}_addCheck(e){return new Yt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...I.errToObj(e)})}url(e){return this._addCheck({kind:"url",...I.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...I.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...I.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...I.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...I.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...I.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...I.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...I.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...I.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...I.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...I.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...I.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...I.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...I.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...I.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...I.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...I.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...I.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...I.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...I.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...I.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...I.errToObj(a)})}nonempty(e){return this.min(1,I.errToObj(e))}trim(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};ca.create=t=>new ca({checks:[],typeName:_.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...R(t)});function ml(t,e){let a=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=a>r?a:r;return Number.parseInt(t.toFixed(s).replace(".",""))%Number.parseInt(e.toFixed(s).replace(".",""))/10**s}var Ha=class Ur extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==w.number){let s=this._getOrReturnCtx(e);return x(s,{code:y.invalid_type,expected:w.number,received:s.parsedType}),O}let a,r=new ge;for(let s of this._def.checks)s.kind==="int"?z.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),x(a,{code:y.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?ml(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),x(a,{code:y.not_finite,message:s.message}),r.dirty()):z.assertNever(s);return{status:r.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,I.toString(a))}gt(e,a){return this.setLimit("min",e,!1,I.toString(a))}lte(e,a){return this.setLimit("max",e,!0,I.toString(a))}lt(e,a){return this.setLimit("max",e,!1,I.toString(a))}setLimit(e,a,r,s){return new Ur({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:I.toString(s)}]})}_addCheck(e){return new Ur({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:I.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:I.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:I.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:I.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:I.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&z.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(a)&&Number.isFinite(e)}};Ha.create=t=>new Ha({checks:[],typeName:_.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...R(t)});var Ga=class Vr extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==w.bigint)return this._getInvalidInput(e);let a,r=new ge;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):z.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return x(a,{code:y.invalid_type,expected:w.bigint,received:a.parsedType}),O}gte(e,a){return this.setLimit("min",e,!0,I.toString(a))}gt(e,a){return this.setLimit("min",e,!1,I.toString(a))}lte(e,a){return this.setLimit("max",e,!0,I.toString(a))}lt(e,a){return this.setLimit("max",e,!1,I.toString(a))}setLimit(e,a,r,s){return new Vr({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:I.toString(s)}]})}_addCheck(e){return new Vr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:I.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Ga.create=t=>new Ga({checks:[],typeName:_.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...R(t)});var Qa=class extends ${_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==w.boolean){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.boolean,received:e.parsedType}),O}return fe(t.data)}};Qa.create=t=>new Qa({typeName:_.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...R(t)});var Xa=class mi extends ${_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==w.date){let s=this._getOrReturnCtx(e);return x(s,{code:y.invalid_type,expected:w.date,received:s.parsedType}),O}if(Number.isNaN(e.data.getTime()))return x(this._getOrReturnCtx(e),{code:y.invalid_date}),O;let a=new ge,r;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),x(r,{code:y.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),x(r,{code:y.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):z.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new mi({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:I.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:I.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};Xa.create=t=>new Xa({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:_.ZodDate,...R(t)});var er=class extends ${_parse(t){if(this._getType(t)!==w.symbol){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.symbol,received:e.parsedType}),O}return fe(t.data)}};er.create=t=>new er({typeName:_.ZodSymbol,...R(t)});var pa=class extends ${_parse(t){if(this._getType(t)!==w.undefined){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.undefined,received:e.parsedType}),O}return fe(t.data)}};pa.create=t=>new pa({typeName:_.ZodUndefined,...R(t)});var ma=class extends ${_parse(t){if(this._getType(t)!==w.null){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.null,received:e.parsedType}),O}return fe(t.data)}};ma.create=t=>new ma({typeName:_.ZodNull,...R(t)});var tr=class extends ${constructor(){super(...arguments),this._any=!0}_parse(t){return fe(t.data)}};tr.create=t=>new tr({typeName:_.ZodAny,...R(t)});var Et=class extends ${constructor(){super(...arguments),this._unknown=!0}_parse(t){return fe(t.data)}};Et.create=t=>new Et({typeName:_.ZodUnknown,...R(t)});var tt=class extends ${_parse(t){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.never,received:e.parsedType}),O}};tt.create=t=>new tt({typeName:_.ZodNever,...R(t)});var ar=class extends ${_parse(t){if(this._getType(t)!==w.undefined){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.void,received:e.parsedType}),O}return fe(t.data)}};ar.create=t=>new ar({typeName:_.ZodVoid,...R(t)});var Tt=class Ma extends ${_parse(e){let{ctx:a,status:r}=this._processInputParams(e),s=this._def;if(a.parsedType!==w.array)return x(a,{code:y.invalid_type,expected:w.array,received:a.parsedType}),O;if(s.exactLength!==null){let o=a.data.length>s.exactLength.value,i=a.data.length<s.exactLength.value;(o||i)&&(x(a,{code:o?y.too_big:y.too_small,minimum:i?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&a.data.length<s.minLength.value&&(x(a,{code:y.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&a.data.length>s.maxLength.value&&(x(a,{code:y.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((o,i)=>s.type._parseAsync(new Me(a,o,a.path,i)))).then(o=>ge.mergeArray(r,o));let n=[...a.data].map((o,i)=>s.type._parseSync(new Me(a,o,a.path,i)));return ge.mergeArray(r,n)}get element(){return this._def.type}min(e,a){return new Ma({...this._def,minLength:{value:e,message:I.toString(a)}})}max(e,a){return new Ma({...this._def,maxLength:{value:e,message:I.toString(a)}})}length(e,a){return new Ma({...this._def,exactLength:{value:e,message:I.toString(a)}})}nonempty(e){return this.min(1,e)}};Tt.create=(t,e)=>new Tt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:_.ZodArray,...R(e)});function It(t){if(t instanceof Ee){let e={};for(let a in t.shape){let r=t.shape[a];e[a]=Ve.create(It(r))}return new Ee({...t._def,shape:()=>e})}else return t instanceof Tt?new Tt({...t._def,type:It(t.element)}):t instanceof Ve?Ve.create(It(t.unwrap())):t instanceof dt?dt.create(It(t.unwrap())):t instanceof lt?lt.create(t.items.map(e=>It(e))):t}var Ee=class Ae extends ${constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:z.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==w.object){let l=this._getOrReturnCtx(e);return x(l,{code:y.invalid_type,expected:w.object,received:l.parsedType}),O}let{status:a,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),o=[];if(!(this._def.catchall instanceof tt&&this._def.unknownKeys==="strip"))for(let l in r.data)n.includes(l)||o.push(l);let i=[];for(let l of n){let d=s[l],u=r.data[l];i.push({key:{status:"valid",value:l},value:d._parse(new Me(r,u,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof tt){let l=this._def.unknownKeys;if(l==="passthrough")for(let d of o)i.push({key:{status:"valid",value:d},value:{status:"valid",value:r.data[d]}});else if(l==="strict")o.length>0&&(x(r,{code:y.unrecognized_keys,keys:o}),a.dirty());else if(l!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let d of o){let u=r.data[d];i.push({key:{status:"valid",value:d},value:l._parse(new Me(r,u,r.path,d)),alwaysSet:d in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let l=[];for(let d of i){let u=await d.key,c=await d.value;l.push({key:u,value:c,alwaysSet:d.alwaysSet})}return l}).then(l=>ge.mergeObjectSync(a,l)):ge.mergeObjectSync(a,i)}get shape(){return this._def.shape()}strict(e){return I.errToObj,new Ae({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,r)=>{var n,o;let s=((o=(n=this._def).errorMap)==null?void 0:o.call(n,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:I.errToObj(e).message??s}:{message:s}}}})}strip(){return new Ae({...this._def,unknownKeys:"strip"})}passthrough(){return new Ae({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ae({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ae({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:_.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new Ae({...this._def,catchall:e})}pick(e){let a={};for(let r of z.objectKeys(e))e[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new Ae({...this._def,shape:()=>a})}omit(e){let a={};for(let r of z.objectKeys(this.shape))e[r]||(a[r]=this.shape[r]);return new Ae({...this._def,shape:()=>a})}deepPartial(){return It(this)}partial(e){let a={};for(let r of z.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?a[r]=s:a[r]=s.optional()}return new Ae({...this._def,shape:()=>a})}required(e){let a={};for(let r of z.objectKeys(this.shape))if(e&&!e[r])a[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Ve;)s=s._def.innerType;a[r]=s}return new Ae({...this._def,shape:()=>a})}keyof(){return Us(z.objectKeys(this.shape))}};Ee.create=(t,e)=>new Ee({shape:()=>t,unknownKeys:"strip",catchall:tt.create(),typeName:_.ZodObject,...R(e)}),Ee.strictCreate=(t,e)=>new Ee({shape:()=>t,unknownKeys:"strict",catchall:tt.create(),typeName:_.ZodObject,...R(e)}),Ee.lazycreate=(t,e)=>new Ee({shape:t,unknownKeys:"strip",catchall:tt.create(),typeName:_.ZodObject,...R(e)});var ha=class extends ${_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function r(s){for(let o of s)if(o.result.status==="valid")return o.result;for(let o of s)if(o.result.status==="dirty")return e.common.issues.push(...o.ctx.common.issues),o.result;let n=s.map(o=>new je(o.ctx.common.issues));return x(e,{code:y.invalid_union,unionErrors:n}),O}if(e.common.async)return Promise.all(a.map(async s=>{let n={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}})).then(r);{let s,n=[];for(let i of a){let l={...e,common:{...e.common,issues:[]},parent:null},d=i._parseSync({data:e.data,path:e.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:l}),l.common.issues.length&&n.push(l.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;let o=n.map(i=>new je(i));return x(e,{code:y.invalid_union,unionErrors:o}),O}}get options(){return this._def.options}};ha.create=(t,e)=>new ha({options:t,typeName:_.ZodUnion,...R(e)});var at=t=>t instanceof ga?at(t.schema):t instanceof Ue?at(t.innerType()):t instanceof ya?[t.value]:t instanceof va?t.options:t instanceof _a?z.objectValues(t.enum):t instanceof ba?at(t._def.innerType):t instanceof pa?[void 0]:t instanceof ma?[null]:t instanceof Ve?[void 0,...at(t.unwrap())]:t instanceof dt?[null,...at(t.unwrap())]:t instanceof Vs||t instanceof wa?at(t.unwrap()):t instanceof xa?at(t._def.innerType):[],hl=class hi extends ${_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==w.object)return x(a,{code:y.invalid_type,expected:w.object,received:a.parsedType}),O;let r=this.discriminator,s=a.data[r],n=this.optionsMap.get(s);return n?a.common.async?n._parseAsync({data:a.data,path:a.path,parent:a}):n._parseSync({data:a.data,path:a.path,parent:a}):(x(a,{code:y.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),O)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,r){let s=new Map;for(let n of a){let o=at(n.shape[e]);if(!o.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of o){if(s.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);s.set(i,n)}}return new hi({typeName:_.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:s,...R(r)})}};function rr(t,e){let a=et(t),r=et(e);if(t===e)return{valid:!0,data:t};if(a===w.object&&r===w.object){let s=z.objectKeys(e),n=z.objectKeys(t).filter(i=>s.indexOf(i)!==-1),o={...t,...e};for(let i of n){let l=rr(t[i],e[i]);if(!l.valid)return{valid:!1};o[i]=l.data}return{valid:!0,data:o}}else if(a===w.array&&r===w.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let o=t[n],i=e[n],l=rr(o,i);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return a===w.date&&r===w.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var fa=class extends ${_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=(s,n)=>{if(Ls(s)||Ls(n))return O;let o=rr(s.value,n.value);return o.valid?(($s(s)||$s(n))&&e.dirty(),{status:e.value,value:o.data}):(x(a,{code:y.invalid_intersection_types}),O)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,n])=>r(s,n)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};fa.create=(t,e,a)=>new fa({left:t,right:e,typeName:_.ZodIntersection,...R(a)});var lt=class fi extends ${_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==w.array)return x(r,{code:y.invalid_type,expected:w.array,received:r.parsedType}),O;if(r.data.length<this._def.items.length)return x(r,{code:y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),O;!this._def.rest&&r.data.length>this._def.items.length&&(x(r,{code:y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let s=[...r.data].map((n,o)=>{let i=this._def.items[o]||this._def.rest;return i?i._parse(new Me(r,n,r.path,o)):null}).filter(n=>!!n);return r.common.async?Promise.all(s).then(n=>ge.mergeArray(a,n)):ge.mergeArray(a,s)}get items(){return this._def.items}rest(e){return new fi({...this._def,rest:e})}};lt.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new lt({items:t,typeName:_.ZodTuple,rest:null,...R(e)})};var fl=class Br extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==w.object)return x(r,{code:y.invalid_type,expected:w.object,received:r.parsedType}),O;let s=[],n=this._def.keyType,o=this._def.valueType;for(let i in r.data)s.push({key:n._parse(new Me(r,i,r.path,i)),value:o._parse(new Me(r,r.data[i],r.path,i)),alwaysSet:i in r.data});return r.common.async?ge.mergeObjectAsync(a,s):ge.mergeObjectSync(a,s)}get element(){return this._def.valueType}static create(e,a,r){return a instanceof $?new Br({keyType:e,valueType:a,typeName:_.ZodRecord,...R(r)}):new Br({keyType:ca.create(),valueType:e,typeName:_.ZodRecord,...R(a)})}},sr=class extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==w.map)return x(a,{code:y.invalid_type,expected:w.map,received:a.parsedType}),O;let r=this._def.keyType,s=this._def.valueType,n=[...a.data.entries()].map(([o,i],l)=>({key:r._parse(new Me(a,o,a.path,[l,"key"])),value:s._parse(new Me(a,i,a.path,[l,"value"]))}));if(a.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let i of n){let l=await i.key,d=await i.value;if(l.status==="aborted"||d.status==="aborted")return O;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),o.set(l.value,d.value)}return{status:e.value,value:o}})}else{let o=new Map;for(let i of n){let l=i.key,d=i.value;if(l.status==="aborted"||d.status==="aborted")return O;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),o.set(l.value,d.value)}return{status:e.value,value:o}}}};sr.create=(t,e,a)=>new sr({valueType:e,keyType:t,typeName:_.ZodMap,...R(a)});var nr=class qr extends ${_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==w.set)return x(r,{code:y.invalid_type,expected:w.set,received:r.parsedType}),O;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(x(r,{code:y.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),a.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(x(r,{code:y.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),a.dirty());let n=this._def.valueType;function o(l){let d=new Set;for(let u of l){if(u.status==="aborted")return O;u.status==="dirty"&&a.dirty(),d.add(u.value)}return{status:a.value,value:d}}let i=[...r.data.values()].map((l,d)=>n._parse(new Me(r,l,r.path,d)));return r.common.async?Promise.all(i).then(l=>o(l)):o(i)}min(e,a){return new qr({...this._def,minSize:{value:e,message:I.toString(a)}})}max(e,a){return new qr({...this._def,maxSize:{value:e,message:I.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};nr.create=(t,e)=>new nr({valueType:t,minSize:null,maxSize:null,typeName:_.ZodSet,...R(e)});var gl=class Pa extends ${constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==w.function)return x(a,{code:y.invalid_type,expected:w.function,received:a.parsedType}),O;function r(i,l){return Ka({data:i,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Ja(),Lt].filter(d=>!!d),issueData:{code:y.invalid_arguments,argumentsError:l}})}function s(i,l){return Ka({data:i,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Ja(),Lt].filter(d=>!!d),issueData:{code:y.invalid_return_type,returnTypeError:l}})}let n={errorMap:a.common.contextualErrorMap},o=a.data;if(this._def.returns instanceof $t){let i=this;return fe(async function(...l){let d=new je([]),u=await i._def.args.parseAsync(l,n).catch(f=>{throw d.addIssue(r(l,f)),d}),c=await Reflect.apply(o,this,u);return await i._def.returns._def.type.parseAsync(c,n).catch(f=>{throw d.addIssue(s(c,f)),d})})}else{let i=this;return fe(function(...l){let d=i._def.args.safeParse(l,n);if(!d.success)throw new je([r(l,d.error)]);let u=Reflect.apply(o,this,d.data),c=i._def.returns.safeParse(u,n);if(!c.success)throw new je([s(u,c.error)]);return c.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Pa({...this._def,args:lt.create(e).rest(Et.create())})}returns(e){return new Pa({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,r){return new Pa({args:e||lt.create([]).rest(Et.create()),returns:a||Et.create(),typeName:_.ZodFunction,...R(r)})}},ga=class extends ${get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};ga.create=(t,e)=>new ga({getter:t,typeName:_.ZodLazy,...R(e)});var ya=class extends ${_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return x(e,{received:e.data,code:y.invalid_literal,expected:this._def.value}),O}return{status:"valid",value:t.data}}get value(){return this._def.value}};ya.create=(t,e)=>new ya({value:t,typeName:_.ZodLiteral,...R(e)});function Us(t,e){return new va({values:t,typeName:_.ZodEnum,...R(e)})}var va=class Wr extends ${_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),r=this._def.values;return x(a,{expected:z.joinValues(r),received:a.parsedType,code:y.invalid_type}),O}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),r=this._def.values;return x(a,{received:a.data,code:y.invalid_enum_value,options:r}),O}return fe(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return Wr.create(e,{...this._def,...a})}exclude(e,a=this._def){return Wr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...a})}};va.create=Us;var _a=class extends ${_parse(t){let e=z.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==w.string&&a.parsedType!==w.number){let r=z.objectValues(e);return x(a,{expected:z.joinValues(r),received:a.parsedType,code:y.invalid_type}),O}if(this._cache||(this._cache=new Set(z.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let r=z.objectValues(e);return x(a,{received:a.data,code:y.invalid_enum_value,options:r}),O}return fe(t.data)}get enum(){return this._def.values}};_a.create=(t,e)=>new _a({values:t,typeName:_.ZodNativeEnum,...R(e)});var $t=class extends ${unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);return e.parsedType!==w.promise&&e.common.async===!1?(x(e,{code:y.invalid_type,expected:w.promise,received:e.parsedType}),O):fe((e.parsedType===w.promise?e.data:Promise.resolve(e.data)).then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}};$t.create=(t,e)=>new $t({type:t,typeName:_.ZodPromise,...R(e)});var Ue=class extends ${innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===_.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=this._def.effect||null,s={addIssue:n=>{x(a,n),n.fatal?e.abort():e.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){let n=r.transform(a.data,s);if(a.common.async)return Promise.resolve(n).then(async o=>{if(e.value==="aborted")return O;let i=await this._def.schema._parseAsync({data:o,path:a.path,parent:a});return i.status==="aborted"?O:i.status==="dirty"||e.value==="dirty"?Ya(i.value):i});{if(e.value==="aborted")return O;let o=this._def.schema._parseSync({data:n,path:a.path,parent:a});return o.status==="aborted"?O:o.status==="dirty"||e.value==="dirty"?Ya(o.value):o}}if(r.type==="refinement"){let n=o=>{let i=r.refinement(o,s);if(a.common.async)return Promise.resolve(i);if(i instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(a.common.async===!1){let o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return o.status==="aborted"?O:(o.status==="dirty"&&e.dirty(),n(o.value),{status:e.value,value:o.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>o.status==="aborted"?O:(o.status==="dirty"&&e.dirty(),n(o.value).then(()=>({status:e.value,value:o.value}))))}if(r.type==="transform")if(a.common.async===!1){let n=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Ct(n))return O;let o=r.transform(n.value,s);if(o instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:o}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(n=>Ct(n)?Promise.resolve(r.transform(n.value,s)).then(o=>({status:e.value,value:o})):O);z.assertNever(r)}};Ue.create=(t,e,a)=>new Ue({schema:t,typeName:_.ZodEffects,effect:e,...R(a)}),Ue.createWithPreprocess=(t,e,a)=>new Ue({schema:e,effect:{type:"preprocess",transform:t},typeName:_.ZodEffects,...R(a)});var Ve=class extends ${_parse(t){return this._getType(t)===w.undefined?fe(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Ve.create=(t,e)=>new Ve({innerType:t,typeName:_.ZodOptional,...R(e)});var dt=class extends ${_parse(t){return this._getType(t)===w.null?fe(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};dt.create=(t,e)=>new dt({innerType:t,typeName:_.ZodNullable,...R(e)});var ba=class extends ${_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===w.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};ba.create=(t,e)=>new ba({innerType:t,typeName:_.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...R(e)});var xa=class extends ${_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return ua(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new je(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new je(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};xa.create=(t,e)=>new xa({innerType:t,typeName:_.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...R(e)});var ir=class extends ${_parse(t){if(this._getType(t)!==w.nan){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.nan,received:e.parsedType}),O}return{status:"valid",value:t.data}}};ir.create=t=>new ir({typeName:_.ZodNaN,...R(t)});var Vs=class extends ${_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},Bs=class gi extends ${_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?O:s.status==="dirty"?(a.dirty(),Ya(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?O:s.status==="dirty"?(a.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,a){return new gi({in:e,out:a,typeName:_.ZodPipeline})}},wa=class extends ${_parse(t){let e=this._def.innerType._parse(t),a=r=>(Ct(r)&&(r.value=Object.freeze(r.value)),r);return ua(e)?e.then(r=>a(r)):a(e)}unwrap(){return this._def.innerType}};wa.create=(t,e)=>new wa({innerType:t,typeName:_.ZodReadonly,...R(e)}),Ee.lazycreate;var _;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(_||(_={})),ca.create,Ha.create,ir.create,Ga.create,Qa.create,Xa.create,er.create,pa.create,ma.create,tr.create,Et.create,tt.create,ar.create,Tt.create,Ee.create,Ee.strictCreate,ha.create,hl.create,fa.create,lt.create,fl.create,sr.create,nr.create,gl.create,ga.create,ya.create,va.create,_a.create,$t.create,Ue.create,Ve.create,dt.create,Ue.createWithPreprocess,Bs.create;var Dt=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,o=Array(e);for(let i=0;i<e;i++)o[i]=a[Math.random()*n|0];return o.join("")};if(t==null)return s;if(a.includes(r))throw new Do({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`},yl=Dt();function or(t=globalThis){var e,a,r;return t.window?"runtime/browser":(e=t.navigator)!=null&&e.userAgent?`runtime/${t.navigator.userAgent.toLowerCase()}`:(r=(a=t.process)==null?void 0:a.versions)!=null&&r.node?`runtime/node.js/${t.process.version.substring(0)}`:t.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function ut(t){if(t==null)return{};let e={};if(t instanceof Headers)t.forEach((a,r)=>{e[r.toLowerCase()]=a});else{Array.isArray(t)||(t=Object.entries(t));for(let[a,r]of t)r!=null&&(e[a.toLowerCase()]=r)}return e}function lr(t,...e){let a=new Headers(ut(t)),r=a.get("user-agent")||"";return a.set("user-agent",[r,...e].filter(Boolean).join(" ")),Object.fromEntries(a.entries())}var vl=/"__proto__"\s*:/,_l=/"constructor"\s*:/;function qs(t){let e=JSON.parse(t);return typeof e!="object"||!e||vl.test(t)===!1&&_l.test(t)===!1?e:bl(e)}function bl(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function xl(t){let{stackTraceLimit:e}=Error;try{Error.stackTraceLimit=0}catch{return qs(t)}try{return qs(t)}finally{Error.stackTraceLimit=e}}var ka=Symbol.for("vercel.ai.validator");function wl(t){return{[ka]:!0,validate:t}}function kl(t){return typeof t=="object"&&!!t&&ka in t&&t[ka]===!0&&"validate"in t}function Cl(t){let e;return()=>(e??(e=t()),e)}function El(t){return kl(t)?t:typeof t=="function"?t():Tl(t)}function Tl(t){return wl(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new da({value:e,cause:a.issues})}})}async function Ws({value:t,schema:e}){let a=await dr({value:t,schema:e});if(!a.success)throw da.wrap({value:t,cause:a.error});return a.value}async function dr({value:t,schema:e}){let a=El(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:da.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:da.wrap({value:t,cause:r}),rawValue:t}}}async function Ca({text:t,schema:e}){try{let a=xl(t);return e==null?{success:!0,value:a,rawValue:a}:await dr({value:a,schema:e})}catch(a){return{success:!1,error:Os.isInstance(a)?a:new Os({text:t,cause:a}),rawValue:void 0}}}function Js({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new Vo).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await Ca({text:a,schema:e}))}}))}async function St(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}function Ea(t){if(t.type==="object"){t.additionalProperties=!1;let e=t.properties;if(e!=null)for(let a in e)e[a]=Ea(e[a])}return t.type==="array"&&t.items!=null&&(Array.isArray(t.items)?t.items=t.items.map(e=>Ea(e)):t.items=Ea(t.items)),t}var Il=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},Sl=Symbol("Let zodToJsonSchema decide on which parser to use"),Ks={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Al=t=>typeof t=="string"?{...Ks,name:t}:{...Ks,...t};function ye(){return{}}function Ol(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==_.ZodAny&&(a.items=q(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function Rl(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function Nl(){return{type:"boolean"}}function Ys(t,e){return q(t.type._def,e)}var jl=(t,e)=>q(t.innerType._def,e);function Hs(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>Hs(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Ml(t)}}var Ml=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function Pl(t,e){return{...q(t.innerType._def,e),default:t.defaultValue()}}function Ll(t,e){return e.effectStrategy==="input"?q(t.schema._def,e):ye()}function $l(t){return{type:"string",enum:Array.from(t.values)}}var Dl=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Zl(t,e){let a=[q(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),q(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(Dl(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:o,...i}=s;n=i}r.push(n)}}),r.length?{allOf:r}:void 0}function Fl(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var ur=void 0,Te={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ur===void 0&&(ur=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ur),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Gs(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Ie(a,"email",r.message,e);break;case"format:idn-email":Ie(a,"idn-email",r.message,e);break;case"pattern:zod":me(a,Te.email,r.message,e);break}break;case"url":Ie(a,"uri",r.message,e);break;case"uuid":Ie(a,"uuid",r.message,e);break;case"regex":me(a,r.regex,r.message,e);break;case"cuid":me(a,Te.cuid,r.message,e);break;case"cuid2":me(a,Te.cuid2,r.message,e);break;case"startsWith":me(a,RegExp(`^${cr(r.value,e)}`),r.message,e);break;case"endsWith":me(a,RegExp(`${cr(r.value,e)}$`),r.message,e);break;case"datetime":Ie(a,"date-time",r.message,e);break;case"date":Ie(a,"date",r.message,e);break;case"time":Ie(a,"time",r.message,e);break;case"duration":Ie(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":me(a,RegExp(cr(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&Ie(a,"ipv4",r.message,e),r.version!=="v4"&&Ie(a,"ipv6",r.message,e);break;case"base64url":me(a,Te.base64url,r.message,e);break;case"jwt":me(a,Te.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&me(a,Te.ipv4Cidr,r.message,e),r.version!=="v4"&&me(a,Te.ipv6Cidr,r.message,e);break;case"emoji":me(a,Te.emoji(),r.message,e);break;case"ulid":me(a,Te.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Ie(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":me(a,Te.base64,r.message,e);break}break;case"nanoid":me(a,Te.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function cr(t,e){return e.patternStrategy==="escape"?Ul(t):t}var zl=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Ul(t){let e="";for(let a=0;a<t.length;a++)zl.has(t[a])||(e+="\\"),e+=t[a];return e}function Ie(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function me(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:Qs(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=Qs(e,r)}function Qs(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,o=!1,i=!1;for(let d=0;d<r.length;d++){if(n){s+=r[d],n=!1;continue}if(a.i){if(o){if(r[d].match(/[a-z]/)){i?(s+=r[d],s+=`${r[d-2]}-${r[d]}`.toUpperCase(),i=!1):r[d+1]==="-"&&((l=r[d+2])!=null&&l.match(/[a-z]/))?(s+=r[d],i=!0):s+=`${r[d]}${r[d].toUpperCase()}`;continue}}else if(r[d].match(/[a-z]/)){s+=`[${r[d]}${r[d].toUpperCase()}]`;continue}}if(a.m){if(r[d]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[d]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[d]==="."){s+=o?`${r[d]}\r
`:`[${r[d]}\r
]`;continue}s+=r[d],r[d]==="\\"?n=!0:o&&r[d]==="]"?o=!1:!o&&r[d]==="["&&(o=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function Xs(t,e){var r,s,n,o,i;let a={type:"object",additionalProperties:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===_.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:l,...d}=Gs(t.keyType._def,e);return{...a,propertyNames:d}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===_.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((o=t.keyType)==null?void 0:o._def.typeName)===_.ZodBranded&&t.keyType._def.type._def.typeName===_.ZodString&&((i=t.keyType._def.type._def.checks)!=null&&i.length)){let{type:l,...d}=Ys(t.keyType._def,e);return{...a,propertyNames:d}}}return a}function Vl(t,e){return e.mapStrategy==="record"?Xs(t,e):{type:"array",maxItems:125,items:{type:"array",items:[q(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ye(),q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ye()],minItems:2,maxItems:2}}}function Bl(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function ql(){return{not:ye()}}function Wl(){return{type:"null"}}var pr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Jl(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in pr&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let o=pr[n._def.typeName];return o&&!s.includes(o)?[...s,o]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let o=typeof n._def.value;switch(o){case"string":case"number":case"boolean":return[...s,o];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];default:return s}},[]);if(r.length===a.length){let s=r.filter((n,o,i)=>i.indexOf(n)===o);return{type:s.length>1?s:s[0],enum:a.reduce((n,o)=>n.includes(o._def.value)?n:[...n,o._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return Kl(t,e)}var Kl=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>q(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function Yl(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[pr[t.innerType._def.typeName],"null"]};let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function Hl(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function Gl(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let o in s){let i=s[o];if(i===void 0||i._def===void 0)continue;let l=Xl(i),d=q(i._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(a.properties[o]=d,l||r.push(o))}r.length&&(a.required=r);let n=Ql(t,e);return n!==void 0&&(a.additionalProperties=n),a}function Ql(t,e){if(t.catchall._def.typeName!=="ZodNever")return q(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Xl(t){try{return t.isOptional()}catch{return!0}}var ed=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return q(t.innerType._def,e);let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:ye()},a]}:ye()},td=(t,e)=>{if(e.pipeStrategy==="input")return q(t.in._def,e);if(e.pipeStrategy==="output")return q(t.out._def,e);let a=q(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]});return{allOf:[a,q(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]})].filter(r=>r!==void 0)}};function ad(t,e){return q(t.type._def,e)}function rd(t,e){let a={type:"array",uniqueItems:!0,items:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function sd(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:q(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function nd(){return{not:ye()}}function id(){return ye()}var od=(t,e)=>q(t.innerType._def,e),ld=(t,e,a)=>{switch(e){case _.ZodString:return Gs(t,a);case _.ZodNumber:return Hl(t);case _.ZodObject:return Gl(t,a);case _.ZodBigInt:return Rl(t);case _.ZodBoolean:return Nl();case _.ZodDate:return Hs(t,a);case _.ZodUndefined:return nd();case _.ZodNull:return Wl();case _.ZodArray:return Ol(t,a);case _.ZodUnion:case _.ZodDiscriminatedUnion:return Jl(t,a);case _.ZodIntersection:return Zl(t,a);case _.ZodTuple:return sd(t,a);case _.ZodRecord:return Xs(t,a);case _.ZodLiteral:return Fl(t);case _.ZodEnum:return $l(t);case _.ZodNativeEnum:return Bl(t);case _.ZodNullable:return Yl(t,a);case _.ZodOptional:return ed(t,a);case _.ZodMap:return Vl(t,a);case _.ZodSet:return rd(t,a);case _.ZodLazy:return()=>t.getter()._def;case _.ZodPromise:return ad(t,a);case _.ZodNaN:case _.ZodNever:return ql();case _.ZodEffects:return Ll(t,a);case _.ZodAny:return ye();case _.ZodUnknown:return id();case _.ZodDefault:return Pl(t,a);case _.ZodBranded:return Ys(t,a);case _.ZodReadonly:return od(t,a);case _.ZodCatch:return jl(t,a);case _.ZodPipeline:return td(t,a);case _.ZodFunction:case _.ZodVoid:case _.ZodSymbol:return;default:return(r=>{})(e)}};function q(t,e,a=!1){var i;let r=e.seen.get(t);if(e.override){let l=(i=e.override)==null?void 0:i.call(e,t,e,r,a);if(l!==Sl)return l}if(r&&!a){let l=dd(r,e);if(l!==void 0)return l}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=ld(t,t.typeName,e),o=typeof n=="function"?q(n(),e):n;if(o&&ud(t,e,o),e.postProcess){let l=e.postProcess(o,t,e);return s.jsonSchema=o,l}return s.jsonSchema=o,o}var dd=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:Il(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ye()):e.$refStrategy==="seen"?ye():void 0}},ud=(t,e,a)=>(t.description&&(a.description=t.description),a),cd=t=>{let e=Al(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},pd=(t,e)=>{let a=cd(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[d,u])=>({...l,[d]:q(u._def,{...a,currentPath:[...a.basePath,a.definitionPath,d]},!0)??ye()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=q(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??ye(),o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(n.title=o);let i=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return i.$schema="http://json-schema.org/draft-07/schema#",i};function md(t,e){let a=(e==null?void 0:e.useReferences)??!1;return hr(()=>pd(t,{$refStrategy:a?"root":"none"}),{validate:async r=>{let s=await t.safeParseAsync(r);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function hd(t,e){let a=(e==null?void 0:e.useReferences)??!1;return hr(()=>Ea(ns(t,{target:"draft-7",io:"input",reused:a?"ref":"inline"})),{validate:async r=>{let s=await Ui(t,r);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function fd(t){return"_zod"in t}function en(t,e){return fd(t)?hd(t,e):md(t,e)}var mr=Symbol.for("vercel.ai.schema");function hr(t,{validate:e}={}){return{[mr]:!0,_type:void 0,[ka]:!0,get jsonSchema(){return typeof t=="function"&&(t=t()),t},validate:e}}function gd(t){return typeof t=="object"&&!!t&&mr in t&&t[mr]===!0&&"jsonSchema"in t&&"validate"in t}function yd(t){return t==null?hr({properties:{},additionalProperties:!1}):gd(t)?t:typeof t=="function"?t():en(t)}var{btoa:Tp,atob:Ip}=globalThis,vd=Object.defineProperty,_d=(t,e)=>{for(var a in e)vd(t,a,{get:e[a],enumerable:!0})},tn="AI_NoObjectGeneratedError",an=`vercel.ai.error.${tn}`,bd=Symbol.for(an),rn,sn=class extends Xe{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:tn,message:t,cause:e}),this[rn]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return Xe.hasMarker(t,an)}};rn=bd;var fr="5.0.124",nn=Ce([E(),ra(Uint8Array),ra(ArrayBuffer),as(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),Zt=Vi(()=>Ce([Bi(),E(),ss(),ce(),Nt(E(),Zt),ze(Zt)])),re=Nt(E(),Nt(E(),Zt)),on=H({type:M("text"),text:E(),providerOptions:re.optional()}),xd=H({type:M("image"),image:Ce([nn,ra(URL)]),mediaType:E().optional(),providerOptions:re.optional()}),ln=H({type:M("file"),data:Ce([nn,ra(URL)]),filename:E().optional(),mediaType:E(),providerOptions:re.optional()}),wd=H({type:M("reasoning"),text:E(),providerOptions:re.optional()}),kd=H({type:M("tool-call"),toolCallId:E(),toolName:E(),input:Fe(),providerOptions:re.optional(),providerExecuted:ce().optional()}),Cd=zi("type",[H({type:M("text"),value:E()}),H({type:M("json"),value:Zt}),H({type:M("error-text"),value:E()}),H({type:M("error-json"),value:Zt}),H({type:M("content"),value:ze(Ce([H({type:M("text"),text:E()}),H({type:M("media"),data:E(),mediaType:E()})]))})]),dn=H({type:M("tool-result"),toolCallId:E(),toolName:E(),output:Cd,providerOptions:re.optional()});Ce([H({role:M("system"),content:E(),providerOptions:re.optional()}),H({role:M("user"),content:Ce([E(),ze(Ce([on,xd,ln]))]),providerOptions:re.optional()}),H({role:M("assistant"),content:Ce([E(),ze(Ce([on,ln,wd,kd,dn]))]),providerOptions:re.optional()}),H({role:M("tool"),content:ze(dn),providerOptions:re.optional()})]),Dt({prefix:"aitxt",size:24});function Ed(t,e){let a=new Headers(t??{});for(let[r,s]of Object.entries(e))a.has(r)||a.set(r,s);return a}var Td=class extends TransformStream{constructor(){super({transform(t,e){e.enqueue(`data: ${JSON.stringify(t)}

`)},flush(t){t.enqueue(`data: [DONE]

`)}})}},Id={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function Sd({status:t,statusText:e,headers:a,stream:r,consumeSseStream:s}){let n=r.pipeThrough(new Td);if(s){let[o,i]=n.tee();n=o,s({stream:i})}return new Response(n.pipeThrough(new TextEncoderStream),{status:t,statusText:e,headers:Ed(a,Id)})}var un=Cl(()=>en(Ce([Q({type:M("text-start"),id:E(),providerMetadata:re.optional()}),Q({type:M("text-delta"),id:E(),delta:E(),providerMetadata:re.optional()}),Q({type:M("text-end"),id:E(),providerMetadata:re.optional()}),Q({type:M("error"),errorText:E()}),Q({type:M("tool-input-start"),toolCallId:E(),toolName:E(),providerExecuted:ce().optional(),dynamic:ce().optional()}),Q({type:M("tool-input-delta"),toolCallId:E(),inputTextDelta:E()}),Q({type:M("tool-input-available"),toolCallId:E(),toolName:E(),input:Fe(),providerExecuted:ce().optional(),providerMetadata:re.optional(),dynamic:ce().optional()}),Q({type:M("tool-input-error"),toolCallId:E(),toolName:E(),input:Fe(),providerExecuted:ce().optional(),providerMetadata:re.optional(),dynamic:ce().optional(),errorText:E()}),Q({type:M("tool-output-available"),toolCallId:E(),output:Fe(),providerExecuted:ce().optional(),dynamic:ce().optional(),preliminary:ce().optional()}),Q({type:M("tool-output-error"),toolCallId:E(),errorText:E(),providerExecuted:ce().optional(),dynamic:ce().optional()}),Q({type:M("reasoning-start"),id:E(),providerMetadata:re.optional()}),Q({type:M("reasoning-delta"),id:E(),delta:E(),providerMetadata:re.optional()}),Q({type:M("reasoning-end"),id:E(),providerMetadata:re.optional()}),Q({type:M("source-url"),sourceId:E(),url:E(),title:E().optional(),providerMetadata:re.optional()}),Q({type:M("source-document"),sourceId:E(),mediaType:E(),title:E(),filename:E().optional(),providerMetadata:re.optional()}),Q({type:M("file"),url:E(),mediaType:E(),providerMetadata:re.optional()}),Q({type:as(t=>typeof t=="string"&&t.startsWith("data-"),{message:'Type must start with "data-"'}),id:E().optional(),data:Fe(),transient:ce().optional()}),Q({type:M("start-step")}),Q({type:M("finish-step")}),Q({type:M("start"),messageId:E().optional(),messageMetadata:Fe().optional()}),Q({type:M("finish"),finishReason:aa(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:Fe().optional()}),Q({type:M("abort")}),Q({type:M("message-metadata"),messageMetadata:Fe()})])));function Ad(t){return t.type.startsWith("data-")}function cn(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;let a={...t};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let s=e[r];if(s===void 0)continue;let n=r in t?t[r]:void 0,o=typeof s=="object"&&!!s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),i=typeof n=="object"&&!!n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);o&&i?a[r]=cn(n,s):a[r]=s}return a}function Od(t){let e=["ROOT"],a=-1,r=null;function s(l,d,u){switch(l){case'"':a=d,e.pop(),e.push(u),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=d,r=d,e.pop(),e.push(u),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=d,e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"{":a=d,e.pop(),e.push(u),e.push("INSIDE_OBJECT_START");break;case"[":a=d,e.pop(),e.push(u),e.push("INSIDE_ARRAY_START");break}}function n(l,d){switch(l){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=d,e.pop();break}}function o(l,d){switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=d,e.pop();break}}for(let l=0;l<t.length;l++){let d=t[l];switch(e[e.length-1]){case"ROOT":s(d,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":d==='"'&&(e.pop(),e.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":d==='"'&&(e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":d===":"&&(e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":s(d,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(d,l);break;case"INSIDE_STRING":switch(d){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":d==="]"?(a=l,e.pop()):(a=l,s(d,l,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(d){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(d){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let u=t.substring(r,l+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(d,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l)):a=l;break}}}let i=t.slice(0,a+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let d=t.substring(r,t.length);"true".startsWith(d)?i+="true".slice(d.length):"false".startsWith(d)?i+="false".slice(d.length):"null".startsWith(d)&&(i+="null".slice(d.length))}}return i}async function pn(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await Ca({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await Ca({text:Od(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function Ta(t){return t.type.startsWith("tool-")}function Rd(t){return t.type==="dynamic-tool"}function mn(t){return Ta(t)||Rd(t)}function hn(t){return t.type.split("-").slice(1).join("-")}function Nd({lastMessage:t,messageId:e}){return{message:(t==null?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function jd({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:n,onData:o}){return t.pipeThrough(new TransformStream({async transform(i,l){await r(async({state:d,write:u})=>{function c(p){let h=d.message.parts.filter(Ta).find(v=>v.toolCallId===p);if(h==null)throw Error("tool-output-error must be preceded by a tool-input-available");return h}function f(p){let h=d.message.parts.filter(v=>v.type==="dynamic-tool").find(v=>v.toolCallId===p);if(h==null)throw Error("tool-output-error must be preceded by a tool-input-available");return h}function m(p){let h=d.message.parts.find(C=>Ta(C)&&C.toolCallId===p.toolCallId),v=p,T=h;h==null?d.message.parts.push({type:`tool-${p.toolName}`,toolCallId:p.toolCallId,state:p.state,input:v.input,output:v.output,rawInput:v.rawInput,errorText:v.errorText,providerExecuted:v.providerExecuted,preliminary:v.preliminary,...v.providerMetadata==null?{}:{callProviderMetadata:v.providerMetadata}}):(h.state=p.state,T.input=v.input,T.output=v.output,T.errorText=v.errorText,T.rawInput=v.rawInput,T.preliminary=v.preliminary,T.providerExecuted=v.providerExecuted??h.providerExecuted,v.providerMetadata!=null&&h.state==="input-available"&&(h.callProviderMetadata=v.providerMetadata))}function b(p){let h=d.message.parts.find(C=>C.type==="dynamic-tool"&&C.toolCallId===p.toolCallId),v=p,T=h;h==null?d.message.parts.push({type:"dynamic-tool",toolName:p.toolName,toolCallId:p.toolCallId,state:p.state,input:v.input,output:v.output,errorText:v.errorText,preliminary:v.preliminary,providerExecuted:v.providerExecuted,...v.providerMetadata==null?{}:{callProviderMetadata:v.providerMetadata}}):(h.state=p.state,T.toolName=p.toolName,T.input=v.input,T.output=v.output,T.errorText=v.errorText,T.rawInput=v.rawInput??T.rawInput,T.preliminary=v.preliminary,T.providerExecuted=v.providerExecuted??h.providerExecuted,v.providerMetadata!=null&&h.state==="input-available"&&(h.callProviderMetadata=v.providerMetadata))}async function g(p){if(p!=null){let h=d.message.metadata==null?p:cn(d.message.metadata,p);e!=null&&await Ws({value:h,schema:e}),d.message.metadata=h}}switch(i.type){case"text-start":{let p={type:"text",text:"",providerMetadata:i.providerMetadata,state:"streaming"};d.activeTextParts[i.id]=p,d.message.parts.push(p),u();break}case"text-delta":{let p=d.activeTextParts[i.id];p.text+=i.delta,p.providerMetadata=i.providerMetadata??p.providerMetadata,u();break}case"text-end":{let p=d.activeTextParts[i.id];p.state="done",p.providerMetadata=i.providerMetadata??p.providerMetadata,delete d.activeTextParts[i.id],u();break}case"reasoning-start":{let p={type:"reasoning",text:"",providerMetadata:i.providerMetadata,state:"streaming"};d.activeReasoningParts[i.id]=p,d.message.parts.push(p),u();break}case"reasoning-delta":{let p=d.activeReasoningParts[i.id];p.text+=i.delta,p.providerMetadata=i.providerMetadata??p.providerMetadata,u();break}case"reasoning-end":{let p=d.activeReasoningParts[i.id];p.providerMetadata=i.providerMetadata??p.providerMetadata,p.state="done",delete d.activeReasoningParts[i.id],u();break}case"file":d.message.parts.push({type:"file",mediaType:i.mediaType,url:i.url}),u();break;case"source-url":d.message.parts.push({type:"source-url",sourceId:i.sourceId,url:i.url,title:i.title,providerMetadata:i.providerMetadata}),u();break;case"source-document":d.message.parts.push({type:"source-document",sourceId:i.sourceId,mediaType:i.mediaType,title:i.title,filename:i.filename,providerMetadata:i.providerMetadata}),u();break;case"tool-input-start":{let p=d.message.parts.filter(Ta);d.partialToolCalls[i.toolCallId]={text:"",toolName:i.toolName,index:p.length,dynamic:i.dynamic},i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted}):m({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted}),u();break}case"tool-input-delta":{let p=d.partialToolCalls[i.toolCallId];p.text+=i.inputTextDelta;let{value:h}=await pn(p.text);p.dynamic?b({toolCallId:i.toolCallId,toolName:p.toolName,state:"input-streaming",input:h}):m({toolCallId:i.toolCallId,toolName:p.toolName,state:"input-streaming",input:h}),u();break}case"tool-input-available":i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}):m({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),u(),n&&!i.providerExecuted&&await n({toolCall:i});break;case"tool-input-error":i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}):m({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:void 0,rawInput:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),u();break;case"tool-output-available":if(i.dynamic){let p=f(i.toolCallId);b({toolCallId:i.toolCallId,toolName:p.toolName,state:"output-available",input:p.input,output:i.output,preliminary:i.preliminary})}else{let p=c(i.toolCallId);m({toolCallId:i.toolCallId,toolName:hn(p),state:"output-available",input:p.input,output:i.output,providerExecuted:i.providerExecuted,preliminary:i.preliminary})}u();break;case"tool-output-error":if(i.dynamic){let p=f(i.toolCallId);b({toolCallId:i.toolCallId,toolName:p.toolName,state:"output-error",input:p.input,errorText:i.errorText,providerExecuted:i.providerExecuted})}else{let p=c(i.toolCallId);m({toolCallId:i.toolCallId,toolName:hn(p),state:"output-error",input:p.input,rawInput:p.rawInput,errorText:i.errorText,providerExecuted:i.providerExecuted})}u();break;case"start-step":d.message.parts.push({type:"step-start"});break;case"finish-step":d.activeTextParts={},d.activeReasoningParts={};break;case"start":i.messageId!=null&&(d.message.id=i.messageId),await g(i.messageMetadata),(i.messageId!=null||i.messageMetadata!=null)&&u();break;case"finish":i.finishReason!=null&&(d.finishReason=i.finishReason),await g(i.messageMetadata),i.messageMetadata!=null&&u();break;case"message-metadata":await g(i.messageMetadata),i.messageMetadata!=null&&u();break;case"error":s==null||s(Error(i.errorText));break;default:if(Ad(i)){(a==null?void 0:a[i.type])!=null&&await Ws({value:i.data,schema:a[i.type]});let p=i;if(p.transient){o==null||o(p);break}let h=p.id==null?void 0:d.message.parts.find(v=>p.type===v.type&&p.id===v.id);h==null?d.message.parts.push(p):h.data=p.data,o==null||o(p),u()}}l.enqueue(i)})}}))}async function fn({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:r}=await a.read();if(r)break}}catch(r){e==null||e(r)}finally{a.releaseLock()}}Dt({prefix:"aitxt",size:24}),Dt({prefix:"aiobj",size:24});var Md=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(r){a(r)}}),this.processQueue()})}};Dt({prefix:"aiobj",size:24}),_d({},{object:()=>Ld,text:()=>Pd});var Pd=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),Ld=({schema:t})=>{let e=yd(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await pn(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await Ca({text:a});if(!s.success)throw new sn({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await dr({value:s.value,schema:e});if(!n.success)throw new sn({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}};async function $d({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:r,value:s}=await a.read();if(r)break;await e(s)}}var Dd=()=>fetch;async function Zd({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:n="data",setCompletion:o,setLoading:i,setError:l,setAbortController:d,onFinish:u,onError:c,fetch:f=Dd()}){try{i(!0),l(void 0);let m=new AbortController;d(m),o("");let b=await f(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:lr({"Content-Type":"application/json",...r},`ai-sdk/${fr}`,or()),signal:m.signal}).catch(p=>{throw p});if(!b.ok)throw Error(await b.text()??"Failed to fetch the chat response.");if(!b.body)throw Error("The response body is empty.");let g="";switch(n){case"text":await $d({stream:b.body,onTextPart:p=>{g+=p,o(g)}});break;case"data":await fn({stream:Js({stream:b.body,schema:un}).pipeThrough(new TransformStream({async transform(p){if(!p.success)throw p.error;let h=p.value;if(h.type==="text-delta")g+=h.delta,o(g);else if(h.type==="error")throw Error(h.errorText)}})),onError:p=>{throw p}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return u&&u(e,g),d(null),g}catch(m){if(m.name==="AbortError")return d(null),null;m instanceof Error&&c&&c(m),l(m)}finally{i(!1)}}async function Fd(t){if(t==null)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async e=>{let{name:a,type:r}=e;return{type:"file",mediaType:r,filename:a,url:await new Promise((s,n)=>{let o=new FileReader;o.onload=i=>{var l;s((l=i.target)==null?void 0:l.result)},o.onerror=i=>n(i),o.readAsDataURL(e)})}}))}var zd=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:o}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=o}async sendMessages({abortSignal:t,...e}){var f;let a=await St(this.body),r=await St(this.headers),s=await St(this.credentials),n={...ut(r),...ut(e.headers)},o=await((f=this.prepareSendMessagesRequest)==null?void 0:f.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:n,credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),i=(o==null?void 0:o.api)??this.api,l=(o==null?void 0:o.headers)===void 0?n:ut(o.headers),d=(o==null?void 0:o.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:o.body,u=(o==null?void 0:o.credentials)??s,c=await(this.fetch??globalThis.fetch)(i,{method:"POST",headers:lr({"Content-Type":"application/json",...l},`ai-sdk/${fr}`,or()),body:JSON.stringify(d),credentials:u,signal:t});if(!c.ok)throw Error(await c.text()??"Failed to fetch the chat response.");if(!c.body)throw Error("The response body is empty.");return this.processResponseStream(c.body)}async reconnectToStream(t){var u;let e=await St(this.body),a=await St(this.headers),r=await St(this.credentials),s={...ut(a),...ut(t.headers)},n=await((u=this.prepareReconnectToStreamRequest)==null?void 0:u.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:s,credentials:r,requestMetadata:t.metadata})),o=(n==null?void 0:n.api)??`${this.api}/${t.chatId}/stream`,i=(n==null?void 0:n.headers)===void 0?s:ut(n.headers),l=(n==null?void 0:n.credentials)??r,d=await(this.fetch??globalThis.fetch)(o,{method:"GET",headers:lr(i,`ai-sdk/${fr}`,or()),credentials:l});if(d.status===204)return null;if(!d.ok)throw Error(await d.text()??"Failed to fetch the chat response.");if(!d.body)throw Error("The response body is empty.");return this.processResponseStream(d.body)}},gr=class extends zd{constructor(t={}){super(t)}processResponseStream(t){return Js({stream:t,schema:un}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},Ud=class{constructor({generateId:t=yl,id:e=t(),transport:a=new gr,messageMetadataSchema:r,dataPartSchemas:s,state:n,onError:o,onToolCall:i,onFinish:l,onData:d,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new Md,this.sendMessage=async(c,f)=>{var b;if(c==null){await this.makeRequest({trigger:"submit-message",messageId:(b=this.lastMessage)==null?void 0:b.id,...f});return}let m;if(m="text"in c||"files"in c?{parts:[...Array.isArray(c.files)?c.files:await Fd(c.files),..."text"in c&&c.text!=null?[{type:"text",text:c.text}]:[]]}:c,c.messageId!=null){let g=this.state.messages.findIndex(p=>p.id===c.messageId);if(g===-1)throw Error(`message with id ${c.messageId} not found`);if(this.state.messages[g].role!=="user")throw Error(`message with id ${c.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,g+1),this.state.replaceMessage(g,{...m,id:c.messageId,role:m.role??"user",metadata:c.metadata})}else this.state.pushMessage({...m,id:m.id??this.generateId(),role:m.role??"user",metadata:c.metadata});await this.makeRequest({trigger:"submit-message",messageId:c.messageId,...f})},this.regenerate=async({messageId:c,...f}={})=>{let m=c==null?this.state.messages.length-1:this.state.messages.findIndex(b=>b.id===c);if(m===-1)throw Error(`message ${c} not found`);this.state.messages=this.state.messages.slice(0,this.messages[m].role==="assistant"?m:m+1),await this.makeRequest({trigger:"regenerate-message",messageId:c,...f})},this.resumeStream=async(c={})=>{await this.makeRequest({trigger:"resume-stream",...c})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolOutput=async({state:c="output-available",tool:f,toolCallId:m,output:b,errorText:g})=>this.jobExecutor.run(async()=>{var v,T;let p=this.state.messages,h=p[p.length-1];this.state.replaceMessage(p.length-1,{...h,parts:h.parts.map(C=>mn(C)&&C.toolCallId===m?{...C,state:c,output:b,errorText:g}:C)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(C=>mn(C)&&C.toolCallId===m?{...C,state:c,output:b,errorText:g}:C)),this.status!=="streaming"&&this.status!=="submitted"&&((v=this.sendAutomaticallyWhen)!=null&&v.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(T=this.lastMessage)==null?void 0:T.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var c;this.status!=="streaming"&&this.status!=="submitted"||(c=this.activeResponse)!=null&&c.abortController&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=n,this.onError=o,this.onToolCall=i,this.onFinish=l,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var u,c,f;var n;this.setStatus({status:"submitted",error:void 0});let o=this.lastMessage,i=!1,l=!1,d=!1;try{let m={state:Nd({lastMessage:this.state.snapshot(o),messageId:this.generateId()}),abortController:new AbortController};m.abortController.signal.addEventListener("abort",()=>{i=!0}),this.activeResponse=m;let b;if(t==="resume-stream"){let g=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(g==null){this.setStatus({status:"ready"});return}b=g}else b=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:m.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});await fn({stream:jd({stream:b,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:g=>this.jobExecutor.run(()=>g({state:m.state,write:()=>{var p;this.setStatus({status:"streaming"}),m.state.message.id===((p=this.lastMessage)==null?void 0:p.id)?this.state.replaceMessage(this.state.messages.length-1,m.state.message):this.state.pushMessage(m.state.message)}})),onError:g=>{throw g}}),onError:g=>{throw g}}),this.setStatus({status:"ready"})}catch(m){if(i||m.name==="AbortError")return i=!0,this.setStatus({status:"ready"}),null;d=!0,m instanceof TypeError&&(m.message.toLowerCase().includes("fetch")||m.message.toLowerCase().includes("network"))&&(l=!0),this.onError&&m instanceof Error&&this.onError(m),this.setStatus({status:"error",error:m})}finally{try{(n=this.onFinish)==null||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:i,isDisconnect:l,isError:d,finishReason:(u=this.activeResponse)==null?void 0:u.state.finishReason})}catch(m){console.error(m)}this.activeResponse=void 0}(c=this.sendAutomaticallyWhen)!=null&&c.call(this,{messages:this.state.messages})&&!d&&await this.makeRequest({trigger:"submit-message",messageId:(f=this.lastMessage)==null?void 0:f.id,metadata:e,headers:a,body:r})}},Vd=bi(((t,e)=>{function a(r,s){if(typeof r!="function")throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let n,o=0;return function(...i){clearTimeout(n);let l=Date.now(),d=s-(l-o);d<=0?(o=l,r.apply(this,i)):n=setTimeout(()=>{o=Date.now(),r.apply(this,i)},d)}}e.exports=a})),gn=Object.prototype.hasOwnProperty;function yr(t,e){var a,r;if(t===e)return!0;if(t&&e&&(a=t.constructor)===e.constructor){if(a===Date)return t.getTime()===e.getTime();if(a===RegExp)return t.toString()===e.toString();if(a===Array){if((r=t.length)===e.length)for(;r--&&yr(t[r],e[r]););return r===-1}if(!a||typeof t=="object"){for(a in r=0,t)if(gn.call(t,a)&&++r&&!gn.call(e,a)||!(a in e)||!yr(t[a],e[a]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}var A=Za(ki(),1),Be=new WeakMap,ct=()=>{},pe=void 0,Ia=Object,F=t=>t===pe,Se=t=>typeof t=="function",qe=(t,e)=>({...t,...e}),yn=t=>Se(t.then),vr={},Sa={},_r="undefined",Ft=typeof window!=_r,br=typeof document!=_r,Bd=Ft&&"Deno"in window,qd=()=>Ft&&typeof window.requestAnimationFrame!=_r,vn=(t,e)=>{let a=Be.get(t);return[()=>!F(e)&&t.get(e)||vr,r=>{if(!F(e)){let s=t.get(e);e in Sa||(Sa[e]=s),a[5](e,qe(s,r),s||vr)}},a[6],()=>!F(e)&&e in Sa?Sa[e]:!F(e)&&t.get(e)||vr]},xr=!0,Wd=()=>xr,[wr,kr]=Ft&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[ct,ct],Jd=()=>{let t=br&&document.visibilityState;return F(t)||t!=="hidden"},Kd=t=>(br&&document.addEventListener("visibilitychange",t),wr("focus",t),()=>{br&&document.removeEventListener("visibilitychange",t),kr("focus",t)}),Yd=t=>{let e=()=>{xr=!0,t()},a=()=>{xr=!1};return wr("online",e),wr("offline",a),()=>{kr("online",e),kr("offline",a)}},Hd={isOnline:Wd,isVisible:Jd},Gd={initFocus:Kd,initReconnect:Yd},_n=!A.useId,zt=!Ft||Bd,Qd=t=>qd()?window.requestAnimationFrame(t):setTimeout(t,1),Aa=zt?A.useEffect:A.useLayoutEffect,Cr=typeof navigator<"u"&&navigator.connection,bn=!zt&&Cr&&(["slow-2g","2g"].includes(Cr.effectiveType)||Cr.saveData),Oa=new WeakMap,Xd=t=>Ia.prototype.toString.call(t),Er=(t,e)=>t===`[object ${e}]`,eu=0,Tr=t=>{let e=typeof t,a=Xd(t),r=Er(a,"Date"),s=Er(a,"RegExp"),n=Er(a,"Object"),o,i;if(Ia(t)===t&&!r&&!s){if(o=Oa.get(t),o)return o;if(o=++eu+"~",Oa.set(t,o),Array.isArray(t)){for(o="@",i=0;i<t.length;i++)o+=Tr(t[i])+",";Oa.set(t,o)}if(n){o="#";let l=Ia.keys(t).sort();for(;!F(i=l.pop());)F(t[i])||(o+=i+":"+Tr(t[i])+",");Oa.set(t,o)}}else o=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return o},Ir=t=>{if(Se(t))try{t=t()}catch{t=""}let e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?Tr(t):"",[t,e]},tu=0,Sr=()=>++tu;async function xn(...t){let[e,a,r,s]=t,n=qe({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{}),o=n.populateCache,i=n.rollbackOnError,l=n.optimisticData,d=f=>typeof i=="function"?i(f):i!==!1,u=n.throwOnError;if(Se(a)){let f=a,m=[],b=e.keys();for(let g of b)!/^\$(inf|sub)\$/.test(g)&&f(e.get(g)._k)&&m.push(g);return Promise.all(m.map(c))}return c(a);async function c(f){let[m]=Ir(f);if(!m)return;let[b,g]=vn(e,m),[p,h,v,T]=Be.get(e),C=()=>{let ae=p[m];return(Se(n.revalidate)?n.revalidate(b().data,f):n.revalidate!==!1)&&(delete v[m],delete T[m],ae&&ae[0])?ae[0](2).then(()=>b().data):b().data};if(t.length<3)return C();let S=r,P,D=!1,N=Sr();h[m]=[N,0];let K=!F(l),j=b(),W=j.data,X=j._c,te=F(X)?W:X;if(K&&(l=Se(l)?l(te,W):l,g({data:l,_c:te})),Se(S))try{S=S(te)}catch(ae){P=ae,D=!0}if(S&&yn(S))if(S=await S.catch(ae=>{P=ae,D=!0}),N!==h[m][0]){if(D)throw P;return S}else D&&K&&d(P)&&(o=!0,g({data:te,_c:pe}));if(o&&(D||(Se(o)?g({data:o(S,te),error:pe,_c:pe}):g({data:S,error:pe,_c:pe}))),h[m][1]=Sr(),Promise.resolve(C()).then(()=>{g({_c:pe})}),D){if(u)throw P;return}return S}}var wn=(t,e)=>{for(let a in t)t[a][0]&&t[a][0](e)},kn=(t,e)=>{if(!Be.has(t)){let a=qe(Gd,e),r=Object.create(null),s=xn.bind(pe,t),n=ct,o=Object.create(null),i=(u,c)=>{let f=o[u]||[];return o[u]=f,f.push(c),()=>f.splice(f.indexOf(c),1)},l=(u,c,f)=>{t.set(u,c);let m=o[u];if(m)for(let b of m)b(c,f)},d=()=>{if(!Be.has(t)&&(Be.set(t,[r,Object.create(null),Object.create(null),Object.create(null),s,l,i]),!zt)){let u=a.initFocus(setTimeout.bind(pe,wn.bind(pe,r,0))),c=a.initReconnect(setTimeout.bind(pe,wn.bind(pe,r,1)));n=()=>{u&&u(),c&&c(),Be.delete(t)}}};return d(),[t,s,d,n]}return[t,Be.get(t)[4]]},au=(t,e,a,r,s)=>{let n=a.errorRetryCount,o=s.retryCount,i=~~((Math.random()+.5)*(1<<(o<8?o:8)))*a.errorRetryInterval;!F(n)&&o>n||setTimeout(r,i,s)},ru=yr,[Ar,su]=kn(new Map),Cn=qe({onLoadingSlow:ct,onSuccess:ct,onError:ct,onErrorRetry:au,onDiscarded:ct,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:bn?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:bn?5e3:3e3,compare:ru,isPaused:()=>!1,cache:Ar,mutate:su,fallback:{}},Hd),En=(t,e)=>{let a=qe(t,e);if(e){let{use:r,fallback:s}=t,{use:n,fallback:o}=e;r&&n&&(a.use=r.concat(n)),s&&o&&(a.fallback=qe(s,o))}return a},Or=(0,A.createContext)({}),nu=t=>{let{value:e}=t,a=(0,A.useContext)(Or),r=Se(e),s=(0,A.useMemo)(()=>r?e(a):e,[r,a,e]),n=(0,A.useMemo)(()=>r?s:En(a,s),[r,a,s]),o=s&&s.provider,i=(0,A.useRef)(pe);o&&!i.current&&(i.current=kn(o(n.cache||Ar),s));let l=i.current;return l&&(n.cache=l[0],n.mutate=l[1]),Aa(()=>{if(l)return l[2]&&l[2](),l[3]},[]),(0,A.createElement)(Or.Provider,qe(t,{value:n}))},Tn=Ft&&window.__SWR_DEVTOOLS_USE__,iu=Tn?window.__SWR_DEVTOOLS_USE__:[],ou=()=>{Tn&&(window.__SWR_DEVTOOLS_REACT__=A.default)},lu=t=>Se(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],du=()=>qe(Cn,(0,A.useContext)(Or)),uu=iu.concat(t=>(e,a,r)=>t(e,a&&((...s)=>{let[n]=Ir(e),[,,,o]=Be.get(Ar);if(n.startsWith("$inf$"))return a(...s);let i=o[n];return F(i)?a(...s):(delete o[n],i)}),r)),cu=t=>function(...e){let a=du(),[r,s,n]=lu(e),o=En(a,n),i=t,{use:l}=o,d=(l||[]).concat(uu);for(let u=d.length;u--;)i=d[u](i);return i(r,s||o.fetcher||null,o)},pu=(t,e,a)=>{let r=e[t]||(e[t]=[]);return r.push(a),()=>{let s=r.indexOf(a);s>=0&&(r[s]=r[r.length-1],r.pop())}};ou();var mu=Eo(),Rr=A.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),Nr={dedupe:!0},hu=(t,e,a)=>{let{cache:r,compare:s,suspense:n,fallbackData:o,revalidateOnMount:i,revalidateIfStale:l,refreshInterval:d,refreshWhenHidden:u,refreshWhenOffline:c,keepPreviousData:f}=a,[m,b,g,p]=Be.get(r),[h,v]=Ir(t),T=(0,A.useRef)(!1),C=(0,A.useRef)(!1),S=(0,A.useRef)(h),P=(0,A.useRef)(e),D=(0,A.useRef)(a),N=()=>D.current,K=()=>N().isVisible()&&N().isOnline(),[j,W,X,te]=vn(r,h),ae=(0,A.useRef)({}).current,G=F(o)?F(a.fallback)?pe:a.fallback[h]:o,Z=(U,V)=>{for(let Y in ae){let B=Y;if(B==="data"){if(!s(U[B],V[B])&&(!F(U[B])||!s(De,V[B])))return!1}else if(V[B]!==U[B])return!1}return!0},oe=(0,A.useMemo)(()=>{let U=!h||!e?!1:F(i)?N().isPaused()||n?!1:l!==!1:i,V=se=>{let _e=qe(se);return delete _e._k,U?{isValidating:!0,isLoading:!0,..._e}:_e},Y=j(),B=te(),ke=V(Y),ve=Y===B?ke:V(B),le=ke;return[()=>{let se=V(j());return Z(se,le)?(le.data=se.data,le.isLoading=se.isLoading,le.isValidating=se.isValidating,le.error=se.error,le):(le=se,se)},()=>ve]},[r,h]),ee=(0,mu.useSyncExternalStore)((0,A.useCallback)(U=>X(h,(V,Y)=>{Z(Y,V)||U()}),[r,h]),oe[0],oe[1]),Le=!T.current,Oe=m[h]&&m[h].length>0,we=ee.data,he=F(we)?G&&yn(G)?Rr(G):G:we,$e=ee.error,mt=(0,A.useRef)(he),De=f?F(we)?F(mt.current)?he:mt.current:we:he,Rt=Oe&&!F($e)?!1:Le&&!F(i)?i:N().isPaused()?!1:n?F(he)?!1:l:F(he)||l,ht=!!(h&&e&&Le&&Rt),ft=F(ee.isValidating)?ht:ee.isValidating,Je=F(ee.isLoading)?ht:ee.isLoading,Re=(0,A.useCallback)(async U=>{let V=P.current;if(!h||!V||C.current||N().isPaused())return!1;let Y,B,ke=!0,ve=U||{},le=!g[h]||!ve.dedupe,se=()=>_n?!C.current&&h===S.current&&T.current:h===S.current,_e={isValidating:!1,isLoading:!1},it=()=>{W(_e)},Ze=()=>{let ne=g[h];ne&&ne[1]===B&&delete g[h]},ot={isValidating:!0};F(j().data)&&(ot.isLoading=!0);try{if(le&&(W(ot),a.loadingTimeout&&F(j().data)&&setTimeout(()=>{ke&&se()&&N().onLoadingSlow(h,a)},a.loadingTimeout),g[h]=[V(v),Sr()]),[Y,B]=g[h],Y=await Y,le&&setTimeout(Ze,a.dedupingInterval),!g[h]||g[h][1]!==B)return le&&se()&&N().onDiscarded(h),!1;_e.error=pe;let ne=b[h];if(!F(ne)&&(B<=ne[0]||B<=ne[1]||ne[1]===0))return it(),le&&se()&&N().onDiscarded(h),!1;let ue=j().data;_e.data=s(ue,Y)?ue:Y,le&&se()&&N().onSuccess(Y,h,a)}catch(ne){Ze();let ue=N(),{shouldRetryOnError:Ke}=ue;ue.isPaused()||(_e.error=ne,le&&se()&&(ue.onError(ne,h,ue),(Ke===!0||Se(Ke)&&Ke(ne))&&(!N().revalidateOnFocus||!N().revalidateOnReconnect||K())&&ue.onErrorRetry(ne,h,ue,Ye=>{let He=m[h];He&&He[0]&&He[0](3,Ye)},{retryCount:(ve.retryCount||0)+1,dedupe:!0})))}return ke=!1,it(),!0},[h,r]),nt=(0,A.useCallback)((...U)=>xn(r,S.current,...U),[]);if(Aa(()=>{P.current=e,D.current=a,F(we)||(mt.current=we)}),Aa(()=>{if(!h)return;let U=Re.bind(pe,Nr),V=0;N().revalidateOnFocus&&(V=Date.now()+N().focusThrottleInterval);let Y=pu(h,m,(B,ke={})=>{if(B==0){let ve=Date.now();N().revalidateOnFocus&&ve>V&&K()&&(V=ve+N().focusThrottleInterval,U())}else if(B==1)N().revalidateOnReconnect&&K()&&U();else{if(B==2)return Re();if(B==3)return Re(ke)}});return C.current=!1,S.current=h,T.current=!0,W({_k:v}),Rt&&(g[h]||(F(he)||zt?U():Qd(U))),()=>{C.current=!0,Y()}},[h]),Aa(()=>{let U;function V(){let B=Se(d)?d(j().data):d;B&&U!==-1&&(U=setTimeout(Y,B))}function Y(){!j().error&&(u||N().isVisible())&&(c||N().isOnline())?Re(Nr).then(V):V()}return V(),()=>{U&&(U=(clearTimeout(U),-1))}},[d,u,c,h]),(0,A.useDebugValue)(De),n&&F(he)&&h){if(!_n&&zt)throw Error("Fallback data is required when using Suspense in SSR.");P.current=e,D.current=a,C.current=!1;let U=p[h];if(F(U)||Rr(nt(U)),F($e)){let V=Re(Nr);F(De)||(V.status="fulfilled",V.value=!0),Rr(V)}else throw $e}return{mutate:nt,get data(){return ae.data=!0,De},get error(){return ae.error=!0,$e},get isValidating(){return ae.isValidating=!0,ft},get isLoading(){return ae.isLoading=!0,Je}}};Ia.defineProperty(nu,"defaultValue",{value:Cn});var In=cu(hu),fu=Za(Vd(),1),Sn=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},J=(t,e,a)=>(Sn(t,e,"read from private field"),a?a.call(t):e.get(t)),Pe=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},rt=(t,e,a,r)=>(Sn(t,e,"write to private field"),r?r.call(t,a):e.set(t,a),a);function An(t,e){return e==null?t:(0,fu.default)(t,e)}var be,Ra,Na,Ut,Vt,Bt,At,jr,Mr,gu=class{constructor(t=[]){Pe(this,be,void 0),Pe(this,Ra,"ready"),Pe(this,Na,void 0),Pe(this,Ut,new Set),Pe(this,Vt,new Set),Pe(this,Bt,new Set),this.pushMessage=e=>{rt(this,be,J(this,be).concat(e)),J(this,At).call(this)},this.popMessage=()=>{rt(this,be,J(this,be).slice(0,-1)),J(this,At).call(this)},this.replaceMessage=(e,a)=>{rt(this,be,[...J(this,be).slice(0,e),this.snapshot(a),...J(this,be).slice(e+1)]),J(this,At).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,a)=>{let r=a?An(e,a):e;return J(this,Ut).add(r),()=>{J(this,Ut).delete(r)}},this["~registerStatusCallback"]=e=>(J(this,Vt).add(e),()=>{J(this,Vt).delete(e)}),this["~registerErrorCallback"]=e=>(J(this,Bt).add(e),()=>{J(this,Bt).delete(e)}),Pe(this,At,()=>{J(this,Ut).forEach(e=>e())}),Pe(this,jr,()=>{J(this,Vt).forEach(e=>e())}),Pe(this,Mr,()=>{J(this,Bt).forEach(e=>e())}),rt(this,be,t)}get status(){return J(this,Ra)}set status(t){rt(this,Ra,t),J(this,jr).call(this)}get error(){return J(this,Na)}set error(t){rt(this,Na,t),J(this,Mr).call(this)}get messages(){return J(this,be)}set messages(t){rt(this,be,[...t]),J(this,At).call(this)}};be=new WeakMap,Ra=new WeakMap,Na=new WeakMap,Ut=new WeakMap,Vt=new WeakMap,Bt=new WeakMap,At=new WeakMap,jr=new WeakMap,Mr=new WeakMap;var Ot,On=class extends Ud{constructor({messages:t,...e}){let a=new gu(t);super({...e,state:a}),Pe(this,Ot,void 0),this["~registerMessagesCallback"]=(r,s)=>J(this,Ot)["~registerMessagesCallback"](r,s),this["~registerStatusCallback"]=r=>J(this,Ot)["~registerStatusCallback"](r),this["~registerErrorCallback"]=r=>J(this,Ot)["~registerErrorCallback"](r),rt(this,Ot,a)}};Ot=new WeakMap;function Rn({experimental_throttle:t,resume:e=!1,...a}={}){let r=(0,A.useRef)("chat"in a?a.chat:new On(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new On(a));let s=(0,A.useSyncExternalStore)((0,A.useCallback)(l=>r.current["~registerMessagesCallback"](l,t),[t,r.current.id]),()=>r.current.messages,()=>r.current.messages),n=(0,A.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),o=(0,A.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),i=(0,A.useCallback)(l=>{typeof l=="function"&&(l=l(r.current.messages)),r.current.messages=l},[r]);return(0,A.useEffect)(()=>{e&&r.current.resumeStream()},[e,r]),{id:r.current.id,messages:s,setMessages:i,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:o,resumeStream:r.current.resumeStream,status:n,addToolResult:r.current.addToolOutput,addToolOutput:r.current.addToolOutput}}function yu({api:t="/api/completion",id:e,initialCompletion:a="",initialInput:r="",credentials:s,headers:n,body:o,streamProtocol:i="data",fetch:l,onFinish:d,onError:u,experimental_throttle:c}={}){let f=(0,A.useId)(),m=e||f,{data:b,mutate:g}=In([t,m],null,{fallbackData:a}),{data:p=!1,mutate:h}=In([m,"loading"],null),[v,T]=(0,A.useState)(void 0),C=b,[S,P]=(0,A.useState)(null),D=(0,A.useRef)({credentials:s,headers:n,body:o});(0,A.useEffect)(()=>{D.current={credentials:s,headers:n,body:o}},[s,n,o]);let N=(0,A.useCallback)(async(G,Z)=>Zd({api:t,prompt:G,credentials:D.current.credentials,headers:{...D.current.headers,...Z==null?void 0:Z.headers},body:{...D.current.body,...Z==null?void 0:Z.body},streamProtocol:i,fetch:l,setCompletion:An(oe=>g(oe,!1),c),setLoading:h,setError:T,setAbortController:P,onFinish:d,onError:u}),[g,h,t,D,P,d,u,T,i,l,c]),K=(0,A.useCallback)(()=>{S&&(S.abort(),P(null))},[S]),j=(0,A.useCallback)(G=>{g(G,!1)},[g]),W=(0,A.useCallback)(async(G,Z)=>N(G,Z),[N]),[X,te]=(0,A.useState)(r),ae=(0,A.useCallback)(G=>{var Z;return(Z=G==null?void 0:G.preventDefault)==null||Z.call(G),X?W(X):void 0},[X,W]);return{completion:C,complete:W,error:v,setCompletion:j,stop:K,input:X,setInput:te,handleInputChange:(0,A.useCallback)(G=>{te(G.target.value)},[te]),handleSubmit:ae,isLoading:p}}var xe=class extends Error{constructor(t,e="TOOL_ERROR",a=!1,r,s){super(t),this.name="ToolExecutionError",this.code=e,this.isRetryable=a,this.suggestedFix=r,this.meta=s}toStructuredString(){let t=JSON.stringify({message:this.message,code:this.code,is_retryable:this.isRetryable,...this.suggestedFix&&{suggested_fix:this.suggestedFix},...this.meta&&{meta:this.meta}});return`Error invoking tool ${this.name}: ${t}`}};const Nn=H({status:aa(["success","error","warning"]).optional(),auth_required:ce().optional(),next_steps:ze(E()).optional(),action_url:E().optional(),message:E().optional(),meta:Nt(E(),Fe()).optional()});function vu(t,e){return t?!!(["image/","video/","audio/","application/pdf"].some(a=>t.startsWith(a))||["svg","vega"].some(a=>t.includes(a))||t==="text/html"&&["<img","<video","<audio","<iframe","<canvas","<svg","<marimo-ui-element"].some(a=>e.includes(a))):!1}var _u=class extends Pt{constructor(e){super();L(this,"title","Cell Outputs");L(this,"mentionPrefix","@");L(this,"contextType","cell-output");this.store=e}getItems(){let e=this.store.get(Ge),a=[];for(let r of e.cellIds.inOrderIds){let s=Mn(r,e),n=s.cellOutput;if(!n)continue;let o=n.output.mimetype||"unknown";a.push({uri:this.asURI(r),name:s.cellName,type:this.contextType,description:`Cell output (${o})`,data:{...s,cellOutput:n}})}return a}formatCompletion(e){let{cellOutput:a,cellName:r,cellCode:s}=e.data;return{label:`@${r}`,displayLabel:r,detail:`${a.outputType} output`,boost:a.outputType==="media"?kt.HIGH:kt.MEDIUM,type:this.contextType,section:wt.CELL_OUTPUT,apply:`@${r}`,info:()=>{let n=document.createElement("div");n.classList.add("mo-cm-tooltip","docs-documentation","min-w-[300px]","max-w-[500px]","flex","flex-col","gap-2");let o=document.createElement("div");o.classList.add("flex","flex-col","gap-1");let i=document.createElement("div");i.classList.add("font-bold","text-base"),i.textContent=r,o.append(i);let l=document.createElement("div");if(l.classList.add("text-sm","text-muted-foreground"),o.append(l),n.append(o),s){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground"),d.textContent="Code:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","font-mono","bg-muted","p-2","rounded","max-h-20","overflow-y-auto"),u.textContent=s.slice(0,200)+(s.length>200?"...":""),n.append(u)}if(a.processedContent){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground","mt-2"),d.textContent="Output Preview:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","bg-muted","p-2","rounded","max-h-24","overflow-y-auto","mb-2"),u.textContent=a.processedContent.slice(0,300)+(a.processedContent.length>300?"...":""),n.append(u)}if(a.outputType==="media"){let d=document.createElement("div");d.classList.add("text-xs","text-muted-foreground","italic","mb-2"),d.textContent="A screenshot of the output will be attached",n.append(d)}return n}}}formatContext(e){let{cellOutput:a,cellName:r,cellId:s,cellCode:n}=e.data,o={name:r,cellId:s,outputType:a.outputType,mimetype:a.output.mimetype},i=`Cell Code:
${n}

`;return a.outputType==="text"&&a.processedContent?i+=`Output:
${a.processedContent}`:a.outputType==="media"&&(i+=`Media Output: Contains ${a.output.mimetype} content`,a.imageUrl&&(i+=`
Image URL: ${a.imageUrl}`)),Mt({type:this.contextType,data:o,details:i})}async getAttachments(e){let a=e[0].data.cellId,r=e[0].data.cellName;return bu(e.map(s=>s.data.cellOutput),a,r)}};async function bu(t,e,a){let r=t.filter(n=>n.shouldDownloadImage&&n.outputType==="media");if(r.length===0)return[];let s=r.flatMap(n=>{let o=document.getElementById(Di.create(e));return o?{cellId:e,cellName:a,mimetype:n.output.mimetype,element:o}:(ie.warn(`Output element not found for cell ${e}`),[])});try{return await Promise.all(s.map(async n=>({type:"file",filename:`${a}-output-screenshot`,mediaType:"image/png",url:await Oo(n.element)})))}catch(n){return ie.error("Error downloading cell output images:",n),[]}}function jn(t){if(cs(t))return null;let e=t.mimetype,a=vu(e,String(t.data))?"media":"text",r=Ro(t),s,n=!1;return a==="media"&&(typeof t.data=="string"&&t.data.startsWith("data:")||typeof t.data=="string"&&t.data.startsWith("http")?s=t.data:n=!0),{processedContent:r,imageUrl:s,shouldDownloadImage:n,outputType:a,output:t}}function Mn(t,e,a){let{includeConsoleOutput:r=!1}=a||{},s=e.cellRuntime[t],n=e.cellData[t],o=e.cellIds.inOrderIds.indexOf(t),i=Zi(n.name,o),l;r&&(l=s.consoleOutputs.map(c=>jn(c)).filter(c=>c!==null));let d,u=s.output;return u&&!cs(u)&&(d=jn(u)??void 0),{cellId:t,cellName:i,cellCode:n.code,cellOutput:d,consoleOutputs:l}}function xu(t){return t.type==="setup-refs"?"The setup cell cannot have references":t.type==="cycle"?"This cell is in a cycle":t.type==="multiple-defs"?`The variable '${t.name}' was defined by another cell`:t.type==="import-star"||t.type==="ancestor-stopped"||t.type==="ancestor-prevented"||t.type==="exception"||t.type==="strict-exception"?t.msg:t.type==="interruption"?"This cell was interrupted and needs to be re-run":t.type==="syntax"||t.type==="unknown"||t.type==="sql-error"?t.msg:t.type==="internal"?t.msg||"An internal error occurred":(is(t),"Unknown error")}var Pn=new Ei("error","errors"),wu=class extends Pt{constructor(e){super();L(this,"title","Errors");L(this,"mentionPrefix","@");L(this,"contextType","error");this.store=e}getItems(){let e=this.store.get(Li);return e.length===0?[]:[{uri:this.asURI("all"),name:"Errors",type:this.contextType,data:{type:"all-errors",errors:e.map(a=>({cellId:a.cellId,cellName:a.cellName,errorData:a.output.data}))},description:"All errors in the notebook"}]}formatCompletion(e){return e.data.type==="all-errors"?{label:"@Errors",displayLabel:"Errors",detail:`${e.data.errors.length} ${Pn.pluralize(e.data.errors.length)}`,type:"error",apply:"@Errors",section:wt.ERROR,info:()=>{let a=document.createElement("div");a.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let r=document.createElement("div");r.classList.add("flex","flex-col","gap-1");let s=document.createElement("div");s.classList.add("font-bold","text-base"),s.textContent="Errors",r.append(s);let n=document.createElement("div");return n.classList.add("text-sm","text-muted-foreground"),n.textContent=`${e.data.errors.length} ${Pn.pluralize(e.data.errors.length)}`,r.append(n),a.append(r),a}}:{label:"Error",displayLabel:"Error",section:wt.ERROR}}formatContext(e){let{data:a}=e;return a.errors.map(r=>Mt({type:this.contextType,data:{name:r.cellName||`Cell ${r.cellId}`,description:r.errorData.map(s=>xu(s)).join(`
`)}})).join(`

`)}};const Ln=Ti();var ku={maxDepth:3,maxResults:20,defaultResultsLimit:5,includeDirectories:!1},Cu=class extends Pt{constructor(e,a=ku){super();L(this,"title","Files");L(this,"mentionPrefix","#");L(this,"contextType","file");L(this,"searchFiles",async(e,a={})=>{let{maxDepth:r,maxResults:s,includeDirectories:n}={...this.config,...a};return(await this.apiRequests.sendSearchFiles({query:e,includeFiles:!0,includeDirectories:n,depth:r,limit:s})).files});this.apiRequests=e,this.config=a}createCompletionSource(){return async e=>{let a=e.matchBefore(/#[^\s#]*/);if(!a)return null;let r=a.text;if(!r.startsWith("#"))return null;let s=r.slice(1);if(s.length===0)return this.getDefaultCompletions(a);try{let n=(await this.searchFiles(s)||[]).map(o=>{let i={uri:this.asURI(o.path),name:o.name,type:this.contextType,description:o.isDirectory?"Directory":"File",data:{path:o.path,isDirectory:o.isDirectory}};return this.formatCompletion(i)});return{from:a.from,options:n}}catch(n){return ie.error("Failed to search files:",n),null}}}async getDefaultCompletions(e){try{for(let a of["py","md","csv"])try{let r=await this.searchFiles(a,{maxDepth:1,maxResults:5});if(r&&r.length>0){let s=r.map(n=>{let o={uri:this.asURI(n.path),name:n.name,type:this.contextType,description:n.isDirectory?"Directory":"File",data:{path:n.path,isDirectory:n.isDirectory}};return this.formatCompletion(o)});return{from:e.from,options:s}}}catch(r){ie.error("Failed to get default file completions:",r)}return{from:e.from,options:[]}}catch(a){return ie.error("Failed to get default file completions:",a),null}}getItems(){return[]}formatCompletion(e){let{data:a,name:r}=e,s=a.isDirectory?"\u{1F4C1}":"\u{1F4C4}";return{...this.createBasicCompletion(e),type:"file",section:wt.FILE,boost:a.isDirectory?kt.MEDIUM:kt.LOW,detail:a.path,displayLabel:`${s} ${r}`,apply:async(n,o,i,l)=>{var m;let d=(m=n.state.facet(Ln))==null?void 0:m.addAttachment;if(!d){ie.warn("No addAttachment callback provided");return}let u=await this.apiRequests.sendFileDetails({path:a.path}).catch(b=>(Va({title:"Failed to get file details",description:b.message}),null));if(!u)return;let c=u.mimeType||"text/plain",f;if(c.startsWith("text/")||c.includes("json")||c.includes("xml"))f=new Blob([u.contents||""],{type:c});else if(u.contents)try{f=Io(co(u.contents,c))}catch{f=new Blob([u.contents],{type:c})}else f=new Blob([""],{type:c});d(new File([f],r,{type:c})),n.dispatch({changes:{from:i,to:l,insert:""}}),no(n)},info:()=>{let n=document.createElement("div");n.classList.add("flex","flex-col","gap-1","p-2");let o=document.createElement("div");o.classList.add("font-bold"),o.textContent=r,n.append(o);let i=document.createElement("div");return i.classList.add("text-xs","text-muted-foreground"),i.textContent=a.path,n.append(i),n}}}formatContext(e){let{data:a,name:r}=e;return Mt({type:this.contextType,data:{name:r,path:a.path,isDirectory:a.isDirectory},details:a.isDirectory?"Directory containing files and subdirectories":"File"})}},Eu=class extends Pt{constructor(e){super();L(this,"title","Tables");L(this,"mentionPrefix","@");L(this,"contextType","data");this.tablesMap=e}getItems(){return[...this.tablesMap.entries()].map(([e,a])=>({uri:this.asURI(e),name:e,type:this.contextType,description:a.source==="memory"?"in-memory":a.source,data:a}))}formatContext(e){let{data:a}=e,{columns:r,source:s,num_rows:n,num_columns:o,name:i,variable_name:l}=a,d=[n==null?void 0:`${n} rows`,o==null?void 0:`${o} columns`].filter(Boolean).join(", "),u="";if(d&&(u+=`Shape: ${d}
`),l&&(u+=`Variable: ${l}
`),r&&r.length>0){u+=`Columns:
`;for(let c of r){let f=`  ${c.name} (${c.type})`;if(c.sample_values&&c.sample_values.length>0){let m=c.sample_values.slice(0,3).map(b=>b===null?"null":String(b)).join(", ");f+=` - samples: [${m}]`}u+=`${f}
`}}return Mt({type:this.contextType,data:{name:i,source:s??"unknown"},details:u.trim()})}formatCompletion(e){let a=e.data.name,r=e.data;return{label:`@${a}`,displayLabel:a,detail:r.source==="memory"?"in-memory":r.source,boost:r.source_type==="local"?kt.LOCAL_TABLE:kt.REMOTE_TABLE,type:es(r),apply:`@${a}`,section:{name:es(r)==="dataframe"?"Dataframe":"Table",rank:wt.TABLE.rank},info:()=>this.createTableInfoElement(a,r)}}createTableInfoElement(e,a){let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");if(n.classList.add("font-bold","text-base"),n.textContent=e,s.append(n),a.source){let i=document.createElement("div");i.classList.add("text-xs","text-muted-foreground"),i.textContent=`Source: ${a.source}`,s.append(i)}r.append(s);let o=[a.num_rows==null?void 0:`${a.num_rows} rows`,a.num_columns==null?void 0:`${a.num_columns} columns`].filter(Boolean).join(", ");if(o){let i=document.createElement("div");i.classList.add("text-xs","bg-muted","px-2","py-1","rounded"),i.textContent=o,r.append(i)}if(a.columns&&a.columns.length>0){let i=document.createElement("div");i.classList.add("overflow-auto","max-h-60");let l=document.createElement("table");l.classList.add("w-full","text-xs","border-collapse");let d=l.insertRow();d.classList.add("bg-muted");let u=d.insertCell();u.classList.add("p-2","font-medium","text-left"),u.textContent="Column";let c=d.insertCell();c.classList.add("p-2","font-medium","text-left"),c.textContent="Type";let f=a.columns.some(b=>this.getItemMetadata(a,b)!==void 0),m;f&&(m=d.insertCell(),m.classList.add("p-2","font-medium","text-left"),m.textContent="Metadata"),a.columns.forEach((b,g)=>{let p=l.insertRow();p.classList.add(g%2==0?"bg-background":"bg-muted/30");let h=p.insertCell();h.classList.add("p-2","font-mono"),h.textContent=b.name;let v=p.insertCell();if(v.classList.add("p-2","text-muted-foreground"),v.textContent=b.type,f){let T=p.insertCell();T.classList.add("p-2");let C=this.getItemMetadata(a,b);C&&T.append(C)}}),i.append(l),r.append(i)}return r}getItemMetadata(e,a){var n,o;let r=(n=e.primary_keys)==null?void 0:n.includes(a.name),s=(o=e.indexes)==null?void 0:o.includes(a.name);if(r||s){let i=document.createElement("span");i.textContent=r?"PK":"IDX";let l=r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";return i.classList.add("text-xs","px-1.5","py-0.5","rounded-full","font-medium",...l.split(" ")),i}}},Tu=class extends Pt{constructor(e,a){super();L(this,"title","Variables");L(this,"mentionPrefix","@");L(this,"contextType","variable");this.variables=e,this.tablesMap=a}getItems(){let e=new Set(this.tablesMap.keys());return Object.entries(this.variables).flatMap(([a,r])=>e.has(a)?[]:[{uri:this.asURI(a),name:a,type:this.contextType,description:r.dataType??"",dataType:r.dataType,data:{variable:r}}])}formatCompletion(e){let{data:a}=e,{variable:r}=a;return{label:`@${r.name}`,displayLabel:r.name,detail:r.dataType??"",type:this.contextType,section:wt.VARIABLE,info:()=>Si(r)}}formatContext(e){let{data:a}=e,{variable:r}=a;return Mt({type:this.contextType,data:{name:r.name,dataType:r.dataType},details:r.value==null?void 0:JSON.stringify(r.value)})}};function pt(t){let e=t.get($i),a=t.get(ji),r=t.get(Fi);return new xo().register(new Eu(a)).register(new Tu(r,a)).register(new wu(t)).register(new _u(t)).register(new wo(e.connectionsMap,a))}function Iu(){return new Cu(lo())}const Su="@";function Au({input:t}){let e="";return t.includes("@")&&(e=Ru(t),ie.debug("Included context",e)),{includeOtherCode:Qr(""),context:{plainText:e,schema:[],variables:[]}}}async function Ou({input:t}){let e="",a=[];if(t.includes("@")){let r=pt(Yr),s=r.parseAllContextIds(t);e=r.formatContextForAI(s);try{a=await r.getAttachmentsForContext(s),ie.debug("Included attachments",a.length)}catch(n){ie.error("Error getting attachments:",n)}}return{body:{includeOtherCode:Qr(""),context:{plainText:e,schema:[],variables:[]}},attachments:a}}function Ru(t){let e=pt(Yr),a=e.parseAllContextIds(t);return e.formatContextForAI(a)}function Nu(t,e=[]){return a=>{let r=t.map(s=>a.matchBefore(s)).find(Boolean);return!r||r&&r.from===r.to&&!a.explicit?null:{from:r==null?void 0:r.from,options:[...e]}}}function $n(t){var e;if((e=t.current)!=null&&e.view){let a=t.current.view.state.selection.main.from;t.current.view.dispatch({changes:{from:a,to:a,insert:"@"},selection:{anchor:a+1,head:a+1}}),t.current.view.focus(),ro(t.current.view)}}function ju(t){if(t.trim().length===0)return[];if(!t.includes("```"))return[{language:"python",code:t}];let e=[],a=0,r=t.indexOf("```",a);for(;r!==-1;){let s=t.indexOf(`
`,r);if(s===-1){let d=t.slice(r+3),u=d.indexOf(" "),c=u===-1?d:d.slice(0,u),f=c==="markdown"?"markdown":c==="sql"?"sql":"python",m=u===-1?"":d.slice(u+1);m.trim()&&e.push({language:f,code:m.trim()});break}let n=t.slice(r+3,s).trim()||"";n=n==="markdown"?"markdown":n==="sql"?"sql":"python";let o=s+1,i=t.indexOf("```",o);if(i===-1){let d=t.slice(o).replace(/\n+$/,"");d.trim()&&e.push({language:n,code:d});break}let l=t.slice(o,i).replace(/\n+$/,"");l.trim()&&e.push({language:n,code:l}),a=i+3,r=t.indexOf("```",a)}return e.length===0&&e.push({language:"python",code:t}),e}var Mu=jt(),Dn=()=>new Map,{valueAtom:qt,useActions:Zn,createActions:Sp,reducer:Ap}=ao(Dn,{addStagedCell:(t,e)=>{let{cellId:a,edit:r}=e;return new Map([...t,[a,r]])},removeStagedCell:(t,e)=>{let a=new Map(t);return a.delete(e),a},clearStagedCells:()=>Dn()});function Fn(t){let e=(0,Mu.c)(27),{addStagedCell:a,removeStagedCell:r,clearStagedCells:s}=Zn(),{createNewCell:n,updateCellCode:o}=ts(),i=No(),l=(0,A.useRef)(null),d;e[0]!==a||e[1]!==n?(d=C=>{let S=Xr.create();return a({cellId:S,edit:{type:"add_cell"}}),n({cellId:"__end__",code:C,before:!1,newCellId:S}),S},e[0]=a,e[1]=n,e[2]=d):d=e[2];let u=d,c;e[3]!==t||e[4]!==o?(c=C=>{let{cellId:S,code:P}=C;if(!t.get(qt).has(S)){ie.error("Staged cell not found",{cellId:S});return}let D=Mi(S);D?Fa(D,P):o({cellId:S,code:P,formattingChange:!1})},e[3]=t,e[4]=o,e[5]=c):c=e[5];let f=c,m;e[6]!==i||e[7]!==r?(m=C=>{r(C),i({cellId:C})},e[6]=i,e[7]=r,e[8]=m):m=e[8];let b=m,g;e[9]!==s||e[10]!==i||e[11]!==t?(g=()=>{let C=t.get(qt);for(let S of C.keys())i({cellId:S});s()},e[9]=s,e[10]=i,e[11]=t,e[12]=g):g=e[12];let p=g,h;e[13]!==a||e[14]!==n||e[15]!==u||e[16]!==f?(h=C=>{e:switch(C.type){case"text-start":l.current=new Pu(u,f,a,n);break e;case"text-delta":if(!l.current){ie.error("Cell creation stream not found");return}l.current.stream(C);break e;case"text-end":case"finish":if(!l.current){ie.error("Cell creation stream not found");return}l.current.stop();break e;case"abort":case"error":case"tool-input-error":case"tool-output-error":ie.error("Error",C.type,{chunk:C});break e;case"start":case"start-step":case"finish-step":case"data-reasoning-signature":break e;case"message-metadata":case"tool-input-available":case"tool-output-available":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"file":case"source-document":case"source-url":case"tool-input-start":case"tool-input-delta":ie.debug(C.type,{chunk:C});break e;default:if(Lu(C)){ie.debug("Data chunk",{chunk:C});break e}is(C)}},e[13]=a,e[14]=n,e[15]=u,e[16]=f,e[17]=h):h=e[17];let v=h,T;return e[18]!==a||e[19]!==s||e[20]!==u||e[21]!==p||e[22]!==b||e[23]!==v||e[24]!==r||e[25]!==f?(T={createStagedCell:u,updateStagedCell:f,addStagedCell:a,removeStagedCell:r,clearStagedCells:s,deleteStagedCell:b,deleteAllStagedCells:p,onStream:v},e[18]=a,e[19]=s,e[20]=u,e[21]=p,e[22]=b,e[23]=v,e[24]=r,e[25]=f,e[26]=T):T=e[26],T}var Pu=class{constructor(t,e,a,r){L(this,"createdCells",[]);L(this,"buffer","");L(this,"hasMarimoImport",!1);this.onCreateCell=t,this.onUpdateCell=e,this.addStagedCell=a,this.createNewCell=r}stream(t){let e=t.delta;this.buffer+=e;let a=ju(this.buffer);for(let[r,s]of a.entries())if(r<this.createdCells.length){this.addMarimoImport(s.language);let n=this.createdCells[r];this.createdCells[r]={...n,cell:s},this.onUpdateCell({cellId:n.cellId,code:s.code,language:s.language})}else{let n=this.onCreateCell(s.code);this.createdCells.push({cellId:n,cell:s})}}addMarimoImport(t){var a;if(this.hasMarimoImport||t==="python")return;let e=Ao({autoInstantiate:!1,createNewCell:this.createNewCell,fromCellId:(a=this.createdCells[0])==null?void 0:a.cellId,before:!0});e&&this.addStagedCell({cellId:e,edit:{type:"add_cell"}}),this.hasMarimoImport=!0}stop(){this.buffer=""}};function Lu(t){return t.type.startsWith("data-")}var $u={baseDescription:"Perform editing operations on the current notebook. You should prefer to create new cells unless you need to edit existing cells. Call this tool multiple times to perform multiple edits. Separate code into logical individual cells to take advantage of the notebook's reactive execution model.",prerequisites:["If you are updating existing cells, you need the cellIds. If they are not known, call the lightweight_cell_map_tool to find out."],additionalInfo:`
  Args:
    edit (object): The editing operation to perform with the following structure:
      - type: One of "update_cell", "add_cell", or "delete_cell"
      - code (string, optional): Required for "update_cell" and "add_cell" operations. The code content for the cell.
      - position (object): Always present, with the following structure:
        - type: One of "relative", "column_end", or "notebook_end". Not needed for "delete_cell" or "update_cell" operations.
        - cellId (string, optional): Required for "update_cell", "delete_cell", and "add_cell" with "relative" position type
        - columnIndex (number, optional): Required for "add_cell" with "column_end" position type (0-based index)
        - before (boolean, optional): Required for "add_cell" with "relative" position type (true to add before, false to add after)

    Operation types:
    - update_cell: Update the code of an existing cell. Requires: code, position.cellId
    - add_cell: Add a new cell to the notebook. Requires: code, and position based on position.type:
        - position.type "notebook_end": Add at the end of the notebook (no additional position fields needed)
        - position.type "relative": Add relative to an existing cell. Requires: position.cellId, position.before
        - position.type "column_end": Add at the end of a specific column. Requires: position.columnIndex
    - delete_cell: Delete an existing cell. Requires: position.cellId. For deleting cells, the user needs to accept the deletion to actually delete the cell, so you may still see the cell in the notebook on subsequent edits which is fine.

    For adding code, use the following guidelines:
    - Markdown cells: use mo.md(f"""{content}""") function to insert content.
    - SQL cells: use mo.sql(f"""{content}""") function to insert content. If a database engine is specified, use mo.sql(f"""{content}""", engine=engine) instead.

    Returns:
    - A result object containing standard tool metadata.`},Du=H({edit:H({type:aa(["update_cell","add_cell","delete_cell"]),code:E().optional(),position:H({type:aa(["relative","column_end","notebook_end"]).optional(),cellId:E().optional(),columnIndex:ss().optional(),before:ce().optional()})})}),Zu=class{constructor(){L(this,"name","edit_notebook_tool");L(this,"description",$u);L(this,"schema",Du);L(this,"outputSchema",Nn);L(this,"mode",["agent"]);L(this,"handler",async({edit:t},e)=>{let{addStagedCell:a,createNewCell:r,store:s}=e;switch(t.type){case"update_cell":{let{position:n,code:o}=t,i=n.cellId;if(i){if(!o)throw new xe("Code is required for update_cell","CODE_REQUIRED_FOR_UPDATE_CELL",!0,"Provide the new code to update the cell")}else throw new xe("Cell ID is required for update_cell","CELL_ID_REQUIRED_FOR_UPDATE_CELL",!0,"Provide a cell ID to update");let l=s.get(Ge);this.validateCellIdExists(i,l);let d=this.getCellEditorView(i,l);Ba(i);let u=s.get(qt).get(i);if((u==null?void 0:u.type)==="add_cell"){Fa(d,o);break}let c=d.state.doc.toString();a({cellId:i,edit:{type:"update_cell",previousCode:(u==null?void 0:u.previousCode)??c}}),Fa(d,o);break}case"add_cell":{let{position:n,code:o}=t,i="__end__",l=!1,d=Xr.create(),u=s.get(Ge);switch(n.type){case"relative":{let c=n.cellId;if(!c)throw new xe("Cell ID is required for add_cell with relative position","TOOL_ERROR",!0,"Provide a cell ID to add the cell before");if(n.before===void 0)throw new xe("Before is required for add_cell with relative position","TOOL_ERROR",!0,`Provide a boolean value for before, true to add before cell ${c}, false to add after the cell`);this.validateCellIdExists(c,u),i=c,l=n.before;break}case"column_end":if(!n.columnIndex)throw new xe("Column index is required for add_cell with column_end position","TOOL_ERROR",!0,"Provide a column index to add the cell at the end of");i={type:"__end__",columnId:this.getColumnId(n.columnIndex,u)};break;case"notebook_end":break}r({cellId:i,before:l,code:o,newCellId:d}),a({cellId:d,edit:{type:"add_cell"}}),Ba(d);break}case"delete_cell":{let{position:n}=t,o=n.cellId;if(!o)throw new xe("Cell ID is required for delete_cell","CELL_ID_REQUIRED_FOR_DELETE_CELL",!0,"Provide a cell ID to delete");let i=s.get(Ge);this.validateCellIdExists(o,i),a({cellId:o,edit:{type:"delete_cell",previousCode:this.getCellEditorView(o,i).state.doc.toString()}}),Ba(o);break}}return{status:"success",next_steps:["If you need to perform more edits, call this tool again.","You should use the lint notebook tool to check for errors and lint issues. Fix them by editing the notebook.","You should use the run stale cells tool to run the cells that have been edited or newly added. This allows you to see the output of the cells and fix any errors."]}})}validateCellIdExists(t,e){if(!e.cellIds.getColumns().some(a=>a.idSet.has(t)))throw new xe("Cell not found","CELL_NOT_FOUND",!1,"Check which cells exist in the notebook")}getColumnId(t,e){let a=e.cellIds.getColumns();if(t<0||t>=a.length)throw new xe("Column index is out of range","COLUMN_INDEX_OUT_OF_RANGE",!0,"Choose a column index between 0 and the number of columns in the notebook (0-based)");return a[t].id}getCellEditorView(t,e){let a=e.cellHandles[t].current;if(!(a!=null&&a.editorView))throw new xe("Cell editor not found","CELL_EDITOR_NOT_FOUND",!1,"Internal error, ask the user to report this error");return a.editorView}},Fu=200,zu=3e4,Uu={baseDescription:"Run cells in the current notebook that are stale. Stale cells are cells that have been edited or newly added. You can run this tool after editing the notebook or when requested. The output of the ran cells will be returned alongside metadata."},zn=H({type:M("file"),url:E(),mediaType:E()}),Vu=class{constructor(t){L(this,"name","run_stale_cells_tool");L(this,"description",Uu);L(this,"schema",H({}));L(this,"outputSchema",Nn.extend({cellsToOutput:Nt(E(),H({consoleOutput:E().optional(),cellOutput:E().optional(),consoleAttachments:ze(zn).optional(),cellAttachments:ze(zn).optional()}).nullable()).optional()}));L(this,"mode",["agent"]);L(this,"handler",async(t,e)=>{let{prepareForRun:a,sendRun:r,store:s}=e,n=s.get(Ge),o=Ci(n);if(o.length===0)return{status:"success",message:"No stale cells found."};if(await So({cellIds:o,sendRun:r,prepareForRun:a,notebook:n}),!await this.waitForCellsToFinish(s,o,zu,this.postExecutionDelay))return{status:"success",message:"No output was returned because some cells have not finished executing"};let i=s.get(Ge),l=new Map,d="",u=!1;for(let f of o){let m=Mn(f,i,{includeConsoleOutput:!0}),b,g,p=m.cellOutput,h=m.consoleOutputs,v=h&&h.length>0;if(!p&&!v){l.set(f,null);continue}p&&(b=this.formatOutputString(p),this.outputHasErrors(p)&&(u=!0)),v&&(g=h.map(T=>this.formatOutputString(T)).join(`
`),d+="Console output represents the stdout or stderr of the cell (eg. print statements).",h.some(T=>this.outputHasErrors(T))&&(u=!0)),l.set(f,{cellOutput:b,consoleOutput:g})}if(l.size===0)return{status:"success",message:"Stale cells have been run. No output was returned."};let c=["Review the output of the cells. The CellId is the key of the result object.",u?"There are errors in the cells. Please fix them by using the edit notebook tool and the given CellIds.":"You may edit the notebook further with the given CellIds."];return{status:"success",cellsToOutput:Object.fromEntries(l),message:d===""?void 0:d,next_steps:c}});this.postExecutionDelay=(t==null?void 0:t.postExecutionDelay)??Fu}outputHasErrors(t){let{output:e}=t;return e.mimetype==="application/vnd.marimo+error"||e.mimetype==="application/vnd.marimo+traceback"}formatOutputString(t){let e="",{outputType:a,processedContent:r,imageUrl:s,output:n}=t;return a==="text"?(e+=`Output:
`,r?e+=r:typeof n.data=="string"?e+=n.data:e+=JSON.stringify(n.data)):a==="media"&&(e+=`Media Output: Contains ${n.mimetype} content`,s&&(e+=`
Image URL: ${s}`)),e}async waitForCellsToFinish(t,e,a,r){let s=o=>e.every(i=>{let l=o.cellRuntime[i];return(l==null?void 0:l.status)!=="running"&&(l==null?void 0:l.status)!=="queued"}),n=async()=>(r>0&&await new Promise(o=>setTimeout(o,r)),!0);if(s(t.get(Ge)))return await n();try{return await Promise.race([wi(Ge,s),new Promise((o,i)=>setTimeout(()=>i(Error("timeout")),a))]),await n()}catch{return!1}}};function Bu(t){let e=t.baseDescription;return t.whenToUse&&(e+=`

## When to use:
- ${t.whenToUse.join(`
- `)}`),t.avoidIf&&(e+=`

## Avoid if:
- ${t.avoidIf.join(`
- `)}`),t.prerequisites&&(e+=`

## Prerequisites:
- ${t.prerequisites.join(`
- `)}`),t.sideEffects&&(e+=`

## Side effects:
- ${t.sideEffects.join(`
- `)}`),t.additionalInfo&&(e+=`

## Additional info:
- ${t.additionalInfo}`),e}var Un,Wt;function qu(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(o){n[o]=r[o]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(o,i){return i(t,e,o)||o},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}const Pr=new(Un=Ai(),Wt=class{constructor(t=[]){L(this,"tools",new Map);this.tools=new Map(t.map(e=>[e.name,e]))}has(t){return this.tools.has(t)}getToolOrThrow(t){let e=this.tools.get(t);if(!e)throw Error(`Tool ${t} not found`);return e}async invoke(t,e,a){var i;let r=this.getToolOrThrow(t),s=r.handler,n=r.schema,o=r.outputSchema;try{let l=await n.safeParseAsync(e);if(l.error)throw new xe(`Tool ${t} returned invalid input: ${rs(l.error)}`,"INVALID_ARGUMENTS",!0,"Please check the arguments and try again.");let d=l.data,u=await s(d,a),c=await o.safeParseAsync(u);if(c.error){let f=rs(c.error);throw Error(`Tool ${t} returned invalid output: ${f}`)}return{tool_name:t,result:c.data,error:null}}catch(l){return l instanceof xe?{tool_name:t,result:null,error:l.toStructuredString()}:{tool_name:t,result:null,error:new xe(l instanceof Error?l.message:String(l),"TOOL_ERROR",!1,"Check the error message and try again with valid arguments.",{args:e,errorType:((i=l==null?void 0:l.constructor)==null?void 0:i.name)??typeof l}).toStructuredString()}}}getToolSchemas(t){return[...this.tools.values()].filter(e=>e.mode.includes(t)).map(e=>({name:e.name,description:Bu(e.description),parameters:ns(e.schema),source:"frontend",mode:e.mode}))}},qu(Wt.prototype,"getToolSchemas",[Un],Object.getOwnPropertyDescriptor(Wt.prototype,"getToolSchemas"),Wt.prototype),Wt)([new Zu,new Vu]);function Lr(t,e){return new Promise(a=>{let r=new FileReader;r.readAsDataURL(t),r.onload=s=>{var n;if((n=s.target)!=null&&n.result){let o=s.target.result;a(e==="base64"?o.slice(o.indexOf(",")+1):o)}}})}function Wu(t){return Promise.all(t.map(e=>Lr(e,"base64").then(a=>[e.name,a])))}var Ju=jt();const Vn=new Set(["openai","google","anthropic"]),Ku=["image/*","text/*"];var Yu=1024*1024*50;function Hu(t){return t.length>50?`${t.slice(0,50)}...`:t}async function Bn(t){return await Promise.all(t.map(async e=>({type:"file",mediaType:e.type,filename:e.name,url:await Lr(e,"dataUrl")})))}function Gu(t){if(t.length===0)return!1;let e=t.at(-1);if(!e||e.role!=="assistant"||!e.parts)return!1;let a=e.parts;return a.length===0?!1:a[a.length-1].type==="reasoning"}function Qu(t){return t.map(e=>e.type==="text"?e.text:"").join(`
`)}async function qn(t){let e=await Ou({input:Qu(t.flatMap(r=>r.parts))});function a(r,s){return s?{...r,parts:[...r.parts,...e.attachments]}:r}return{...e.body,uiMessages:t.map((r,s)=>a(r,s===t.length-1))}}async function Wn({invokeAiTool:t,addToolOutput:e,toolCall:a,toolContext:r}){try{if(Pr.has(a.toolName)){let s=await Pr.invoke(a.toolName,a.input,r);e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}else{let s=await t({toolName:a.toolName,arguments:a.input??{}});e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}}catch(s){ie.error("Tool call failed:",s),e({tool:a.toolName,toolCallId:a.toolCallId,output:`Error: ${s instanceof Error?s.message:String(s)}`})}}function Xu(t){var i;if(t.length===0)return!1;let e=t[t.length-1],a=e.parts;if(a.length===0||e.role!=="assistant")return!1;let r=a.filter(l=>l.type.startsWith("tool-"));if(r.length===0)return!1;let s=r.every(l=>l.state==="output-available"),n=a[a.length-1],o=n.type==="text"&&((i=n.text)==null?void 0:i.trim().length)>0;return ie.warn("All tool calls completed: %s",s),s&&!o}function Jn(){let t=(0,Ju.c)(7),e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=[],t[0]=e):e=t[0];let[a,r]=(0,A.useState)(e),s;t[1]===Symbol.for("react.memo_cache_sentinel")?(s=c=>{if(c.length!==0){if(c.reduce(ec,0)>Yu){Va({title:"File size exceeded",description:"Attachments must be under 50 MB",variant:"danger"});return}r(f=>[...f,...c])}},t[1]=s):s=t[1];let n=Hr(s),o;t[2]===Symbol.for("react.memo_cache_sentinel")?(o=()=>r([]),t[2]=o):o=t[2];let i=o,l;t[3]===Symbol.for("react.memo_cache_sentinel")?(l=c=>r(f=>f.filter(m=>m!==c)),t[3]=l):l=t[3];let d=l,u;return t[4]!==n||t[5]!==a?(u={files:a,addFiles:n,clearFiles:i,removeFile:d},t[4]=n,t[5]=a,t[6]=u):u=t[6],u}function ec(t,e){return t+e.size}var Jt=jt(),k=Za(Hi(),1);const tc=t=>{var o;let e=(0,Jt.c)(6),{attachment:a}=t;if((o=a.mediaType)!=null&&o.startsWith("image/")){let i=a.filename||"Attachment",l;return e[0]!==a.url||e[1]!==i?(l=(0,k.jsx)("img",{src:a.url,alt:i,className:"max-h-[100px] max-w-[100px] object-contain mb-1.5"}),e[0]=a.url,e[1]=i,e[2]=l):l=e[2],l}let r;e[3]===Symbol.for("react.memo_cache_sentinel")?(r=(0,k.jsx)(ms,{className:"h-3 w-3 mt-0.5"}),e[3]=r):r=e[3];let s=a.filename||"Attachment",n;return e[4]===s?n=e[5]:(n=(0,k.jsxs)("div",{className:"flex flex-row gap-1 items-center text-xs",children:[r,s]}),e[4]=s,e[5]=n),n},Kn=t=>{let e=(0,Jt.c)(12),{file:a,className:r,onRemove:s}=t,[n,o]=(0,A.useState)(!1),i;e[0]===r?i=e[1]:(i=za("py-1 px-1.5 bg-muted rounded-md cursor-pointer flex flex-row gap-1 items-center text-xs",r),e[0]=r,e[1]=i);let l,d;e[2]===Symbol.for("react.memo_cache_sentinel")?(l=()=>o(!0),d=()=>o(!1),e[2]=l,e[3]=d):(l=e[2],d=e[3]);let u;e[4]!==a||e[5]!==n||e[6]!==s?(u=n?(0,k.jsx)(us,{className:"h-3 w-3 mt-0.5",onClick:s}):ac(a),e[4]=a,e[5]=n,e[6]=s,e[7]=u):u=e[7];let c;return e[8]!==a.name||e[9]!==i||e[10]!==u?(c=(0,k.jsxs)("div",{className:i,onMouseEnter:l,onMouseLeave:d,children:[u,a.name]}),e[8]=a.name,e[9]=i,e[10]=u,e[11]=c):c=e[11],c},Yn=t=>{let e=(0,Jt.c)(12),{isLoading:a,onStop:r,onSendClick:s,isEmpty:n,showStopLabel:o}=t,i=o===void 0?!1:o,l;e[0]===i?l=e[1]:(l=i?(0,k.jsxs)("div",{className:"flex flex-row items-center gap-1 px-1.5",children:[(0,k.jsx)("span",{className:"text-xs text-error",children:"Stop"}),(0,k.jsx)(vo,{size:"small"})]}):(0,k.jsx)(fs,{className:"size-4 text-error"}),e[0]=i,e[1]=l);let d=l,u=a?"Stop":"Submit",c=a?r:s,f=a?!1:n,m;e[2]!==a||e[3]!==d?(m=a?d:(0,k.jsx)(ys,{className:"h-3.5 w-3.5"}),e[2]=a,e[3]=d,e[4]=m):m=e[4];let b;e[5]!==c||e[6]!==f||e[7]!==m?(b=(0,k.jsx)(Qe,{variant:"text",size:"sm",className:"h-6 min-w-6 p-0 hover:bg-muted/30 cursor-pointer",onClick:c,disabled:f,children:m}),e[5]=c,e[6]=f,e[7]=m,e[8]=b):b=e[8];let g;return e[9]!==u||e[10]!==b?(g=(0,k.jsx)(la,{content:u,children:b}),e[9]=u,e[10]=b,e[11]=g):g=e[11],g},Hn=t=>{let e=(0,Jt.c)(4),{handleAddContext:a,isLoading:r}=t,s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,k.jsx)(hs,{className:"h-3.5 w-3.5"}),e[0]=s):s=e[0];let n;return e[1]!==a||e[2]!==r?(n=(0,k.jsx)(la,{content:"Add context",children:(0,k.jsx)(Qe,{variant:"text",size:"icon",onClick:a,disabled:r,children:s})}),e[1]=a,e[2]=r,e[3]=n):n=e[3],n},Gn=t=>{let e=(0,Jt.c)(15),{fileInputRef:a,isLoading:r,onAddFiles:s}=t,n;e[0]===a?n=e[1]:(n=()=>{var f;return(f=a.current)==null?void 0:f.click()},e[0]=a,e[1]=n);let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=(0,k.jsx)(gs,{className:"h-3.5 w-3.5"}),e[2]=o):o=e[2];let i;e[3]!==r||e[4]!==n?(i=(0,k.jsx)(la,{content:"Attach a file",children:(0,k.jsx)(Qe,{variant:"text",size:"icon",onClick:n,disabled:r,children:o})}),e[3]=r,e[4]=n,e[5]=i):i=e[5];let l;e[6]===s?l=e[7]:(l=f=>{f.target.files&&s([...f.target.files])},e[6]=s,e[7]=l);let d;e[8]===Symbol.for("react.memo_cache_sentinel")?(d=Ku.join(","),e[8]=d):d=e[8];let u;e[9]!==a||e[10]!==l?(u=(0,k.jsx)(_o,{ref:a,type:"file",multiple:!0,hidden:!0,onChange:l,accept:d}),e[9]=a,e[10]=l,e[11]=u):u=e[11];let c;return e[12]!==i||e[13]!==u?(c=(0,k.jsxs)(k.Fragment,{children:[i,u]}),e[12]=i,e[13]=u,e[14]=c):c=e[14],c};function ac(t){let e="h-3 w-3 mt-0.5";return t.type.startsWith("image/")?(0,k.jsx)(go,{className:e}):t.type.startsWith("text/")?(0,k.jsx)(Ii,{className:e}):(0,k.jsx)(ms,{className:e})}function rc(t){return Qi.define({combine:e=>e[0]??t})}var Qn=rc({}),$r=ia.define(),ja=ia.define(),sc=50,Dr=sa.define({create(){return{prompts:[],navigationIndex:-1,originalText:""}},update(t,e){var r,s;let a={...t};e.docChanged&&t.navigationIndex!==-1&&(e.effects.some(n=>n.is(ja)||n.is($r))||(a.navigationIndex=-1,a.originalText=""));for(let n of e.effects)if(n.is($r)){let o=n.value.trim();o&&(a.prompts=[o,...t.prompts.filter(i=>i!==o)].slice(0,sc),(s=(r=e.state.facet(Qn)).save)==null||s.call(r,a.prompts)),a.navigationIndex=-1,a.originalText=""}else n.is(ja)&&(a.navigationIndex=n.value.index,a.originalText=n.value.originalText);return a}}),nc=t=>{let e=t.state.field(Dr),a=t.state.doc;if(e.prompts.length===0)return!1;let r,s=e.originalText;if(e.navigationIndex===-1){if(a.length>0)return!1;r=0,s=a.toString()}else if(r=Math.min(e.navigationIndex+1,e.prompts.length-1),r===e.navigationIndex)return!1;let n=e.prompts[r];return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},effects:ja.of({index:r,originalText:s})}),!0},ic=t=>{let e=t.state.field(Dr);if(e.navigationIndex===-1)return!1;let a,r;return e.navigationIndex===0?(a=e.originalText,r=-1):(r=e.navigationIndex-1,a=e.prompts[r]??""),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:a},effects:ja.of({index:r,originalText:e.originalText})}),!0};const Xn=t=>{let e=t.state.doc.toString();return e.trim()?(t.dispatch({effects:$r.of(e)}),!0):!1};function oc(t={}){let{storage:e,defaultKeymap:a=!0}=t,r=[Dr.init(()=>{var s;return{prompts:((s=e==null?void 0:e.load)==null?void 0:s.call(e))??[],navigationIndex:-1,originalText:""}}),Qn.of(e??{})];return a&&r.push(na.of([{key:"ArrowUp",run:nc},{key:"ArrowDown",run:ic}])),r}const Zr=ia.define(),We=sa.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Zr)){a||(a=(r=new Map(t),!0));for(let[n,o]of s.value)r.set(n,o)}return r}}),lc=sa.define({create(){return{onResourceClick:void 0,onResourceMouseOver:void 0,onResourceMouseOut:void 0,onPromptSubmit:void 0}},update(t){return t}}),dc=ia.define();sa.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(dc)){a||(a=(r=new Map(t),!0));for(let[n,o]of s.value)r.set(n,o)}return r}});const uc=(t,e)=>async a=>{let r=a.matchBefore(/@(\w+)?/);if(!r||r.from===r.to&&!a.explicit)return null;let s=await t();if(s.length===0)return null;let n=Zr.of(new Map(s.map(i=>[i.uri,i])));a.view&&a.view.dispatch({effects:n});let o=s.map(i=>({label:`@${i.name}`,displayLabel:i.name,detail:i.uri,info:i.description||void 0,type:i.mimeType?"constant":"variable",boost:i.description?100:0,...e==null?void 0:e(i),apply:(l,d,u,c)=>{l.dispatch({changes:{from:u,to:c,insert:`@${i.uri} `}})}}));return{from:r.from,options:o}},cc=/@[\w-]+:\/\/(?!\/)[^\s]+/;function st(t){return t.matchAll(new RegExp(cc.source,"g"))}var pc=class extends ds{constructor(e,a){super();L(this,"resource");L(this,"view");this.resource=e,this.view=a}eq(e){return e.resource.uri===this.resource.uri}toDOM(){let e=document.createElement("span");e.className="cm-resource-widget",e.textContent=`@${this.resource.name}`;let a=this.view.state.field(lc,!1),r=a==null?void 0:a.onResourceClick,s=a==null?void 0:a.onResourceMouseOver,n=a==null?void 0:a.onResourceMouseOut;return r&&(e.style.cursor="pointer",e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),r(this.resource)})),s&&e.addEventListener("mouseover",o=>{o.preventDefault(),o.stopPropagation(),s(this.resource)}),n&&e.addEventListener("mouseout",o=>{o.preventDefault(),o.stopPropagation(),n(this.resource)}),e}},mc=class extends ds{constructor(e,a){super();L(this,"uri");L(this,"view");this.uri=e,this.view=a}eq(e){return e.uri===this.uri}toDOM(){let e=document.createElement("span");return e.className="cm-not-found-resource-widget",e.textContent=`@${this.uri.split("://")[1]??this.uri}`,e}};function ei(t){let e=t.state.field(We),a=[];for(let{from:r,to:s}of t.visibleRanges){let n=t.state.doc.sliceString(r,s);for(let o of st(n)){let i=r+o.index,l=o[0].slice(1),d=e.get(l);d?a.push(Ua.replace({widget:new pc(d,t)}).range(i,i+o[0].length)):a.push(Ua.replace({widget:new mc(l,t)}).range(i,i+o[0].length))}}return Ua.set(a)}const hc=eo.fromClass(class{constructor(t){L(this,"decorations");this.decorations=ei(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(a=>a.is(Zr))))&&(this.decorations=ei(t.view))}},{decorations:t=>t.decorations});function fc(t){let e=document.createElement("div");e.className="cm-tooltip-cursor";let a=document.createElement("div");if(a.className="cm-tooltip-cursor-title",a.textContent=`${t.name} (${t.uri})`,e.appendChild(a),t.description){let r=document.createElement("div");r.className="cm-tooltip-cursor-description",r.textContent=t.description,e.appendChild(r)}if(t.mimeType){let r=document.createElement("div");r.className="cm-tooltip-cursor-mimetype",r.textContent=t.mimeType,e.appendChild(r)}return{dom:e}}function gc(t,e,a,r=0){for(let s of st(t)){let n=r+s.index,o=n+s[0].length;if(e>=n&&e<=o){let i=s[0].slice(1),l=a.get(i);if(l)return{resource:l,start:n,end:o}}}return null}function yc(t){return to((e,a)=>{let{from:r,text:s}=e.state.doc.lineAt(a),n=gc(s,a,e.state.field(We),r);return n?{pos:n.start,end:n.end,above:!0,create(){return(t.createTooltip??fc)(n.resource)}}:null})}function vc(t,e){let a=t.field(We),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(st(n));if(o.length===0)return null;for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(e===d&&a.has(u))return{from:l,to:d,uri:u}}return null}function _c(t,e){let a=t.field(We),r=t.doc,s=r.lineAt(e).to,n=r.sliceString(e,s),o=Array.from(st(n));if(o.length===0)return null;let i=o[0];if(!i||i.index!==0)return null;let l=e,d=e+i[0].length,u=i[0].slice(1);return a.has(u)?{from:l,to:d,uri:u}:null}function ti(t,e){let a=t.field(We),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(st(n));for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(e>l&&e<d&&a.has(u))return{from:l,to:d,uri:u}}return null}function bc(t,e){let a=t.field(We),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,e),o=Array.from(st(n)),i=null;for(let l of o){let d=s.from+l.index,u=d+l[0].length,c=l[0].slice(1);a.has(c)&&u<=e&&(e>u?i=u:e===u&&(i=d))}return i}function xc(t,e){let a=t.field(We),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(st(n));for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(a.has(u)&&l>=e){if(e<l)return l;if(e===l)return d}}return null}const wc=Gi.transactionFilter.of(t=>{var r;let e=t.annotation(Xi.userEvent);if(!e)return t;let a=t.startState.selection.main;if(!a.empty)return t;if(e==="input.type"||e.startsWith("input")){if(t.changes.empty)return t;let s=t.startState.field(We),n=t.startState.doc,o=!1,i=0,l=[];if(t.changes.iterChanges((d,u,c,f,m)=>{let b=m.toString(),g=d;if(/^\s+$/.test(b)){l.push({from:d,to:u,insert:b});return}let p=n.lineAt(g),h=n.sliceString(p.from,p.to),v=Array.from(st(h)),T=!1,C=!1;for(let P of v){let D=p.from+P.index,N=D+P[0].length,K=P[0].slice(1);if(s.has(K)){if(g===D){let j=g>0?n.sliceString(g-1,g):"";j!==""&&j!==" "&&j!==`
`&&j!=="	"&&(T=!0)}if(g===N){let j=g<n.length?n.sliceString(g,g+1):"";(j===""||j!==" "&&j!==`
`&&j!=="	")&&(C=!0)}}}let S=b;T&&(S=` ${S}`,i+=1),C&&(S=` ${S}`,i+=1),S!==b&&(o=!0),l.push({from:d,to:u,insert:S})}),o)return[{changes:l,selection:t.selection?{anchor:t.selection.main.anchor+i,head:t.selection.main.head+i}:void 0,scrollIntoView:t.scrollIntoView}]}if(e==="delete.backward"||e==="delete.forward"){let s=null;return e==="delete.backward"?s=vc(t.startState,a.head):e==="delete.forward"&&(s=_c(t.startState,a.head)),s?[{changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from},scrollIntoView:!0}]:t}if((r=t.selection)!=null&&r.main.empty&&a.empty&&!e.startsWith("input")&&e!=="input.type"){let s=a.head,n=t.selection.main.head,o=null;if(n<s){let i=ti(t.startState,s);o=i&&s>i.from?i.from:bc(t.startState,s)}else if(n>s){let i=ti(t.startState,s);o=i&&s<i.to?i.to:xc(t.startState,s)}if(o!==null&&o!==n)return[{selection:{anchor:o},scrollIntoView:!0}]}return t}),kc=ls.baseTheme({".cm-resource-widget":{background:"light-dark(rgba(86,156,214,0.08),rgba(86,156,214,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#2367a2,#7ecbff)",fontWeight:"500"},".cm-resource-widget:hover":{background:"light-dark(rgba(86,156,214,0.18),rgba(86,156,214,0.28))"},".cm-not-found-resource-widget":{background:"light-dark(rgba(151,151,151,0.08),rgba(151,151,151,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#b00020,#ff8080)",fontWeight:"500"}});var ai="_none_",Cc=[{uri:"",name:"No resources",type:ai,data:{}}],Ec={info:"Variables, dataframes, and tables will appear here.",apply:()=>{}};function Tc(t){let{language:e,store:a,onAddFiles:r}=t;return[e.data.of({autocomplete:uc(async()=>{let s=pt(a).getAllItems();return s.length===0?Cc:s},s=>{var n;return s.type===ai?Ec:((n=pt(a).getProvider(s.type))==null?void 0:n.formatCompletion(s))||{}})}),os.high(na.of([{key:"Tab",run:s=>so(s)}])),Ln.of({addAttachment:s=>r==null?void 0:r([s])}),...r?[e.data.of({autocomplete:Iu().createCompletionSource()})]:[],hc,wc,We.init(()=>{let s=pt(a).getAllItems();return new Map(s.map(n=>[n.uri,n]))}),kc,yc({createTooltip:s=>{let n=pt(a).getProvider(s.type);if(!n)return ie.warn("No provider found for resource",s),Kt(s.description||s.name);let o=n.formatCompletion(s),i=s.description||s.name;if(!(o!=null&&o.info))return Kt(i);if(typeof o.info=="string")return Kt(o.info);let l=o.info(o);return l?"dom"in l?{dom:l.dom}:"then"in l?(ie.warn("info is a promise. This is not supported",l),Kt(i)):{dom:l}:Kt(i)}})]}function Kt(t){let e=document.createElement("div");return e.innerHTML=t,{dom:e}}var Fr=jt();const ri=t=>{let{handleAcceptCompletion:e,handleDeclineCompletion:a,isLoading:r,hasCompletion:s}=t;return n=>{let o=Ji()?n.metaKey:n.ctrlKey;o&&n.key==="Enter"&&!r&&s&&e(),(n.key==="Delete"||n.key==="Backspace")&&o&&n.shiftKey&&(a(),n.preventDefault(),n.stopPropagation())}},Ic=t=>{let e=(0,Fr.c)(9),{isLoading:a,onAccept:r,onDecline:s,runCell:n}=t,o;e[0]!==a||e[1]!==r||e[2]!==n?(o=(0,k.jsx)(si,{isLoading:a,onAccept:r,size:"xs",runCell:n}),e[0]=a,e[1]=r,e[2]=n,e[3]=o):o=e[3];let i;e[4]===s?i=e[5]:(i=(0,k.jsx)(ni,{onDecline:s,size:"xs"}),e[4]=s,e[5]=i);let l;return e[6]!==o||e[7]!==i?(l=(0,k.jsxs)(k.Fragment,{children:[o,i]}),e[6]=o,e[7]=i,e[8]=l):l=e[8],l},si=t=>{let e=(0,Fr.c)(33),{isLoading:a,onAccept:r,multipleCompletions:s,size:n,buttonStyles:o,acceptShortcut:i,runCell:l,playButtonStyles:d,borderless:u}=t,c=s===void 0?!1:s,f=n===void 0?"sm":n,m=u===void 0?!1:u,b;e[0]!==r||e[1]!==l?(b=()=>{r(),l&&l()},e[0]=r,e[1]=l,e[2]=b):b=e[2];let g=b,p=c?"Accept all":"Accept";if(l){let C=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-r-none ${m&&"border-none rounded-md rounded-r-none"} ${o}`,S;e[3]===i?S=e[4]:(S=i&&(0,k.jsx)(qa,{className:"ml-1 inline",shortcut:i}),e[3]=i,e[4]=S);let P;e[5]!==a||e[6]!==r||e[7]!==f||e[8]!==C||e[9]!==S||e[10]!==p?(P=(0,k.jsxs)(Qe,{variant:"text",size:f,disabled:a,onClick:r,className:C,children:[p,S]}),e[5]=a,e[6]=r,e[7]=f,e[8]=C,e[9]=S,e[10]=p,e[11]=P):P=e[11];let D=c?"Accept and run all cells":"Accept and run cell",N=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-l-none px-1.5 ${m&&"border-0 border-l"} ${d}`,K;e[12]===Symbol.for("react.memo_cache_sentinel")?(K=(0,k.jsx)(yo,{className:"h-2.5 w-2.5"}),e[12]=K):K=e[12];let j;e[13]!==g||e[14]!==a||e[15]!==f||e[16]!==N?(j=(0,k.jsx)(Qe,{variant:"text",size:f,disabled:a,onClick:g,className:N,children:K}),e[13]=g,e[14]=a,e[15]=f,e[16]=N,e[17]=j):j=e[17];let W;e[18]!==j||e[19]!==D?(W=(0,k.jsx)(la,{content:D,children:j}),e[18]=j,e[19]=D,e[20]=W):W=e[20];let X;return e[21]!==W||e[22]!==P?(X=(0,k.jsxs)("div",{className:"flex",children:[P,W]}),e[21]=W,e[22]=P,e[23]=X):X=e[23],X}let h=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded px-3 ${o}`,v;e[24]===i?v=e[25]:(v=i&&(0,k.jsx)(qa,{className:"ml-1 inline",shortcut:i}),e[24]=i,e[25]=v);let T;return e[26]!==a||e[27]!==r||e[28]!==f||e[29]!==h||e[30]!==v||e[31]!==p?(T=(0,k.jsxs)(Qe,{variant:"text",size:f,disabled:a,onClick:r,className:h,children:[p,v]}),e[26]=a,e[27]=r,e[28]=f,e[29]=h,e[30]=v,e[31]=p,e[32]=T):T=e[32],T},ni=t=>{let e=(0,Fr.c)(8),{onDecline:a,multipleCompletions:r,size:s,className:n,declineShortcut:o,borderless:i}=t,l=r===void 0?!1:r,d=s===void 0?"sm":s,u=`h-6 text-(--red-10) bg-(--red-3)/60 hover:bg-(--red-3)
    dark:bg-(--red-4)/80 dark:hover:bg-(--red-3) rounded px-3 font-semibold
    active:bg-(--red-5) dark:active:bg-(--red-4)
    border-(--red-6) border hover:shadow-xs ${(i===void 0?!1:i)&&"border-none rounded-md"} ${n}`,c=l&&" all",f;e[0]===o?f=e[1]:(f=o&&(0,k.jsx)(qa,{className:"ml-1 inline",shortcut:o}),e[0]=o,e[1]=f);let m;return e[2]!==a||e[3]!==d||e[4]!==u||e[5]!==c||e[6]!==f?(m=(0,k.jsxs)(Qe,{variant:"text",size:d,onClick:a,className:u,children:["Reject",c,f]}),e[2]=a,e[3]=d,e[4]=u,e[5]=c,e[6]=f,e[7]=m):m=e[7],m};var Sc=class extends gr{constructor(t,e){super(t),this.onChunkReceived=e}processResponseStream(t){let e=this.onChunkReceived;return super.processResponseStream(t).pipeThrough(new TransformStream({async transform(a,r){e(a),r.enqueue(a)}}))}},ii=jt(),Ac=Ni("marimo:ai-language","python",Pi),oi="marimo:ai-prompt-history",li=new Ri(ze(E()),()=>[]);const Oc=t=>{var Jr;let e=(0,ii.c)(95),{onClose:a}=t,r=Kr(),[s,n]=(0,A.useState)(""),{deleteAllStagedCells:o,clearStagedCells:i,onStream:l,addStagedCell:d}=Fn(r),[u,c]=xi(Ac),f=Yi(),{invokeAiTool:m,sendRun:b}=oo(),g=Gr(qt),p=(0,A.useRef)(null),h=(0,A.useRef)(null),{files:v,addFiles:T,removeFile:C}=Jn(),S=Gr(Ki),{createNewCell:P,prepareForRun:D}=ts(),N;e[0]!==d||e[1]!==P||e[2]!==D||e[3]!==b||e[4]!==r?(N={store:r,addStagedCell:d,createNewCell:P,prepareForRun:D,sendRun:b},e[0]=d,e[1]=P,e[2]=D,e[3]=b,e[4]=r,e[5]=N):N=e[5];let K=N,j;if(e[6]!==u||e[7]!==l||e[8]!==f){let de;e[10]===u?de=e[11]:(de=async ta=>{let yi=await qn(ta.messages);return{body:{...ta,...yi,code:"",prompt:"",language:u}}},e[10]=u,e[11]=de);let Ne;e[12]===l?Ne=e[13]:(Ne=ta=>{l(ta)},e[12]=l,e[13]=Ne),j=new Sc({api:f.getAiURL("completion").toString(),headers:f.headers(),prepareSendMessagesRequest:de},Ne),e[6]=u,e[7]=l,e[8]=f,e[9]=j}else j=e[9];let{sendMessage:W,stop:X,status:te,addToolOutput:ae}=Rn({experimental_throttle:100,transport:j,onToolCall:async de=>{let{toolCall:Ne}=de;await Wn({invokeAiTool:m,addToolOutput:G,toolCall:{toolName:Ne.toolName,toolCallId:Ne.toolCallId,input:Ne.input},toolContext:K})},onError:Rc}),G=ae,Z=te==="streaming"||te==="submitted",oe=g.size>0,ee=((Jr=S==null?void 0:S.models)==null?void 0:Jr.edit_model)||"openai/gpt-4o",Le;if(e[14]!==ee){let de=Wi.parse(ee).providerId;Le=Vn.has(de),e[14]=ee,e[15]=Le}else Le=e[15];let Oe=Le,we;e[16]!==o||e[17]!==v||e[18]!==s||e[19]!==Z||e[20]!==W?(we=async()=>{var de;Z||((de=p.current)!=null&&de.view&&Xn(p.current.view),o(),W({text:s,files:v?await Bn(v):void 0}))},e[16]=o,e[17]=v,e[18]=s,e[19]=Z,e[20]=W,e[21]=we):we=e[21];let he=we,$e;e[22]===Symbol.for("react.memo_cache_sentinel")?($e=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(Po,{className:"size-4 mr-2"}),"Python"]}),e[22]=$e):$e=e[22];let mt=$e,De;e[23]===Symbol.for("react.memo_cache_sentinel")?(De=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(Oi,{className:"size-4 mr-2"}),"SQL"]}),e[23]=De):De=e[23];let Rt=De,ht=u==="python"?mt:Rt,ft;e[24]===Symbol.for("react.memo_cache_sentinel")?(ft=(0,k.jsx)(uo,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"}),e[24]=ft):ft=e[24];let Je;e[25]===ht?Je=e[26]:(Je=(0,k.jsxs)(mo,{className:"flex items-center justify-between h-7 text-xs px-2 py-0.5 border rounded-md hover:text-accent-foreground","data-testid":"language-button",children:[ht,ft]}),e[25]=ht,e[26]=Je);let Re,nt;e[27]===Symbol.for("react.memo_cache_sentinel")?(Re=(0,k.jsx)("div",{className:"px-2 py-1 text-sm text-muted-foreground",children:"Select language"}),nt=(0,k.jsx)(po,{}),e[27]=Re,e[28]=nt):(Re=e[27],nt=e[28]);let U;e[29]===c?U=e[30]:(U=(0,k.jsx)(ps,{onClick:()=>c("python"),children:mt}),e[29]=c,e[30]=U);let V;e[31]===c?V=e[32]:(V=(0,k.jsx)(ps,{onClick:()=>c("sql"),children:Rt}),e[31]=c,e[32]=V);let Y;e[33]!==U||e[34]!==V?(Y=(0,k.jsxs)(ho,{align:"center",children:[Re,nt,U,V]}),e[33]=U,e[34]=V,e[35]=Y):Y=e[35];let B;e[36]!==Je||e[37]!==Y?(B=(0,k.jsxs)(fo,{modal:!1,children:[Je,Y]}),e[36]=Je,e[37]=Y,e[38]=B):B=e[38];let ke=B,ve;e[39]!==i||e[40]!==a?(ve=()=>{i(),a()},e[39]=i,e[40]=a,e[41]=ve):ve=e[41];let le=ve,se;e[42]===o?se=e[43]:(se=()=>{o()},e[42]=o,e[43]=se);let _e=se,it;e[44]===Symbol.for("react.memo_cache_sentinel")?(it=(0,k.jsx)(bo,{className:"size-4 text-(--blue-11) mr-2"}),e[44]=it):it=e[44];let Ze;e[45]!==o||e[46]!==a?(Ze=()=>{o(),a()},e[45]=o,e[46]=a,e[47]=Ze):Ze=e[47];let ot;e[48]===Symbol.for("react.memo_cache_sentinel")?(ot=de=>{n(de)},e[48]=ot):ot=e[48];let ne;e[49]!==le||e[50]!==_e||e[51]!==oe||e[52]!==Z?(ne=ri({handleAcceptCompletion:le,handleDeclineCompletion:_e,isLoading:Z,hasCompletion:oe}),e[49]=le,e[50]=_e,e[51]=oe,e[52]=Z,e[53]=ne):ne=e[53];let ue;e[54]!==s||e[55]!==he||e[56]!==Ze||e[57]!==ne?(ue=(0,k.jsx)(di,{inputRef:p,onClose:Ze,value:s,onChange:ot,onSubmit:he,onKeyDown:ne}),e[54]=s,e[55]=he,e[56]=Ze,e[57]=ne,e[58]=ue):ue=e[58];let Ke;e[59]===Symbol.for("react.memo_cache_sentinel")?(Ke=(0,k.jsx)(us,{className:"size-4"}),e[59]=Ke):Ke=e[59];let Ye;e[60]===a?Ye=e[61]:(Ye=(0,k.jsx)(Qe,{variant:"text",size:"sm",className:"mb-0 px-1",onClick:a,children:Ke}),e[60]=a,e[61]=Ye);let He;e[62]!==ue||e[63]!==Ye?(He=(0,k.jsxs)("div",{className:"flex items-center px-3",children:[it,ue,Ye]}),e[62]=ue,e[63]=Ye,e[64]=He):He=e[64];let La=He,Ht;e[65]===Symbol.for("react.memo_cache_sentinel")?(Ht=(0,k.jsx)(qi,{triggerClassName:"h-7 text-xs max-w-64",iconSize:"small",forRole:"edit",showAddCustomModelDocs:!0}),e[65]=Ht):Ht=e[65];let gt;e[66]===ke?gt=e[67]:(gt=(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[Ht,ke]}),e[66]=ke,e[67]=gt);let yt;e[68]!==v||e[69]!==C?(yt=v.length>0&&(0,k.jsx)("div",{className:"flex flex-row gap-1 flex-wrap pr-1",children:v==null?void 0:v.map((de,Ne)=>(0,k.jsx)(Kn,{file:de,onRemove:()=>C(de)},`${de.name}-${Ne}`))}),e[68]=v,e[69]=C,e[70]=yt):yt=e[70];let Gt;e[71]===Symbol.for("react.memo_cache_sentinel")?(Gt=()=>$n(p),e[71]=Gt):Gt=e[71];let vt;e[72]===Z?vt=e[73]:(vt=(0,k.jsx)(Hn,{handleAddContext:Gt,isLoading:Z}),e[72]=Z,e[73]=vt);let _t;e[74]!==T||e[75]!==Oe||e[76]!==Z?(_t=Oe&&(0,k.jsx)(Gn,{fileInputRef:h,isLoading:Z,onAddFiles:T}),e[74]=T,e[75]=Oe,e[76]=Z,e[77]=_t):_t=e[77];let $a=!s.trim(),bt;e[78]!==Z||e[79]!==X||e[80]!==he||e[81]!==$a?(bt=(0,k.jsx)(Yn,{isLoading:Z,onStop:X,onSendClick:he,isEmpty:$a,showStopLabel:!0}),e[78]=Z,e[79]=X,e[80]=he,e[81]=$a,e[82]=bt):bt=e[82];let xt;e[83]!==yt||e[84]!==vt||e[85]!==_t||e[86]!==bt?(xt=(0,k.jsxs)("div",{className:"flex flex-row items-center",children:[yt,vt,_t,bt]}),e[83]=yt,e[84]=vt,e[85]=_t,e[86]=bt,e[87]=xt):xt=e[87];let Qt;e[88]!==gt||e[89]!==xt?(Qt=(0,k.jsxs)("div",{className:"px-3 pt-1 flex flex-row items-center justify-between",children:[gt,xt]}),e[88]=gt,e[89]=xt,e[90]=Qt):Qt=e[90];let Da=Qt,Xt;e[91]===Symbol.for("react.memo_cache_sentinel")?(Xt=za("flex flex-col w-full py-2"),e[91]=Xt):Xt=e[91];let ea;return e[92]!==Da||e[93]!==La?(ea=(0,k.jsxs)("div",{className:Xt,children:[La,Da]}),e[92]=Da,e[93]=La,e[94]=ea):ea=e[94],ea},di=t=>{let e=(0,ii.c)(35),{value:a,placeholder:r,inputRef:s,className:n,onChange:o,onSubmit:i,onKeyDown:l,onClose:d,onAddFiles:u,additionalCompletions:c,maxHeight:f}=t,m=i,b=d,g=Kr(),{theme:p}=Co(),h;e[0]===c?h=e[1]:(h=oe=>c?Nu([c.triggerCompletionRegex],c.completions)(oe):null,e[0]=c,e[1]=h);let v=Hr(h),T,C,S,P;if(e[2]!==v||e[3]!==u||e[4]!==g){let oe=ko();e[9]===Symbol.for("react.memo_cache_sentinel")?(T=io({}),e[9]=T):T=e[9],C=oe,S=Tc({language:oe.language,store:g,onAddFiles:u}),P=oe.language.data.of({autocomplete:v}),e[2]=v,e[3]=u,e[4]=g,e[5]=T,e[6]=C,e[7]=S,e[8]=P}else T=e[5],C=e[6],S=e[7],P=e[8];let D;e[10]===Symbol.for("react.memo_cache_sentinel")?(D=oc({storage:{load:Nc,save:jc}}),e[10]=D):D=e[10];let N;e[11]===Symbol.for("react.memo_cache_sentinel")?(N=jo(),e[11]=N):N=e[11];let K;e[12]===m?K=e[13]:(K=os.highest(na.of([{preventDefault:!0,stopPropagation:!0,any:(oe,ee)=>{let Le=ee.metaKey||ee.ctrlKey||ee.shiftKey;if(ee.key==="Enter"&&!Le)return m(ee,oe.state.doc.toString()),ee.preventDefault(),ee.stopPropagation(),!0;if(ee.key==="Enter"&&ee.shiftKey){let Oe=oe.state.selection.main.from;return oe.dispatch({changes:{from:Oe,to:Oe,insert:`
`},selection:{anchor:Oe+1,head:Oe+1}}),ee.preventDefault(),ee.stopPropagation(),!0}return!1}}])),e[12]=m,e[13]=K);let j;e[14]===b?j=e[15]:(j=na.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(b(),!0)}]),e[14]=b,e[15]=j);let W;e[16]!==T||e[17]!==C||e[18]!==S||e[19]!==P||e[20]!==K||e[21]!==j?(W=[T,C,S,P,D,ls.lineWrapping,N,K,j],e[16]=T,e[17]=C,e[18]=S,e[19]=P,e[20]=K,e[21]=j,e[22]=W):W=e[22];let X=W,te;e[23]===n?te=e[24]:(te=za("flex-1 font-sans overflow-auto my-1",n),e[23]=n,e[24]=te);let ae=p==="dark"?"dark":"light",G=r||"Generate with AI, @ to include context",Z;return e[25]!==X||e[26]!==s||e[27]!==f||e[28]!==o||e[29]!==l||e[30]!==te||e[31]!==ae||e[32]!==G||e[33]!==a?(Z=(0,k.jsx)(Mo,{ref:s,className:te,width:"100%",maxHeight:f,value:a,basicSetup:!1,extensions:X,onChange:o,onKeyDown:l,theme:ae,placeholder:G}),e[25]=X,e[26]=s,e[27]=f,e[28]=o,e[29]=l,e[30]=te,e[31]=ae,e[32]=G,e[33]=a,e[34]=Z):Z=e[34],Z};function Rc(t){Va({title:"Generate with AI failed",description:To(t)})}function Nc(){return li.get(oi)}function jc(t){return li.set(oi,t)}export{pt as A,Pr as C,Su as D,Fn as E,ys as F,gs as I,fs as L,yu as M,gr as N,$n as O,Sd as P,hs as R,Wu as S,Zn as T,Wn as _,ni as a,Jn as b,Hn as c,Kn as d,Yn as f,Hu as g,Bn as h,Ic as i,Rn as j,Au as k,Gn as l,qn as m,di as n,ri as o,Vn as p,si as r,Xn as s,Oc as t,tc as u,Xu as v,qt as w,Lr as x,Gu as y};
