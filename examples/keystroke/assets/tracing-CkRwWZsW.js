import{s as O}from"./chunk-LvLJmgfZ.js";import{c as q,d as Z,l as ee}from"./jotai-D74Ef_p1.js";import{t as te}from"./react-XTZdWHwa.js";import{H as U,k as re}from"./cells-B1ds6ZjK.js";import"./react-dom-BZDtXk6t.js";import"./zod-BBqism5D.js";import{t as ie}from"./compiler-runtime-QczY1yfQ.js";import"./_Uint8Array-BGESiCQL.js";import"./isSymbol-BGkTcW3U.js";import"./toString-DlRqgfqz.js";import"./toNumber-GB_lFVaq.js";import"./toInteger-Cl1doThW.js";import"./isArrayLikeObject-BkJc8lDE.js";import"./_getTag-BWqNuuwU.js";import"./_baseIsEqual-C8v2yRqO.js";import"./merge-DVX6Ez37.js";import"./_baseSlice-CskhCEVH.js";import"./useLifecycle-bYJVBwo9.js";import"./_hasUnicode-BC4vb_bF.js";import"./_arrayReduce-BPS6ICyD.js";import"./type-Bx7IFbhF.js";import"./_baseProperty-Bl8lQyHQ.js";import"./now-DBnXnRPe.js";import"./debounce-BzCP2SOK.js";import"./hotkeys-sK-kaEBC.js";import"./invariant-EWlZS5z8.js";import"./utils-Clm_pCuX.js";import"./constants-Bt6NlroV.js";import"./config-BwUC_LRl.js";import"./useEventListener-BMXqdHZ5.js";import{t as le}from"./jsx-runtime-B4_2-8Ho.js";import"./button-BtVgadIf.js";import"./clsx-CGw3WJH5.js";import{t as se}from"./cn-f3ruLt4G.js";import"./dist-hQAzR0Cy.js";import"./dist-BWV-5FQQ.js";import"./once-DF3Ybce_.js";import"./capabilities-DPEuN0Kv.js";import"./cjs-VdEqhsWH.js";import"./createReducer-uDMmKGBt.js";import"./requests-CMMs4cl8.js";import"./dist-a5AhnPua.js";import"./dist-AYL4p4Dn.js";import{t as oe}from"./createLucideIcon-C9QGcv--.js";import{t as ae}from"./activity-BOAUebep.js";import{n as me,r as V}from"./CellStatus-BF6SIoRw.js";import"./check-Pczj-rmu.js";import{_ as ne}from"./select-Dre1F6mo.js";import{t as pe}from"./chevron-right-Cn1LhTdd.js";import{t as de}from"./circle-check-B2gq4hw1.js";import{t as ce}from"./circle-play-BbAdVNT1.js";import"./toDate-J43JkZRd.js";import{t as ue}from"./circle-x-72ItD0Ur.js";import"./ellipsis-BzzfoNv3.js";import"./DeferredRequestRegistry-DUZWfqOX.js";import"./refresh-cw-DHav_aX8.js";import"./input-fjIzfaON.js";import"./workflow-DpU95Ph-.js";import"./badge-DjEl44tW.js";import"./preload-helper-WDmkW-6F.js";import"./dist-BFZNB01C.js";import"./dist-DjRxw7g7.js";import"./dist-BRKC9vDH.js";import"./dist-C2lGLtUJ.js";import"./dist-CiIxDFsH.js";import"./stex-BQjjdb1n.js";import"./Deferred-cELqHKYi.js";import"./uuid-DFgsIVBI.js";import"./use-toast-CTk3v2Fk.js";import"./main-B1nOh376.js";import"./useNonce-BPtPhVM4.js";import"./connection-DZfQ0nfK.js";import{n as he}from"./useTheme-DNzypnwR.js";import"./Combination-DIF6wDxT.js";import"./dist-DTKIwXcy.js";import{t as A}from"./tooltip-DEUNsdbK.js";import"./menu-items-QU91GQzu.js";import"./en-US-DZkKelDe.js";import"./alert-dialog-CYJZg0vV.js";import"./dialog-C-S4uQH4.js";import"./usePress-CuSksPzr.js";import"./SSRProvider-DrIPqn2D.js";import"./useDateFormatter-BQepJAoC.js";import"./context-C5uPODSj.js";import"./useNumberFormatter-C1aNc7b4.js";import"./numbers-BWXaNlZC.js";import"./useEvent-bc5jSpSz.js";import"./useDebounce-Dz48GAub.js";import"./ImperativeModal-DD50EU1G.js";import"./vega-loader.browser-DUgPL0IU.js";import"./precisionRound-BdwMj645.js";import"./linear-BQs_BJbB.js";import{r as fe,t as xe}from"./react-vega-BAaWsGgr.js";import"./ordinal-6cy7Wi6n.js";import"./time-BI36HTF4.js";import"./range-CBESds6M.js";import"./defaultLocale-9ao8Dcla.js";import"./defaultLocale-Bu1vZnwX.js";import{t as ve}from"./cell-link-ByqSnfe2.js";import{t as ge}from"./bundle.esm-CBRGmh5t.js";import{t as je}from"./empty-state-Q1kmIC8W.js";import"./timer-CjInJf90.js";import"./multi-icon-Du4jZia9.js";import{t as ye}from"./clear-button-BKX-NUB4.js";import{n as Ie,t as Se}from"./runs-ktQuNucz.js";import"./path-Whqm9ggf.js";import"./math-CJEhL5Or.js";import"./arc-Ds_Zv0QO.js";import"./array-BLCDwreq.js";import"./step-Cy9SLim8.js";import"./line-BXY1-slS.js";import"./init-MQWkw9UL.js";import"./colors-DdaNPisK.js";import"./treemap-C4MB7fhl.js";var be=oe("circle-ellipsis",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M17 12h.01",key:"1m0b6t"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M7 12h.01",key:"eqddd0"}]]),z=ie(),P=O(te(),1);const G="hoveredCellId",J="cellHover";var Ne="cellNum",K="cell",F="startTimestamp",W="endTimestamp",Y="status";function Te(t,e,r,s){let o="hoursminutessecondsmilliseconds";return{$schema:"https://vega.github.io/schema/vega-lite/v6.json",background:s==="dark"?"black":void 0,mark:{type:"bar",cornerRadius:2},params:[{name:G,bind:{element:`#${e}`}},{name:J,select:{type:"point",on:"mouseover",fields:[K],clear:"mouseout"}}],height:{step:r==="sideBySide"?26:21},encoding:{y:{field:Ne,scale:{paddingInner:.2},sort:{field:"sortPriority"},title:"cell",axis:r==="sideBySide"?null:void 0},x:{field:F,type:"temporal",axis:{orient:"top",title:null}},x2:{field:W,type:"temporal"},tooltip:[{field:F,type:"temporal",timeUnit:o,title:"Start"},{field:W,type:"temporal",timeUnit:o,title:"End"}],size:{value:{expr:`${G} == toString(datum.${K}) ? 19.5 : 18`}},color:{field:Y,scale:{domain:["success","error"],range:["#37BE5F","red"]},legend:null}},data:{values:t},transform:[{calculate:`datum.${Y} === 'queued' ? 9999999999999 : datum.${F}`,as:"sortPriority"}],config:{view:{stroke:"transparent"}}}}function Q(t){try{let e=new Date(t*1e3);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}.${String(e.getMilliseconds()).padStart(3,"0")}`}catch{return""}}var i=O(le(),1),X=Z(new Map);const ke=()=>{let t=(0,z.c)(28),{runIds:e,runMap:r}=q(Se),s=q(X),{clearRuns:o}=Ie(),{theme:a}=he(),[l,b]=(0,P.useState)("above"),h;t[0]===l?h=t[1]:(h=()=>{b(l==="above"?"sideBySide":"above")},t[0]=l,t[1]=h);let p=h;if(e.length===0){let c;return t[2]===Symbol.for("react.memo_cache_sentinel")?(c=(0,i.jsx)(je,{title:"No traces",description:(0,i.jsx)("span",{children:"Cells that have ran will appear here."}),icon:(0,i.jsx)(ae,{})}),t[2]=c):c=t[2],c}let d;t[3]===Symbol.for("react.memo_cache_sentinel")?(d=(0,i.jsx)("label",{htmlFor:"chartPosition",className:"text-xs",children:"Inline chart"}),t[3]=d):d=t[3];let x=l==="sideBySide",u;t[4]!==x||t[5]!==p?(u=(0,i.jsxs)("div",{className:"flex flex-row gap-1 items-center",children:[d,(0,i.jsx)("input",{type:"checkbox",name:"chartPosition","data-testid":"chartPosition",onClick:p,defaultChecked:x,className:"h-3 cursor-pointer"})]}),t[4]=x,t[5]=p,t[6]=u):u=t[6];let m;t[7]===o?m=t[8]:(m=(0,i.jsx)(ye,{dataTestId:"clear-traces-button",onClick:o}),t[7]=o,t[8]=m);let f;t[9]!==u||t[10]!==m?(f=(0,i.jsxs)("div",{className:"flex flex-row justify-end gap-3",children:[u,m]}),t[9]=u,t[10]=m,t[11]=f):f=t[11];let v;if(t[12]!==l||t[13]!==s||t[14]!==e||t[15]!==r||t[16]!==a){let c;t[18]!==l||t[19]!==s||t[20]!==r||t[21]!==a?(c=(I,S)=>{let n=r.get(I);return n?(0,i.jsx)(we,{run:n,isExpanded:s.get(n.runId),isMostRecentRun:S===0,chartPosition:l,theme:a},n.runId):null},t[18]=l,t[19]=s,t[20]=r,t[21]=a,t[22]=c):c=t[22],v=e.map(c),t[12]=l,t[13]=s,t[14]=e,t[15]=r,t[16]=a,t[17]=v}else v=t[17];let g;t[23]===v?g=t[24]:(g=(0,i.jsx)("div",{className:"flex flex-col gap-3",children:v}),t[23]=v,t[24]=g);let y;return t[25]!==f||t[26]!==g?(y=(0,i.jsxs)("div",{className:"py-1 px-2 overflow-y-scroll",children:[f,g]}),t[25]=f,t[26]=g,t[27]=y):y=t[27],y};var we=({run:t,isMostRecentRun:e,chartPosition:r,isExpanded:s,theme:o})=>{let a=ee(X);s??(s=e);let l=()=>{a(p=>{let d=new Map(p);return d.set(t.runId,!s),d})},b=(0,i.jsx)(s?ne:pe,{height:16,className:"inline"}),h=(0,i.jsxs)("span",{className:"text-sm cursor-pointer",onClick:l,children:["Run - ",U(t.runStartTime),b]});return s?(0,i.jsx)(Re,{run:t,chartPosition:r,theme:o,title:h},t.runId):(0,i.jsx)("div",{className:"flex flex-col",children:(0,i.jsx)("pre",{className:"font-mono font-semibold",children:h})},t.runId)},Re=t=>{let e=(0,z.c)(40),{run:r,chartPosition:s,theme:o,title:a}=t,[l,b]=(0,P.useState)(),h=(0,P.useRef)(null),{ref:p,width:d}=ge(),x=d===void 0?300:d,u=re(),m,f;if(e[0]!==u||e[1]!==s||e[2]!==r.cellRuns||e[3]!==r.runId||e[4]!==o){let k=[...r.cellRuns.values()].map(j=>{let R=j.elapsedTime??0;return{cell:j.cellId,cellNum:u.inOrderIds.indexOf(j.cellId),startTimestamp:Q(j.startTime),endTimestamp:Q(j.startTime+R),elapsedTime:V(R*1e3),status:j.status}});m=`hiddenInputElement-${r.runId}`,f=fe(Te(k,m,s,o)),e[0]=u,e[1]=s,e[2]=r.cellRuns,e[3]=r.runId,e[4]=o,e[5]=m,e[6]=f}else m=e[5],f=e[6];let v=f.spec,g=o==="dark"?"dark":void 0,y=x-50,c=s==="above"?120:100,I;e[7]!==g||e[8]!==y||e[9]!==c?(I={theme:g,width:y,height:c,actions:!1,mode:"vega",renderer:"canvas"},e[7]=g,e[8]=y,e[9]=c,e[10]=I):I=e[10];let S;e[11]!==I||e[12]!==v?(S={ref:h,spec:v,options:I},e[11]=I,e[12]=v,e[13]=S):S=e[13];let n=xe(S),N;e[14]===(n==null?void 0:n.view)?N=e[15]:(N=()=>{let k=[{signalName:J,handler:(j,R)=>{var L;let C=(L=R.cell)==null?void 0:L[0];b(C??null)}}];return k.forEach(j=>{let{signalName:R,handler:C}=j;n==null||n.view.addSignalListener(R,C)}),()=>{k.forEach(j=>{let{signalName:R,handler:C}=j;n==null||n.view.removeSignalListener(R,C)})}},e[14]=n==null?void 0:n.view,e[15]=N);let T;e[16]===n?T=e[17]:(T=[n],e[16]=n,e[17]=T),(0,P.useEffect)(N,T);let w;e[18]!==m||e[19]!==l||e[20]!==r?(w=(0,i.jsx)(Me,{run:r,hoveredCellId:l,hiddenInputElementId:m}),e[18]=m,e[19]=l,e[20]=r,e[21]=w):w=e[21];let M=w,D=s==="sideBySide"?"-mt-0.5 flex-1":"",E;e[22]===Symbol.for("react.memo_cache_sentinel")?(E=(0,i.jsx)(P.Suspense,{children:(0,i.jsx)("div",{ref:h})}),e[22]=E):E=e[22];let B;e[23]!==p||e[24]!==D?(B=(0,i.jsx)("div",{className:D,ref:p,children:E}),e[23]=p,e[24]=D,e[25]=B):B=e[25];let $=B;if(s==="above"){let k;e[26]!==$||e[27]!==a||e[28]!==M?(k=(0,i.jsxs)("pre",{className:"font-mono font-semibold",children:[a,$,M]}),e[26]=$,e[27]=a,e[28]=M,e[29]=k):k=e[29];let j;return e[30]!==r.runId||e[31]!==k?(j=(0,i.jsx)("div",{className:"flex flex-col",children:k},r.runId),e[30]=r.runId,e[31]=k,e[32]=j):j=e[32],j}let _;e[33]!==a||e[34]!==M?(_=(0,i.jsxs)("pre",{className:"font-mono font-semibold",children:[a,M]}),e[33]=a,e[34]=M,e[35]=_):_=e[35];let H;return e[36]!==$||e[37]!==r.runId||e[38]!==_?(H=(0,i.jsxs)("div",{className:"flex flex-row",children:[_,$]},r.runId),e[36]=$,e[37]=r.runId,e[38]=_,e[39]=H):H=e[39],H},Me=t=>{let e=(0,z.c)(12),{run:r,hoveredCellId:s,hiddenInputElementId:o}=t,a=(0,P.useRef)(null),l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=m=>{a.current&&(a.current.value=String(m),a.current.dispatchEvent(new Event("input",{bubbles:!0})))},e[0]=l):l=e[0];let b=l,h=s||"",p;e[1]!==o||e[2]!==h?(p=(0,i.jsx)("input",{type:"text",id:o,defaultValue:h,hidden:!0,ref:a}),e[1]=o,e[2]=h,e[3]=p):p=e[3];let d;e[4]===r.cellRuns?d=e[5]:(d=[...r.cellRuns.values()],e[4]=r.cellRuns,e[5]=d);let x;e[6]!==s||e[7]!==d?(x=d.map(m=>(0,i.jsx)(_e,{cellRun:m,hovered:m.cellId===s,dispatchHoverEvent:b},m.cellId)),e[6]=s,e[7]=d,e[8]=x):x=e[8];let u;return e[9]!==p||e[10]!==x?(u=(0,i.jsxs)("div",{className:"text-xs mt-0.5 ml-3 flex flex-col gap-0.5",children:[p,x]}),e[9]=p,e[10]=x,e[11]=u):u=e[11],u},$e={success:(0,i.jsx)(de,{color:"green",size:14}),running:(0,i.jsx)(ce,{color:"var(--blue-10)",size:14}),error:(0,i.jsx)(ue,{color:"red",size:14}),queued:(0,i.jsx)(be,{color:"grey",size:14})},_e=t=>{let e=(0,z.c)(39),{cellRun:r,hovered:s,dispatchHoverEvent:o}=t,a;e[0]===r.elapsedTime?a=e[1]:(a=r.elapsedTime?V(r.elapsedTime*1e3):"-",e[0]=r.elapsedTime,e[1]=a);let l=a,b;e[2]!==r.elapsedTime||e[3]!==l?(b=r.elapsedTime?(0,i.jsxs)("span",{children:["This cell took ",(0,i.jsx)(me,{elapsedTime:l})," to run"]}):(0,i.jsx)("span",{children:"This cell has not been run"}),e[2]=r.elapsedTime,e[3]=l,e[4]=b):b=e[4];let h=b,p;e[5]!==r.cellId||e[6]!==o?(p=()=>{o(r.cellId)},e[5]=r.cellId,e[6]=o,e[7]=p):p=e[7];let d=p,x;e[8]===o?x=e[9]:(x=()=>{o(null)},e[8]=o,e[9]=x);let u=x,m=s&&"bg-(--gray-3) opacity-100",f;e[10]===m?f=e[11]:(f=se("flex flex-row gap-2 py-1 px-1 opacity-70 hover:bg-(--gray-3) hover:opacity-100",m),e[10]=m,e[11]=f);let v;e[12]===r.startTime?v=e[13]:(v=U(r.startTime),e[12]=r.startTime,e[13]=v);let g;e[14]===v?g=e[15]:(g=(0,i.jsxs)("span",{className:"text-(--gray-10) dark:text-(--gray-11)",children:["[",v,"]"]}),e[14]=v,e[15]=g);let y;e[16]===r.cellId?y=e[17]:(y=(0,i.jsxs)("span",{className:"text-(--gray-10) w-16",children:["(",(0,i.jsx)(ve,{cellId:r.cellId}),")"]}),e[16]=r.cellId,e[17]=y);let c;e[18]===r.code?c=e[19]:(c=(0,i.jsx)("span",{className:"w-40 truncate -ml-1",children:r.code}),e[18]=r.code,e[19]=c);let I;e[20]===l?I=e[21]:(I=(0,i.jsx)("span",{className:"text-(--gray-10) dark:text-(--gray-11)",children:l}),e[20]=l,e[21]=I);let S;e[22]!==h||e[23]!==I?(S=(0,i.jsx)(A,{content:h,children:I}),e[22]=h,e[23]=I,e[24]=S):S=e[24];let n=$e[r.status],N;e[25]!==r.status||e[26]!==n?(N=(0,i.jsx)(A,{content:r.status,children:n}),e[25]=r.status,e[26]=n,e[27]=N):N=e[27];let T;e[28]!==S||e[29]!==N?(T=(0,i.jsxs)("div",{className:"flex flex-row gap-1 w-16 justify-end -ml-2",children:[S,N]}),e[28]=S,e[29]=N,e[30]=T):T=e[30];let w;return e[31]!==d||e[32]!==u||e[33]!==c||e[34]!==T||e[35]!==f||e[36]!==g||e[37]!==y?(w=(0,i.jsxs)("div",{className:f,onMouseEnter:d,onMouseLeave:u,children:[g,y,c,T]}),e[31]=d,e[32]=u,e[33]=c,e[34]=T,e[35]=f,e[36]=g,e[37]=y,e[38]=w):w=e[38],w};export{ke as Tracing};
