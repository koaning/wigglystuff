import{s as j}from"./chunk-LvLJmgfZ.js";import{c as P,l as w,s as A}from"./jotai-D74Ef_p1.js";import{Ar as b,Vr as L,in as O,j as y,k as E,mt as S,qt as T,w as $}from"./cells-B1ds6ZjK.js";import{t as _}from"./compiler-runtime-QczY1yfQ.js";import{u as q}from"./hotkeys-sK-kaEBC.js";import{u as D}from"./utils-Clm_pCuX.js";import{n as I}from"./constants-Bt6NlroV.js";import{f as F}from"./config-BwUC_LRl.js";import{t as H}from"./jsx-runtime-B4_2-8Ho.js";import{t as V}from"./cn-f3ruLt4G.js";import{r as B}from"./requests-CMMs4cl8.js";import{s as M,t as R}from"./connection-DZfQ0nfK.js";import{n as U}from"./useEvent-bc5jSpSz.js";import{n as z}from"./ImperativeModal-DD50EU1G.js";var G=_();function N(){return P(b)}function J(){let r=(0,G.c)(5),[t]=A(R),e=w(b),{openAlert:o}=z(),{sendRename:a}=B(),s;return r[0]!==t.state||r[1]!==o||r[2]!==a||r[3]!==e?(s=async l=>{let n=D();return t.state===M.OPEN?(F(i=>{l===null?i.delete(I.filePath):i.set(I.filePath,l)}),a({filename:l}).then(()=>(e(l),document.title=n.app_title||T.basename(l)||"Untitled Notebook",l)).catch(i=>(o(i.message),null))):(o("Failed to save notebook: not connected to a kernel."),null)},r[0]=t.state,r[1]=o,r[2]=a,r[3]=e,r[4]=s):s=r[4],U(s)}var p=_(),v=j(H(),1);const k=r=>{let t=(0,p.c)(12),{className:e,cellId:o,variant:a,onClick:s,formatCellName:l,skipScroll:n}=r,i=y()[o]??"",C=E().inOrderIds.indexOf(o),{showCellIfHidden:f}=$(),g=l??W,c;t[0]===e?c=t[1]:(c=V("inline-block cursor-pointer text-link hover:underline",e),t[0]=e,t[1]=c);let m;t[2]!==o||t[3]!==s||t[4]!==f||t[5]!==n||t[6]!==a?(m=h=>{if(o==="__scratch__")return!1;f({cellId:o}),h.stopPropagation(),h.preventDefault(),requestAnimationFrame(()=>{x(o,a,n)&&(s==null||s())})},t[2]=o,t[3]=s,t[4]=f,t[5]=n,t[6]=a,t[7]=m):m=t[7];let d=g(S(i,C)),u;return t[8]!==c||t[9]!==m||t[10]!==d?(u=(0,v.jsx)("div",{className:c,role:"link",tabIndex:-1,onClick:m,children:d}),t[8]=c,t[9]=m,t[10]=d,t[11]=u):u=t[11],u},K=r=>{let t=(0,p.c)(2),e;return t[0]===r?e=t[1]:(e=(0,v.jsx)(k,{...r,variant:"destructive"}),t[0]=r,t[1]=e),e},Q=r=>{let t=(0,p.c)(10),{cellId:e,lineNumber:o}=r,a=N(),s;t[0]!==e||t[1]!==o?(s=()=>O(e,o),t[0]=e,t[1]=o,t[2]=s):s=t[2];let l;t[3]!==e||t[4]!==a?(l=i=>e==="__scratch__"?"scratch":`marimo://${a||"untitled"}#cell=${i}`,t[3]=e,t[4]=a,t[5]=l):l=t[5];let n;return t[6]!==e||t[7]!==s||t[8]!==l?(n=(0,v.jsx)(k,{cellId:e,onClick:s,skipScroll:!0,variant:"destructive",className:"traceback-cell-link",formatCellName:l}),t[6]=e,t[7]=s,t[8]=l,t[9]=n):n=t[9],n};function x(r,t,e){let o=L.create(r),a=document.getElementById(o);return a===null?(q.error(`Cell ${o} not found on page.`),!1):(e||a.scrollIntoView({behavior:"smooth",block:"center"}),t==="destructive"&&(a.classList.add("error-outline"),setTimeout(()=>{a.classList.remove("error-outline")},2e3)),t==="focus"&&(a.classList.add("focus-outline"),setTimeout(()=>{a.classList.remove("focus-outline")},2e3)),!0)}function W(r){return r}export{N as a,x as i,K as n,J as o,Q as r,k as t};
