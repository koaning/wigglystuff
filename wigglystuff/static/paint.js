import*as d from"react";import*as Y from"react-dom/client";var U=d.createContext(null);function re(){let a=d.useContext(U);if(!a)throw new Error("RenderContext not found");return a}function ne(){return re().model}function E(a){let c=ne(),[w,m]=d.useState(c.get(a));return d.useEffect(()=>{let g=()=>m(c.get(a));return c.on(`change:${a}`,g),()=>c.off(`change:${a}`,g)},[c,a]),[w,g=>{c.set(a,g),c.save_changes()}]}function _(a){return({el:c,model:w,experimental:m})=>{let g=Y.createRoot(c);return g.render(d.createElement(d.StrictMode,null,d.createElement(U.Provider,{value:{model:w,experimental:m}},d.createElement(a)))),()=>g.unmount()}}import ae,{useRef as F,useState as v,useEffect as k}from"react";import{jsx as r,jsxs as u}from"react/jsx-runtime";var h=ae.forwardRef(({className:a="",variant:c="default",...w},m)=>r("button",{ref:m,className:`inline-flex items-center justify-center rounded-md text-sm font-medium focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50 ${{default:"bg-gray-200 active:bg-gray-300",ghost:"active:bg-gray-100/50"}[c]} ${a}`,...w}));h.displayName="Button";var oe=["#000000","#FFFFFF","#C0C0C0","#FF0000","#FFFF00","#00FF00","#00FFFF","#0000FF","#FF00FF","#FFFF80","#00FF80","#80FFFF","#8080FF","#FF0080"],se=4096;function ie(){let a=F(null),c=F(null),[w,m]=v(!1),[g,D]=v("#000000"),[x,T]=v("brush"),[S,P]=v({x:0,y:0}),[V,H]=v(!1),[I,f]=v(null),[b,q]=E("base64"),[G,le]=E("height"),[M,J]=E("store_background"),[y,$]=v({width:0,height:0}),R=()=>a.current?.getContext("2d"),z=(e,n)=>{let t=R();if(!t)return!1;let o=Math.min(1,se/Math.max(e,n)),s=Math.floor(e*o),l=Math.floor(n*o);try{let i=a.current?.toDataURL();if(a.current.width=s,a.current.height=l,i){let N=new Image;N.onload=()=>{t.drawImage(N,0,0)},N.src=i}return!0}catch(i){return console.error("Failed to resize canvases:",i),f("Failed to resize canvas. Try reducing the window size."),!1}};k(()=>{let e,n=()=>{let o=a.current?.parentElement;if(!o)return;let s=o.clientWidth,l=o.clientHeight;if(C.current){let i=new Image;i.onload=()=>{let N=i.width/i.height,de=s/l;s=Math.min(s,i.width),l=i.height,z(s,l)&&$({width:s,height:l})},i.src=`data:image/png;base64,${C.current}`}else z(s,l)&&$({width:s,height:l})},t=()=>{clearTimeout(e),e=setTimeout(n,250)};return window.addEventListener("resize",t),n(),()=>{window.removeEventListener("resize",t),clearTimeout(e)}},[]),k(()=>{let e=a.current;if(!e)return;let n=s=>{s.preventDefault();let l=s.touches[0],i=e.getBoundingClientRect();O(l.clientX-i.left,l.clientY-i.top)},t=s=>{s.preventDefault();let l=s.touches[0],i=e.getBoundingClientRect();X(l.clientX-i.left,l.clientY-i.top)},o=s=>{s.preventDefault(),B()};return e.addEventListener("touchstart",n),e.addEventListener("touchmove",t),e.addEventListener("touchend",o),()=>{e.removeEventListener("touchstart",n),e.removeEventListener("touchmove",t),e.removeEventListener("touchend",o)}},[]);let W=F(""),p=F(!1),C=F(""),[A,L]=v(0);k(()=>{C.current=b},[]);let O=(e,n)=>{let t=R();if(t)try{t.beginPath(),t.moveTo(e,n),m(!0)}catch(o){console.error("Failed to start drawing:",o),f("Failed to start drawing. Try refreshing the page.")}},X=(e,n)=>{if(!w)return;let t=R();if(t)try{t.lineTo(e,n),x==="eraser"?(t.save(),t.globalCompositeOperation="destination-out",t.strokeStyle="#000000",t.lineWidth=20,t.lineCap="round",t.stroke(),t.restore()):(t.strokeStyle=g,t.lineWidth=x==="marker"?8:2,t.lineCap="round",t.stroke())}catch(o){console.error("Failed to draw:",o),f("Failed to draw. Try refreshing the page."),m(!1)}},B=()=>{if(w){try{L(e=>e+1)}catch(e){console.error("Failed to complete drawing:",e),f("Failed to complete drawing. Try refreshing the page.")}m(!1)}};k(()=>{let e=R();if(!e||!a.current||!b)return;if(b===W.current){let o=a.current;if(o&&o.width>0&&o.height>0)try{if(e.getImageData(0,0,o.width,o.height).data.some(i=>i!==0))return}catch{}}let n=a.current;if(n.width===0||n.height===0)return;p.current=!0;let t=new Image;t.onload=()=>{e.clearRect(0,0,n.width,n.height),e.drawImage(t,0,0,t.width,t.height),W.current=b,p.current=!1},t.onerror=o=>{console.error("Failed to load image:",o),p.current=!1},t.src=`data:image/png;base64,${b}`},[b,y.width,y.height]),k(()=>{if(!a.current||A===0||p.current)return;let e=document.createElement("canvas");e.width=a.current.width,e.height=a.current.height;let n=e.getContext("2d",{alpha:!0});if(n){n.clearRect(0,0,e.width,e.height),M&&(n.fillStyle="#FFFFFF",n.fillRect(0,0,e.width,e.height)),n.globalCompositeOperation="source-over",n.drawImage(a.current,0,0);try{let t=e.toDataURL("image/png");q(t.split(",")[1])}catch(t){console.error("Failed to export canvas:",t),f("Failed to export canvas. Try refreshing the page.")}}},[M,y,A]);let K=e=>{let n=e.currentTarget.getBoundingClientRect();O(e.clientX-n.left,e.clientY-n.top)},Q=e=>{let n=e.currentTarget.getBoundingClientRect();X(e.clientX-n.left,e.clientY-n.top)},Z=e=>{H(!0),P({x:e.clientX-(c.current?.offsetLeft||0),y:e.clientY-(c.current?.offsetTop||0)})},ee=e=>{if(V){let n=e.clientX-S.x,t=e.clientY-S.y;c.current&&(c.current.style.left=`${n}px`,c.current.style.top=`${t}px`)}},j=()=>{H(!1)},te=()=>u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),r("rect",{x:"7",y:"7",width:"10",height:"10",rx:"1",ry:"1",fill:"currentColor",fillOpacity:"0.2"})]});return u("div",{className:"bg-teal-600 w-full overflow-hidden",style:{height:`${G}px`},children:[I&&u("div",{className:"absolute top-0 left-0 right-0 bg-red-500 text-white p-2 text-center",children:[I,r("button",{className:"ml-2 underline",onClick:()=>f(null),children:"Dismiss"})]}),u("div",{ref:c,className:"absolute bg-white border-2 border-gray-200 shadow-md flex flex-col",style:{width:"90%",height:"90%",left:"50%",top:"50%",transform:"translate(-50%, -50%)",minWidth:"400px",minHeight:"300px"},children:[u("div",{className:"bg-blue-900 text-white px-2 py-1 flex justify-between items-center cursor-move",onMouseDown:Z,onMouseMove:ee,onMouseUp:j,onMouseLeave:j,children:[r("span",{className:"text-white",children:"untitled - Paint"}),u("div",{className:"flex gap-1",children:[r(h,{variant:"ghost",className:"h-5 w-5 p-0 min-w-0 text-white hover:bg-blue-700",children:"_"}),r(h,{variant:"ghost",className:"h-5 w-5 p-0 min-w-0 text-white hover:bg-blue-700",children:"\u25A1"}),r(h,{variant:"ghost",className:"h-5 w-5 p-0 min-w-0 text-white hover:bg-blue-700",children:"\xD7"})]})]}),u("div",{className:"bg-gray-300 px-2 py-1 text-sm text-black",children:[r("span",{className:"mr-4 text-black",children:"File"}),r("span",{className:"mr-4 text-black",children:"Edit"}),r("span",{className:"mr-4 text-black",children:"View"}),r("span",{className:"mr-4 text-black",children:"Image"}),r("span",{className:"mr-4 text-black",children:"Options"}),r("span",{className:"text-black",children:"Help"})]}),u("div",{className:"flex flex-1 min-h-0",children:[u("div",{className:"w-8 bg-gray-300 p-0.5 border-r border-gray-400",children:[r(h,{variant:"ghost",className:`w-7 h-7 p-0 min-w-0 mb-0.5 ${x==="brush"?"bg-gray-300 border border-gray-400 shadow-inner":""}`,onClick:()=>T("brush"),title:"Brush",children:r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-black",children:r("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})})}),r(h,{variant:"ghost",className:`w-7 h-7 p-0 min-w-0 mb-0.5 ${x==="marker"?"bg-gray-300 border border-gray-400 shadow-inner":""}`,onClick:()=>T("marker"),title:"Thick Marker",children:r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-black",children:r("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})})}),r(h,{variant:"ghost",className:`w-7 h-7 p-0 min-w-0 mb-0.5 ${x==="eraser"?"bg-gray-300 border border-gray-400 shadow-inner":""}`,onClick:()=>T("eraser"),title:"Eraser",children:u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-black",children:[r("path",{d:"M7 21h10"}),r("path",{d:"M5.5 13.5L13 6c.83-.83 2.17-.83 3 0l2 2c.83.83.83 2.17 0 3l-7.5 7.5c-.83.83-2.17.83-3 0l-2-2c-.83-.83-.83-2.17 0-3z"})]})}),r("div",{className:"w-7 h-0.5 bg-gray-400 my-1"}),r(h,{variant:"ghost",className:`w-7 h-7 p-0 min-w-0 mb-0.5 ${M?"bg-gray-300 border border-gray-400 shadow-inner":""}`,onClick:()=>J(!M),title:"Store White Background",children:r(te,{})}),r("div",{className:"w-7 h-0.5 bg-gray-400 my-1"}),r(h,{variant:"ghost",className:"w-7 h-7 p-0 min-w-0 mb-0.5",onClick:()=>{let e=a.current;if(e){let n=e.getContext("2d");if(n)if(n.clearRect(0,0,e.width,e.height),C.current){p.current=!0;let t=new Image;t.onload=()=>{n.drawImage(t,0,0,t.width,t.height),p.current=!1,L(o=>o+1)},t.onerror=()=>{p.current=!1,L(o=>o+1)},t.src=`data:image/png;base64,${C.current}`}else L(t=>t+1)}},title:"Clear Canvas",children:u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-black",children:[r("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),r("path",{d:"M21 3v5h-5"}),r("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),r("path",{d:"M8 16H3v5"})]})})]}),r("div",{className:"flex-grow overflow-hidden border border-gray-400 relative",children:r("canvas",{ref:a,width:y.width,height:y.height,style:{width:"100%",height:"100%",background:"transparent"},onMouseDown:K,onMouseMove:Q,onMouseUp:B,onMouseLeave:B})})]}),r("div",{className:"flex bg-gray-300 p-1 border-t border-gray-400",children:r("div",{className:"flex flex-wrap gap-1",children:oe.map(e=>r(h,{variant:"ghost",className:`w-6 h-6 p-0 min-w-0 ${g===e?"ring-1 ring-gray-600":""}`,style:{backgroundColor:e},onClick:()=>D(e)},e))})}),r("div",{className:"bg-gray-300 px-2 py-1 text-xs border-t border-gray-400 text-black",children:"For Help, click Help Topics on the Help Menu."})]})]})}var ce=_(ie),me={render:ce};export{me as default};
